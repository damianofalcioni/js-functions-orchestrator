<html>
<script type="module">
//import { Orchestrator } from 'https://esm.run/js-functions-orchestrator';
//import { Orchestrator } from 'https://unpkg.com/js-functions-orchestrator/index.min.js';
import { Orchestrator } from './index.min.js';

const orchestrator = new Orchestrator({
  functions: {
    //sync or async functions
    echo: echo=>echo
  }
});
orchestrator.addEventListener('state.change', e=>console.log(e));
orchestrator.addEventListener('success', e=>console.log(e));
orchestrator.addEventListener('error', e=>console.log(e));
orchestrator.addEventListener('errors', e=>console.log(e));
orchestrator.addEventListener('errors.fn1', e=>console.log(e));
orchestrator.addEventListener('errors.fn2', e=>console.log(e));
orchestrator.addEventListener('errors.fn3', e=>console.log(e));
orchestrator.addEventListener('results', e=>console.log(e));
orchestrator.addEventListener('results.fn1', e=>console.log(e));
orchestrator.addEventListener('results.fn2', e=>console.log(e));
orchestrator.addEventListener('results.fn3', e=>console.log(e));
const runResult = await orchestrator.run({
  functions: {
    fn1: { ref: 'echo', args: ['Hello']},
    fn2: { ref: 'echo', args: ['World']},
    fn3: { ref: 'echo'}
  },
  connections: [{
    from: ['fn1', 'fn2'],
    transition: '{ "to":[[ $.from[0] & " " & $.from[1] ]] }', //the result of fn1 (the string "Hello") is combined with the the result of fn2 (the string "World") and used as input for fn3
    to: ['fn3']
  }]
});
document.body.innerText = JSON.stringify(runResult);
console.log(runResult);
/* output:
{
  results: { fn3: 'Hello World' },
  variables: { global: {}, locals: [ {} ] }
}
*/
</script>
</html>