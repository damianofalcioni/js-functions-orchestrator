var Ft=Object.create;var At=Object.defineProperty;var Mt=Object.getOwnPropertyDescriptor;var Nt=Object.getOwnPropertyNames;var Ut=Object.getPrototypeOf,jt=Object.prototype.hasOwnProperty;var lt=(ge=>typeof require<"u"?require:typeof Proxy<"u"?new Proxy(ge,{get:(Z,Se)=>(typeof require<"u"?require:Z)[Se]}):ge)(function(ge){if(typeof require<"u")return require.apply(this,arguments);throw Error('Dynamic require of "'+ge+'" is not supported')});var It=(ge,Z)=>()=>(Z||ge((Z={exports:{}}).exports,Z),Z.exports);var Rt=(ge,Z,Se,ie)=>{if(Z&&typeof Z=="object"||typeof Z=="function")for(let he of Nt(Z))!jt.call(ge,he)&&he!==Se&&At(ge,he,{get:()=>Z[he],enumerable:!(ie=Mt(Z,he))||ie.enumerable});return ge};var Lt=(ge,Z,Se)=>(Se=ge!=null?Ft(Ut(ge)):{},Rt(Z||!ge||!ge.__esModule?At(Se,"default",{value:ge,enumerable:!0}):Se,ge));var Tt=It((Et,bt)=>{(function(ge){if(typeof Et=="object"&&typeof bt<"u")bt.exports=ge();else if(typeof define=="function"&&define.amd)define([],ge);else{var Z;typeof window<"u"?Z=window:typeof global<"u"?Z=global:typeof self<"u"?Z=self:Z=this,Z.jsonata=ge()}})(function(){var ge,Z,Se;return(function(){function ie(he,$e,$){function y(W,ee){if(!$e[W]){if(!he[W]){var A=typeof lt=="function"&&lt;if(!ee&&A)return A(W,!0);if(D)return D(W,!0);var v=new Error("Cannot find module '"+W+"'");throw v.code="MODULE_NOT_FOUND",v}var b=$e[W]={exports:{}};he[W][0].call(b.exports,function(x){var B=he[W][1][x];return y(B||x)},b,b.exports,ie,he,$e,$)}return $e[W].exports}for(var D=typeof lt=="function"&&lt,J=0;J<$.length;J++)y($[J]);return y}return ie})()({1:[function(ie,he,$e){let $=ie("./utils"),y=(function(){"use strict";let D=$.stringToArray,J=["Zero","One","Two","Three","Four","Five","Six","Seven","Eight","Nine","Ten","Eleven","Twelve","Thirteen","Fourteen","Fifteen","Sixteen","Seventeen","Eighteen","Nineteen"],W=["Zeroth","First","Second","Third","Fourth","Fifth","Sixth","Seventh","Eighth","Ninth","Tenth","Eleventh","Twelfth","Thirteenth","Fourteenth","Fifteenth","Sixteenth","Seventeenth","Eighteenth","Nineteenth"],ee=["Twenty","Thirty","Forty","Fifty","Sixty","Seventy","Eighty","Ninety","Hundred"],A=["Thousand","Million","Billion","Trillion"];function v(c,p){var l=function(S,E,g){var T="";if(S<=19)T=(E?" and ":"")+(g?W[S]:J[S]);else if(S<100){let te=Math.floor(S/10),re=S%10;T=(E?" and ":"")+ee[te-2],re>0?T+="-"+l(re,!1,g):g&&(T=T.substring(0,T.length-1)+"ieth")}else if(S<1e3){let te=Math.floor(S/100),re=S%100;T=(E?", ":"")+J[te]+" Hundred",re>0?T+=l(re,!0,g):g&&(T+="th")}else{var I=Math.floor(Math.log10(S)/3);I>A.length&&(I=A.length);let te=Math.pow(10,I*3),re=Math.floor(S/te),j=S-re*te;T=(E?", ":"")+l(re,!1,!1)+" "+A[I-1],j>0?T+=l(j,!0,g):g&&(T+="th")}return T},m=l(c,!1,p);return m}let b={};J.forEach(function(c,p){b[c.toLowerCase()]=p}),W.forEach(function(c,p){b[c.toLowerCase()]=p}),ee.forEach(function(c,p){let l=c.toLowerCase();b[l]=(p+2)*10,b[l.substring(0,c.length-1)+"ieth"]=b[l]}),b.hundredth=100,A.forEach(function(c,p){let l=c.toLowerCase(),m=Math.pow(10,(p+1)*3);b[l]=m,b[l+"th"]=m});function x(c){let l=c.split(/,\s|\sand\s|[\s\\-]/).map(E=>b[E]),m=[0];return l.forEach(E=>{if(E<100){let g=m.pop();g>=1e3&&(m.push(g),g=0),m.push(g+E)}else m.push(m.pop()*E)}),m.reduce((E,g)=>E+g,0)}let B=[[1e3,"m"],[900,"cm"],[500,"d"],[400,"cd"],[100,"c"],[90,"xc"],[50,"l"],[40,"xl"],[10,"x"],[9,"ix"],[5,"v"],[4,"iv"],[1,"i"]],ye={M:1e3,D:500,C:100,L:50,X:10,V:5,I:1};function fe(c){for(var p=0;p<B.length;p++){let l=B[p];if(c>=l[0])return l[1]+fe(c-l[0])}return""}function L(c){for(var p=0,l=1,m=c.length-1;m>=0;m--){let S=c[m],E=ye[S];E<l?p-=E:(l=E,p+=E)}return p}function w(c,p){for(var l=[],m=p.charCodeAt(0);c>0;)l.unshift(String.fromCharCode((c-1)%26+m)),c=Math.floor((c-1)/26);return l.join("")}function Y(c,p){for(var l=p.charCodeAt(0),m=0,S=0;S<c.length;S++)m+=(c.charCodeAt(c.length-S-1)-l+1)*Math.pow(26,S);return m}function C(c,p){if(typeof c>"u")return;c=Math.floor(c);let l=oe(p);return M(c,l)}let h={DECIMAL:"decimal",LETTERS:"letters",ROMAN:"roman",WORDS:"words",SEQUENCE:"sequence"},O={UPPER:"upper",LOWER:"lower",TITLE:"title"};function M(c,p){let l,m=c<0;switch(c=Math.abs(c),p.primary){case h.LETTERS:l=w(c,p.case===O.UPPER?"A":"a");break;case h.ROMAN:l=fe(c),p.case===O.UPPER&&(l=l.toUpperCase());break;case h.WORDS:l=v(c,p.ordinal),p.case===O.UPPER?l=l.toUpperCase():p.case===O.LOWER&&(l=l.toLowerCase());break;case h.DECIMAL:l=""+c;var S=p.mandatoryDigits-l.length;if(S>0){var E=new Array(S+1).join("0");l=E+l}if(p.zeroCode!==48&&(l=D(l).map(te=>String.fromCodePoint(te.codePointAt(0)+p.zeroCode-48)).join("")),p.regular){let te=Math.floor((l.length-1)/p.groupingSeparators.position);for(let re=te;re>0;re--){let j=l.length-re*p.groupingSeparators.position;l=l.substr(0,j)+p.groupingSeparators.character+l.substr(j)}}else p.groupingSeparators.reverse().forEach(te=>{let re=l.length-te.position;l=l.substr(0,re)+te.character+l.substr(re)});if(p.ordinal){var g={1:"st",2:"nd",3:"rd"},T=l[l.length-1],I=g[T];(!I||l.length>1&&l[l.length-2]==="1")&&(I="th"),l=l+I}break;case h.SEQUENCE:throw{code:"D3130",value:p.token}}return m&&(l="-"+l),l}let X=[48,1632,1776,1984,2406,2534,2662,2790,2918,3046,3174,3302,3430,3558,3664,3792,3872,4160,4240,6112,6160,6470,6608,6784,6800,6992,7088,7232,7248,42528,43216,43264,43472,43504,43600,44016,65296];function oe(c){let p={type:"integer",primary:h.DECIMAL,case:O.LOWER,ordinal:!1},l,m,S=c.lastIndexOf(";");switch(S===-1?l=c:(l=c.substring(0,S),m=c.substring(S+1),m[0]==="o"&&(p.ordinal=!0)),l){case"A":p.case=O.UPPER;case"a":p.primary=h.LETTERS;break;case"I":p.case=O.UPPER;case"i":p.primary=h.ROMAN;break;case"W":p.case=O.UPPER,p.primary=h.WORDS;break;case"Ww":p.case=O.TITLE,p.primary=h.WORDS;break;case"w":p.primary=h.WORDS;break;default:{let E=null,g=0,T=0,I=[],te=0;if(D(l).map(j=>j.codePointAt(0)).reverse().forEach(j=>{let z=!1;for(let Q=0;Q<X.length;Q++){let U=X[Q];if(j>=U&&j<=U+9){if(z=!0,g++,te++,E===null)E=U;else if(U!==E)throw{code:"D3131"};break}}z||(j===35?(te++,T++):I.push({position:te,character:String.fromCodePoint(j)}))}),g>0){p.primary=h.DECIMAL,p.zeroCode=E,p.mandatoryDigits=g,p.optionalDigits=T;let z=function(Q){if(Q.length===0)return 0;let U=Q[0].character;for(let Oe=1;Oe<Q.length;Oe++)if(Q[Oe].character!==U)return 0;let xe=Q.map(Oe=>Oe.position),Be=function(Oe,Ue){return Ue===0?Oe:Be(Ue,Oe%Ue)},Ne=xe.reduce(Be);for(let Oe=1;Oe<=xe.length;Oe++)if(xe.indexOf(Oe*Ne)===-1)return 0;return Ne}(I);z>0?(p.regular=!0,p.groupingSeparators={position:z,character:I[0].character}):(p.regular=!1,p.groupingSeparators=I)}else p.primary=h.SEQUENCE,p.token=l}}return p}let ce={Y:"1",M:"1",D:"1",d:"1",F:"n",W:"1",w:"1",X:"1",x:"1",H:"1",h:"1",P:"n",m:"01",s:"01",f:"1",Z:"01:01",z:"01:01",C:"n",E:"n"};function le(c){var p=[];let l={type:"datetime",parts:p},m=function(z,Q){if(Q>z){let U=c.substring(z,Q);U=U.split("]]").join("]"),p.push({type:"literal",value:U})}};for(var S=0,E=0;E<c.length;){if(c.charAt(E)==="["){if(c.charAt(E+1)==="["){m(S,E),p.push({type:"literal",value:"["}),E+=2,S=E;continue}if(m(S,E),S=E,E=c.indexOf("]",S),E===-1)throw{code:"D3135"};let z=c.substring(S+1,E);z=z.split(/\s+/).join("");var g={type:"marker",component:z.charAt(0)},T=z.lastIndexOf(","),I;if(T!==-1){let Q=z.substring(T+1),U=Q.indexOf("-"),xe,Be,Ne=function(Ue){if(!(typeof Ue>"u"||Ue==="*"))return parseInt(Ue)};U===-1?xe=Q:(xe=Q.substring(0,U),Be=Q.substring(U+1));let Oe={min:Ne(xe),max:Ne(Be)};g.width=Oe,I=z.substring(1,T)}else I=z.substring(1);if(I.length===1)g.presentation1=I;else if(I.length>1){var te=I.charAt(I.length-1);"atco".indexOf(te)!==-1?(g.presentation2=te,te==="o"&&(g.ordinal=!0),g.presentation1=I.substring(0,I.length-1)):g.presentation1=I}else g.presentation1=ce[g.component];if(typeof g.presentation1>"u")throw{code:"D3132",value:g.component};if(g.presentation1[0]==="n")g.names=O.LOWER;else if(g.presentation1[0]==="N")g.presentation1[1]==="n"?g.names=O.TITLE:g.names=O.UPPER;else if("YMDdFWwXxHhmsf".indexOf(g.component)!==-1){var re=g.presentation1;if(g.presentation2&&(re+=";"+g.presentation2),g.integerFormat=oe(re),g.width&&g.width.min!==void 0&&g.integerFormat.mandatoryDigits<g.width.min&&(g.integerFormat.mandatoryDigits=g.width.min),g.component==="Y")if(g.n=-1,g.width&&g.width.max!==void 0)g.n=g.width.max,g.integerFormat.mandatoryDigits=g.n;else{var j=g.integerFormat.mandatoryDigits+g.integerFormat.optionalDigits;j>=2&&(g.n=j)}let Q=p[p.length-1];Q&&Q.integerFormat&&(Q.integerFormat.parseWidth=Q.integerFormat.mandatoryDigits)}(g.component==="Z"||g.component==="z")&&(g.integerFormat=oe(g.presentation1)),p.push(g),S=E+1}E++}return m(S,E),l}let ne=["","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"],ke=["January","February","March","April","May","June","July","August","September","October","November","December"],ze=1e3*60*60*24,se=function(c){let p=Date.UTC(c.year,c.month);var l=new Date(p).getUTCDay();return l===0&&(l=7),l>4?p+(8-l)*ze:p-(l-1)*ze},H=function(c,p){return{year:c,month:p,nextMonth:function(){return p===11?H(c+1,0):H(c,p+1)},previousMonth:function(){return p===0?H(c-1,11):H(c,p-1)},nextYear:function(){return H(c+1,p)},previousYear:function(){return H(c-1,p)}}},We=function(c,p){return(p-c)/(ze*7)+1},q=(c,p)=>{let l;switch(p){case"Y":l=c.getUTCFullYear();break;case"M":l=c.getUTCMonth()+1;break;case"D":l=c.getUTCDate();break;case"d":{let m=Date.UTC(c.getUTCFullYear(),c.getUTCMonth(),c.getUTCDate()),S=Date.UTC(c.getUTCFullYear(),0);l=(m-S)/ze+1;break}case"F":l=c.getUTCDay(),l===0&&(l=7);break;case"W":{let m=H(c.getUTCFullYear(),0),S=se(m),E=Date.UTC(m.year,c.getUTCMonth(),c.getUTCDate()),g=We(S,E);if(g>52){let T=se(m.nextYear());E>=T&&(g=1)}else if(g<1){let T=se(m.previousYear());g=We(T,E)}l=Math.floor(g);break}case"w":{let m=H(c.getUTCFullYear(),c.getUTCMonth()),S=se(m),E=Date.UTC(m.year,m.month,c.getUTCDate()),g=We(S,E);if(g>4){let T=se(m.nextMonth());E>=T&&(g=1)}else if(g<1){let T=se(m.previousMonth());g=We(T,E)}l=Math.floor(g);break}case"X":{let m=H(c.getUTCFullYear(),0),S=se(m),E=se(m.nextYear()),g=c.getTime();g<S?l=m.year-1:g>=E?l=m.year+1:l=m.year;break}case"x":{let m=H(c.getUTCFullYear(),c.getUTCMonth()),S=se(m),E=m.nextMonth(),g=se(E),T=c.getTime();T<S?l=m.previousMonth().month+1:T>=g?l=E.month+1:l=m.month+1;break}case"H":l=c.getUTCHours();break;case"h":l=c.getUTCHours(),l=l%12,l===0&&(l=12);break;case"P":l=c.getUTCHours()>=12?"pm":"am";break;case"m":l=c.getUTCMinutes();break;case"s":l=c.getUTCSeconds();break;case"f":l=c.getUTCMilliseconds();break;case"Z":case"z":break;case"C":l="ISO";break;case"E":l="ISO";break}return l},Te=null;function Ye(c,p,l){var m=0,S=0;if(typeof l<"u"){let re=parseInt(l);m=Math.floor(re/100),S=re%100}var E=function(re,j){var z=q(re,j.component);if("YMDdFWwXxHhms".indexOf(j.component)!==-1)if(j.component==="Y"&&j.n!==-1&&(z=z%Math.pow(10,j.n)),j.names){if(j.component==="M"||j.component==="x")z=ke[z-1];else if(j.component==="F")z=ne[z];else throw{code:"D3133",value:j.component};j.names===O.UPPER?z=z.toUpperCase():j.names===O.LOWER&&(z=z.toLowerCase()),j.width&&z.length>j.width.max&&(z=z.substring(0,j.width.max))}else z=M(z,j.integerFormat);else if(j.component==="f")z=M(z,j.integerFormat);else if(j.component==="Z"||j.component==="z"){let Q=m*100+S;if(j.integerFormat.regular)z=M(Q,j.integerFormat);else{let U=j.integerFormat.mandatoryDigits;if(U===1||U===2)z=M(m,j.integerFormat),S!==0&&(z+=":"+C(S,"00"));else if(U===3||U===4)z=M(Q,j.integerFormat);else throw{code:"D3134",value:U}}Q>=0&&(z="+"+z),j.component==="z"&&(z="GMT"+z),Q===0&&j.presentation2==="t"&&(z="Z")}else j.component==="P"&&j.names===O.UPPER&&(z=z.toUpperCase());return z};let g;typeof p>"u"?(Te===null&&(Te=le("[Y0001]-[M01]-[D01]T[H01]:[m01]:[s01].[f001][Z01:01t]")),g=Te):g=le(p);let T=(60*m+S)*60*1e3,I=new Date(c+T),te="";return g.parts.forEach(function(re){re.type==="literal"?te+=re.value:te+=E(I,re)}),te}function a(c){var p={};if(c.type==="datetime")p.type="datetime",p.parts=c.parts.map(function(l){var m={};if(l.type==="literal")m.regex=l.value.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");else if(l.component==="Z"||l.component==="z"){let E;Array.isArray(l.integerFormat.groupingSeparators)||(E=l.integerFormat.groupingSeparators),m.regex="",l.component==="z"&&(m.regex="GMT"),m.regex+="[-+][0-9]+",E&&(m.regex+=E.character+"[0-9]+"),m.parse=function(g){l.component==="z"&&(g=g.substring(3));let T=0,I=0;return E?(T=Number.parseInt(g.substring(0,g.indexOf(E.character))),I=Number.parseInt(g.substring(g.indexOf(E.character)+1))):g.length-1<=2?T=Number.parseInt(g):(T=Number.parseInt(g.substring(0,3)),I=Number.parseInt(g.substring(3))),T*60+I}}else if(l.integerFormat)m=a(l.integerFormat);else{m.regex="[a-zA-Z]+";var S={};if(l.component==="M"||l.component==="x")ke.forEach(function(E,g){l.width&&l.width.max?S[E.substring(0,l.width.max)]=g+1:S[E]=g+1});else if(l.component==="F")ne.forEach(function(E,g){g>0&&(l.width&&l.width.max?S[E.substring(0,l.width.max)]=g:S[E]=g)});else if(l.component==="P")S={am:0,AM:0,pm:1,PM:1};else throw{code:"D3133",value:l.component};m.parse=function(E){return S[E]}}return m.component=l.component,m});else{p.type="integer";let l=c.case===O.UPPER;switch(c.primary){case h.LETTERS:p.regex=l?"[A-Z]+":"[a-z]+",p.parse=function(m){return Y(m,l?"A":"a")};break;case h.ROMAN:p.regex=l?"[MDCLXVI]+":"[mdclxvi]+",p.parse=function(m){return L(l?m:m.toUpperCase())};break;case h.WORDS:p.regex="(?:"+Object.keys(b).concat("and","[\\-, ]").join("|")+")+",p.parse=function(m){return x(m.toLowerCase())};break;case h.DECIMAL:p.regex="[0-9]",c.parseWidth?p.regex+=`{${c.parseWidth}}`:p.regex+="+",c.ordinal&&(p.regex+="(?:th|st|nd|rd)"),p.parse=function(m){let S=m;return c.ordinal&&(S=m.substring(0,m.length-2)),c.regular?S=S.split(",").join(""):c.groupingSeparators.forEach(E=>{S=S.split(E.character).join("")}),c.zeroCode!==48&&(S=S.split("").map(E=>String.fromCodePoint(E.codePointAt(0)-c.zeroCode+48)).join("")),parseInt(S)};break;case h.SEQUENCE:throw{code:"D3130",value:c.token}}}return p}function u(c,p){if(typeof c>"u")return;let l=oe(p);return a(l).parse(c)}function F(c,p){let l=le(p),m=a(l),S="^"+m.parts.map(I=>"("+I.regex+")").join("")+"$";var g=new RegExp(S,"i").exec(c);if(g!==null){let U={};for(let pe=1;pe<g.length;pe++){let n=m.parts[pe-1];n.parse&&(U[n.component]=n.parse(g[pe]))}if(Object.getOwnPropertyNames(U).length===0)return;let xe=0,Be=pe=>{xe<<=1,xe+=pe?1:0},Ne=pe=>!(~pe&xe)&&!!(pe&xe);"YXMxWwdD".split("").forEach(pe=>Be(U[pe]));let Ue=!Ne(161)&&Ne(130),Ze=Ne(84),Qe=!Ze&&Ne(72);xe=0,"PHhmsf".split("").forEach(pe=>Be(U[pe]));let Ke=!Ne(23)&&Ne(47),st=(Ue?"YD":Ze?"XxwF":Qe?"XWF":"YMD")+(Ke?"Phmsf":"Hmsf"),Ge=this.environment.timestamp,rt=!1,Ve=!1;if(st.split("").forEach(pe=>{if(typeof U[pe]>"u")rt?(U[pe]="MDd".indexOf(pe)!==-1?1:0,Ve=!0):U[pe]=q(Ge,pe);else if(rt=!0,Ve)throw{code:"D3136"}}),U.M>0?U.M-=1:U.M=0,Ue){let pe=Date.UTC(U.Y,0),n=(U.d-1)*1e3*60*60*24,i=new Date(pe+n);U.M=i.getUTCMonth(),U.D=i.getUTCDate()}if(Ze)throw{code:"D3136"};if(Qe)throw{code:"D3136"};Ke&&(U.H=U.h===12?0:U.h,U.P===1&&(U.H+=12));var T=Date.UTC(U.Y,U.M,U.D,U.H,U.m,U.s,U.f);return(U.Z||U.z)&&(T-=(U.Z||U.z)*60*1e3),T}}var V=new RegExp("^\\d{4}(-[01]\\d)*(-[0-3]\\d)*(T[0-2]\\d:[0-5]\\d:[0-5]\\d)*(\\.\\d+)?([+-][0-2]\\d:?[0-5]\\d|Z)?$");function be(c,p){if(!(typeof c>"u"))if(typeof p>"u"){if(!V.test(c))throw{stack:new Error().stack,code:"D3110",value:c};return Date.parse(c)}else return F.call(this,c,p)}function ue(c,p,l){if(!(typeof c>"u"))return Ye.call(this,c,p,l)}return{formatInteger:C,parseInteger:u,fromMillis:ue,toMillis:be}})();he.exports=y},{"./utils":6}],2:[function(ie,he,$e){(function($){(function(){var y=ie("./utils");let D=(()=>{"use strict";var J=y.isNumeric,W=y.isArrayOfStrings,ee=y.isArrayOfNumbers,A=y.createSequence,v=y.isSequence,b=y.isFunction,x=y.isLambda,B=y.isPromise,ye=y.getFunctionArity,fe=y.isDeepEqual,L=y.stringToArray;function w(e){if(!(typeof e>"u")){var t=0;return e.forEach(function(r){t+=r}),t}}function Y(e){return typeof e>"u"?0:e.length}function C(e){if(!(typeof e>"u"||e.length===0))return Math.max.apply(Math,e)}function h(e){if(!(typeof e>"u"||e.length===0))return Math.min.apply(Math,e)}function O(e){if(!(typeof e>"u"||e.length===0)){var t=0;return e.forEach(function(r){t+=r}),t/e.length}}function M(e,t=!1){if(!(typeof e>"u")){var r;if(typeof e=="string")r=e;else if(b(e))r="";else{if(typeof e=="number"&&!isFinite(e))throw{code:"D3001",value:e,stack:new Error().stack};var f=t?2:0;Array.isArray(e)&&e.outerWrapper&&(e=e[0]),r=JSON.stringify(e,function(s,d){return typeof d<"u"&&d!==null&&d.toPrecision&&J(d)?Number(d.toPrecision(15)):d&&b(d)?"":d},f)}return r}}function X(e,t,r){if(!(typeof e>"u")){var f=L(e),s=f.length;if(s+t<0&&(t=0),typeof r<"u"){if(r<=0)return"";var d=t>=0?t+r:s+t+r;return f.slice(t,d).join("")}return f.slice(t).join("")}}function oe(e,t){if(!(typeof e>"u")){var r=e.indexOf(t);return r>-1?e.substr(0,r):e}}function ce(e,t){if(!(typeof e>"u")){var r=e.indexOf(t);return r>-1?e.substr(r+t.length):e}}function le(e){if(!(typeof e>"u"))return e.toLowerCase()}function ne(e){if(!(typeof e>"u"))return e.toUpperCase()}function ke(e){if(!(typeof e>"u"))return L(e).length}function ze(e){if(!(typeof e>"u")){var t=e.replace(/[ \t\n\r]+/gm," ");return t.charAt(0)===" "&&(t=t.substring(1)),t.charAt(t.length-1)===" "&&(t=t.substring(0,t.length-1)),t}}function se(e,t,r){if(!(typeof e>"u")){(typeof r>"u"||r.length===0)&&(r=" ");var f;t=Math.trunc(t);var s=Math.abs(t)-ke(e);if(s>0){var d=new Array(s+1).join(r);r.length>1&&(d=X(d,0,s)),t>0?f=e+d:f=d+e}else f=e;return f}}async function H(e,t){var r=e.apply(this,[t]);if(B(r)&&(r=await r),r&&!(typeof r.start=="number"||r.end==="number"||Array.isArray(r.groups)||b(r.next)))throw{code:"T1010",stack:new Error().stack};return r}async function We(e,t){if(!(typeof e>"u")){var r;if(typeof t=="string")r=e.indexOf(t)!==-1;else{var f=await H(t,e);r=typeof f<"u"}return r}}async function q(e,t,r){if(!(typeof e>"u")){if(r<0)throw{stack:new Error().stack,value:r,code:"D3040",index:3};var f=A();if(typeof r>"u"||r>0){var s=0,d=await H(t,e);if(typeof d<"u")for(;typeof d<"u"&&(typeof r>"u"||s<r);)f.push({match:d.match,index:d.start,groups:d.groups}),d=await H(d.next),s++}return f}}async function Te(e,t,r,f){if(!(typeof e>"u")){var s=this;if(t==="")throw{code:"D3010",stack:new Error().stack,value:t,index:2};if(f<0)throw{code:"D3011",stack:new Error().stack,value:f,index:4};var d;typeof r=="string"?d=function(de){for(var Ce="",ae=0,Ee=r.indexOf("$",ae);Ee!==-1&&ae<r.length;){Ce+=r.substring(ae,Ee),ae=Ee+1;var Je=r.charAt(ae);if(Je==="$")Ce+="$",ae++;else if(Je==="0")Ce+=de.match,ae++;else{var Fe;if(de.groups.length===0?Fe=1:Fe=Math.floor(Math.log(de.groups.length)*Math.LOG10E)+1,Ee=parseInt(r.substring(ae,ae+Fe),10),Fe>1&&Ee>de.groups.length&&(Ee=parseInt(r.substring(ae,ae+Fe-1),10)),isNaN(Ee))Ce+="$";else{if(de.groups.length>0){var at=de.groups[Ee-1];typeof at<"u"&&(Ce+=at)}ae+=Ee.toString().length}}Ee=r.indexOf("$",ae)}return Ce+=r.substring(ae),Ce}:d=r;var k="",N=0;if(typeof f>"u"||f>0){var R=0;if(typeof t=="string"){for(var ve=e.indexOf(t,N);ve!==-1&&(typeof f>"u"||R<f);)k+=e.substring(N,ve),k+=r,N=ve+t.length,R++,ve=e.indexOf(t,N);k+=e.substring(N)}else{var K=await H(t,e);if(typeof K<"u"){for(;typeof K<"u"&&(typeof f>"u"||R<f);){k+=e.substring(N,K.start);var me=d.apply(s,[K]);if(B(me)&&(me=await me),typeof me=="string")k+=me;else throw{code:"D3012",stack:new Error().stack,value:me};N=K.start+K.match.length,R++,K=await H(K.next)}k+=e.substring(N)}else k=e}}else k=e;return k}}function Ye(e){if(!(typeof e>"u")){var t=typeof window<"u"?window.btoa:function(r){return new $.Buffer.from(r,"binary").toString("base64")};return t(e)}}function a(e){if(!(typeof e>"u")){var t=typeof window<"u"?window.atob:function(r){return new $.Buffer.from(r,"base64").toString("binary")};return t(e)}}function u(e){if(!(typeof e>"u")){var t;try{t=encodeURIComponent(e)}catch{throw{code:"D3140",stack:new Error().stack,value:e,functionName:"encodeUrlComponent"}}return t}}function F(e){if(!(typeof e>"u")){var t;try{t=encodeURI(e)}catch{throw{code:"D3140",stack:new Error().stack,value:e,functionName:"encodeUrl"}}return t}}function V(e){if(!(typeof e>"u")){var t;try{t=decodeURIComponent(e)}catch{throw{code:"D3140",stack:new Error().stack,value:e,functionName:"decodeUrlComponent"}}return t}}function be(e){if(!(typeof e>"u")){var t;try{t=decodeURI(e)}catch{throw{code:"D3140",stack:new Error().stack,value:e,functionName:"decodeUrl"}}return t}}async function ue(e,t,r){if(!(typeof e>"u")){if(r<0)throw{code:"D3020",stack:new Error().stack,value:r,index:3};var f=[];if(typeof r>"u"||r>0)if(typeof t=="string")f=e.split(t,r);else{var s=0,d=await H(t,e);if(typeof d<"u"){for(var k=0;typeof d<"u"&&(typeof r>"u"||s<r);)f.push(e.substring(k,d.start)),k=d.end,d=await H(d.next),s++;(typeof r>"u"||s<r)&&f.push(e.substring(k))}else f.push(e)}return f}}function c(e,t){if(!(typeof e>"u"))return typeof t>"u"&&(t=""),e.join(t)}function p(e,t,r){if(!(typeof e>"u")){var f={"decimal-separator":".","grouping-separator":",","exponent-separator":"e",infinity:"Infinity","minus-sign":"-",NaN:"NaN",percent:"%","per-mille":"\u2030","zero-digit":"0",digit:"#","pattern-separator":";"},s=f;typeof r<"u"&&Object.keys(r).forEach(function(_){s[_]=r[_]});for(var d=[],k=s["zero-digit"].charCodeAt(0),N=k;N<k+10;N++)d.push(String.fromCharCode(N));var R=d.concat([s["decimal-separator"],s["exponent-separator"],s["grouping-separator"],s.digit,s["pattern-separator"]]),ve=t.split(s["pattern-separator"]);if(ve.length>2)throw{code:"D3080",stack:new Error().stack};var K=function(_){var Ae=(function(){for(var Pe,qe=0;qe<_.length;qe++)if(Pe=_.charAt(qe),R.indexOf(Pe)!==-1&&Pe!==s["exponent-separator"])return _.substring(0,qe)})(),Ie=(function(){for(var Pe,qe=_.length-1;qe>=0;qe--)if(Pe=_.charAt(qe),R.indexOf(Pe)!==-1&&Pe!==s["exponent-separator"])return _.substring(qe+1)})(),we=_.substring(Ae.length,_.length-Ie.length),Re,et,Le,nt,_e=_.indexOf(s["exponent-separator"],Ae.length);_e===-1||_e>_.length-Ie.length?(Re=we,et=void 0):(Re=we.substring(0,_e),et=we.substring(_e+1));var He=Re.indexOf(s["decimal-separator"]);return He===-1?(Le=Re,nt=Ie):(Le=Re.substring(0,He),nt=Re.substring(He+1)),{prefix:Ae,suffix:Ie,activePart:we,mantissaPart:Re,exponentPart:et,integerPart:Le,fractionalPart:nt,subpicture:_}},me=function(_){var Ae,Ie,we=_.subpicture,Re=we.indexOf(s["decimal-separator"]);Re!==we.lastIndexOf(s["decimal-separator"])&&(Ae="D3081"),we.indexOf(s.percent)!==we.lastIndexOf(s.percent)&&(Ae="D3082"),we.indexOf(s["per-mille"])!==we.lastIndexOf(s["per-mille"])&&(Ae="D3083"),we.indexOf(s.percent)!==-1&&we.indexOf(s["per-mille"])!==-1&&(Ae="D3084");var et=!1;for(Ie=0;Ie<_.mantissaPart.length;Ie++){var Le=_.mantissaPart.charAt(Ie);if(d.indexOf(Le)!==-1||Le===s.digit){et=!0;break}}et||(Ae="D3085");var nt=_.activePart.split("").map(function(Pe){return R.indexOf(Pe)===-1?"p":"a"}).join("");nt.indexOf("p")!==-1&&(Ae="D3086"),Re!==-1?(we.charAt(Re-1)===s["grouping-separator"]||we.charAt(Re+1)===s["grouping-separator"])&&(Ae="D3087"):_.integerPart.charAt(_.integerPart.length-1)===s["grouping-separator"]&&(Ae="D3088"),we.indexOf(s["grouping-separator"]+s["grouping-separator"])!==-1&&(Ae="D3089");var _e=_.integerPart.indexOf(s.digit);_e!==-1&&_.integerPart.substring(0,_e).split("").filter(function(Pe){return d.indexOf(Pe)>-1}).length>0&&(Ae="D3090"),_e=_.fractionalPart.lastIndexOf(s.digit),_e!==-1&&_.fractionalPart.substring(_e).split("").filter(function(Pe){return d.indexOf(Pe)>-1}).length>0&&(Ae="D3091");var He=typeof _.exponentPart=="string";if(He&&_.exponentPart.length>0&&(we.indexOf(s.percent)!==-1||we.indexOf(s["per-mille"])!==-1)&&(Ae="D3092"),He&&(_.exponentPart.length===0||_.exponentPart.split("").filter(function(Pe){return d.indexOf(Pe)===-1}).length>0)&&(Ae="D3093"),Ae)throw{code:Ae,stack:new Error().stack}},de=function(_){var Ae=function(Me,yt){for(var ct=[],Xe=Me.indexOf(s["grouping-separator"]);Xe!==-1;){var gt=(yt?Me.substring(0,Xe):Me.substring(Xe)).split("").filter(function(ot){return d.indexOf(ot)!==-1||ot===s.digit}).length;ct.push(gt),Xe=_.integerPart.indexOf(s["grouping-separator"],Xe+1)}return ct},Ie=Ae(_.integerPart),we=function(Me){if(Me.length===0)return 0;for(var yt=function(gt,ot){return ot===0?gt:yt(ot,gt%ot)},ct=Me.reduce(yt),Xe=1;Xe<=Me.length;Xe++)if(Me.indexOf(Xe*ct)===-1)return 0;return ct},Re=we(Ie),et=Ae(_.fractionalPart,!0),Le=_.integerPart.split("").filter(function(Me){return d.indexOf(Me)!==-1}).length,nt=Le,_e=_.fractionalPart.split(""),He=_e.filter(function(Me){return d.indexOf(Me)!==-1}).length,Pe=_e.filter(function(Me){return d.indexOf(Me)!==-1||Me===s.digit}).length,qe=typeof _.exponentPart=="string";Le===0&&Pe===0&&(qe?(He=1,Pe=1):Le=1),qe&&Le===0&&_.integerPart.indexOf(s.digit)!==-1&&(Le=1),Le===0&&He===0&&(He=1);var kt=0;return qe&&(kt=_.exponentPart.split("").filter(function(Me){return d.indexOf(Me)!==-1}).length),{integerPartGroupingPositions:Ie,regularGrouping:Re,minimumIntegerPartSize:Le,scalingFactor:nt,prefix:_.prefix,fractionalPartGroupingPositions:et,minimumFactionalPartSize:He,maximumFactionalPartSize:Pe,minimumExponentSize:kt,suffix:_.suffix,picture:_.subpicture}},Ce=ve.map(K);Ce.forEach(me);var ae=Ce.map(de),Ee=s["minus-sign"],Je=s["zero-digit"],Fe=s["decimal-separator"],at=s["grouping-separator"];ae.length===1&&(ae.push(JSON.parse(JSON.stringify(ae[0]))),ae[1].prefix=Ee+ae[1].prefix);var De;e>=0?De=ae[0]:De=ae[1];var ut;De.picture.indexOf(s.percent)!==-1?ut=e*100:De.picture.indexOf(s["per-mille"])!==-1?ut=e*1e3:ut=e;var tt,it;if(De.minimumExponentSize===0)tt=ut;else{var Ot=Math.pow(10,De.scalingFactor),Pt=Math.pow(10,De.scalingFactor-1);for(tt=ut,it=0;tt<Pt;)tt*=10,it-=1;for(;tt>Ot;)tt/=10,it+=1}var xt=T(tt,De.maximumFactionalPartSize),mt=function(_,Ae){var Ie=Math.abs(_).toFixed(Ae);return Je!=="0"&&(Ie=Ie.split("").map(function(we){return we>="0"&&we<="9"?d[we.charCodeAt(0)-48]:we}).join("")),Ie},G=mt(xt,De.maximumFactionalPartSize),je=G.indexOf(".");for(je===-1?G=G+Fe:G=G.replace(".",Fe);G.charAt(0)===Je;)G=G.substring(1);for(;G.charAt(G.length-1)===Je;)G=G.substring(0,G.length-1);je=G.indexOf(Fe);var ft=De.minimumIntegerPartSize-je,wt=De.minimumFactionalPartSize-(G.length-je-1);if(G=(ft>0?new Array(ft+1).join(Je):"")+G,G=G+(wt>0?new Array(wt+1).join(Je):""),je=G.indexOf(Fe),De.regularGrouping>0)for(var Ct=Math.floor((je-1)/De.regularGrouping),pt=1;pt<=Ct;pt++)G=[G.slice(0,je-pt*De.regularGrouping),at,G.slice(je-pt*De.regularGrouping)].join("");else De.integerPartGroupingPositions.forEach(function(_){G=[G.slice(0,je-_),at,G.slice(je-_)].join(""),je++});if(je=G.indexOf(Fe),De.fractionalPartGroupingPositions.forEach(function(_){G=[G.slice(0,_+je+1),at,G.slice(_+je+1)].join("")}),je=G.indexOf(Fe),(De.picture.indexOf(Fe)===-1||je===G.length-1)&&(G=G.substring(0,G.length-1)),typeof it<"u"){var vt=mt(it,0);ft=De.minimumExponentSize-vt.length,ft>0&&(vt=new Array(ft+1).join(Je)+vt),G=G+s["exponent-separator"]+(it<0?Ee:"")+vt}return G=De.prefix+G+De.suffix,G}}function l(e,t){if(!(typeof e>"u")){if(e=T(e),typeof t>"u"?t=10:t=T(t),t<2||t>36)throw{code:"D3100",stack:new Error().stack,value:t};var r=e.toString(t);return r}}function m(e){var t;if(!(typeof e>"u")){if(typeof e=="number")t=e;else if(typeof e=="string"&&/^-?[0-9]+(\.[0-9]+)?([Ee][-+]?[0-9]+)?$/.test(e)&&!isNaN(parseFloat(e))&&isFinite(e))t=parseFloat(e);else if(typeof e=="string"&&/^(0[xX][0-9A-Fa-f]+)|(0[oO][0-7]+)|(0[bB][0-1]+)$/.test(e))t=Number(e);else if(e===!0)t=1;else if(e===!1)t=0;else throw{code:"D3030",value:e,stack:new Error().stack,index:1};return t}}function S(e){var t;if(!(typeof e>"u"))return t=Math.abs(e),t}function E(e){var t;if(!(typeof e>"u"))return t=Math.floor(e),t}function g(e){var t;if(!(typeof e>"u"))return t=Math.ceil(e),t}function T(e,t){var r;if(!(typeof e>"u")){if(t){var f=e.toString().split("e");e=+(f[0]+"e"+(f[1]?+f[1]+t:t))}r=Math.round(e);var s=r-e;return Math.abs(s)===.5&&Math.abs(r%2)===1&&(r=r-1),t&&(f=r.toString().split("e"),r=+(f[0]+"e"+(f[1]?+f[1]-t:-t))),Object.is(r,-0)&&(r=0),r}}function I(e){var t;if(!(typeof e>"u")){if(e<0)throw{stack:new Error().stack,code:"D3060",index:1,value:e};return t=Math.sqrt(e),t}}function te(e,t){var r;if(!(typeof e>"u")){if(r=Math.pow(e,t),!isFinite(r))throw{stack:new Error().stack,code:"D3061",index:1,value:e,exp:t};return r}}function re(){return Math.random()}function j(e){if(!(typeof e>"u")){var t=!1;if(Array.isArray(e)){if(e.length===1)t=j(e[0]);else if(e.length>1){var r=e.filter(function(f){return j(f)});t=r.length>0}}else typeof e=="string"?e.length>0&&(t=!0):J(e)?e!==0&&(t=!0):e!==null&&typeof e=="object"&&!b(e)?Object.keys(e).length>0&&(t=!0):typeof e=="boolean"&&e===!0&&(t=!0);return t}}function z(e){if(!(typeof e>"u"))return!j(e)}function Q(e,t,r,f){var s=[t],d=ye(e);return d>=2&&s.push(r),d>=3&&s.push(f),s}async function U(e,t){if(!(typeof e>"u")){for(var r=A(),f=0;f<e.length;f++){var s=Q(t,e[f],f,e),d=await t.apply(this,s);typeof d<"u"&&r.push(d)}return r}}async function xe(e,t){if(!(typeof e>"u")){for(var r=A(),f=0;f<e.length;f++){var s=e[f],d=Q(t,s,f,e),k=await t.apply(this,d);j(k)&&r.push(s)}return r}}async function Be(e,t){if(!(typeof e>"u")){for(var r=!1,f,s=0;s<e.length;s++){var d=e[s],k=!0;if(typeof t<"u"){var N=Q(t,d,s,e),R=await t.apply(this,N);k=j(R)}if(k)if(!r)f=d,r=!0;else throw{stack:new Error().stack,code:"D3138",index:s}}if(!r)throw{stack:new Error().stack,code:"D3139"};return f}}function Ne(){for(var e=[],t=Array.prototype.slice.call(arguments),r=Math.min.apply(Math,t.map(function(d){return Array.isArray(d)?d.length:0})),f=0;f<r;f++){var s=t.map(d=>d[f]);e.push(s)}return e}async function Oe(e,t,r){if(!(typeof e>"u")){var f,s=ye(t);if(s<2)throw{stack:new Error().stack,code:"D3050",index:1};var d;for(typeof r>"u"&&e.length>0?(f=e[0],d=1):(f=r,d=0);d<e.length;){var k=[f,e[d]];s>=3&&k.push(d),s>=4&&k.push(e),f=await t.apply(this,k),d++}return f}}function Ue(e){var t=A();if(Array.isArray(e)){var r={};e.forEach(function(f){var s=Ue(f);s.forEach(function(d){r[d]=!0})}),t=Ue(r)}else e!==null&&typeof e=="object"&&!b(e)&&Object.keys(e).forEach(f=>t.push(f));return t}function Ze(e,t){var r;if(Array.isArray(e)){r=A();for(var f=0;f<e.length;f++){var s=Ze(e[f],t);typeof s<"u"&&(Array.isArray(s)?s.forEach(d=>r.push(d)):r.push(s))}}else e!==null&&typeof e=="object"&&!b(e)&&(r=e[t]);return r}function Qe(e,t){return typeof e>"u"?t:typeof t>"u"?e:(Array.isArray(e)||(e=A(e)),Array.isArray(t)||(t=[t]),e.concat(t))}function dt(e){return!(typeof e>"u")}function Ke(e){var t=A();if(Array.isArray(e))e.forEach(function(s){t=Qe(t,Ke(s))});else if(e!==null&&typeof e=="object"&&!x(e))for(var r in e){var f={};f[r]=e[r],t.push(f)}else t=e;return t}function P(e){if(!(typeof e>"u")){var t={};return e.forEach(function(r){for(var f in r)t[f]=r[f]}),t}}function ht(e){if(!(typeof e>"u")){if(e.length<=1)return e;for(var t=e.length,r=new Array(t),f=0;f<t;f++)r[t-f-1]=e[f];return r}}async function st(e,t){var r=A();for(var f in e){var s=Q(t,e[f],f,e),d=await t.apply(this,s);typeof d<"u"&&r.push(d)}return r}function Ge(e){throw{code:"D3137",stack:new Error().stack,message:e||"$error() function evaluated"}}function rt(e,t){if(!e)throw{code:"D3141",stack:new Error().stack,message:t||"$assert() statement failed"}}function Ve(e){if(e!==void 0)return e===null?"null":J(e)?"number":typeof e=="string"?"string":typeof e=="boolean"?"boolean":Array.isArray(e)?"array":b(e)?"function":"object"}async function pe(e,t){if(!(typeof e>"u")){if(e.length<=1)return e;var r;if(typeof t>"u"){if(!ee(e)&&!W(e))throw{stack:new Error().stack,code:"D3070",index:1};r=async function(k,N){return k>N}}else r=t;var f=async function(k,N){var R=async function(K,me,de){me.length===0?Array.prototype.push.apply(K,de):de.length===0?Array.prototype.push.apply(K,me):await r(me[0],de[0])?(K.push(de[0]),await R(K,me,de.slice(1))):(K.push(me[0]),await R(K,me.slice(1),de))},ve=[];return await R(ve,k,N),ve},s=async function(k){if(!Array.isArray(k)||k.length<=1)return k;var N=Math.floor(k.length/2),R=k.slice(0,N),ve=k.slice(N);return R=await s(R),ve=await s(ve),await f(R,ve)},d=await s(e);return d}}function n(e){if(!(typeof e>"u")){if(e.length<=1)return e;for(var t=new Array(e.length),r=0;r<e.length;r++){var f=Math.floor(Math.random()*(r+1));r!==f&&(t[r]=t[f]),t[f]=e[r]}return t}}function i(e){if(!(typeof e>"u")){if(!Array.isArray(e)||e.length<=1)return e;for(var t=v(e)?A():[],r=0;r<e.length;r++){for(var f=e[r],s=!1,d=0;d<t.length;d++)if(fe(f,t[d])){s=!0;break}s||t.push(f)}return t}}async function o(e,t){var r={};for(var f in e){var s=e[f],d=Q(t,s,f,e),k=await t.apply(this,d);j(k)&&(r[f]=s)}return Object.keys(r).length===0&&(r=void 0),r}return{sum:w,count:Y,max:C,min:h,average:O,string:M,substring:X,substringBefore:oe,substringAfter:ce,lowercase:le,uppercase:ne,length:ke,trim:ze,pad:se,match:q,contains:We,replace:Te,split:ue,join:c,formatNumber:p,formatBase:l,number:m,floor:E,ceil:g,round:T,abs:S,sqrt:I,power:te,random:re,boolean:j,not:z,map:U,zip:Ne,filter:xe,single:Be,foldLeft:Oe,sift:o,keys:Ue,lookup:Ze,append:Qe,exists:dt,spread:Ke,merge:P,reverse:ht,each:st,error:Ge,assert:rt,type:Ve,sort:pe,shuffle:n,distinct:i,base64encode:Ye,base64decode:a,encodeUrlComponent:u,encodeUrl:F,decodeUrlComponent:V,decodeUrl:be}})();he.exports=D}).call(this)}).call(this,typeof global<"u"?global:typeof self<"u"?self:typeof window<"u"?window:{})},{"./utils":6}],3:[function(ie,he,$e){var $=ie("./datetime"),y=ie("./functions"),D=ie("./utils"),J=ie("./parser"),W=ie("./signature"),ee=(function(){"use strict";var A=D.isNumeric,v=D.isArrayOfStrings,b=D.isArrayOfNumbers,x=D.createSequence,B=D.isSequence,ye=D.isFunction,fe=D.isLambda,L=D.isIterable,w=D.isPromise,Y=D.getFunctionArity,C=D.isDeepEqual,h=Ge(null);async function O(n,i,o){var e,t=o.lookup(Symbol.for("jsonata.__evaluate_entry"));switch(t&&await t(n,i,o),n.type){case"path":e=await M(n,i,o);break;case"binary":e=await ke(n,i,o);break;case"unary":e=await ze(n,i,o);break;case"name":e=se(n,i,o);break;case"string":case"number":case"value":e=H(n,i,o);break;case"wildcard":e=We(n,i,o);break;case"descendant":e=Te(n,i,o);break;case"parent":e=o.lookup(n.slot.label);break;case"condition":e=await E(n,i,o);break;case"block":e=await g(n,i,o);break;case"bind":e=await S(n,i,o);break;case"regex":e=T(n,i,o);break;case"function":e=await Q(n,i,o);break;case"variable":e=I(n,i,o);break;case"lambda":e=Be(n,i,o);break;case"partial":e=await Ne(n,i,o);break;case"apply":e=await z(n,i,o);break;case"transform":e=re(n,i,o);break}if(Object.prototype.hasOwnProperty.call(n,"predicate"))for(var r=0;r<n.predicate.length;r++)e=await ne(n.predicate[r].expr,e,o);n.type!=="path"&&Object.prototype.hasOwnProperty.call(n,"group")&&(e=await p(n.group,e,o));var f=o.lookup(Symbol.for("jsonata.__evaluate_exit"));return f&&await f(n,i,o,e),e&&B(e)&&!e.tupleStream&&(n.keepArray&&(e.keepSingleton=!0),e.length===0?e=void 0:e.length===1&&(e=e.keepSingleton?e:e[0])),e}async function M(n,i,o){var e;Array.isArray(i)&&n.steps[0].type!=="variable"?e=i:e=x(i);for(var t,r=!1,f=void 0,s=0;s<n.steps.length;s++){var d=n.steps[s];if(d.tuple&&(r=!0),s===0&&d.consarray?t=await O(d,e,o):r?f=await le(d,e,f,o):t=await oe(d,e,o,s===n.steps.length-1),!r&&(typeof t>"u"||t.length===0))break;typeof d.focus>"u"&&(e=t)}if(r)if(n.tuple)t=f;else for(t=x(),s=0;s<f.length;s++)t.push(f[s]["@"]);return n.keepSingletonArray&&(Array.isArray(t)&&t.cons&&!t.sequence&&(t=x(t)),t.keepSingleton=!0),n.hasOwnProperty("group")&&(t=await p(n.group,r?f:t,o)),t}function X(n,i){var o=Ge(n);for(let e in i)o.bind(e,i[e]);return o}async function oe(n,i,o,e){var t;if(n.type==="sort")return t=await te(n,i,o),n.stages&&(t=await ce(n.stages,t,o)),t;t=x();for(var r=0;r<i.length;r++){var f=await O(n,i[r],o);if(n.stages)for(var s=0;s<n.stages.length;s++)f=await ne(n.stages[s].expr,f,o);typeof f<"u"&&t.push(f)}var d=x();return e&&t.length===1&&Array.isArray(t[0])&&!B(t[0])?d=t[0]:t.forEach(function(k){!Array.isArray(k)||k.cons?d.push(k):k.forEach(N=>d.push(N))}),d}async function ce(n,i,o){for(var e=i,t=0;t<n.length;t++){var r=n[t];switch(r.type){case"filter":e=await ne(r.expr,e,o);break;case"index":for(var f=0;f<e.length;f++){var s=e[f];s[r.value]=f}break}}return e}async function le(n,i,o,e){var t;if(n.type==="sort"){if(o)t=await te(n,o,e);else{var r=await te(n,i,e);t=x(),t.tupleStream=!0;for(var f=0;f<r.length;f++){var s={"@":r[f]};s[n.index]=f,t.push(s)}}return n.stages&&(t=await ce(n.stages,t,e)),t}t=x(),t.tupleStream=!0;var d=e;o===void 0&&(o=i.map(ve=>({"@":ve})));for(var k=0;k<o.length;k++){d=X(e,o[k]);var N=await O(n,o[k]["@"],d);if(typeof N<"u"){Array.isArray(N)||(N=[N]);for(var R=0;R<N.length;R++)s={},Object.assign(s,o[k]),N.tupleStream?Object.assign(s,N[R]):(n.focus?(s[n.focus]=N[R],s["@"]=o[k]["@"]):s["@"]=N[R],n.index&&(s[n.index]=R),n.ancestor&&(s[n.ancestor.label]=o[k]["@"])),t.push(s)}}return n.stages&&(t=await ce(n.stages,t,e)),t}async function ne(n,i,o){var e=x();if(i&&i.tupleStream&&(e.tupleStream=!0),Array.isArray(i)||(i=x(i)),n.type==="number"){var t=Math.floor(n.value);t<0&&(t=i.length+t);var r=await i[t];typeof r<"u"&&(Array.isArray(r)?e=r:e.push(r))}else for(t=0;t<i.length;t++){var r=i[t],f=r,s=o;i.tupleStream&&(f=r["@"],s=X(o,r));var d=await O(n,f,s);A(d)&&(d=[d]),b(d)?d.forEach(function(N){var R=Math.floor(N);R<0&&(R=i.length+R),R===t&&e.push(r)}):y.boolean(d)&&e.push(r)}return e}async function ke(n,i,o){var e,t=await O(n.lhs,i,o),r=n.value,f=async()=>await O(n.rhs,i,o);if(r==="and"||r==="or")try{return await be(t,f,r)}catch(d){throw d.position=n.position,d.token=r,d}var s=await f();try{switch(r){case"+":case"-":case"*":case"/":case"%":e=a(t,s,r);break;case"=":case"!=":e=u(t,s,r);break;case"<":case"<=":case">":case">=":e=F(t,s,r);break;case"&":e=c(t,s);break;case"..":e=m(t,s);break;case"in":e=V(t,s);break}}catch(d){throw d.position=n.position,d.token=r,d}return e}async function ze(n,i,o){var e;switch(n.value){case"-":if(e=await O(n.expression,i,o),typeof e>"u")e=void 0;else if(A(e))e=-e;else throw{code:"D1002",stack:new Error().stack,position:n.position,token:n.value,value:e};break;case"[":e=[];let f=await Promise.all(n.expressions.map(async(s,d)=>(o.isParallelCall=d>0,[s,await O(s,i,o)])));for(let s of f){var[t,r]=s;typeof r<"u"&&(t.value==="["?e.push(r):e=y.append(e,r))}n.consarray&&Object.defineProperty(e,"cons",{enumerable:!1,configurable:!1,value:!0});break;case"{":e=await p(n,i,o);break}return e}function se(n,i,o){return y.lookup(i,n.value)}function H(n){return n.value}function We(n,i){var o=x();return Array.isArray(i)&&i.outerWrapper&&i.length>0&&(i=i[0]),i!==null&&typeof i=="object"&&Object.keys(i).forEach(function(e){var t=i[e];Array.isArray(t)?(t=q(t),o=y.append(o,t)):o.push(t)}),o}function q(n,i){return typeof i>"u"&&(i=[]),Array.isArray(n)?n.forEach(function(o){q(o,i)}):i.push(n),i}function Te(n,i){var o,e=x();return typeof i<"u"&&(Ye(i,e),e.length===1?o=e[0]:o=e),o}function Ye(n,i){Array.isArray(n)||i.push(n),Array.isArray(n)?n.forEach(function(o){Ye(o,i)}):n!==null&&typeof n=="object"&&Object.keys(n).forEach(function(o){Ye(n[o],i)})}function a(n,i,o){var e;if(typeof n<"u"&&!A(n))throw{code:"T2001",stack:new Error().stack,value:n};if(typeof i<"u"&&!A(i))throw{code:"T2002",stack:new Error().stack,value:i};if(typeof n>"u"||typeof i>"u")return e;switch(o){case"+":e=n+i;break;case"-":e=n-i;break;case"*":e=n*i;break;case"/":e=n/i;break;case"%":e=n%i;break}return e}function u(n,i,o){var e,t=typeof n,r=typeof i;if(t==="undefined"||r==="undefined")return!1;switch(o){case"=":e=C(n,i);break;case"!=":e=!C(n,i);break}return e}function F(n,i,o){var e,t=typeof n,r=typeof i,f=t==="undefined"||t==="string"||t==="number",s=r==="undefined"||r==="string"||r==="number";if(!f||!s)throw{code:"T2010",stack:new Error().stack,value:t==="string"||t==="number"?i:n};if(!(t==="undefined"||r==="undefined")){if(t!==r)throw{code:"T2009",stack:new Error().stack,value:n,value2:i};switch(o){case"<":e=n<i;break;case"<=":e=n<=i;break;case">":e=n>i;break;case">=":e=n>=i;break}return e}}function V(n,i){var o=!1;if(typeof n>"u"||typeof i>"u")return!1;Array.isArray(i)||(i=[i]);for(var e=0;e<i.length;e++)if(i[e]===n){o=!0;break}return o}async function be(n,i,o){var e,t=ue(n);switch(o){case"and":e=t&&ue(await i());break;case"or":e=t||ue(await i());break}return e}function ue(n){var i=y.boolean(n);return typeof i>"u"?!1:i}function c(n,i){var o,e="",t="";return typeof n<"u"&&(e=y.string(n)),typeof i<"u"&&(t=y.string(i)),o=e.concat(t),o}async function p(n,i,o){var e={},t={},r=!!(i&&i.tupleStream);Array.isArray(i)||(i=x(i)),i.length===0&&i.push(void 0);for(var f=0;f<i.length;f++)for(var s=i[f],d=r?X(o,s):o,k=0;k<n.lhs.length;k++){var N=n.lhs[k],R=await O(N[0],r?s["@"]:s,d);if(typeof R!="string"&&R!==void 0)throw{code:"T1003",stack:new Error().stack,position:n.position,value:R};if(R!==void 0){var ve={data:s,exprIndex:k};if(t.hasOwnProperty(R)){if(t[R].exprIndex!==k)throw{code:"D1009",stack:new Error().stack,position:n.position,value:R};t[R].data=y.append(t[R].data,s)}else t[R]=ve}}let K=await Promise.all(Object.keys(t).map(async(de,Ce)=>{let ae=t[de];var Ee=ae.data,Je=o;if(r){var Fe=l(ae.data);Ee=Fe["@"],delete Fe["@"],Je=X(o,Fe)}return o.isParallelCall=Ce>0,[de,await O(n.lhs[ae.exprIndex][1],Ee,Je)]}));for(let de of K){var[R,me]=await de;typeof me<"u"&&(e[R]=me)}return e}function l(n){if(!Array.isArray(n))return n;var i={};Object.assign(i,n[0]);for(var o=1;o<n.length;o++)for(let e in n[o])i[e]=y.append(i[e],n[o][e]);return i}function m(n,i){var o;if(typeof n<"u"&&!Number.isInteger(n))throw{code:"T2003",stack:new Error().stack,value:n};if(typeof i<"u"&&!Number.isInteger(i))throw{code:"T2004",stack:new Error().stack,value:i};if(typeof n>"u"||typeof i>"u"||n>i)return o;var e=i-n+1;if(e>1e7)throw{code:"D2014",stack:new Error().stack,value:e};o=new Array(e);for(var t=n,r=0;t<=i;t++,r++)o[r]=t;return o.sequence=!0,o}async function S(n,i,o){var e=await O(n.rhs,i,o);return o.bind(n.lhs.value,e),e}async function E(n,i,o){var e,t=await O(n.condition,i,o);return y.boolean(t)?e=await O(n.then,i,o):typeof n.else<"u"&&(e=await O(n.else,i,o)),e}async function g(n,i,o){for(var e,t=Ge(o),r=0;r<n.expressions.length;r++)e=await O(n.expressions[r],i,t);return e}function T(n){var i=new pe.RegexEngine(n.value),o=function(e,t){var r;i.lastIndex=t||0;var f=i.exec(e);if(f!==null){if(r={match:f[0],start:f.index,end:f.index+f[0].length,groups:[]},f.length>1)for(var s=1;s<f.length;s++)r.groups.push(f[s]);r.next=function(){if(!(i.lastIndex>=e.length)){var d=o(e,i.lastIndex);if(d&&d.match==="")throw{code:"D1004",stack:new Error().stack,position:n.position,value:n.value.source};return d}}}return r};return o}function I(n,i,o){var e;return n.value===""?e=i&&i.outerWrapper?i[0]:i:e=o.lookup(n.value),e}async function te(n,i,o){var e,t=i,r=!!i.tupleStream,f=async function(d,k){for(var N=0,R=0;N===0&&R<n.terms.length;R++){var ve=n.terms[R],K=d,me=o;r&&(K=d["@"],me=X(o,d));var de=await O(ve.expression,K,me);K=k,me=o,r&&(K=k["@"],me=X(o,k));var Ce=await O(ve.expression,K,me),ae=typeof de,Ee=typeof Ce;if(ae==="undefined"){N=Ee==="undefined"?0:1;continue}if(Ee==="undefined"){N=-1;continue}if(!(ae==="string"||ae==="number")||!(Ee==="string"||Ee==="number"))throw{code:"T2008",stack:new Error().stack,position:n.position,value:ae==="string"||ae==="number"?Ce:de};if(ae!==Ee)throw{code:"T2007",stack:new Error().stack,position:n.position,value:de,value2:Ce};de!==Ce&&(de<Ce?N=-1:N=1,ve.descending===!0&&(N=-N))}return N===1},s={environment:o,input:i};return e=await y.sort.apply(s,[t,f]),e}function re(n,i,o){var e=async function(t){if(!(typeof t>"u")){var r=o.lookup("clone");if(!ye(r))throw{code:"T2013",stack:new Error().stack,position:n.position};var f=await U(r,[t],null,o),s=await O(n.pattern,f,o);if(typeof s<"u"){Array.isArray(s)||(s=[s]);for(var d=0;d<s.length;d++){var k=s[d];if(k&&(k.isPrototypeOf(f)||k instanceof Object.constructor))throw{code:"D1010",stack:new Error().stack,position:n.position};var N=await O(n.update,k,o),R=typeof N;if(R!=="undefined"){if(R!=="object"||N===null||Array.isArray(N))throw{code:"T2011",stack:new Error().stack,position:n.update.position,value:N};for(var ve in N)k[ve]=N[ve]}if(typeof n.delete<"u"){var K=await O(n.delete,k,o);if(typeof K<"u"){var me=K;if(Array.isArray(K)||(K=[K]),!v(K))throw{code:"T2012",stack:new Error().stack,position:n.delete.position,value:me};for(var de=0;de<K.length;de++)typeof k=="object"&&k!==null&&delete k[K[de]]}}}}return f}};return P(e,"<(oa):o>")}var j=J("function($f, $g) { function($x){ $g($f($x)) } }");async function z(n,i,o){var e,t=await O(n.lhs,i,o);if(n.rhs.type==="function")e=await Q(n.rhs,i,o,{context:t});else{var r=await O(n.rhs,i,o);if(!ye(r))throw{code:"T2006",stack:new Error().stack,position:n.position,value:r};if(ye(t)){var f=await O(j,null,o);e=await U(f,[t,r],null,o)}else e=await U(r,[t],null,o)}return e}async function Q(n,i,o,e){var t,r=await O(n.procedure,i,o);if(typeof r>"u"&&n.procedure.type==="path"&&o.lookup(n.procedure.steps[0].value))throw{code:"T1005",stack:new Error().stack,position:n.position,token:n.procedure.steps[0].value};var f=[];typeof e<"u"&&f.push(e.context);for(var s=0;s<n.arguments.length;s++){let k=await O(n.arguments[s],i,o);if(ye(k)){let N=async function(...R){return await U(k,R,null,o)};N.arity=Y(k),f.push(N)}else f.push(k)}var d=n.procedure.type==="path"?n.procedure.steps[0].value:n.procedure.value;try{typeof r=="object"&&(r.token=d,r.position=n.position),t=await U(r,f,i,o)}catch(k){throw k.position||(k.position=n.position),k.token||(k.token=d),k}return t}async function U(n,i,o,e){var t;for(t=await xe(n,i,o,e);fe(t)&&t.thunk===!0;){var r=await O(t.body.procedure,t.input,t.environment);t.body.procedure.type==="variable"&&(r.token=t.body.procedure.value),r.position=t.body.procedure.position;for(var f=[],s=0;s<t.body.arguments.length;s++)f.push(await O(t.body.arguments[s],t.input,t.environment));t=await xe(r,f,o,e)}return t}async function xe(n,i,o,e){var t;try{var r=i;if(n&&(r=Oe(n.signature,i,o)),fe(n))t=await Ue(n,r);else if(n&&n._jsonata_function===!0){var f={environment:e,input:o};t=n.implementation.apply(f,r),L(t)&&(t=t.next().value),w(t)&&(t=await t)}else if(typeof n=="function")t=n.apply(o,r),w(t)&&(t=await t);else throw{code:"T1006",stack:new Error().stack}}catch(s){throw n&&(typeof s.token>"u"&&typeof n.token<"u"&&(s.token=n.token),s.position=n.position||s.position),s}return t}function Be(n,i,o){var e={_jsonata_lambda:!0,input:i,environment:o,arguments:n.arguments,signature:n.signature,body:n.body};return n.thunk===!0&&(e.thunk=!0),e.apply=async function(t,r){return await U(e,r,i,t?t.environment:o)},e}async function Ne(n,i,o){for(var e,t=[],r=0;r<n.arguments.length;r++){var f=n.arguments[r];f.type==="operator"&&f.value==="?"?t.push(f):t.push(await O(f,i,o))}var s=await O(n.procedure,i,o);if(typeof s>"u"&&n.procedure.type==="path"&&o.lookup(n.procedure.steps[0].value))throw{code:"T1007",stack:new Error().stack,position:n.position,token:n.procedure.steps[0].value};if(fe(s))e=Ze(s,t);else if(s&&s._jsonata_function===!0)e=Qe(s.implementation,t);else if(typeof s=="function")e=Qe(s,t);else throw{code:"T1008",stack:new Error().stack,position:n.position,token:n.procedure.type==="path"?n.procedure.steps[0].value:n.procedure.value};return e}function Oe(n,i,o){if(typeof n>"u")return i;var e=n.validate(i,o);return e}async function Ue(n,i){var o,e=Ge(n.environment);return n.arguments.forEach(function(t,r){e.bind(t.value,i[r])}),typeof n.body=="function"?o=await dt(n.body,e):o=await O(n.body,n.input,e),o}function Ze(n,i){var o=Ge(n.environment),e=[];n.arguments.forEach(function(r,f){var s=i[f];s&&s.type==="operator"&&s.value==="?"?e.push(r):o.bind(r.value,s)});var t={_jsonata_lambda:!0,input:n.input,environment:o,arguments:e,body:n.body};return t}function Qe(n,i){var o=Ke(n);o=o.map(function(f){return"$"+f.trim()});var e="function("+o.join(", ")+"){ _ }",t=J(e);t.body=n;var r=Ze(t,i);return r}async function dt(n,i){var o=Ke(n),e=o.map(function(f){return i.lookup(f.trim())}),t={environment:i},r=n.apply(t,e);return w(r)&&(r=await r),r}function Ke(n){var i=n.toString(),o=/\(([^)]*)\)/.exec(i)[1],e=o.split(",");return e}function P(n,i){var o={_jsonata_function:!0,implementation:n};return typeof i<"u"&&(o.signature=W(i)),o}async function ht(n,i){if(!(typeof n>"u")){var o=this.input;typeof i<"u"&&(o=i,Array.isArray(o)&&!B(o)&&(o=x(o),o.outerWrapper=!0));try{var e=J(n,!1)}catch(r){throw Ve(r),{stack:new Error().stack,code:"D3120",value:r.message,error:r}}try{var t=await O(e,o,this.environment)}catch(r){throw Ve(r),{stack:new Error().stack,code:"D3121",value:r.message,error:r}}return t}}function st(n){if(!(typeof n>"u"))return JSON.parse(y.string(n))}function Ge(n){var i={};let o={bind:function(t,r){i[t]=r},lookup:function(t){var r;return i.hasOwnProperty(t)?r=i[t]:n&&(r=n.lookup(t)),r},timestamp:n?n.timestamp:null,async:n?n.async:!1,isParallelCall:n?n.isParallelCall:!1,global:n?n.global:{ancestry:[null]}};if(n){var e=n.lookup(Symbol.for("jsonata.__createFrame_push"));e&&e(n,o)}return o}h.bind("sum",P(y.sum,"<a<n>:n>")),h.bind("count",P(y.count,"<a:n>")),h.bind("max",P(y.max,"<a<n>:n>")),h.bind("min",P(y.min,"<a<n>:n>")),h.bind("average",P(y.average,"<a<n>:n>")),h.bind("string",P(y.string,"<x-b?:s>")),h.bind("substring",P(y.substring,"<s-nn?:s>")),h.bind("substringBefore",P(y.substringBefore,"<s-s:s>")),h.bind("substringAfter",P(y.substringAfter,"<s-s:s>")),h.bind("lowercase",P(y.lowercase,"<s-:s>")),h.bind("uppercase",P(y.uppercase,"<s-:s>")),h.bind("length",P(y.length,"<s-:n>")),h.bind("trim",P(y.trim,"<s-:s>")),h.bind("pad",P(y.pad,"<s-ns?:s>")),h.bind("match",P(y.match,"<s-f<s:o>n?:a<o>>")),h.bind("contains",P(y.contains,"<s-(sf):b>")),h.bind("replace",P(y.replace,"<s-(sf)(sf)n?:s>")),h.bind("split",P(y.split,"<s-(sf)n?:a<s>>")),h.bind("join",P(y.join,"<a<s>s?:s>")),h.bind("formatNumber",P(y.formatNumber,"<n-so?:s>")),h.bind("formatBase",P(y.formatBase,"<n-n?:s>")),h.bind("formatInteger",P($.formatInteger,"<n-s:s>")),h.bind("parseInteger",P($.parseInteger,"<s-s:n>")),h.bind("number",P(y.number,"<(nsb)-:n>")),h.bind("floor",P(y.floor,"<n-:n>")),h.bind("ceil",P(y.ceil,"<n-:n>")),h.bind("round",P(y.round,"<n-n?:n>")),h.bind("abs",P(y.abs,"<n-:n>")),h.bind("sqrt",P(y.sqrt,"<n-:n>")),h.bind("power",P(y.power,"<n-n:n>")),h.bind("random",P(y.random,"<:n>")),h.bind("boolean",P(y.boolean,"<x-:b>")),h.bind("not",P(y.not,"<x-:b>")),h.bind("map",P(y.map,"<af>")),h.bind("zip",P(y.zip,"<a+>")),h.bind("filter",P(y.filter,"<af>")),h.bind("single",P(y.single,"<af?>")),h.bind("reduce",P(y.foldLeft,"<afj?:j>")),h.bind("sift",P(y.sift,"<o-f?:o>")),h.bind("keys",P(y.keys,"<x-:a<s>>")),h.bind("lookup",P(y.lookup,"<x-s:x>")),h.bind("append",P(y.append,"<xx:a>")),h.bind("exists",P(y.exists,"<x:b>")),h.bind("spread",P(y.spread,"<x-:a<o>>")),h.bind("merge",P(y.merge,"<a<o>:o>")),h.bind("reverse",P(y.reverse,"<a:a>")),h.bind("each",P(y.each,"<o-f:a>")),h.bind("error",P(y.error,"<s?:x>")),h.bind("assert",P(y.assert,"<bs?:x>")),h.bind("type",P(y.type,"<x:s>")),h.bind("sort",P(y.sort,"<af?:a>")),h.bind("shuffle",P(y.shuffle,"<a:a>")),h.bind("distinct",P(y.distinct,"<x:x>")),h.bind("base64encode",P(y.base64encode,"<s-:s>")),h.bind("base64decode",P(y.base64decode,"<s-:s>")),h.bind("encodeUrlComponent",P(y.encodeUrlComponent,"<s-:s>")),h.bind("encodeUrl",P(y.encodeUrl,"<s-:s>")),h.bind("decodeUrlComponent",P(y.decodeUrlComponent,"<s-:s>")),h.bind("decodeUrl",P(y.decodeUrl,"<s-:s>")),h.bind("eval",P(ht,"<sx?:x>")),h.bind("toMillis",P($.toMillis,"<s-s?:n>")),h.bind("fromMillis",P($.fromMillis,"<n-s?s?:s>")),h.bind("clone",P(st,"<(oa)-:o>"));var rt={S0101:"String literal must be terminated by a matching quote",S0102:"Number out of range: {{token}}",S0103:"Unsupported escape sequence: \\{{token}}",S0104:"The escape sequence \\u must be followed by 4 hex digits",S0105:"Quoted property name must be terminated with a backquote (`)",S0106:"Comment has no closing tag",S0201:"Syntax error: {{token}}",S0202:"Expected {{value}}, got {{token}}",S0203:"Expected {{value}} before end of expression",S0204:"Unknown operator: {{token}}",S0205:"Unexpected token: {{token}}",S0206:"Unknown expression type: {{token}}",S0207:"Unexpected end of expression",S0208:"Parameter {{value}} of function definition must be a variable name (start with $)",S0209:"A predicate cannot follow a grouping expression in a step",S0210:"Each step can only have one grouping expression",S0211:"The symbol {{token}} cannot be used as a unary operator",S0212:"The left side of := must be a variable name (start with $)",S0213:"The literal value {{value}} cannot be used as a step within a path expression",S0214:"The right side of {{token}} must be a variable name (start with $)",S0215:"A context variable binding must precede any predicates on a step",S0216:"A context variable binding must precede the 'order-by' clause on a step",S0217:"The object representing the 'parent' cannot be derived from this expression",S0301:"Empty regular expressions are not allowed",S0302:"No terminating / in regular expression",S0402:"Choice groups containing parameterized types are not supported",S0401:"Type parameters can only be applied to functions and arrays",S0500:"Attempted to evaluate an expression containing syntax error(s)",T0410:"Argument {{index}} of function {{token}} does not match function signature",T0411:"Context value is not a compatible type with argument {{index}} of function {{token}}",T0412:"Argument {{index}} of function {{token}} must be an array of {{type}}",D1001:"Number out of range: {{value}}",D1002:"Cannot negate a non-numeric value: {{value}}",T1003:"Key in object structure must evaluate to a string; got: {{value}}",D1004:"Regular expression matches zero length string",T1005:"Attempted to invoke a non-function. Did you mean ${{{token}}}?",T1006:"Attempted to invoke a non-function",T1007:"Attempted to partially apply a non-function. Did you mean ${{{token}}}?",T1008:"Attempted to partially apply a non-function",D1009:"Multiple key definitions evaluate to same key: {{value}}",D1010:"Attempted to access the Javascript object prototype",T1010:"The matcher function argument passed to function {{token}} does not return the correct object structure",T2001:"The left side of the {{token}} operator must evaluate to a number",T2002:"The right side of the {{token}} operator must evaluate to a number",T2003:"The left side of the range operator (..) must evaluate to an integer",T2004:"The right side of the range operator (..) must evaluate to an integer",D2005:"The left side of := must be a variable name (start with $)",T2006:"The right side of the function application operator ~> must be a function",T2007:"Type mismatch when comparing values {{value}} and {{value2}} in order-by clause",T2008:"The expressions within an order-by clause must evaluate to numeric or string values",T2009:"The values {{value}} and {{value2}} either side of operator {{token}} must be of the same data type",T2010:"The expressions either side of operator {{token}} must evaluate to numeric or string values",T2011:"The insert/update clause of the transform expression must evaluate to an object: {{value}}",T2012:"The delete clause of the transform expression must evaluate to a string or array of strings: {{value}}",T2013:"The transform expression clones the input object using the $clone() function.  This has been overridden in the current scope by a non-function.",D2014:"The size of the sequence allocated by the range operator (..) must not exceed 1e6.  Attempted to allocate {{value}}.",D3001:"Attempting to invoke string function on Infinity or NaN",D3010:"Second argument of replace function cannot be an empty string",D3011:"Fourth argument of replace function must evaluate to a positive number",D3012:"Attempted to replace a matched string with a non-string value",D3020:"Third argument of split function must evaluate to a positive number",D3030:"Unable to cast value to a number: {{value}}",D3040:"Third argument of match function must evaluate to a positive number",D3050:"The second argument of reduce function must be a function with at least two arguments",D3060:"The sqrt function cannot be applied to a negative number: {{value}}",D3061:"The power function has resulted in a value that cannot be represented as a JSON number: base={{value}}, exponent={{exp}}",D3070:"The single argument form of the sort function can only be applied to an array of strings or an array of numbers.  Use the second argument to specify a comparison function",D3080:"The picture string must only contain a maximum of two sub-pictures",D3081:"The sub-picture must not contain more than one instance of the 'decimal-separator' character",D3082:"The sub-picture must not contain more than one instance of the 'percent' character",D3083:"The sub-picture must not contain more than one instance of the 'per-mille' character",D3084:"The sub-picture must not contain both a 'percent' and a 'per-mille' character",D3085:"The mantissa part of a sub-picture must contain at least one character that is either an 'optional digit character' or a member of the 'decimal digit family'",D3086:"The sub-picture must not contain a passive character that is preceded by an active character and that is followed by another active character",D3087:"The sub-picture must not contain a 'grouping-separator' character that appears adjacent to a 'decimal-separator' character",D3088:"The sub-picture must not contain a 'grouping-separator' at the end of the integer part",D3089:"The sub-picture must not contain two adjacent instances of the 'grouping-separator' character",D3090:"The integer part of the sub-picture must not contain a member of the 'decimal digit family' that is followed by an instance of the 'optional digit character'",D3091:"The fractional part of the sub-picture must not contain an instance of the 'optional digit character' that is followed by a member of the 'decimal digit family'",D3092:"A sub-picture that contains a 'percent' or 'per-mille' character must not contain a character treated as an 'exponent-separator'",D3093:"The exponent part of the sub-picture must comprise only of one or more characters that are members of the 'decimal digit family'",D3100:"The radix of the formatBase function must be between 2 and 36.  It was given {{value}}",D3110:"The argument of the toMillis function must be an ISO 8601 formatted timestamp. Given {{value}}",D3120:"Syntax error in expression passed to function eval: {{value}}",D3121:"Dynamic error evaluating the expression passed to function eval: {{value}}",D3130:"Formatting or parsing an integer as a sequence starting with {{value}} is not supported by this implementation",D3131:"In a decimal digit pattern, all digits must be from the same decimal group",D3132:"Unknown component specifier {{value}} in date/time picture string",D3133:"The 'name' modifier can only be applied to months and days in the date/time picture string, not {{value}}",D3134:"The timezone integer format specifier cannot have more than four digits",D3135:"No matching closing bracket ']' in date/time picture string",D3136:"The date/time picture string is missing specifiers required to parse the timestamp",D3137:"{{{message}}}",D3138:"The $single() function expected exactly 1 matching result.  Instead it matched more.",D3139:"The $single() function expected exactly 1 matching result.  Instead it matched 0.",D3140:"Malformed URL passed to ${{{functionName}}}(): {{value}}",D3141:"{{{message}}}"};function Ve(n){var i=rt[n.code];if(typeof i<"u"){var o=i.replace(/\{\{\{([^}]+)}}}/g,function(){return n[arguments[1]]});o=o.replace(/\{\{([^}]+)}}/g,function(){return JSON.stringify(n[arguments[1]])}),n.message=o}}function pe(n,i){var o,e;try{o=J(n,i&&i.recover),e=o.errors,delete o.errors}catch(f){throw Ve(f),f}var t=Ge(h),r=new Date;return t.bind("now",P(function(f,s){return $.fromMillis(r.getTime(),f,s)},"<s?s?:s>")),t.bind("millis",P(function(){return r.getTime()},"<:n>")),i&&i.RegexEngine?pe.RegexEngine=i.RegexEngine:pe.RegexEngine=RegExp,{evaluate:async function(f,s,d){if(typeof e<"u"){var k={code:"S0500",position:0};throw Ve(k),k}if(typeof s<"u"){var N;N=Ge(t);for(var R in s)N.bind(R,s[R])}else N=t;N.bind("$",f),r=new Date,N.timestamp=r,Array.isArray(f)&&!B(f)&&(f=x(f),f.outerWrapper=!0);var ve;try{return ve=await O(o,f,N),typeof d=="function"&&d(null,ve),ve}catch(K){throw Ve(K),K}},assign:function(f,s){t.bind(f,s)},registerFunction:function(f,s,d){var k=P(s,d);t.bind(f,k)},ast:function(){return o},errors:function(){return e}}}return pe.parser=J,pe})();he.exports=ee},{"./datetime":1,"./functions":2,"./parser":4,"./signature":5,"./utils":6}],4:[function(ie,he,$e){var $=ie("./signature");let y=(()=>{"use strict";var D={".":75,"[":80,"]":0,"{":70,"}":0,"(":80,")":0,",":0,"@":80,"#":80,";":80,":":80,"?":20,"+":50,"-":50,"*":60,"/":60,"%":60,"|":20,"=":40,"<":40,">":40,"^":40,"**":60,"..":20,":=":10,"!=":40,"<=":40,">=":40,"~>":40,"?:":40,"??":40,and:30,or:25,in:40,"&":50,"!":0,"~":0},J={'"':'"',"\\":"\\","/":"/",b:"\b",f:"\f",n:`
`,r:"\r",t:"	"},W=function(A){var v=0,b=A.length,x=function(fe,L){var w={type:fe,value:L,position:v};return w},B=function(){for(var fe=v,L=0,w,Y,C=function(O){if(A.charAt(O)==="/"&&L===0){for(var M=0;A.charAt(O-(M+1))==="\\";)M++;if(M%2===0)return!0}return!1};v<b;){var h=A.charAt(v);if(C(v)){if(w=A.substring(fe,v),w==="")throw{code:"S0301",stack:new Error().stack,position:v};for(v++,h=A.charAt(v),fe=v;h==="i"||h==="m";)v++,h=A.charAt(v);return Y=A.substring(fe,v)+"g",new RegExp(w,Y)}(h==="("||h==="["||h==="{")&&A.charAt(v-1)!=="\\"&&L++,(h===")"||h==="]"||h==="}")&&A.charAt(v-1)!=="\\"&&L--,v++}throw{code:"S0302",stack:new Error().stack,position:v}},ye=function(fe){if(v>=b)return null;for(var L=A.charAt(v);v<b&&` 	
\r\v`.indexOf(L)>-1;)v++,L=A.charAt(v);if(L==="/"&&A.charAt(v+1)==="*"){var w=v;for(v+=2,L=A.charAt(v);!(L==="*"&&A.charAt(v+1)==="/");)if(L=A.charAt(++v),v>=b)throw{code:"S0106",stack:new Error().stack,position:w};return v+=2,L=A.charAt(v),ye(fe)}if(fe!==!0&&L==="/")return v++,x("regex",B());if(L==="."&&A.charAt(v+1)===".")return v+=2,x("operator","..");if(L===":"&&A.charAt(v+1)==="=")return v+=2,x("operator",":=");if(L==="!"&&A.charAt(v+1)==="=")return v+=2,x("operator","!=");if(L===">"&&A.charAt(v+1)==="=")return v+=2,x("operator",">=");if(L==="<"&&A.charAt(v+1)==="=")return v+=2,x("operator","<=");if(L==="*"&&A.charAt(v+1)==="*")return v+=2,x("operator","**");if(L==="~"&&A.charAt(v+1)===">")return v+=2,x("operator","~>");if(L==="?"&&A.charAt(v+1)===":")return v+=2,x("operator","?:");if(L==="?"&&A.charAt(v+1)==="?")return v+=2,x("operator","??");if(Object.prototype.hasOwnProperty.call(D,L))return v++,x("operator",L);if(L==='"'||L==="'"){var Y=L;v++;for(var C="";v<b;){if(L=A.charAt(v),L==="\\")if(v++,L=A.charAt(v),Object.prototype.hasOwnProperty.call(J,L))C+=J[L];else if(L==="u"){var h=A.substr(v+1,4);if(/^[0-9a-fA-F]+$/.test(h)){var O=parseInt(h,16);C+=String.fromCharCode(O),v+=4}else throw{code:"S0104",stack:new Error().stack,position:v}}else throw{code:"S0103",stack:new Error().stack,position:v,token:L};else{if(L===Y)return v++,x("string",C);C+=L}v++}throw{code:"S0101",stack:new Error().stack,position:v}}var M=/^-?(0|([1-9][0-9]*))(\.[0-9]+)?([Ee][-+]?[0-9]+)?/,X=M.exec(A.substring(v));if(X!==null){var oe=parseFloat(X[0]);if(!isNaN(oe)&&isFinite(oe))return v+=X[0].length,x("number",oe);throw{code:"S0102",stack:new Error().stack,position:v,token:X[0]}}var ce;if(L==="`"){v++;var le=A.indexOf("`",v);if(le!==-1)return ce=A.substring(v,le),v=le+1,x("name",ce);throw v=b,{code:"S0105",stack:new Error().stack,position:v}}for(var ne=v,ke;;)if(ke=A.charAt(ne),ne===b||` 	
\r\v`.indexOf(ke)>-1||Object.prototype.hasOwnProperty.call(D,ke)){if(A.charAt(v)==="$")return ce=A.substring(v+1,ne),v=ne,x("variable",ce);switch(ce=A.substring(v,ne),v=ne,ce){case"or":case"in":case"and":return x("operator",ce);case"true":return x("value",!0);case"false":return x("value",!1);case"null":return x("value",null);default:return v===b&&ce===""?null:x("name",ce)}}else ne++};return ye},ee=function(A,v){var b,x,B={},ye=[],fe=function(){var a=[];b.id!=="(end)"&&a.push({type:b.type,value:b.value,position:b.position});for(var u=x();u!==null;)a.push(u),u=x();return a},L={nud:function(){var a={code:"S0211",token:this.value,position:this.position};if(v)return a.remaining=fe(),a.type="error",ye.push(a),a;throw a.stack=new Error().stack,a}},w=function(a,u){var F=B[a];return u=u||0,F?u>=F.lbp&&(F.lbp=u):(F=Object.create(L),F.id=F.value=a,F.lbp=u,B[a]=F),F},Y=function(a){if(v){a.remaining=fe(),ye.push(a);var u=B["(error)"];return b=Object.create(u),b.error=a,b.type="(error)",b}else throw a.stack=new Error().stack,a},C=function(a,u){if(a&&b.id!==a){var F;b.id==="(end)"?F="S0203":F="S0202";var V={code:F,position:b.position,token:b.value,value:a};return Y(V)}var be=x(u);if(be===null)return b=B["(end)"],b.position=A.length,b;var ue=be.value,c=be.type,p;switch(c){case"name":case"variable":p=B["(name)"];break;case"operator":if(p=B[ue],!p)return Y({code:"S0204",stack:new Error().stack,position:be.position,token:ue});break;case"string":case"number":case"value":p=B["(literal)"];break;case"regex":c="regex",p=B["(regex)"];break;default:return Y({code:"S0205",stack:new Error().stack,position:be.position,token:ue})}return b=Object.create(p),b.value=ue,b.type=c,b.position=be.position,b},h=function(a){var u,F=b;for(C(null,!0),u=F.nud();a<b.lbp;)F=b,C(),u=F.led(u);return u},O=function(a){var u=w(a,0);u.nud=function(){return this}},M=function(a,u,F){var V=u||D[a],be=w(a,V);return be.led=F||function(ue){return this.lhs=ue,this.rhs=h(V),this.type="binary",this},be},X=function(a,u,F){var V=w(a,u);return V.led=F,V},oe=function(a,u){var F=w(a);return F.nud=u||function(){return this.expression=h(70),this.type="unary",this},F};O("(end)"),O("(name)"),O("(literal)"),O("(regex)"),w(":"),w(";"),w(","),w(")"),w("]"),w("}"),w(".."),M("."),M("+"),M("-"),M("*"),M("/"),M("%"),M("="),M("<"),M(">"),M("!="),M("<="),M(">="),M("&"),M("and"),M("or"),M("in"),O("and"),O("or"),O("in"),oe("-"),M("~>"),M("??",D["??"],function(a){return this.type="condition",this.condition={type:"function",value:"(",procedure:{type:"variable",value:"exists"},arguments:[a]},this.then=a,this.else=h(0),this}),X("(error)",10,function(a){return this.lhs=a,this.error=b.error,this.remaining=fe(),this.type="error",this}),oe("*",function(){return this.type="wildcard",this}),oe("**",function(){return this.type="descendant",this}),oe("%",function(){return this.type="parent",this}),M("(",D["("],function(a){if(this.procedure=a,this.type="function",this.arguments=[],b.id!==")")for(;b.type==="operator"&&b.id==="?"?(this.type="partial",this.arguments.push(b),C("?")):this.arguments.push(h(0)),b.id===",";)C(",");if(C(")",!0),a.type==="name"&&(a.value==="function"||a.value==="\u03BB")){if(this.arguments.forEach(function(ue,c){if(ue.type!=="variable")return Y({code:"S0208",stack:new Error().stack,position:ue.position,token:ue.value,value:c+1})}),this.type="lambda",b.id==="<"){for(var u=b.position,F=1,V="<";F>0&&b.id!=="{"&&b.id!=="(end)";){var be=C();be.id===">"?F--:be.id==="<"&&F++,V+=be.value}C(">");try{this.signature=$(V)}catch(ue){return ue.position=u+ue.offset,Y(ue)}}C("{"),this.body=h(0),C("}")}return this}),oe("(",function(){for(var a=[];b.id!==")"&&(a.push(h(0)),b.id===";");)C(";");return C(")",!0),this.type="block",this.expressions=a,this}),oe("[",function(){var a=[];if(b.id!=="]")for(;;){var u=h(0);if(b.id===".."){var F={type:"binary",value:"..",position:b.position,lhs:u};C(".."),F.rhs=h(0),u=F}if(a.push(u),b.id!==",")break;C(",")}return C("]",!0),this.expressions=a,this.type="unary",this}),M("[",D["["],function(a){if(b.id==="]"){for(var u=a;u&&u.type==="binary"&&u.value==="[";)u=u.lhs;return u.keepArray=!0,C("]"),a}else return this.lhs=a,this.rhs=h(D["]"]),this.type="binary",C("]",!0),this}),M("^",D["^"],function(a){C("(");for(var u=[];;){var F={descending:!1};if(b.id==="<"?C("<"):b.id===">"&&(F.descending=!0,C(">")),F.expression=h(0),u.push(F),b.id!==",")break;C(",")}return C(")"),this.lhs=a,this.rhs=u,this.type="binary",this});var ce=function(a){var u=[];if(b.id!=="}")for(;;){var F=h(0);C(":");var V=h(0);if(u.push([F,V]),b.id!==",")break;C(",")}return C("}",!0),typeof a>"u"?(this.lhs=u,this.type="unary"):(this.lhs=a,this.rhs=u,this.type="binary"),this};oe("{",ce),M("{",D["{"],ce),X(":=",D[":="],function(a){return a.type!=="variable"?Y({code:"S0212",stack:new Error().stack,position:a.position,token:a.value}):(this.lhs=a,this.rhs=h(D[":="]-1),this.type="binary",this)}),M("@",D["@"],function(a){return this.lhs=a,this.rhs=h(D["@"]),this.rhs.type!=="variable"?Y({code:"S0214",stack:new Error().stack,position:this.rhs.position,token:"@"}):(this.type="binary",this)}),M("#",D["#"],function(a){return this.lhs=a,this.rhs=h(D["#"]),this.rhs.type!=="variable"?Y({code:"S0214",stack:new Error().stack,position:this.rhs.position,token:"#"}):(this.type="binary",this)}),M("?",D["?"],function(a){return this.type="condition",this.condition=a,this.then=h(0),b.id===":"&&(C(":"),this.else=h(0)),this}),M("?:",D["?:"],function(a){return this.type="condition",this.condition=a,this.then=a,this.else=h(0),this}),oe("|",function(){return this.type="transform",this.pattern=h(0),C("|"),this.update=h(0),b.id===","&&(C(","),this.delete=h(0)),C("|"),this});var le=function(a){var u;if(a.type==="function"&&!a.predicate){var F={type:"lambda",thunk:!0,arguments:[],position:a.position};F.body=a,u=F}else if(a.type==="condition")a.then=le(a.then),typeof a.else<"u"&&(a.else=le(a.else)),u=a;else if(a.type==="block"){var V=a.expressions.length;V>0&&(a.expressions[V-1]=le(a.expressions[V-1])),u=a}else u=a;return u},ne=0,ke=0,ze=[],se=function(a,u){switch(a.type){case"name":case"wildcard":u.level--,u.level===0&&(typeof a.ancestor>"u"||(ze[u.index].slot.label=a.ancestor.label),a.ancestor=u,a.tuple=!0);break;case"parent":u.level++;break;case"block":a.expressions.length>0&&(a.tuple=!0,u=se(a.expressions[a.expressions.length-1],u));break;case"path":a.tuple=!0;var F=a.steps.length-1;for(u=se(a.steps[F--],u);u.level>0&&F>=0;)u=se(a.steps[F--],u);break;default:throw{code:"S0217",token:a.type,position:a.position}}return u},H=function(a,u){if(typeof u.seekingParent<"u"||u.type==="parent"){var F=typeof u.seekingParent<"u"?u.seekingParent:[];u.type==="parent"&&F.push(u.slot),typeof a.seekingParent>"u"?a.seekingParent=F:Array.prototype.push.apply(a.seekingParent,F)}},We=function(a){var u=a.steps.length-1,F=a.steps[u],V=typeof F.seekingParent<"u"?F.seekingParent:[];F.type==="parent"&&V.push(F.slot);for(var be=0;be<V.length;be++){var ue=V[be];for(u=a.steps.length-2;ue.level>0;){if(u<0){typeof a.seekingParent>"u"?a.seekingParent=[ue]:a.seekingParent.push(ue);break}for(var c=a.steps[u--];u>=0&&c.focus&&a.steps[u].focus;)c=a.steps[u--];ue=se(c,ue)}}},q=function(a){var u;switch(a.type){case"binary":switch(a.value){case".":var F=q(a.lhs);F.type==="path"?u=F:u={type:"path",steps:[F]},F.type==="parent"&&(u.seekingParent=[F.slot]);var V=q(a.rhs);V.type==="function"&&V.procedure.type==="path"&&V.procedure.steps.length===1&&V.procedure.steps[0].type==="name"&&u.steps[u.steps.length-1].type==="function"&&(u.steps[u.steps.length-1].nextFunction=V.procedure.steps[0].value),V.type==="path"?Array.prototype.push.apply(u.steps,V.steps):(typeof V.predicate<"u"&&(V.stages=V.predicate,delete V.predicate),u.steps.push(V)),u.steps.filter(function(T){if(T.type==="number"||T.type==="value")throw{code:"S0213",stack:new Error().stack,position:T.position,value:T.value};return T.type==="string"}).forEach(function(T){T.type="name"}),u.steps.filter(function(T){return T.keepArray===!0}).length>0&&(u.keepSingletonArray=!0);var be=u.steps[0];be.type==="unary"&&be.value==="["&&(be.consarray=!0);var ue=u.steps[u.steps.length-1];ue.type==="unary"&&ue.value==="["&&(ue.consarray=!0),We(u);break;case"[":u=q(a.lhs);var c=u,p="predicate";if(u.type==="path"&&(c=u.steps[u.steps.length-1],p="stages"),typeof c.group<"u")throw{code:"S0209",stack:new Error().stack,position:a.position};typeof c[p]>"u"&&(c[p]=[]);var l=q(a.rhs);typeof l.seekingParent<"u"&&(l.seekingParent.forEach(T=>{T.level===1?se(c,T):T.level--}),H(c,l)),c[p].push({type:"filter",expr:l,position:a.position});break;case"{":if(u=q(a.lhs),typeof u.group<"u")throw{code:"S0210",stack:new Error().stack,position:a.position};u.group={lhs:a.rhs.map(function(T){return[q(T[0]),q(T[1])]}),position:a.position};break;case"^":u=q(a.lhs),u.type!=="path"&&(u={type:"path",steps:[u]});var m={type:"sort",position:a.position};m.terms=a.rhs.map(function(T){var I=q(T.expression);return H(m,I),{descending:T.descending,expression:I}}),u.steps.push(m),We(u);break;case":=":u={type:"bind",value:a.value,position:a.position},u.lhs=q(a.lhs),u.rhs=q(a.rhs),H(u,u.rhs);break;case"@":if(u=q(a.lhs),c=u,u.type==="path"&&(c=u.steps[u.steps.length-1]),typeof c.stages<"u"||typeof c.predicate<"u")throw{code:"S0215",stack:new Error().stack,position:a.position};if(c.type==="sort")throw{code:"S0216",stack:new Error().stack,position:a.position};a.keepArray&&(c.keepArray=!0),c.focus=a.rhs.value,c.tuple=!0;break;case"#":u=q(a.lhs),c=u,u.type==="path"?c=u.steps[u.steps.length-1]:(u={type:"path",steps:[u]},typeof c.predicate<"u"&&(c.stages=c.predicate,delete c.predicate)),typeof c.stages>"u"?c.index=a.rhs.value:c.stages.push({type:"index",value:a.rhs.value,position:a.position}),c.tuple=!0;break;case"~>":u={type:"apply",value:a.value,position:a.position},u.lhs=q(a.lhs),u.rhs=q(a.rhs),u.keepArray=u.lhs.keepArray||u.rhs.keepArray;break;default:u={type:a.type,value:a.value,position:a.position},u.lhs=q(a.lhs),u.rhs=q(a.rhs),H(u,u.lhs),H(u,u.rhs)}break;case"unary":u={type:a.type,value:a.value,position:a.position},a.value==="["?u.expressions=a.expressions.map(function(T){var I=q(T);return H(u,I),I}):a.value==="{"?u.lhs=a.lhs.map(function(T){var I=q(T[0]);H(u,I);var te=q(T[1]);return H(u,te),[I,te]}):(u.expression=q(a.expression),a.value==="-"&&u.expression.type==="number"?(u=u.expression,u.value=-u.value):H(u,u.expression));break;case"function":case"partial":u={type:a.type,name:a.name,value:a.value,position:a.position},u.arguments=a.arguments.map(function(T){var I=q(T);return H(u,I),I}),u.procedure=q(a.procedure);break;case"lambda":u={type:a.type,arguments:a.arguments,signature:a.signature,position:a.position};var S=q(a.body);u.body=le(S);break;case"condition":u={type:a.type,position:a.position},u.condition=q(a.condition),H(u,u.condition),u.then=q(a.then),H(u,u.then),typeof a.else<"u"&&(u.else=q(a.else),H(u,u.else));break;case"transform":u={type:a.type,position:a.position},u.pattern=q(a.pattern),u.update=q(a.update),typeof a.delete<"u"&&(u.delete=q(a.delete));break;case"block":u={type:a.type,position:a.position},u.expressions=a.expressions.map(function(T){var I=q(T);return H(u,I),(I.consarray||I.type==="path"&&I.steps[0].consarray)&&(u.consarray=!0),I});break;case"name":u={type:"path",steps:[a]},a.keepArray&&(u.keepSingletonArray=!0);break;case"parent":u={type:"parent",slot:{label:"!"+ne++,level:1,index:ke++}},ze.push(u);break;case"string":case"number":case"value":case"wildcard":case"descendant":case"variable":case"regex":u=a;break;case"operator":if(a.value==="and"||a.value==="or"||a.value==="in")a.type="name",u=q(a);else if(a.value==="?")u=a;else throw{code:"S0201",stack:new Error().stack,position:a.position,token:a.value};break;case"error":u=a,a.lhs&&(u=q(a.lhs));break;default:var E="S0206";a.id==="(end)"&&(E="S0207");var g={code:E,position:a.position,token:a.value};if(v)return ye.push(g),{type:"error",error:g};throw g.stack=new Error().stack,g}return a.keepArray&&(u.keepArray=!0),u};x=W(A),C();var Te=h(0);if(b.id!=="(end)"){var Ye={code:"S0201",position:b.position,token:b.value};Y(Ye)}if(Te=q(Te),Te.type==="parent"||typeof Te.seekingParent<"u")throw{code:"S0217",token:Te.type,position:Te.position};return ye.length>0&&(Te.errors=ye),Te};return ee})();he.exports=y},{"./signature":5}],5:[function(ie,he,$e){var $=ie("./utils");let y=(()=>{"use strict";var D={a:"arrays",b:"booleans",f:"functions",n:"numbers",o:"objects",s:"strings"};function J(W){for(var ee=1,A=[],v={},b=v;ee<W.length;){var x=W.charAt(ee);if(x===":")break;var B=function(){A.push(v),b=v,v={}},ye=function(M,X,oe,ce){for(var le=1,ne=X;ne<M.length;)if(ne++,x=M.charAt(ne),x===ce){if(le--,le===0)break}else x===oe&&le++;return ne};switch(x){case"s":case"n":case"b":case"l":case"o":v.regex="["+x+"m]",v.type=x,B();break;case"a":v.regex="[asnblfom]",v.type=x,v.array=!0,B();break;case"f":v.regex="f",v.type=x,B();break;case"j":v.regex="[asnblom]",v.type=x,B();break;case"x":v.regex="[asnblfom]",v.type=x,B();break;case"-":b.context=!0,b.contextRegex=new RegExp(b.regex),b.regex+="?";break;case"?":case"+":b.regex+=x;break;case"(":var fe=ye(W,ee,"(",")"),L=W.substring(ee+1,fe);if(L.indexOf("<")===-1)v.regex="["+L+"m]";else throw{code:"S0402",stack:new Error().stack,value:L,offset:ee};v.type="("+L+")",ee=fe,B();break;case"<":if(b.type==="a"||b.type==="f"){var w=ye(W,ee,"<",">");b.subtype=W.substring(ee+1,w),ee=w}else throw{code:"S0401",stack:new Error().stack,value:b.type,offset:ee};break}ee++}var Y="^"+A.map(function(M){return"("+M.regex+")"}).join("")+"$",C=new RegExp(Y),h=function(M){var X;if($.isFunction(M))X="f";else{var oe=typeof M;switch(oe){case"string":X="s";break;case"number":X="n";break;case"boolean":X="b";break;case"object":M===null?X="l":Array.isArray(M)?X="a":X="o";break;case"undefined":default:X="m"}}return X},O=function(M,X){for(var oe="^",ce=0,le=0;le<A.length;le++){oe+=A[le].regex;var ne=X.match(oe);if(ne===null)throw{code:"T0410",stack:new Error().stack,value:M[ce],index:ce+1};ce=ne[0].length}throw{code:"T0410",stack:new Error().stack,value:M[ce],index:ce+1}};return{definition:W,validate:function(M,X){var oe="";M.forEach(function(ke){oe+=h(ke)});var ce=C.exec(oe);if(ce){var le=[],ne=0;return A.forEach(function(ke,ze){var se=M[ne],H=ce[ze+1];if(H==="")if(ke.context&&ke.contextRegex){var We=h(X);if(ke.contextRegex.test(We))le.push(X);else throw{code:"T0411",stack:new Error().stack,value:X,index:ne+1}}else le.push(se),ne++;else H.split("").forEach(function(q){if(ke.type==="a"){if(q==="m")se=void 0;else{se=M[ne];var Te=!0;if(typeof ke.subtype<"u"){if(q!=="a"&&H!==ke.subtype)Te=!1;else if(q==="a"&&se.length>0){var Ye=h(se[0]);if(Ye!==ke.subtype.charAt(0))Te=!1;else{var a=se.filter(function(u){return h(u)!==Ye});Te=a.length===0}}}if(!Te)throw{code:"T0412",stack:new Error().stack,value:se,index:ne+1,type:D[ke.subtype]};q!=="a"&&(se=[se])}le.push(se),ne++}else le.push(se),ne++})}),le}O(M,oe)}}}return J})();he.exports=y},{"./utils":6}],6:[function(ie,he,$e){let $=(()=>{"use strict";function y(w){var Y=!1;if(typeof w=="number"&&(Y=!isNaN(w),Y&&!isFinite(w)))throw{code:"D1001",value:w,stack:new Error().stack};return Y}function D(w){var Y=!1;return Array.isArray(w)&&(Y=w.filter(function(C){return typeof C!="string"}).length===0),Y}function J(w){var Y=!1;return Array.isArray(w)&&(Y=w.filter(function(C){return!y(C)}).length===0),Y}function W(){var w=[];return w.sequence=!0,arguments.length===1&&w.push(arguments[0]),w}function ee(w){return w.sequence===!0&&Array.isArray(w)}function A(w){return w&&(w._jsonata_function===!0||w._jsonata_lambda===!0)||typeof w=="function"}function v(w){var Y=typeof w.arity=="number"?w.arity:typeof w.implementation=="function"?w.implementation.length:typeof w.length=="number"?w.length:w.arguments.length;return Y}function b(w){return w&&w._jsonata_lambda===!0}var x=(typeof Symbol=="function"?Symbol:{}).iterator||"@@iterator";function B(w){return typeof w=="object"&&w!==null&&x in w&&"next"in w&&typeof w.next=="function"}function ye(w,Y){if(w===Y)return!0;if(typeof w=="object"&&typeof Y=="object"&&w!==null&&Y!==null){if(Array.isArray(w)&&Array.isArray(Y)){if(w.length!==Y.length)return!1;for(var C=0;C<w.length;C++)if(!ye(w[C],Y[C]))return!1;return!0}var h=Object.getOwnPropertyNames(w),O=Object.getOwnPropertyNames(Y);if(h.length!==O.length)return!1;for(h=h.sort(),O=O.sort(),C=0;C<h.length;C++)if(h[C]!==O[C])return!1;for(C=0;C<h.length;C++){var M=h[C];if(!ye(w[M],Y[M]))return!1}return!0}return!1}function fe(w){return typeof w=="object"&&w!==null&&"then"in w&&typeof w.then=="function"}function L(w){var Y=[];for(let C of w)Y.push(C);return Y}return{isNumeric:y,isArrayOfStrings:D,isArrayOfNumbers:J,createSequence:W,isSequence:ee,isFunction:A,isLambda:b,isIterable:B,getFunctionArity:v,isDeepEqual:ye,stringToArray:L,isPromise:fe}})();he.exports=$},{}]},{},[3])(3)})});var St=Lt(Tt(),1),Dt=class extends EventTarget{#t={};#n=!1;#e={results:{},variables:{global:{},locals:[]},connectionIndex:0,userProvided:!1};constructor({functions:Z,explicitInitsOnly:Se=!1}){super(),this.#t=Z,this.#n=Se}setState(Z){this.#e=Z,this.#e.userProvided=!0}async run({functions:Z={},connections:Se=[]}={}){let ie={};if(Object.keys(Z).forEach($=>{Z[$].args&&(ie[$]=Z[$].args)}),this.#n&&Object.keys(ie).length===0)throw new Error('When "explicitInitsOnly" is true, args must be provided to some functions.');let he=($,y)=>{let D=Z[$]?.ref?this.#t[Z[$].ref]:this.#t[$];if(!D)throw new Error(`Function ${$} not existing.`);return(async()=>{try{return{result:await D(...y)}}catch(J){let W={error:J,message:J?.message?J.message:null};if(this.dispatchEvent(new CustomEvent("errors",{detail:W})),this.dispatchEvent(new CustomEvent(`errors.${$}`,{detail:W})),Z[$]?.throws)throw J;return W}})()};if(!this.#n){let $={};for(let y of Se){for(let D of y.from??[])$[D]=[];for(let D of y.to??[])$[D]&&delete $[D]}for(let y of Object.keys($))ie[y]||(ie[y]=$[y])}if(!this.#e.userProvided){this.#e.results={},this.#e.variables={global:{},locals:new Array(Se.length).fill(null).map(()=>({}))};for(let $ of Object.keys(ie)){if(!Array.isArray(ie[$]))throw new Error(`The "args" value for function "${$}", must be an array.`);this.#e.results[$]=he($,ie[$]),this.dispatchEvent(new CustomEvent("state.change",{detail:{state:this.#e}}))}}await(async()=>{let $;do for($=!1,this.#e.connectionIndex=this.#e.userProvided?this.#e.connectionIndex:0;this.#e.connectionIndex<Se.length;this.#e.connectionIndex++){delete this.#e.userProvided;let y=this.#e.connectionIndex,D=Se[y],J=!0,W=[],ee=D.from??[];if(ee.length===0)throw new Error(`The connection ${y} from is an empty array.
Connection: ${JSON.stringify(D)}`);for(let v of ee)if(Object.hasOwn(this.#e.results,v))W.push(this.#e.results[v]);else{J=!1;break}if(J)for(let v of W)await zt(v)||(await v).error&&(J=!1);let A=[];if(J)for(let v of W){let b=await v;b.error?J=!1:A.push(b.result?b.result:b)}if(J){for(let B of ee)delete this.#e.results[B];$=!0;let v=D.to??[],b={to:A.map(B=>[B]),global:this.#e.variables.global,local:this.#e.variables.locals[y]};if(D.transition)try{let B={from:A,global:this.#e.variables.global,local:this.#e.variables.locals[y]};b=await $t(D.transition,B)}catch(B){throw new Error(`Connection ${y} transition: ${B.message}`)}let x=b.to;if(this.#e.variables.global=b.global??this.#e.variables.global,this.#e.variables.locals[y]=b.local??this.#e.variables.locals[y],v.length>0){if(!Array.isArray(x))throw new Error(`The transition returned "to" value must be an array.
Returned: ${JSON.stringify(x)}
Connection: ${JSON.stringify(D)}`);if(x.length!=v.length)throw new Error(`The transition returned "to" value must be an array of the same length of the "connection.to" array.
Returned: ${JSON.stringify(x)}
Connection: ${JSON.stringify(D)}`);for(let B=0;B<v.length;B++){let ye=v[B],fe=x[B];if(fe!=null){if(!Array.isArray(fe))throw new Error(`The transition returned "to" array value must contains only arrays of input parameters.
Returned: ${JSON.stringify(fe)}
Connection: ${JSON.stringify(D)}`);this.#e.results[ye]=he(ye,fe),this.dispatchEvent(new CustomEvent("state.change",{detail:{state:this.#e}}))}}}else this.#e.results["connection_"+y]=Promise.resolve(x),this.dispatchEvent(new CustomEvent("state.change",{detail:{state:this.#e}}))}}while($);this.#e.connectionIndex=0})();for(let $ of Object.keys(this.#e.results)){let y=await this.#e.results[$];this.#e.results[$]=y.result?y.result:y}return this.dispatchEvent(new CustomEvent("success",{detail:{state:this.#e}})),{results:this.#e.results,variables:this.#e.variables}}};async function $t(ge,Z){let Se={},ie=D=>{let J=typeof D;if(J==="function"||J==="symbol"){let W=globalThis.crypto.randomUUID();return Se[W]=D,W}else if(J==="object"){if(D===null)return null;let W=Array.isArray(D),ee=W?[]:{};for(let A of W?D:Object.keys(D))W?ee.push(ie(A)):ee[A]=ie(D[A]);return ee}else return D},he=D=>{let J=typeof D;if(J==="string"){for(let W of Object.keys(Se))if(D===W)return Se[W];return D}else if(J==="object"){if(D===null)return null;let W=Array.isArray(D),ee=W?[]:{};for(let A of W?D:Object.keys(D))W?ee.push(he(A)):ee[A]=he(D[A]);return ee}else return D},$e=ie(Z),$=await(0,St.default)(ge).evaluate($e);return he($)}async function zt(ge){let Z={};return await Promise.race([ge,Z])===Z}export{Dt as Orchestrator};
//# sourceMappingURL=index.min.js.map
