var Ft=Object.create;var At=Object.defineProperty;var Mt=Object.getOwnPropertyDescriptor;var jt=Object.getOwnPropertyNames;var Nt=Object.getPrototypeOf,Ut=Object.prototype.hasOwnProperty;var lt=(Ae=>typeof require<"u"?require:typeof Proxy<"u"?new Proxy(Ae,{get:(he,Ce)=>(typeof require<"u"?require:he)[Ce]}):Ae)(function(Ae){if(typeof require<"u")return require.apply(this,arguments);throw Error('Dynamic require of "'+Ae+'" is not supported')});var It=(Ae,he)=>()=>(he||Ae((he={exports:{}}).exports,he),he.exports);var Rt=(Ae,he,Ce,ge)=>{if(he&&typeof he=="object"||typeof he=="function")for(let be of jt(he))!Ut.call(Ae,be)&&be!==Ce&&At(Ae,be,{get:()=>he[be],enumerable:!(ge=Mt(he,be))||ge.enumerable});return Ae};var Lt=(Ae,he,Ce)=>(Ce=Ae!=null?Ft(Nt(Ae)):{},Rt(he||!Ae||!Ae.__esModule?At(Ce,"default",{value:Ae,enumerable:!0}):Ce,Ae));var Tt=It((Et,bt)=>{(function(Ae){if(typeof Et=="object"&&typeof bt<"u")bt.exports=Ae();else if(typeof define=="function"&&define.amd)define([],Ae);else{var he;typeof window<"u"?he=window:typeof global<"u"?he=global:typeof self<"u"?he=self:he=this,he.jsonata=Ae()}})(function(){var Ae,he,Ce;return(function(){function ge(be,Je,W){function g(ie,de){if(!Je[ie]){if(!be[ie]){var D=typeof lt=="function"&&lt;if(!de&&D)return D(ie,!0);if(R)return R(ie,!0);var v=new Error("Cannot find module '"+ie+"'");throw v.code="MODULE_NOT_FOUND",v}var b=Je[ie]={exports:{}};be[ie][0].call(b.exports,function(C){var H=be[ie][1][C];return g(H||C)},b,b.exports,ge,be,Je,W)}return Je[ie].exports}for(var R=typeof lt=="function"&&lt,pe=0;pe<W.length;pe++)g(W[pe]);return g}return ge})()({1:[function(ge,be,Je){let W=ge("./utils"),g=(function(){"use strict";let R=W.stringToArray,pe=["Zero","One","Two","Three","Four","Five","Six","Seven","Eight","Nine","Ten","Eleven","Twelve","Thirteen","Fourteen","Fifteen","Sixteen","Seventeen","Eighteen","Nineteen"],ie=["Zeroth","First","Second","Third","Fourth","Fifth","Sixth","Seventh","Eighth","Ninth","Tenth","Eleventh","Twelfth","Thirteenth","Fourteenth","Fifteenth","Sixteenth","Seventeenth","Eighteenth","Nineteenth"],de=["Twenty","Thirty","Forty","Fifty","Sixty","Seventy","Eighty","Ninety","Hundred"],D=["Thousand","Million","Billion","Trillion"];function v(c,p){var l=function(S,E,y){var T="";if(S<=19)T=(E?" and ":"")+(y?ie[S]:pe[S]);else if(S<100){let X=Math.floor(S/10),ee=S%10;T=(E?" and ":"")+de[X-2],ee>0?T+="-"+l(ee,!1,y):y&&(T=T.substring(0,T.length-1)+"ieth")}else if(S<1e3){let X=Math.floor(S/100),ee=S%100;T=(E?", ":"")+pe[X]+" Hundred",ee>0?T+=l(ee,!0,y):y&&(T+="th")}else{var L=Math.floor(Math.log10(S)/3);L>D.length&&(L=D.length);let X=Math.pow(10,L*3),ee=Math.floor(S/X),I=S-ee*X;T=(E?", ":"")+l(ee,!1,!1)+" "+D[L-1],I>0?T+=l(I,!0,y):y&&(T+="th")}return T},w=l(c,!1,p);return w}let b={};pe.forEach(function(c,p){b[c.toLowerCase()]=p}),ie.forEach(function(c,p){b[c.toLowerCase()]=p}),de.forEach(function(c,p){let l=c.toLowerCase();b[l]=(p+2)*10,b[l.substring(0,c.length-1)+"ieth"]=b[l]}),b.hundredth=100,D.forEach(function(c,p){let l=c.toLowerCase(),w=Math.pow(10,(p+1)*3);b[l]=w,b[l+"th"]=w});function C(c){let l=c.split(/,\s|\sand\s|[\s\\-]/).map(E=>b[E]),w=[0];return l.forEach(E=>{if(E<100){let y=w.pop();y>=1e3&&(w.push(y),y=0),w.push(y+E)}else w.push(w.pop()*E)}),w.reduce((E,y)=>E+y,0)}let H=[[1e3,"m"],[900,"cm"],[500,"d"],[400,"cd"],[100,"c"],[90,"xc"],[50,"l"],[40,"xl"],[10,"x"],[9,"ix"],[5,"v"],[4,"iv"],[1,"i"]],se={M:1e3,D:500,C:100,L:50,X:10,V:5,I:1};function K(c){for(var p=0;p<H.length;p++){let l=H[p];if(c>=l[0])return l[1]+K(c-l[0])}return""}function A(c){for(var p=0,l=1,w=c.length-1;w>=0;w--){let S=c[w],E=se[S];E<l?p-=E:(l=E,p+=E)}return p}function m(c,p){for(var l=[],w=p.charCodeAt(0);c>0;)l.unshift(String.fromCharCode((c-1)%26+w)),c=Math.floor((c-1)/26);return l.join("")}function F(c,p){for(var l=p.charCodeAt(0),w=0,S=0;S<c.length;S++)w+=(c.charCodeAt(c.length-S-1)-l+1)*Math.pow(26,S);return w}function O(c,p){if(typeof c>"u")return;c=Math.floor(c);let l=ne(p);return j(c,l)}let d={DECIMAL:"decimal",LETTERS:"letters",ROMAN:"roman",WORDS:"words",SEQUENCE:"sequence"},P={UPPER:"upper",LOWER:"lower",TITLE:"title"};function j(c,p){let l,w=c<0;switch(c=Math.abs(c),p.primary){case d.LETTERS:l=m(c,p.case===P.UPPER?"A":"a");break;case d.ROMAN:l=K(c),p.case===P.UPPER&&(l=l.toUpperCase());break;case d.WORDS:l=v(c,p.ordinal),p.case===P.UPPER?l=l.toUpperCase():p.case===P.LOWER&&(l=l.toLowerCase());break;case d.DECIMAL:l=""+c;var S=p.mandatoryDigits-l.length;if(S>0){var E=new Array(S+1).join("0");l=E+l}if(p.zeroCode!==48&&(l=R(l).map(X=>String.fromCodePoint(X.codePointAt(0)+p.zeroCode-48)).join("")),p.regular){let X=Math.floor((l.length-1)/p.groupingSeparators.position);for(let ee=X;ee>0;ee--){let I=l.length-ee*p.groupingSeparators.position;l=l.substr(0,I)+p.groupingSeparators.character+l.substr(I)}}else p.groupingSeparators.reverse().forEach(X=>{let ee=l.length-X.position;l=l.substr(0,ee)+X.character+l.substr(ee)});if(p.ordinal){var y={1:"st",2:"nd",3:"rd"},T=l[l.length-1],L=y[T];(!L||l.length>1&&l[l.length-2]==="1")&&(L="th"),l=l+L}break;case d.SEQUENCE:throw{code:"D3130",value:p.token}}return w&&(l="-"+l),l}let G=[48,1632,1776,1984,2406,2534,2662,2790,2918,3046,3174,3302,3430,3558,3664,3792,3872,4160,4240,6112,6160,6470,6608,6784,6800,6992,7088,7232,7248,42528,43216,43264,43472,43504,43600,44016,65296];function ne(c){let p={type:"integer",primary:d.DECIMAL,case:P.LOWER,ordinal:!1},l,w,S=c.lastIndexOf(";");switch(S===-1?l=c:(l=c.substring(0,S),w=c.substring(S+1),w[0]==="o"&&(p.ordinal=!0)),l){case"A":p.case=P.UPPER;case"a":p.primary=d.LETTERS;break;case"I":p.case=P.UPPER;case"i":p.primary=d.ROMAN;break;case"W":p.case=P.UPPER,p.primary=d.WORDS;break;case"Ww":p.case=P.TITLE,p.primary=d.WORDS;break;case"w":p.primary=d.WORDS;break;default:{let E=null,y=0,T=0,L=[],X=0;if(R(l).map(I=>I.codePointAt(0)).reverse().forEach(I=>{let $=!1;for(let V=0;V<G.length;V++){let U=G[V];if(I>=U&&I<=U+9){if($=!0,y++,X++,E===null)E=U;else if(U!==E)throw{code:"D3131"};break}}$||(I===35?(X++,T++):L.push({position:X,character:String.fromCodePoint(I)}))}),y>0){p.primary=d.DECIMAL,p.zeroCode=E,p.mandatoryDigits=y,p.optionalDigits=T;let $=function(V){if(V.length===0)return 0;let U=V[0].character;for(let Se=1;Se<V.length;Se++)if(V[Se].character!==U)return 0;let Pe=V.map(Se=>Se.position),Ye=function(Se,Ne){return Ne===0?Se:Ye(Ne,Se%Ne)},je=Pe.reduce(Ye);for(let Se=1;Se<=Pe.length;Se++)if(Pe.indexOf(Se*je)===-1)return 0;return je}(L);$>0?(p.regular=!0,p.groupingSeparators={position:$,character:L[0].character}):(p.regular=!1,p.groupingSeparators=L)}else p.primary=d.SEQUENCE,p.token=l}}return p}let oe={Y:"1",M:"1",D:"1",d:"1",F:"n",W:"1",w:"1",X:"1",x:"1",H:"1",h:"1",P:"n",m:"01",s:"01",f:"1",Z:"01:01",z:"01:01",C:"n",E:"n"};function fe(c){var p=[];let l={type:"datetime",parts:p},w=function($,V){if(V>$){let U=c.substring($,V);U=U.split("]]").join("]"),p.push({type:"literal",value:U})}};for(var S=0,E=0;E<c.length;){if(c.charAt(E)==="["){if(c.charAt(E+1)==="["){w(S,E),p.push({type:"literal",value:"["}),E+=2,S=E;continue}if(w(S,E),S=E,E=c.indexOf("]",S),E===-1)throw{code:"D3135"};let $=c.substring(S+1,E);$=$.split(/\s+/).join("");var y={type:"marker",component:$.charAt(0)},T=$.lastIndexOf(","),L;if(T!==-1){let V=$.substring(T+1),U=V.indexOf("-"),Pe,Ye,je=function(Ne){if(!(typeof Ne>"u"||Ne==="*"))return parseInt(Ne)};U===-1?Pe=V:(Pe=V.substring(0,U),Ye=V.substring(U+1));let Se={min:je(Pe),max:je(Ye)};y.width=Se,L=$.substring(1,T)}else L=$.substring(1);if(L.length===1)y.presentation1=L;else if(L.length>1){var X=L.charAt(L.length-1);"atco".indexOf(X)!==-1?(y.presentation2=X,X==="o"&&(y.ordinal=!0),y.presentation1=L.substring(0,L.length-1)):y.presentation1=L}else y.presentation1=oe[y.component];if(typeof y.presentation1>"u")throw{code:"D3132",value:y.component};if(y.presentation1[0]==="n")y.names=P.LOWER;else if(y.presentation1[0]==="N")y.presentation1[1]==="n"?y.names=P.TITLE:y.names=P.UPPER;else if("YMDdFWwXxHhmsf".indexOf(y.component)!==-1){var ee=y.presentation1;if(y.presentation2&&(ee+=";"+y.presentation2),y.integerFormat=ne(ee),y.width&&y.width.min!==void 0&&y.integerFormat.mandatoryDigits<y.width.min&&(y.integerFormat.mandatoryDigits=y.width.min),y.component==="Y")if(y.n=-1,y.width&&y.width.max!==void 0)y.n=y.width.max,y.integerFormat.mandatoryDigits=y.n;else{var I=y.integerFormat.mandatoryDigits+y.integerFormat.optionalDigits;I>=2&&(y.n=I)}let V=p[p.length-1];V&&V.integerFormat&&(V.integerFormat.parseWidth=V.integerFormat.mandatoryDigits)}(y.component==="Z"||y.component==="z")&&(y.integerFormat=ne(y.presentation1)),p.push(y),S=E+1}E++}return w(S,E),l}let Q=["","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"],we=["January","February","March","April","May","June","July","August","September","October","November","December"],ze=1e3*60*60*24,re=function(c){let p=Date.UTC(c.year,c.month);var l=new Date(p).getUTCDay();return l===0&&(l=7),l>4?p+(8-l)*ze:p-(l-1)*ze},B=function(c,p){return{year:c,month:p,nextMonth:function(){return p===11?B(c+1,0):B(c,p+1)},previousMonth:function(){return p===0?B(c-1,11):B(c,p-1)},nextYear:function(){return B(c+1,p)},previousYear:function(){return B(c-1,p)}}},$e=function(c,p){return(p-c)/(ze*7)+1},q=(c,p)=>{let l;switch(p){case"Y":l=c.getUTCFullYear();break;case"M":l=c.getUTCMonth()+1;break;case"D":l=c.getUTCDate();break;case"d":{let w=Date.UTC(c.getUTCFullYear(),c.getUTCMonth(),c.getUTCDate()),S=Date.UTC(c.getUTCFullYear(),0);l=(w-S)/ze+1;break}case"F":l=c.getUTCDay(),l===0&&(l=7);break;case"W":{let w=B(c.getUTCFullYear(),0),S=re(w),E=Date.UTC(w.year,c.getUTCMonth(),c.getUTCDate()),y=$e(S,E);if(y>52){let T=re(w.nextYear());E>=T&&(y=1)}else if(y<1){let T=re(w.previousYear());y=$e(T,E)}l=Math.floor(y);break}case"w":{let w=B(c.getUTCFullYear(),c.getUTCMonth()),S=re(w),E=Date.UTC(w.year,w.month,c.getUTCDate()),y=$e(S,E);if(y>4){let T=re(w.nextMonth());E>=T&&(y=1)}else if(y<1){let T=re(w.previousMonth());y=$e(T,E)}l=Math.floor(y);break}case"X":{let w=B(c.getUTCFullYear(),0),S=re(w),E=re(w.nextYear()),y=c.getTime();y<S?l=w.year-1:y>=E?l=w.year+1:l=w.year;break}case"x":{let w=B(c.getUTCFullYear(),c.getUTCMonth()),S=re(w),E=w.nextMonth(),y=re(E),T=c.getTime();T<S?l=w.previousMonth().month+1:T>=y?l=E.month+1:l=w.month+1;break}case"H":l=c.getUTCHours();break;case"h":l=c.getUTCHours(),l=l%12,l===0&&(l=12);break;case"P":l=c.getUTCHours()>=12?"pm":"am";break;case"m":l=c.getUTCMinutes();break;case"s":l=c.getUTCSeconds();break;case"f":l=c.getUTCMilliseconds();break;case"Z":case"z":break;case"C":l="ISO";break;case"E":l="ISO";break}return l},Te=null;function We(c,p,l){var w=0,S=0;if(typeof l<"u"){let ee=parseInt(l);w=Math.floor(ee/100),S=ee%100}var E=function(ee,I){var $=q(ee,I.component);if("YMDdFWwXxHhms".indexOf(I.component)!==-1)if(I.component==="Y"&&I.n!==-1&&($=$%Math.pow(10,I.n)),I.names){if(I.component==="M"||I.component==="x")$=we[$-1];else if(I.component==="F")$=Q[$];else throw{code:"D3133",value:I.component};I.names===P.UPPER?$=$.toUpperCase():I.names===P.LOWER&&($=$.toLowerCase()),I.width&&$.length>I.width.max&&($=$.substring(0,I.width.max))}else $=j($,I.integerFormat);else if(I.component==="f")$=j($,I.integerFormat);else if(I.component==="Z"||I.component==="z"){let V=w*100+S;if(I.integerFormat.regular)$=j(V,I.integerFormat);else{let U=I.integerFormat.mandatoryDigits;if(U===1||U===2)$=j(w,I.integerFormat),S!==0&&($+=":"+O(S,"00"));else if(U===3||U===4)$=j(V,I.integerFormat);else throw{code:"D3134",value:U}}V>=0&&($="+"+$),I.component==="z"&&($="GMT"+$),V===0&&I.presentation2==="t"&&($="Z")}else I.component==="P"&&I.names===P.UPPER&&($=$.toUpperCase());return $};let y;typeof p>"u"?(Te===null&&(Te=fe("[Y0001]-[M01]-[D01]T[H01]:[m01]:[s01].[f001][Z01:01t]")),y=Te):y=fe(p);let T=(60*w+S)*60*1e3,L=new Date(c+T),X="";return y.parts.forEach(function(ee){ee.type==="literal"?X+=ee.value:X+=E(L,ee)}),X}function a(c){var p={};if(c.type==="datetime")p.type="datetime",p.parts=c.parts.map(function(l){var w={};if(l.type==="literal")w.regex=l.value.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");else if(l.component==="Z"||l.component==="z"){let E;Array.isArray(l.integerFormat.groupingSeparators)||(E=l.integerFormat.groupingSeparators),w.regex="",l.component==="z"&&(w.regex="GMT"),w.regex+="[-+][0-9]+",E&&(w.regex+=E.character+"[0-9]+"),w.parse=function(y){l.component==="z"&&(y=y.substring(3));let T=0,L=0;return E?(T=Number.parseInt(y.substring(0,y.indexOf(E.character))),L=Number.parseInt(y.substring(y.indexOf(E.character)+1))):y.length-1<=2?T=Number.parseInt(y):(T=Number.parseInt(y.substring(0,3)),L=Number.parseInt(y.substring(3))),T*60+L}}else if(l.integerFormat)w=a(l.integerFormat);else{w.regex="[a-zA-Z]+";var S={};if(l.component==="M"||l.component==="x")we.forEach(function(E,y){l.width&&l.width.max?S[E.substring(0,l.width.max)]=y+1:S[E]=y+1});else if(l.component==="F")Q.forEach(function(E,y){y>0&&(l.width&&l.width.max?S[E.substring(0,l.width.max)]=y:S[E]=y)});else if(l.component==="P")S={am:0,AM:0,pm:1,PM:1};else throw{code:"D3133",value:l.component};w.parse=function(E){return S[E]}}return w.component=l.component,w});else{p.type="integer";let l=c.case===P.UPPER;switch(c.primary){case d.LETTERS:p.regex=l?"[A-Z]+":"[a-z]+",p.parse=function(w){return F(w,l?"A":"a")};break;case d.ROMAN:p.regex=l?"[MDCLXVI]+":"[mdclxvi]+",p.parse=function(w){return A(l?w:w.toUpperCase())};break;case d.WORDS:p.regex="(?:"+Object.keys(b).concat("and","[\\-, ]").join("|")+")+",p.parse=function(w){return C(w.toLowerCase())};break;case d.DECIMAL:p.regex="[0-9]",c.parseWidth?p.regex+=`{${c.parseWidth}}`:p.regex+="+",c.ordinal&&(p.regex+="(?:th|st|nd|rd)"),p.parse=function(w){let S=w;return c.ordinal&&(S=w.substring(0,w.length-2)),c.regular?S=S.split(",").join(""):c.groupingSeparators.forEach(E=>{S=S.split(E.character).join("")}),c.zeroCode!==48&&(S=S.split("").map(E=>String.fromCodePoint(E.codePointAt(0)-c.zeroCode+48)).join("")),parseInt(S)};break;case d.SEQUENCE:throw{code:"D3130",value:c.token}}}return p}function f(c,p){if(typeof c>"u")return;let l=ne(p);return a(l).parse(c)}function M(c,p){let l=fe(p),w=a(l),S="^"+w.parts.map(L=>"("+L.regex+")").join("")+"$";var y=new RegExp(S,"i").exec(c);if(y!==null){let U={};for(let ce=1;ce<y.length;ce++){let n=w.parts[ce-1];n.parse&&(U[n.component]=n.parse(y[ce]))}if(Object.getOwnPropertyNames(U).length===0)return;let Pe=0,Ye=ce=>{Pe<<=1,Pe+=ce?1:0},je=ce=>!(~ce&Pe)&&!!(ce&Pe);"YXMxWwdD".split("").forEach(ce=>Ye(U[ce]));let Ne=!je(161)&&je(130),Ze=je(84),Qe=!Ze&&je(72);Pe=0,"PHhmsf".split("").forEach(ce=>Ye(U[ce]));let Ke=!je(23)&&je(47),st=(Ne?"YD":Ze?"XxwF":Qe?"XWF":"YMD")+(Ke?"Phmsf":"Hmsf"),Ge=this.environment.timestamp,rt=!1,Ve=!1;if(st.split("").forEach(ce=>{if(typeof U[ce]>"u")rt?(U[ce]="MDd".indexOf(ce)!==-1?1:0,Ve=!0):U[ce]=q(Ge,ce);else if(rt=!0,Ve)throw{code:"D3136"}}),U.M>0?U.M-=1:U.M=0,Ne){let ce=Date.UTC(U.Y,0),n=(U.d-1)*1e3*60*60*24,i=new Date(ce+n);U.M=i.getUTCMonth(),U.D=i.getUTCDate()}if(Ze)throw{code:"D3136"};if(Qe)throw{code:"D3136"};Ke&&(U.H=U.h===12?0:U.h,U.P===1&&(U.H+=12));var T=Date.UTC(U.Y,U.M,U.D,U.H,U.m,U.s,U.f);return(U.Z||U.z)&&(T-=(U.Z||U.z)*60*1e3),T}}var J=new RegExp("^\\d{4}(-[01]\\d)*(-[0-3]\\d)*(T[0-2]\\d:[0-5]\\d:[0-5]\\d)*(\\.\\d+)?([+-][0-2]\\d:?[0-5]\\d|Z)?$");function ve(c,p){if(!(typeof c>"u"))if(typeof p>"u"){if(!J.test(c))throw{stack:new Error().stack,code:"D3110",value:c};return Date.parse(c)}else return M.call(this,c,p)}function ae(c,p,l){if(!(typeof c>"u"))return We.call(this,c,p,l)}return{formatInteger:O,parseInteger:f,fromMillis:ae,toMillis:ve}})();be.exports=g},{"./utils":6}],2:[function(ge,be,Je){(function(W){(function(){var g=ge("./utils");let R=(()=>{"use strict";var pe=g.isNumeric,ie=g.isArrayOfStrings,de=g.isArrayOfNumbers,D=g.createSequence,v=g.isSequence,b=g.isFunction,C=g.isLambda,H=g.isPromise,se=g.getFunctionArity,K=g.isDeepEqual,A=g.stringToArray;function m(e){if(!(typeof e>"u")){var t=0;return e.forEach(function(r){t+=r}),t}}function F(e){return typeof e>"u"?0:e.length}function O(e){if(!(typeof e>"u"||e.length===0))return Math.max.apply(Math,e)}function d(e){if(!(typeof e>"u"||e.length===0))return Math.min.apply(Math,e)}function P(e){if(!(typeof e>"u"||e.length===0)){var t=0;return e.forEach(function(r){t+=r}),t/e.length}}function j(e,t=!1){if(!(typeof e>"u")){var r;if(typeof e=="string")r=e;else if(b(e))r="";else{if(typeof e=="number"&&!isFinite(e))throw{code:"D3001",value:e,stack:new Error().stack};var u=t?2:0;Array.isArray(e)&&e.outerWrapper&&(e=e[0]),r=JSON.stringify(e,function(s,h){return typeof h<"u"&&h!==null&&h.toPrecision&&pe(h)?Number(h.toPrecision(15)):h&&b(h)?"":h},u)}return r}}function G(e,t,r){if(!(typeof e>"u")){var u=A(e),s=u.length;if(s+t<0&&(t=0),typeof r<"u"){if(r<=0)return"";var h=t>=0?t+r:s+t+r;return u.slice(t,h).join("")}return u.slice(t).join("")}}function ne(e,t){if(!(typeof e>"u")){var r=e.indexOf(t);return r>-1?e.substr(0,r):e}}function oe(e,t){if(!(typeof e>"u")){var r=e.indexOf(t);return r>-1?e.substr(r+t.length):e}}function fe(e){if(!(typeof e>"u"))return e.toLowerCase()}function Q(e){if(!(typeof e>"u"))return e.toUpperCase()}function we(e){if(!(typeof e>"u"))return A(e).length}function ze(e){if(!(typeof e>"u")){var t=e.replace(/[ \t\n\r]+/gm," ");return t.charAt(0)===" "&&(t=t.substring(1)),t.charAt(t.length-1)===" "&&(t=t.substring(0,t.length-1)),t}}function re(e,t,r){if(!(typeof e>"u")){(typeof r>"u"||r.length===0)&&(r=" ");var u;t=Math.trunc(t);var s=Math.abs(t)-we(e);if(s>0){var h=new Array(s+1).join(r);r.length>1&&(h=G(h,0,s)),t>0?u=e+h:u=h+e}else u=e;return u}}async function B(e,t){var r=e.apply(this,[t]);if(H(r)&&(r=await r),r&&!(typeof r.start=="number"||r.end==="number"||Array.isArray(r.groups)||b(r.next)))throw{code:"T1010",stack:new Error().stack};return r}async function $e(e,t){if(!(typeof e>"u")){var r;if(typeof t=="string")r=e.indexOf(t)!==-1;else{var u=await B(t,e);r=typeof u<"u"}return r}}async function q(e,t,r){if(!(typeof e>"u")){if(r<0)throw{stack:new Error().stack,value:r,code:"D3040",index:3};var u=D();if(typeof r>"u"||r>0){var s=0,h=await B(t,e);if(typeof h<"u")for(;typeof h<"u"&&(typeof r>"u"||s<r);)u.push({match:h.match,index:h.start,groups:h.groups}),h=await B(h.next),s++}return u}}async function Te(e,t,r,u){if(!(typeof e>"u")){var s=this;if(t==="")throw{code:"D3010",stack:new Error().stack,value:t,index:2};if(u<0)throw{code:"D3011",stack:new Error().stack,value:u,index:4};var h;typeof r=="string"?h=function(ue){for(var xe="",te=0,Ee=r.indexOf("$",te);Ee!==-1&&te<r.length;){xe+=r.substring(te,Ee),te=Ee+1;var Be=r.charAt(te);if(Be==="$")xe+="$",te++;else if(Be==="0")xe+=ue.match,te++;else{var Fe;if(ue.groups.length===0?Fe=1:Fe=Math.floor(Math.log(ue.groups.length)*Math.LOG10E)+1,Ee=parseInt(r.substring(te,te+Fe),10),Fe>1&&Ee>ue.groups.length&&(Ee=parseInt(r.substring(te,te+Fe-1),10)),isNaN(Ee))xe+="$";else{if(ue.groups.length>0){var at=ue.groups[Ee-1];typeof at<"u"&&(xe+=at)}te+=Ee.toString().length}}Ee=r.indexOf("$",te)}return xe+=r.substring(te),xe}:h=r;var k="",N=0;if(typeof u>"u"||u>0){var z=0;if(typeof t=="string"){for(var le=e.indexOf(t,N);le!==-1&&(typeof u>"u"||z<u);)k+=e.substring(N,le),k+=r,N=le+t.length,z++,le=e.indexOf(t,N);k+=e.substring(N)}else{var Z=await B(t,e);if(typeof Z<"u"){for(;typeof Z<"u"&&(typeof u>"u"||z<u);){k+=e.substring(N,Z.start);var ye=h.apply(s,[Z]);if(H(ye)&&(ye=await ye),typeof ye=="string")k+=ye;else throw{code:"D3012",stack:new Error().stack,value:ye};N=Z.start+Z.match.length,z++,Z=await B(Z.next)}k+=e.substring(N)}else k=e}}else k=e;return k}}function We(e){if(!(typeof e>"u")){var t=typeof window<"u"?window.btoa:function(r){return new W.Buffer.from(r,"binary").toString("base64")};return t(e)}}function a(e){if(!(typeof e>"u")){var t=typeof window<"u"?window.atob:function(r){return new W.Buffer.from(r,"base64").toString("binary")};return t(e)}}function f(e){if(!(typeof e>"u")){var t;try{t=encodeURIComponent(e)}catch{throw{code:"D3140",stack:new Error().stack,value:e,functionName:"encodeUrlComponent"}}return t}}function M(e){if(!(typeof e>"u")){var t;try{t=encodeURI(e)}catch{throw{code:"D3140",stack:new Error().stack,value:e,functionName:"encodeUrl"}}return t}}function J(e){if(!(typeof e>"u")){var t;try{t=decodeURIComponent(e)}catch{throw{code:"D3140",stack:new Error().stack,value:e,functionName:"decodeUrlComponent"}}return t}}function ve(e){if(!(typeof e>"u")){var t;try{t=decodeURI(e)}catch{throw{code:"D3140",stack:new Error().stack,value:e,functionName:"decodeUrl"}}return t}}async function ae(e,t,r){if(!(typeof e>"u")){if(r<0)throw{code:"D3020",stack:new Error().stack,value:r,index:3};var u=[];if(typeof r>"u"||r>0)if(typeof t=="string")u=e.split(t,r);else{var s=0,h=await B(t,e);if(typeof h<"u"){for(var k=0;typeof h<"u"&&(typeof r>"u"||s<r);)u.push(e.substring(k,h.start)),k=h.end,h=await B(h.next),s++;(typeof r>"u"||s<r)&&u.push(e.substring(k))}else u.push(e)}return u}}function c(e,t){if(!(typeof e>"u"))return typeof t>"u"&&(t=""),e.join(t)}function p(e,t,r){if(!(typeof e>"u")){var u={"decimal-separator":".","grouping-separator":",","exponent-separator":"e",infinity:"Infinity","minus-sign":"-",NaN:"NaN",percent:"%","per-mille":"\u2030","zero-digit":"0",digit:"#","pattern-separator":";"},s=u;typeof r<"u"&&Object.keys(r).forEach(function(_){s[_]=r[_]});for(var h=[],k=s["zero-digit"].charCodeAt(0),N=k;N<k+10;N++)h.push(String.fromCharCode(N));var z=h.concat([s["decimal-separator"],s["exponent-separator"],s["grouping-separator"],s.digit,s["pattern-separator"]]),le=t.split(s["pattern-separator"]);if(le.length>2)throw{code:"D3080",stack:new Error().stack};var Z=function(_){var ke=(function(){for(var Oe,qe=0;qe<_.length;qe++)if(Oe=_.charAt(qe),z.indexOf(Oe)!==-1&&Oe!==s["exponent-separator"])return _.substring(0,qe)})(),Ie=(function(){for(var Oe,qe=_.length-1;qe>=0;qe--)if(Oe=_.charAt(qe),z.indexOf(Oe)!==-1&&Oe!==s["exponent-separator"])return _.substring(qe+1)})(),me=_.substring(ke.length,_.length-Ie.length),Re,et,Le,nt,_e=_.indexOf(s["exponent-separator"],ke.length);_e===-1||_e>_.length-Ie.length?(Re=me,et=void 0):(Re=me.substring(0,_e),et=me.substring(_e+1));var He=Re.indexOf(s["decimal-separator"]);return He===-1?(Le=Re,nt=Ie):(Le=Re.substring(0,He),nt=Re.substring(He+1)),{prefix:ke,suffix:Ie,activePart:me,mantissaPart:Re,exponentPart:et,integerPart:Le,fractionalPart:nt,subpicture:_}},ye=function(_){var ke,Ie,me=_.subpicture,Re=me.indexOf(s["decimal-separator"]);Re!==me.lastIndexOf(s["decimal-separator"])&&(ke="D3081"),me.indexOf(s.percent)!==me.lastIndexOf(s.percent)&&(ke="D3082"),me.indexOf(s["per-mille"])!==me.lastIndexOf(s["per-mille"])&&(ke="D3083"),me.indexOf(s.percent)!==-1&&me.indexOf(s["per-mille"])!==-1&&(ke="D3084");var et=!1;for(Ie=0;Ie<_.mantissaPart.length;Ie++){var Le=_.mantissaPart.charAt(Ie);if(h.indexOf(Le)!==-1||Le===s.digit){et=!0;break}}et||(ke="D3085");var nt=_.activePart.split("").map(function(Oe){return z.indexOf(Oe)===-1?"p":"a"}).join("");nt.indexOf("p")!==-1&&(ke="D3086"),Re!==-1?(me.charAt(Re-1)===s["grouping-separator"]||me.charAt(Re+1)===s["grouping-separator"])&&(ke="D3087"):_.integerPart.charAt(_.integerPart.length-1)===s["grouping-separator"]&&(ke="D3088"),me.indexOf(s["grouping-separator"]+s["grouping-separator"])!==-1&&(ke="D3089");var _e=_.integerPart.indexOf(s.digit);_e!==-1&&_.integerPart.substring(0,_e).split("").filter(function(Oe){return h.indexOf(Oe)>-1}).length>0&&(ke="D3090"),_e=_.fractionalPart.lastIndexOf(s.digit),_e!==-1&&_.fractionalPart.substring(_e).split("").filter(function(Oe){return h.indexOf(Oe)>-1}).length>0&&(ke="D3091");var He=typeof _.exponentPart=="string";if(He&&_.exponentPart.length>0&&(me.indexOf(s.percent)!==-1||me.indexOf(s["per-mille"])!==-1)&&(ke="D3092"),He&&(_.exponentPart.length===0||_.exponentPart.split("").filter(function(Oe){return h.indexOf(Oe)===-1}).length>0)&&(ke="D3093"),ke)throw{code:ke,stack:new Error().stack}},ue=function(_){var ke=function(Me,yt){for(var ct=[],Xe=Me.indexOf(s["grouping-separator"]);Xe!==-1;){var gt=(yt?Me.substring(0,Xe):Me.substring(Xe)).split("").filter(function(ot){return h.indexOf(ot)!==-1||ot===s.digit}).length;ct.push(gt),Xe=_.integerPart.indexOf(s["grouping-separator"],Xe+1)}return ct},Ie=ke(_.integerPart),me=function(Me){if(Me.length===0)return 0;for(var yt=function(gt,ot){return ot===0?gt:yt(ot,gt%ot)},ct=Me.reduce(yt),Xe=1;Xe<=Me.length;Xe++)if(Me.indexOf(Xe*ct)===-1)return 0;return ct},Re=me(Ie),et=ke(_.fractionalPart,!0),Le=_.integerPart.split("").filter(function(Me){return h.indexOf(Me)!==-1}).length,nt=Le,_e=_.fractionalPart.split(""),He=_e.filter(function(Me){return h.indexOf(Me)!==-1}).length,Oe=_e.filter(function(Me){return h.indexOf(Me)!==-1||Me===s.digit}).length,qe=typeof _.exponentPart=="string";Le===0&&Oe===0&&(qe?(He=1,Oe=1):Le=1),qe&&Le===0&&_.integerPart.indexOf(s.digit)!==-1&&(Le=1),Le===0&&He===0&&(He=1);var kt=0;return qe&&(kt=_.exponentPart.split("").filter(function(Me){return h.indexOf(Me)!==-1}).length),{integerPartGroupingPositions:Ie,regularGrouping:Re,minimumIntegerPartSize:Le,scalingFactor:nt,prefix:_.prefix,fractionalPartGroupingPositions:et,minimumFactionalPartSize:He,maximumFactionalPartSize:Oe,minimumExponentSize:kt,suffix:_.suffix,picture:_.subpicture}},xe=le.map(Z);xe.forEach(ye);var te=xe.map(ue),Ee=s["minus-sign"],Be=s["zero-digit"],Fe=s["decimal-separator"],at=s["grouping-separator"];te.length===1&&(te.push(JSON.parse(JSON.stringify(te[0]))),te[1].prefix=Ee+te[1].prefix);var De;e>=0?De=te[0]:De=te[1];var ft;De.picture.indexOf(s.percent)!==-1?ft=e*100:De.picture.indexOf(s["per-mille"])!==-1?ft=e*1e3:ft=e;var tt,it;if(De.minimumExponentSize===0)tt=ft;else{var Ot=Math.pow(10,De.scalingFactor),Pt=Math.pow(10,De.scalingFactor-1);for(tt=ft,it=0;tt<Pt;)tt*=10,it-=1;for(;tt>Ot;)tt/=10,it+=1}var xt=T(tt,De.maximumFactionalPartSize),mt=function(_,ke){var Ie=Math.abs(_).toFixed(ke);return Be!=="0"&&(Ie=Ie.split("").map(function(me){return me>="0"&&me<="9"?h[me.charCodeAt(0)-48]:me}).join("")),Ie},Y=mt(xt,De.maximumFactionalPartSize),Ue=Y.indexOf(".");for(Ue===-1?Y=Y+Fe:Y=Y.replace(".",Fe);Y.charAt(0)===Be;)Y=Y.substring(1);for(;Y.charAt(Y.length-1)===Be;)Y=Y.substring(0,Y.length-1);Ue=Y.indexOf(Fe);var ut=De.minimumIntegerPartSize-Ue,wt=De.minimumFactionalPartSize-(Y.length-Ue-1);if(Y=(ut>0?new Array(ut+1).join(Be):"")+Y,Y=Y+(wt>0?new Array(wt+1).join(Be):""),Ue=Y.indexOf(Fe),De.regularGrouping>0)for(var Ct=Math.floor((Ue-1)/De.regularGrouping),pt=1;pt<=Ct;pt++)Y=[Y.slice(0,Ue-pt*De.regularGrouping),at,Y.slice(Ue-pt*De.regularGrouping)].join("");else De.integerPartGroupingPositions.forEach(function(_){Y=[Y.slice(0,Ue-_),at,Y.slice(Ue-_)].join(""),Ue++});if(Ue=Y.indexOf(Fe),De.fractionalPartGroupingPositions.forEach(function(_){Y=[Y.slice(0,_+Ue+1),at,Y.slice(_+Ue+1)].join("")}),Ue=Y.indexOf(Fe),(De.picture.indexOf(Fe)===-1||Ue===Y.length-1)&&(Y=Y.substring(0,Y.length-1)),typeof it<"u"){var vt=mt(it,0);ut=De.minimumExponentSize-vt.length,ut>0&&(vt=new Array(ut+1).join(Be)+vt),Y=Y+s["exponent-separator"]+(it<0?Ee:"")+vt}return Y=De.prefix+Y+De.suffix,Y}}function l(e,t){if(!(typeof e>"u")){if(e=T(e),typeof t>"u"?t=10:t=T(t),t<2||t>36)throw{code:"D3100",stack:new Error().stack,value:t};var r=e.toString(t);return r}}function w(e){var t;if(!(typeof e>"u")){if(typeof e=="number")t=e;else if(typeof e=="string"&&/^-?[0-9]+(\.[0-9]+)?([Ee][-+]?[0-9]+)?$/.test(e)&&!isNaN(parseFloat(e))&&isFinite(e))t=parseFloat(e);else if(typeof e=="string"&&/^(0[xX][0-9A-Fa-f]+)|(0[oO][0-7]+)|(0[bB][0-1]+)$/.test(e))t=Number(e);else if(e===!0)t=1;else if(e===!1)t=0;else throw{code:"D3030",value:e,stack:new Error().stack,index:1};return t}}function S(e){var t;if(!(typeof e>"u"))return t=Math.abs(e),t}function E(e){var t;if(!(typeof e>"u"))return t=Math.floor(e),t}function y(e){var t;if(!(typeof e>"u"))return t=Math.ceil(e),t}function T(e,t){var r;if(!(typeof e>"u")){if(t){var u=e.toString().split("e");e=+(u[0]+"e"+(u[1]?+u[1]+t:t))}r=Math.round(e);var s=r-e;return Math.abs(s)===.5&&Math.abs(r%2)===1&&(r=r-1),t&&(u=r.toString().split("e"),r=+(u[0]+"e"+(u[1]?+u[1]-t:-t))),Object.is(r,-0)&&(r=0),r}}function L(e){var t;if(!(typeof e>"u")){if(e<0)throw{stack:new Error().stack,code:"D3060",index:1,value:e};return t=Math.sqrt(e),t}}function X(e,t){var r;if(!(typeof e>"u")){if(r=Math.pow(e,t),!isFinite(r))throw{stack:new Error().stack,code:"D3061",index:1,value:e,exp:t};return r}}function ee(){return Math.random()}function I(e){if(!(typeof e>"u")){var t=!1;if(Array.isArray(e)){if(e.length===1)t=I(e[0]);else if(e.length>1){var r=e.filter(function(u){return I(u)});t=r.length>0}}else typeof e=="string"?e.length>0&&(t=!0):pe(e)?e!==0&&(t=!0):e!==null&&typeof e=="object"&&!b(e)?Object.keys(e).length>0&&(t=!0):typeof e=="boolean"&&e===!0&&(t=!0);return t}}function $(e){if(!(typeof e>"u"))return!I(e)}function V(e,t,r,u){var s=[t],h=se(e);return h>=2&&s.push(r),h>=3&&s.push(u),s}async function U(e,t){if(!(typeof e>"u")){for(var r=D(),u=0;u<e.length;u++){var s=V(t,e[u],u,e),h=await t.apply(this,s);typeof h<"u"&&r.push(h)}return r}}async function Pe(e,t){if(!(typeof e>"u")){for(var r=D(),u=0;u<e.length;u++){var s=e[u],h=V(t,s,u,e),k=await t.apply(this,h);I(k)&&r.push(s)}return r}}async function Ye(e,t){if(!(typeof e>"u")){for(var r=!1,u,s=0;s<e.length;s++){var h=e[s],k=!0;if(typeof t<"u"){var N=V(t,h,s,e),z=await t.apply(this,N);k=I(z)}if(k)if(!r)u=h,r=!0;else throw{stack:new Error().stack,code:"D3138",index:s}}if(!r)throw{stack:new Error().stack,code:"D3139"};return u}}function je(){for(var e=[],t=Array.prototype.slice.call(arguments),r=Math.min.apply(Math,t.map(function(h){return Array.isArray(h)?h.length:0})),u=0;u<r;u++){var s=t.map(h=>h[u]);e.push(s)}return e}async function Se(e,t,r){if(!(typeof e>"u")){var u,s=se(t);if(s<2)throw{stack:new Error().stack,code:"D3050",index:1};var h;for(typeof r>"u"&&e.length>0?(u=e[0],h=1):(u=r,h=0);h<e.length;){var k=[u,e[h]];s>=3&&k.push(h),s>=4&&k.push(e),u=await t.apply(this,k),h++}return u}}function Ne(e){var t=D();if(Array.isArray(e)){var r={};e.forEach(function(u){var s=Ne(u);s.forEach(function(h){r[h]=!0})}),t=Ne(r)}else e!==null&&typeof e=="object"&&!b(e)&&Object.keys(e).forEach(u=>t.push(u));return t}function Ze(e,t){var r;if(Array.isArray(e)){r=D();for(var u=0;u<e.length;u++){var s=Ze(e[u],t);typeof s<"u"&&(Array.isArray(s)?s.forEach(h=>r.push(h)):r.push(s))}}else e!==null&&typeof e=="object"&&!b(e)&&(r=e[t]);return r}function Qe(e,t){return typeof e>"u"?t:typeof t>"u"?e:(Array.isArray(e)||(e=D(e)),Array.isArray(t)||(t=[t]),e.concat(t))}function dt(e){return!(typeof e>"u")}function Ke(e){var t=D();if(Array.isArray(e))e.forEach(function(s){t=Qe(t,Ke(s))});else if(e!==null&&typeof e=="object"&&!C(e))for(var r in e){var u={};u[r]=e[r],t.push(u)}else t=e;return t}function x(e){if(!(typeof e>"u")){var t={};return e.forEach(function(r){for(var u in r)t[u]=r[u]}),t}}function ht(e){if(!(typeof e>"u")){if(e.length<=1)return e;for(var t=e.length,r=new Array(t),u=0;u<t;u++)r[t-u-1]=e[u];return r}}async function st(e,t){var r=D();for(var u in e){var s=V(t,e[u],u,e),h=await t.apply(this,s);typeof h<"u"&&r.push(h)}return r}function Ge(e){throw{code:"D3137",stack:new Error().stack,message:e||"$error() function evaluated"}}function rt(e,t){if(!e)throw{code:"D3141",stack:new Error().stack,message:t||"$assert() statement failed"}}function Ve(e){if(e!==void 0)return e===null?"null":pe(e)?"number":typeof e=="string"?"string":typeof e=="boolean"?"boolean":Array.isArray(e)?"array":b(e)?"function":"object"}async function ce(e,t){if(!(typeof e>"u")){if(e.length<=1)return e;var r;if(typeof t>"u"){if(!de(e)&&!ie(e))throw{stack:new Error().stack,code:"D3070",index:1};r=async function(k,N){return k>N}}else r=t;var u=async function(k,N){var z=async function(Z,ye,ue){ye.length===0?Array.prototype.push.apply(Z,ue):ue.length===0?Array.prototype.push.apply(Z,ye):await r(ye[0],ue[0])?(Z.push(ue[0]),await z(Z,ye,ue.slice(1))):(Z.push(ye[0]),await z(Z,ye.slice(1),ue))},le=[];return await z(le,k,N),le},s=async function(k){if(!Array.isArray(k)||k.length<=1)return k;var N=Math.floor(k.length/2),z=k.slice(0,N),le=k.slice(N);return z=await s(z),le=await s(le),await u(z,le)},h=await s(e);return h}}function n(e){if(!(typeof e>"u")){if(e.length<=1)return e;for(var t=new Array(e.length),r=0;r<e.length;r++){var u=Math.floor(Math.random()*(r+1));r!==u&&(t[r]=t[u]),t[u]=e[r]}return t}}function i(e){if(!(typeof e>"u")){if(!Array.isArray(e)||e.length<=1)return e;for(var t=v(e)?D():[],r=0;r<e.length;r++){for(var u=e[r],s=!1,h=0;h<t.length;h++)if(K(u,t[h])){s=!0;break}s||t.push(u)}return t}}async function o(e,t){var r={};for(var u in e){var s=e[u],h=V(t,s,u,e),k=await t.apply(this,h);I(k)&&(r[u]=s)}return Object.keys(r).length===0&&(r=void 0),r}return{sum:m,count:F,max:O,min:d,average:P,string:j,substring:G,substringBefore:ne,substringAfter:oe,lowercase:fe,uppercase:Q,length:we,trim:ze,pad:re,match:q,contains:$e,replace:Te,split:ae,join:c,formatNumber:p,formatBase:l,number:w,floor:E,ceil:y,round:T,abs:S,sqrt:L,power:X,random:ee,boolean:I,not:$,map:U,zip:je,filter:Pe,single:Ye,foldLeft:Se,sift:o,keys:Ne,lookup:Ze,append:Qe,exists:dt,spread:Ke,merge:x,reverse:ht,each:st,error:Ge,assert:rt,type:Ve,sort:ce,shuffle:n,distinct:i,base64encode:We,base64decode:a,encodeUrlComponent:f,encodeUrl:M,decodeUrlComponent:J,decodeUrl:ve}})();be.exports=R}).call(this)}).call(this,typeof global<"u"?global:typeof self<"u"?self:typeof window<"u"?window:{})},{"./utils":6}],3:[function(ge,be,Je){var W=ge("./datetime"),g=ge("./functions"),R=ge("./utils"),pe=ge("./parser"),ie=ge("./signature"),de=(function(){"use strict";var D=R.isNumeric,v=R.isArrayOfStrings,b=R.isArrayOfNumbers,C=R.createSequence,H=R.isSequence,se=R.isFunction,K=R.isLambda,A=R.isIterable,m=R.isPromise,F=R.getFunctionArity,O=R.isDeepEqual,d=Ge(null);async function P(n,i,o){var e,t=o.lookup(Symbol.for("jsonata.__evaluate_entry"));switch(t&&await t(n,i,o),n.type){case"path":e=await j(n,i,o);break;case"binary":e=await we(n,i,o);break;case"unary":e=await ze(n,i,o);break;case"name":e=re(n,i,o);break;case"string":case"number":case"value":e=B(n,i,o);break;case"wildcard":e=$e(n,i,o);break;case"descendant":e=Te(n,i,o);break;case"parent":e=o.lookup(n.slot.label);break;case"condition":e=await E(n,i,o);break;case"block":e=await y(n,i,o);break;case"bind":e=await S(n,i,o);break;case"regex":e=T(n,i,o);break;case"function":e=await V(n,i,o);break;case"variable":e=L(n,i,o);break;case"lambda":e=Ye(n,i,o);break;case"partial":e=await je(n,i,o);break;case"apply":e=await $(n,i,o);break;case"transform":e=ee(n,i,o);break}if(Object.prototype.hasOwnProperty.call(n,"predicate"))for(var r=0;r<n.predicate.length;r++)e=await Q(n.predicate[r].expr,e,o);n.type!=="path"&&Object.prototype.hasOwnProperty.call(n,"group")&&(e=await p(n.group,e,o));var u=o.lookup(Symbol.for("jsonata.__evaluate_exit"));return u&&await u(n,i,o,e),e&&H(e)&&!e.tupleStream&&(n.keepArray&&(e.keepSingleton=!0),e.length===0?e=void 0:e.length===1&&(e=e.keepSingleton?e:e[0])),e}async function j(n,i,o){var e;Array.isArray(i)&&n.steps[0].type!=="variable"?e=i:e=C(i);for(var t,r=!1,u=void 0,s=0;s<n.steps.length;s++){var h=n.steps[s];if(h.tuple&&(r=!0),s===0&&h.consarray?t=await P(h,e,o):r?u=await fe(h,e,u,o):t=await ne(h,e,o,s===n.steps.length-1),!r&&(typeof t>"u"||t.length===0))break;typeof h.focus>"u"&&(e=t)}if(r)if(n.tuple)t=u;else for(t=C(),s=0;s<u.length;s++)t.push(u[s]["@"]);return n.keepSingletonArray&&(Array.isArray(t)&&t.cons&&!t.sequence&&(t=C(t)),t.keepSingleton=!0),n.hasOwnProperty("group")&&(t=await p(n.group,r?u:t,o)),t}function G(n,i){var o=Ge(n);for(let e in i)o.bind(e,i[e]);return o}async function ne(n,i,o,e){var t;if(n.type==="sort")return t=await X(n,i,o),n.stages&&(t=await oe(n.stages,t,o)),t;t=C();for(var r=0;r<i.length;r++){var u=await P(n,i[r],o);if(n.stages)for(var s=0;s<n.stages.length;s++)u=await Q(n.stages[s].expr,u,o);typeof u<"u"&&t.push(u)}var h=C();return e&&t.length===1&&Array.isArray(t[0])&&!H(t[0])?h=t[0]:t.forEach(function(k){!Array.isArray(k)||k.cons?h.push(k):k.forEach(N=>h.push(N))}),h}async function oe(n,i,o){for(var e=i,t=0;t<n.length;t++){var r=n[t];switch(r.type){case"filter":e=await Q(r.expr,e,o);break;case"index":for(var u=0;u<e.length;u++){var s=e[u];s[r.value]=u}break}}return e}async function fe(n,i,o,e){var t;if(n.type==="sort"){if(o)t=await X(n,o,e);else{var r=await X(n,i,e);t=C(),t.tupleStream=!0;for(var u=0;u<r.length;u++){var s={"@":r[u]};s[n.index]=u,t.push(s)}}return n.stages&&(t=await oe(n.stages,t,e)),t}t=C(),t.tupleStream=!0;var h=e;o===void 0&&(o=i.map(le=>({"@":le})));for(var k=0;k<o.length;k++){h=G(e,o[k]);var N=await P(n,o[k]["@"],h);if(typeof N<"u"){Array.isArray(N)||(N=[N]);for(var z=0;z<N.length;z++)s={},Object.assign(s,o[k]),N.tupleStream?Object.assign(s,N[z]):(n.focus?(s[n.focus]=N[z],s["@"]=o[k]["@"]):s["@"]=N[z],n.index&&(s[n.index]=z),n.ancestor&&(s[n.ancestor.label]=o[k]["@"])),t.push(s)}}return n.stages&&(t=await oe(n.stages,t,e)),t}async function Q(n,i,o){var e=C();if(i&&i.tupleStream&&(e.tupleStream=!0),Array.isArray(i)||(i=C(i)),n.type==="number"){var t=Math.floor(n.value);t<0&&(t=i.length+t);var r=await i[t];typeof r<"u"&&(Array.isArray(r)?e=r:e.push(r))}else for(t=0;t<i.length;t++){var r=i[t],u=r,s=o;i.tupleStream&&(u=r["@"],s=G(o,r));var h=await P(n,u,s);D(h)&&(h=[h]),b(h)?h.forEach(function(N){var z=Math.floor(N);z<0&&(z=i.length+z),z===t&&e.push(r)}):g.boolean(h)&&e.push(r)}return e}async function we(n,i,o){var e,t=await P(n.lhs,i,o),r=n.value,u=async()=>await P(n.rhs,i,o);if(r==="and"||r==="or")try{return await ve(t,u,r)}catch(h){throw h.position=n.position,h.token=r,h}var s=await u();try{switch(r){case"+":case"-":case"*":case"/":case"%":e=a(t,s,r);break;case"=":case"!=":e=f(t,s,r);break;case"<":case"<=":case">":case">=":e=M(t,s,r);break;case"&":e=c(t,s);break;case"..":e=w(t,s);break;case"in":e=J(t,s);break}}catch(h){throw h.position=n.position,h.token=r,h}return e}async function ze(n,i,o){var e;switch(n.value){case"-":if(e=await P(n.expression,i,o),typeof e>"u")e=void 0;else if(D(e))e=-e;else throw{code:"D1002",stack:new Error().stack,position:n.position,token:n.value,value:e};break;case"[":e=[];let u=await Promise.all(n.expressions.map(async(s,h)=>(o.isParallelCall=h>0,[s,await P(s,i,o)])));for(let s of u){var[t,r]=s;typeof r<"u"&&(t.value==="["?e.push(r):e=g.append(e,r))}n.consarray&&Object.defineProperty(e,"cons",{enumerable:!1,configurable:!1,value:!0});break;case"{":e=await p(n,i,o);break}return e}function re(n,i,o){return g.lookup(i,n.value)}function B(n){return n.value}function $e(n,i){var o=C();return Array.isArray(i)&&i.outerWrapper&&i.length>0&&(i=i[0]),i!==null&&typeof i=="object"&&Object.keys(i).forEach(function(e){var t=i[e];Array.isArray(t)?(t=q(t),o=g.append(o,t)):o.push(t)}),o}function q(n,i){return typeof i>"u"&&(i=[]),Array.isArray(n)?n.forEach(function(o){q(o,i)}):i.push(n),i}function Te(n,i){var o,e=C();return typeof i<"u"&&(We(i,e),e.length===1?o=e[0]:o=e),o}function We(n,i){Array.isArray(n)||i.push(n),Array.isArray(n)?n.forEach(function(o){We(o,i)}):n!==null&&typeof n=="object"&&Object.keys(n).forEach(function(o){We(n[o],i)})}function a(n,i,o){var e;if(typeof n<"u"&&!D(n))throw{code:"T2001",stack:new Error().stack,value:n};if(typeof i<"u"&&!D(i))throw{code:"T2002",stack:new Error().stack,value:i};if(typeof n>"u"||typeof i>"u")return e;switch(o){case"+":e=n+i;break;case"-":e=n-i;break;case"*":e=n*i;break;case"/":e=n/i;break;case"%":e=n%i;break}return e}function f(n,i,o){var e,t=typeof n,r=typeof i;if(t==="undefined"||r==="undefined")return!1;switch(o){case"=":e=O(n,i);break;case"!=":e=!O(n,i);break}return e}function M(n,i,o){var e,t=typeof n,r=typeof i,u=t==="undefined"||t==="string"||t==="number",s=r==="undefined"||r==="string"||r==="number";if(!u||!s)throw{code:"T2010",stack:new Error().stack,value:t==="string"||t==="number"?i:n};if(!(t==="undefined"||r==="undefined")){if(t!==r)throw{code:"T2009",stack:new Error().stack,value:n,value2:i};switch(o){case"<":e=n<i;break;case"<=":e=n<=i;break;case">":e=n>i;break;case">=":e=n>=i;break}return e}}function J(n,i){var o=!1;if(typeof n>"u"||typeof i>"u")return!1;Array.isArray(i)||(i=[i]);for(var e=0;e<i.length;e++)if(i[e]===n){o=!0;break}return o}async function ve(n,i,o){var e,t=ae(n);switch(o){case"and":e=t&&ae(await i());break;case"or":e=t||ae(await i());break}return e}function ae(n){var i=g.boolean(n);return typeof i>"u"?!1:i}function c(n,i){var o,e="",t="";return typeof n<"u"&&(e=g.string(n)),typeof i<"u"&&(t=g.string(i)),o=e.concat(t),o}async function p(n,i,o){var e={},t={},r=!!(i&&i.tupleStream);Array.isArray(i)||(i=C(i)),i.length===0&&i.push(void 0);for(var u=0;u<i.length;u++)for(var s=i[u],h=r?G(o,s):o,k=0;k<n.lhs.length;k++){var N=n.lhs[k],z=await P(N[0],r?s["@"]:s,h);if(typeof z!="string"&&z!==void 0)throw{code:"T1003",stack:new Error().stack,position:n.position,value:z};if(z!==void 0){var le={data:s,exprIndex:k};if(t.hasOwnProperty(z)){if(t[z].exprIndex!==k)throw{code:"D1009",stack:new Error().stack,position:n.position,value:z};t[z].data=g.append(t[z].data,s)}else t[z]=le}}let Z=await Promise.all(Object.keys(t).map(async(ue,xe)=>{let te=t[ue];var Ee=te.data,Be=o;if(r){var Fe=l(te.data);Ee=Fe["@"],delete Fe["@"],Be=G(o,Fe)}return o.isParallelCall=xe>0,[ue,await P(n.lhs[te.exprIndex][1],Ee,Be)]}));for(let ue of Z){var[z,ye]=await ue;typeof ye<"u"&&(e[z]=ye)}return e}function l(n){if(!Array.isArray(n))return n;var i={};Object.assign(i,n[0]);for(var o=1;o<n.length;o++)for(let e in n[o])i[e]=g.append(i[e],n[o][e]);return i}function w(n,i){var o;if(typeof n<"u"&&!Number.isInteger(n))throw{code:"T2003",stack:new Error().stack,value:n};if(typeof i<"u"&&!Number.isInteger(i))throw{code:"T2004",stack:new Error().stack,value:i};if(typeof n>"u"||typeof i>"u"||n>i)return o;var e=i-n+1;if(e>1e7)throw{code:"D2014",stack:new Error().stack,value:e};o=new Array(e);for(var t=n,r=0;t<=i;t++,r++)o[r]=t;return o.sequence=!0,o}async function S(n,i,o){var e=await P(n.rhs,i,o);return o.bind(n.lhs.value,e),e}async function E(n,i,o){var e,t=await P(n.condition,i,o);return g.boolean(t)?e=await P(n.then,i,o):typeof n.else<"u"&&(e=await P(n.else,i,o)),e}async function y(n,i,o){for(var e,t=Ge(o),r=0;r<n.expressions.length;r++)e=await P(n.expressions[r],i,t);return e}function T(n){var i=new ce.RegexEngine(n.value),o=function(e,t){var r;i.lastIndex=t||0;var u=i.exec(e);if(u!==null){if(r={match:u[0],start:u.index,end:u.index+u[0].length,groups:[]},u.length>1)for(var s=1;s<u.length;s++)r.groups.push(u[s]);r.next=function(){if(!(i.lastIndex>=e.length)){var h=o(e,i.lastIndex);if(h&&h.match==="")throw{code:"D1004",stack:new Error().stack,position:n.position,value:n.value.source};return h}}}return r};return o}function L(n,i,o){var e;return n.value===""?e=i&&i.outerWrapper?i[0]:i:e=o.lookup(n.value),e}async function X(n,i,o){var e,t=i,r=!!i.tupleStream,u=async function(h,k){for(var N=0,z=0;N===0&&z<n.terms.length;z++){var le=n.terms[z],Z=h,ye=o;r&&(Z=h["@"],ye=G(o,h));var ue=await P(le.expression,Z,ye);Z=k,ye=o,r&&(Z=k["@"],ye=G(o,k));var xe=await P(le.expression,Z,ye),te=typeof ue,Ee=typeof xe;if(te==="undefined"){N=Ee==="undefined"?0:1;continue}if(Ee==="undefined"){N=-1;continue}if(!(te==="string"||te==="number")||!(Ee==="string"||Ee==="number"))throw{code:"T2008",stack:new Error().stack,position:n.position,value:te==="string"||te==="number"?xe:ue};if(te!==Ee)throw{code:"T2007",stack:new Error().stack,position:n.position,value:ue,value2:xe};ue!==xe&&(ue<xe?N=-1:N=1,le.descending===!0&&(N=-N))}return N===1},s={environment:o,input:i};return e=await g.sort.apply(s,[t,u]),e}function ee(n,i,o){var e=async function(t){if(!(typeof t>"u")){var r=o.lookup("clone");if(!se(r))throw{code:"T2013",stack:new Error().stack,position:n.position};var u=await U(r,[t],null,o),s=await P(n.pattern,u,o);if(typeof s<"u"){Array.isArray(s)||(s=[s]);for(var h=0;h<s.length;h++){var k=s[h];if(k&&(k.isPrototypeOf(u)||k instanceof Object.constructor))throw{code:"D1010",stack:new Error().stack,position:n.position};var N=await P(n.update,k,o),z=typeof N;if(z!=="undefined"){if(z!=="object"||N===null||Array.isArray(N))throw{code:"T2011",stack:new Error().stack,position:n.update.position,value:N};for(var le in N)k[le]=N[le]}if(typeof n.delete<"u"){var Z=await P(n.delete,k,o);if(typeof Z<"u"){var ye=Z;if(Array.isArray(Z)||(Z=[Z]),!v(Z))throw{code:"T2012",stack:new Error().stack,position:n.delete.position,value:ye};for(var ue=0;ue<Z.length;ue++)typeof k=="object"&&k!==null&&delete k[Z[ue]]}}}}return u}};return x(e,"<(oa):o>")}var I=pe("function($f, $g) { function($x){ $g($f($x)) } }");async function $(n,i,o){var e,t=await P(n.lhs,i,o);if(n.rhs.type==="function")e=await V(n.rhs,i,o,{context:t});else{var r=await P(n.rhs,i,o);if(!se(r))throw{code:"T2006",stack:new Error().stack,position:n.position,value:r};if(se(t)){var u=await P(I,null,o);e=await U(u,[t,r],null,o)}else e=await U(r,[t],null,o)}return e}async function V(n,i,o,e){var t,r=await P(n.procedure,i,o);if(typeof r>"u"&&n.procedure.type==="path"&&o.lookup(n.procedure.steps[0].value))throw{code:"T1005",stack:new Error().stack,position:n.position,token:n.procedure.steps[0].value};var u=[];typeof e<"u"&&u.push(e.context);for(var s=0;s<n.arguments.length;s++){let k=await P(n.arguments[s],i,o);if(se(k)){let N=async function(...z){return await U(k,z,null,o)};N.arity=F(k),u.push(N)}else u.push(k)}var h=n.procedure.type==="path"?n.procedure.steps[0].value:n.procedure.value;try{typeof r=="object"&&(r.token=h,r.position=n.position),t=await U(r,u,i,o)}catch(k){throw k.position||(k.position=n.position),k.token||(k.token=h),k}return t}async function U(n,i,o,e){var t;for(t=await Pe(n,i,o,e);K(t)&&t.thunk===!0;){var r=await P(t.body.procedure,t.input,t.environment);t.body.procedure.type==="variable"&&(r.token=t.body.procedure.value),r.position=t.body.procedure.position;for(var u=[],s=0;s<t.body.arguments.length;s++)u.push(await P(t.body.arguments[s],t.input,t.environment));t=await Pe(r,u,o,e)}return t}async function Pe(n,i,o,e){var t;try{var r=i;if(n&&(r=Se(n.signature,i,o)),K(n))t=await Ne(n,r);else if(n&&n._jsonata_function===!0){var u={environment:e,input:o};t=n.implementation.apply(u,r),A(t)&&(t=t.next().value),m(t)&&(t=await t)}else if(typeof n=="function")t=n.apply(o,r),m(t)&&(t=await t);else throw{code:"T1006",stack:new Error().stack}}catch(s){throw n&&(typeof s.token>"u"&&typeof n.token<"u"&&(s.token=n.token),s.position=n.position||s.position),s}return t}function Ye(n,i,o){var e={_jsonata_lambda:!0,input:i,environment:o,arguments:n.arguments,signature:n.signature,body:n.body};return n.thunk===!0&&(e.thunk=!0),e.apply=async function(t,r){return await U(e,r,i,t?t.environment:o)},e}async function je(n,i,o){for(var e,t=[],r=0;r<n.arguments.length;r++){var u=n.arguments[r];u.type==="operator"&&u.value==="?"?t.push(u):t.push(await P(u,i,o))}var s=await P(n.procedure,i,o);if(typeof s>"u"&&n.procedure.type==="path"&&o.lookup(n.procedure.steps[0].value))throw{code:"T1007",stack:new Error().stack,position:n.position,token:n.procedure.steps[0].value};if(K(s))e=Ze(s,t);else if(s&&s._jsonata_function===!0)e=Qe(s.implementation,t);else if(typeof s=="function")e=Qe(s,t);else throw{code:"T1008",stack:new Error().stack,position:n.position,token:n.procedure.type==="path"?n.procedure.steps[0].value:n.procedure.value};return e}function Se(n,i,o){if(typeof n>"u")return i;var e=n.validate(i,o);return e}async function Ne(n,i){var o,e=Ge(n.environment);return n.arguments.forEach(function(t,r){e.bind(t.value,i[r])}),typeof n.body=="function"?o=await dt(n.body,e):o=await P(n.body,n.input,e),o}function Ze(n,i){var o=Ge(n.environment),e=[];n.arguments.forEach(function(r,u){var s=i[u];s&&s.type==="operator"&&s.value==="?"?e.push(r):o.bind(r.value,s)});var t={_jsonata_lambda:!0,input:n.input,environment:o,arguments:e,body:n.body};return t}function Qe(n,i){var o=Ke(n);o=o.map(function(u){return"$"+u.trim()});var e="function("+o.join(", ")+"){ _ }",t=pe(e);t.body=n;var r=Ze(t,i);return r}async function dt(n,i){var o=Ke(n),e=o.map(function(u){return i.lookup(u.trim())}),t={environment:i},r=n.apply(t,e);return m(r)&&(r=await r),r}function Ke(n){var i=n.toString(),o=/\(([^)]*)\)/.exec(i)[1],e=o.split(",");return e}function x(n,i){var o={_jsonata_function:!0,implementation:n};return typeof i<"u"&&(o.signature=ie(i)),o}async function ht(n,i){if(!(typeof n>"u")){var o=this.input;typeof i<"u"&&(o=i,Array.isArray(o)&&!H(o)&&(o=C(o),o.outerWrapper=!0));try{var e=pe(n,!1)}catch(r){throw Ve(r),{stack:new Error().stack,code:"D3120",value:r.message,error:r}}try{var t=await P(e,o,this.environment)}catch(r){throw Ve(r),{stack:new Error().stack,code:"D3121",value:r.message,error:r}}return t}}function st(n){if(!(typeof n>"u"))return JSON.parse(g.string(n))}function Ge(n){var i={};let o={bind:function(t,r){i[t]=r},lookup:function(t){var r;return i.hasOwnProperty(t)?r=i[t]:n&&(r=n.lookup(t)),r},timestamp:n?n.timestamp:null,async:n?n.async:!1,isParallelCall:n?n.isParallelCall:!1,global:n?n.global:{ancestry:[null]}};if(n){var e=n.lookup(Symbol.for("jsonata.__createFrame_push"));e&&e(n,o)}return o}d.bind("sum",x(g.sum,"<a<n>:n>")),d.bind("count",x(g.count,"<a:n>")),d.bind("max",x(g.max,"<a<n>:n>")),d.bind("min",x(g.min,"<a<n>:n>")),d.bind("average",x(g.average,"<a<n>:n>")),d.bind("string",x(g.string,"<x-b?:s>")),d.bind("substring",x(g.substring,"<s-nn?:s>")),d.bind("substringBefore",x(g.substringBefore,"<s-s:s>")),d.bind("substringAfter",x(g.substringAfter,"<s-s:s>")),d.bind("lowercase",x(g.lowercase,"<s-:s>")),d.bind("uppercase",x(g.uppercase,"<s-:s>")),d.bind("length",x(g.length,"<s-:n>")),d.bind("trim",x(g.trim,"<s-:s>")),d.bind("pad",x(g.pad,"<s-ns?:s>")),d.bind("match",x(g.match,"<s-f<s:o>n?:a<o>>")),d.bind("contains",x(g.contains,"<s-(sf):b>")),d.bind("replace",x(g.replace,"<s-(sf)(sf)n?:s>")),d.bind("split",x(g.split,"<s-(sf)n?:a<s>>")),d.bind("join",x(g.join,"<a<s>s?:s>")),d.bind("formatNumber",x(g.formatNumber,"<n-so?:s>")),d.bind("formatBase",x(g.formatBase,"<n-n?:s>")),d.bind("formatInteger",x(W.formatInteger,"<n-s:s>")),d.bind("parseInteger",x(W.parseInteger,"<s-s:n>")),d.bind("number",x(g.number,"<(nsb)-:n>")),d.bind("floor",x(g.floor,"<n-:n>")),d.bind("ceil",x(g.ceil,"<n-:n>")),d.bind("round",x(g.round,"<n-n?:n>")),d.bind("abs",x(g.abs,"<n-:n>")),d.bind("sqrt",x(g.sqrt,"<n-:n>")),d.bind("power",x(g.power,"<n-n:n>")),d.bind("random",x(g.random,"<:n>")),d.bind("boolean",x(g.boolean,"<x-:b>")),d.bind("not",x(g.not,"<x-:b>")),d.bind("map",x(g.map,"<af>")),d.bind("zip",x(g.zip,"<a+>")),d.bind("filter",x(g.filter,"<af>")),d.bind("single",x(g.single,"<af?>")),d.bind("reduce",x(g.foldLeft,"<afj?:j>")),d.bind("sift",x(g.sift,"<o-f?:o>")),d.bind("keys",x(g.keys,"<x-:a<s>>")),d.bind("lookup",x(g.lookup,"<x-s:x>")),d.bind("append",x(g.append,"<xx:a>")),d.bind("exists",x(g.exists,"<x:b>")),d.bind("spread",x(g.spread,"<x-:a<o>>")),d.bind("merge",x(g.merge,"<a<o>:o>")),d.bind("reverse",x(g.reverse,"<a:a>")),d.bind("each",x(g.each,"<o-f:a>")),d.bind("error",x(g.error,"<s?:x>")),d.bind("assert",x(g.assert,"<bs?:x>")),d.bind("type",x(g.type,"<x:s>")),d.bind("sort",x(g.sort,"<af?:a>")),d.bind("shuffle",x(g.shuffle,"<a:a>")),d.bind("distinct",x(g.distinct,"<x:x>")),d.bind("base64encode",x(g.base64encode,"<s-:s>")),d.bind("base64decode",x(g.base64decode,"<s-:s>")),d.bind("encodeUrlComponent",x(g.encodeUrlComponent,"<s-:s>")),d.bind("encodeUrl",x(g.encodeUrl,"<s-:s>")),d.bind("decodeUrlComponent",x(g.decodeUrlComponent,"<s-:s>")),d.bind("decodeUrl",x(g.decodeUrl,"<s-:s>")),d.bind("eval",x(ht,"<sx?:x>")),d.bind("toMillis",x(W.toMillis,"<s-s?:n>")),d.bind("fromMillis",x(W.fromMillis,"<n-s?s?:s>")),d.bind("clone",x(st,"<(oa)-:o>"));var rt={S0101:"String literal must be terminated by a matching quote",S0102:"Number out of range: {{token}}",S0103:"Unsupported escape sequence: \\{{token}}",S0104:"The escape sequence \\u must be followed by 4 hex digits",S0105:"Quoted property name must be terminated with a backquote (`)",S0106:"Comment has no closing tag",S0201:"Syntax error: {{token}}",S0202:"Expected {{value}}, got {{token}}",S0203:"Expected {{value}} before end of expression",S0204:"Unknown operator: {{token}}",S0205:"Unexpected token: {{token}}",S0206:"Unknown expression type: {{token}}",S0207:"Unexpected end of expression",S0208:"Parameter {{value}} of function definition must be a variable name (start with $)",S0209:"A predicate cannot follow a grouping expression in a step",S0210:"Each step can only have one grouping expression",S0211:"The symbol {{token}} cannot be used as a unary operator",S0212:"The left side of := must be a variable name (start with $)",S0213:"The literal value {{value}} cannot be used as a step within a path expression",S0214:"The right side of {{token}} must be a variable name (start with $)",S0215:"A context variable binding must precede any predicates on a step",S0216:"A context variable binding must precede the 'order-by' clause on a step",S0217:"The object representing the 'parent' cannot be derived from this expression",S0301:"Empty regular expressions are not allowed",S0302:"No terminating / in regular expression",S0402:"Choice groups containing parameterized types are not supported",S0401:"Type parameters can only be applied to functions and arrays",S0500:"Attempted to evaluate an expression containing syntax error(s)",T0410:"Argument {{index}} of function {{token}} does not match function signature",T0411:"Context value is not a compatible type with argument {{index}} of function {{token}}",T0412:"Argument {{index}} of function {{token}} must be an array of {{type}}",D1001:"Number out of range: {{value}}",D1002:"Cannot negate a non-numeric value: {{value}}",T1003:"Key in object structure must evaluate to a string; got: {{value}}",D1004:"Regular expression matches zero length string",T1005:"Attempted to invoke a non-function. Did you mean ${{{token}}}?",T1006:"Attempted to invoke a non-function",T1007:"Attempted to partially apply a non-function. Did you mean ${{{token}}}?",T1008:"Attempted to partially apply a non-function",D1009:"Multiple key definitions evaluate to same key: {{value}}",D1010:"Attempted to access the Javascript object prototype",T1010:"The matcher function argument passed to function {{token}} does not return the correct object structure",T2001:"The left side of the {{token}} operator must evaluate to a number",T2002:"The right side of the {{token}} operator must evaluate to a number",T2003:"The left side of the range operator (..) must evaluate to an integer",T2004:"The right side of the range operator (..) must evaluate to an integer",D2005:"The left side of := must be a variable name (start with $)",T2006:"The right side of the function application operator ~> must be a function",T2007:"Type mismatch when comparing values {{value}} and {{value2}} in order-by clause",T2008:"The expressions within an order-by clause must evaluate to numeric or string values",T2009:"The values {{value}} and {{value2}} either side of operator {{token}} must be of the same data type",T2010:"The expressions either side of operator {{token}} must evaluate to numeric or string values",T2011:"The insert/update clause of the transform expression must evaluate to an object: {{value}}",T2012:"The delete clause of the transform expression must evaluate to a string or array of strings: {{value}}",T2013:"The transform expression clones the input object using the $clone() function.  This has been overridden in the current scope by a non-function.",D2014:"The size of the sequence allocated by the range operator (..) must not exceed 1e6.  Attempted to allocate {{value}}.",D3001:"Attempting to invoke string function on Infinity or NaN",D3010:"Second argument of replace function cannot be an empty string",D3011:"Fourth argument of replace function must evaluate to a positive number",D3012:"Attempted to replace a matched string with a non-string value",D3020:"Third argument of split function must evaluate to a positive number",D3030:"Unable to cast value to a number: {{value}}",D3040:"Third argument of match function must evaluate to a positive number",D3050:"The second argument of reduce function must be a function with at least two arguments",D3060:"The sqrt function cannot be applied to a negative number: {{value}}",D3061:"The power function has resulted in a value that cannot be represented as a JSON number: base={{value}}, exponent={{exp}}",D3070:"The single argument form of the sort function can only be applied to an array of strings or an array of numbers.  Use the second argument to specify a comparison function",D3080:"The picture string must only contain a maximum of two sub-pictures",D3081:"The sub-picture must not contain more than one instance of the 'decimal-separator' character",D3082:"The sub-picture must not contain more than one instance of the 'percent' character",D3083:"The sub-picture must not contain more than one instance of the 'per-mille' character",D3084:"The sub-picture must not contain both a 'percent' and a 'per-mille' character",D3085:"The mantissa part of a sub-picture must contain at least one character that is either an 'optional digit character' or a member of the 'decimal digit family'",D3086:"The sub-picture must not contain a passive character that is preceded by an active character and that is followed by another active character",D3087:"The sub-picture must not contain a 'grouping-separator' character that appears adjacent to a 'decimal-separator' character",D3088:"The sub-picture must not contain a 'grouping-separator' at the end of the integer part",D3089:"The sub-picture must not contain two adjacent instances of the 'grouping-separator' character",D3090:"The integer part of the sub-picture must not contain a member of the 'decimal digit family' that is followed by an instance of the 'optional digit character'",D3091:"The fractional part of the sub-picture must not contain an instance of the 'optional digit character' that is followed by a member of the 'decimal digit family'",D3092:"A sub-picture that contains a 'percent' or 'per-mille' character must not contain a character treated as an 'exponent-separator'",D3093:"The exponent part of the sub-picture must comprise only of one or more characters that are members of the 'decimal digit family'",D3100:"The radix of the formatBase function must be between 2 and 36.  It was given {{value}}",D3110:"The argument of the toMillis function must be an ISO 8601 formatted timestamp. Given {{value}}",D3120:"Syntax error in expression passed to function eval: {{value}}",D3121:"Dynamic error evaluating the expression passed to function eval: {{value}}",D3130:"Formatting or parsing an integer as a sequence starting with {{value}} is not supported by this implementation",D3131:"In a decimal digit pattern, all digits must be from the same decimal group",D3132:"Unknown component specifier {{value}} in date/time picture string",D3133:"The 'name' modifier can only be applied to months and days in the date/time picture string, not {{value}}",D3134:"The timezone integer format specifier cannot have more than four digits",D3135:"No matching closing bracket ']' in date/time picture string",D3136:"The date/time picture string is missing specifiers required to parse the timestamp",D3137:"{{{message}}}",D3138:"The $single() function expected exactly 1 matching result.  Instead it matched more.",D3139:"The $single() function expected exactly 1 matching result.  Instead it matched 0.",D3140:"Malformed URL passed to ${{{functionName}}}(): {{value}}",D3141:"{{{message}}}"};function Ve(n){var i=rt[n.code];if(typeof i<"u"){var o=i.replace(/\{\{\{([^}]+)}}}/g,function(){return n[arguments[1]]});o=o.replace(/\{\{([^}]+)}}/g,function(){return JSON.stringify(n[arguments[1]])}),n.message=o}}function ce(n,i){var o,e;try{o=pe(n,i&&i.recover),e=o.errors,delete o.errors}catch(u){throw Ve(u),u}var t=Ge(d),r=new Date;return t.bind("now",x(function(u,s){return W.fromMillis(r.getTime(),u,s)},"<s?s?:s>")),t.bind("millis",x(function(){return r.getTime()},"<:n>")),i&&i.RegexEngine?ce.RegexEngine=i.RegexEngine:ce.RegexEngine=RegExp,{evaluate:async function(u,s,h){if(typeof e<"u"){var k={code:"S0500",position:0};throw Ve(k),k}if(typeof s<"u"){var N;N=Ge(t);for(var z in s)N.bind(z,s[z])}else N=t;N.bind("$",u),r=new Date,N.timestamp=r,Array.isArray(u)&&!H(u)&&(u=C(u),u.outerWrapper=!0);var le;try{return le=await P(o,u,N),typeof h=="function"&&h(null,le),le}catch(Z){throw Ve(Z),Z}},assign:function(u,s){t.bind(u,s)},registerFunction:function(u,s,h){var k=x(s,h);t.bind(u,k)},ast:function(){return o},errors:function(){return e}}}return ce.parser=pe,ce})();be.exports=de},{"./datetime":1,"./functions":2,"./parser":4,"./signature":5,"./utils":6}],4:[function(ge,be,Je){var W=ge("./signature");let g=(()=>{"use strict";var R={".":75,"[":80,"]":0,"{":70,"}":0,"(":80,")":0,",":0,"@":80,"#":80,";":80,":":80,"?":20,"+":50,"-":50,"*":60,"/":60,"%":60,"|":20,"=":40,"<":40,">":40,"^":40,"**":60,"..":20,":=":10,"!=":40,"<=":40,">=":40,"~>":40,"?:":40,"??":40,and:30,or:25,in:40,"&":50,"!":0,"~":0},pe={'"':'"',"\\":"\\","/":"/",b:"\b",f:"\f",n:`
`,r:"\r",t:"	"},ie=function(D){var v=0,b=D.length,C=function(K,A){var m={type:K,value:A,position:v};return m},H=function(){for(var K=v,A=0,m,F,O=function(P){if(D.charAt(P)==="/"&&A===0){for(var j=0;D.charAt(P-(j+1))==="\\";)j++;if(j%2===0)return!0}return!1};v<b;){var d=D.charAt(v);if(O(v)){if(m=D.substring(K,v),m==="")throw{code:"S0301",stack:new Error().stack,position:v};for(v++,d=D.charAt(v),K=v;d==="i"||d==="m";)v++,d=D.charAt(v);return F=D.substring(K,v)+"g",new RegExp(m,F)}(d==="("||d==="["||d==="{")&&D.charAt(v-1)!=="\\"&&A++,(d===")"||d==="]"||d==="}")&&D.charAt(v-1)!=="\\"&&A--,v++}throw{code:"S0302",stack:new Error().stack,position:v}},se=function(K){if(v>=b)return null;for(var A=D.charAt(v);v<b&&` 	
\r\v`.indexOf(A)>-1;)v++,A=D.charAt(v);if(A==="/"&&D.charAt(v+1)==="*"){var m=v;for(v+=2,A=D.charAt(v);!(A==="*"&&D.charAt(v+1)==="/");)if(A=D.charAt(++v),v>=b)throw{code:"S0106",stack:new Error().stack,position:m};return v+=2,A=D.charAt(v),se(K)}if(K!==!0&&A==="/")return v++,C("regex",H());if(A==="."&&D.charAt(v+1)===".")return v+=2,C("operator","..");if(A===":"&&D.charAt(v+1)==="=")return v+=2,C("operator",":=");if(A==="!"&&D.charAt(v+1)==="=")return v+=2,C("operator","!=");if(A===">"&&D.charAt(v+1)==="=")return v+=2,C("operator",">=");if(A==="<"&&D.charAt(v+1)==="=")return v+=2,C("operator","<=");if(A==="*"&&D.charAt(v+1)==="*")return v+=2,C("operator","**");if(A==="~"&&D.charAt(v+1)===">")return v+=2,C("operator","~>");if(A==="?"&&D.charAt(v+1)===":")return v+=2,C("operator","?:");if(A==="?"&&D.charAt(v+1)==="?")return v+=2,C("operator","??");if(Object.prototype.hasOwnProperty.call(R,A))return v++,C("operator",A);if(A==='"'||A==="'"){var F=A;v++;for(var O="";v<b;){if(A=D.charAt(v),A==="\\")if(v++,A=D.charAt(v),Object.prototype.hasOwnProperty.call(pe,A))O+=pe[A];else if(A==="u"){var d=D.substr(v+1,4);if(/^[0-9a-fA-F]+$/.test(d)){var P=parseInt(d,16);O+=String.fromCharCode(P),v+=4}else throw{code:"S0104",stack:new Error().stack,position:v}}else throw{code:"S0103",stack:new Error().stack,position:v,token:A};else{if(A===F)return v++,C("string",O);O+=A}v++}throw{code:"S0101",stack:new Error().stack,position:v}}var j=/^-?(0|([1-9][0-9]*))(\.[0-9]+)?([Ee][-+]?[0-9]+)?/,G=j.exec(D.substring(v));if(G!==null){var ne=parseFloat(G[0]);if(!isNaN(ne)&&isFinite(ne))return v+=G[0].length,C("number",ne);throw{code:"S0102",stack:new Error().stack,position:v,token:G[0]}}var oe;if(A==="`"){v++;var fe=D.indexOf("`",v);if(fe!==-1)return oe=D.substring(v,fe),v=fe+1,C("name",oe);throw v=b,{code:"S0105",stack:new Error().stack,position:v}}for(var Q=v,we;;)if(we=D.charAt(Q),Q===b||` 	
\r\v`.indexOf(we)>-1||Object.prototype.hasOwnProperty.call(R,we)){if(D.charAt(v)==="$")return oe=D.substring(v+1,Q),v=Q,C("variable",oe);switch(oe=D.substring(v,Q),v=Q,oe){case"or":case"in":case"and":return C("operator",oe);case"true":return C("value",!0);case"false":return C("value",!1);case"null":return C("value",null);default:return v===b&&oe===""?null:C("name",oe)}}else Q++};return se},de=function(D,v){var b,C,H={},se=[],K=function(){var a=[];b.id!=="(end)"&&a.push({type:b.type,value:b.value,position:b.position});for(var f=C();f!==null;)a.push(f),f=C();return a},A={nud:function(){var a={code:"S0211",token:this.value,position:this.position};if(v)return a.remaining=K(),a.type="error",se.push(a),a;throw a.stack=new Error().stack,a}},m=function(a,f){var M=H[a];return f=f||0,M?f>=M.lbp&&(M.lbp=f):(M=Object.create(A),M.id=M.value=a,M.lbp=f,H[a]=M),M},F=function(a){if(v){a.remaining=K(),se.push(a);var f=H["(error)"];return b=Object.create(f),b.error=a,b.type="(error)",b}else throw a.stack=new Error().stack,a},O=function(a,f){if(a&&b.id!==a){var M;b.id==="(end)"?M="S0203":M="S0202";var J={code:M,position:b.position,token:b.value,value:a};return F(J)}var ve=C(f);if(ve===null)return b=H["(end)"],b.position=D.length,b;var ae=ve.value,c=ve.type,p;switch(c){case"name":case"variable":p=H["(name)"];break;case"operator":if(p=H[ae],!p)return F({code:"S0204",stack:new Error().stack,position:ve.position,token:ae});break;case"string":case"number":case"value":p=H["(literal)"];break;case"regex":c="regex",p=H["(regex)"];break;default:return F({code:"S0205",stack:new Error().stack,position:ve.position,token:ae})}return b=Object.create(p),b.value=ae,b.type=c,b.position=ve.position,b},d=function(a){var f,M=b;for(O(null,!0),f=M.nud();a<b.lbp;)M=b,O(),f=M.led(f);return f},P=function(a){var f=m(a,0);f.nud=function(){return this}},j=function(a,f,M){var J=f||R[a],ve=m(a,J);return ve.led=M||function(ae){return this.lhs=ae,this.rhs=d(J),this.type="binary",this},ve},G=function(a,f,M){var J=m(a,f);return J.led=M,J},ne=function(a,f){var M=m(a);return M.nud=f||function(){return this.expression=d(70),this.type="unary",this},M};P("(end)"),P("(name)"),P("(literal)"),P("(regex)"),m(":"),m(";"),m(","),m(")"),m("]"),m("}"),m(".."),j("."),j("+"),j("-"),j("*"),j("/"),j("%"),j("="),j("<"),j(">"),j("!="),j("<="),j(">="),j("&"),j("and"),j("or"),j("in"),P("and"),P("or"),P("in"),ne("-"),j("~>"),j("??",R["??"],function(a){return this.type="condition",this.condition={type:"function",value:"(",procedure:{type:"variable",value:"exists"},arguments:[a]},this.then=a,this.else=d(0),this}),G("(error)",10,function(a){return this.lhs=a,this.error=b.error,this.remaining=K(),this.type="error",this}),ne("*",function(){return this.type="wildcard",this}),ne("**",function(){return this.type="descendant",this}),ne("%",function(){return this.type="parent",this}),j("(",R["("],function(a){if(this.procedure=a,this.type="function",this.arguments=[],b.id!==")")for(;b.type==="operator"&&b.id==="?"?(this.type="partial",this.arguments.push(b),O("?")):this.arguments.push(d(0)),b.id===",";)O(",");if(O(")",!0),a.type==="name"&&(a.value==="function"||a.value==="\u03BB")){if(this.arguments.forEach(function(ae,c){if(ae.type!=="variable")return F({code:"S0208",stack:new Error().stack,position:ae.position,token:ae.value,value:c+1})}),this.type="lambda",b.id==="<"){for(var f=b.position,M=1,J="<";M>0&&b.id!=="{"&&b.id!=="(end)";){var ve=O();ve.id===">"?M--:ve.id==="<"&&M++,J+=ve.value}O(">");try{this.signature=W(J)}catch(ae){return ae.position=f+ae.offset,F(ae)}}O("{"),this.body=d(0),O("}")}return this}),ne("(",function(){for(var a=[];b.id!==")"&&(a.push(d(0)),b.id===";");)O(";");return O(")",!0),this.type="block",this.expressions=a,this}),ne("[",function(){var a=[];if(b.id!=="]")for(;;){var f=d(0);if(b.id===".."){var M={type:"binary",value:"..",position:b.position,lhs:f};O(".."),M.rhs=d(0),f=M}if(a.push(f),b.id!==",")break;O(",")}return O("]",!0),this.expressions=a,this.type="unary",this}),j("[",R["["],function(a){if(b.id==="]"){for(var f=a;f&&f.type==="binary"&&f.value==="[";)f=f.lhs;return f.keepArray=!0,O("]"),a}else return this.lhs=a,this.rhs=d(R["]"]),this.type="binary",O("]",!0),this}),j("^",R["^"],function(a){O("(");for(var f=[];;){var M={descending:!1};if(b.id==="<"?O("<"):b.id===">"&&(M.descending=!0,O(">")),M.expression=d(0),f.push(M),b.id!==",")break;O(",")}return O(")"),this.lhs=a,this.rhs=f,this.type="binary",this});var oe=function(a){var f=[];if(b.id!=="}")for(;;){var M=d(0);O(":");var J=d(0);if(f.push([M,J]),b.id!==",")break;O(",")}return O("}",!0),typeof a>"u"?(this.lhs=f,this.type="unary"):(this.lhs=a,this.rhs=f,this.type="binary"),this};ne("{",oe),j("{",R["{"],oe),G(":=",R[":="],function(a){return a.type!=="variable"?F({code:"S0212",stack:new Error().stack,position:a.position,token:a.value}):(this.lhs=a,this.rhs=d(R[":="]-1),this.type="binary",this)}),j("@",R["@"],function(a){return this.lhs=a,this.rhs=d(R["@"]),this.rhs.type!=="variable"?F({code:"S0214",stack:new Error().stack,position:this.rhs.position,token:"@"}):(this.type="binary",this)}),j("#",R["#"],function(a){return this.lhs=a,this.rhs=d(R["#"]),this.rhs.type!=="variable"?F({code:"S0214",stack:new Error().stack,position:this.rhs.position,token:"#"}):(this.type="binary",this)}),j("?",R["?"],function(a){return this.type="condition",this.condition=a,this.then=d(0),b.id===":"&&(O(":"),this.else=d(0)),this}),j("?:",R["?:"],function(a){return this.type="condition",this.condition=a,this.then=a,this.else=d(0),this}),ne("|",function(){return this.type="transform",this.pattern=d(0),O("|"),this.update=d(0),b.id===","&&(O(","),this.delete=d(0)),O("|"),this});var fe=function(a){var f;if(a.type==="function"&&!a.predicate){var M={type:"lambda",thunk:!0,arguments:[],position:a.position};M.body=a,f=M}else if(a.type==="condition")a.then=fe(a.then),typeof a.else<"u"&&(a.else=fe(a.else)),f=a;else if(a.type==="block"){var J=a.expressions.length;J>0&&(a.expressions[J-1]=fe(a.expressions[J-1])),f=a}else f=a;return f},Q=0,we=0,ze=[],re=function(a,f){switch(a.type){case"name":case"wildcard":f.level--,f.level===0&&(typeof a.ancestor>"u"||(ze[f.index].slot.label=a.ancestor.label),a.ancestor=f,a.tuple=!0);break;case"parent":f.level++;break;case"block":a.expressions.length>0&&(a.tuple=!0,f=re(a.expressions[a.expressions.length-1],f));break;case"path":a.tuple=!0;var M=a.steps.length-1;for(f=re(a.steps[M--],f);f.level>0&&M>=0;)f=re(a.steps[M--],f);break;default:throw{code:"S0217",token:a.type,position:a.position}}return f},B=function(a,f){if(typeof f.seekingParent<"u"||f.type==="parent"){var M=typeof f.seekingParent<"u"?f.seekingParent:[];f.type==="parent"&&M.push(f.slot),typeof a.seekingParent>"u"?a.seekingParent=M:Array.prototype.push.apply(a.seekingParent,M)}},$e=function(a){var f=a.steps.length-1,M=a.steps[f],J=typeof M.seekingParent<"u"?M.seekingParent:[];M.type==="parent"&&J.push(M.slot);for(var ve=0;ve<J.length;ve++){var ae=J[ve];for(f=a.steps.length-2;ae.level>0;){if(f<0){typeof a.seekingParent>"u"?a.seekingParent=[ae]:a.seekingParent.push(ae);break}for(var c=a.steps[f--];f>=0&&c.focus&&a.steps[f].focus;)c=a.steps[f--];ae=re(c,ae)}}},q=function(a){var f;switch(a.type){case"binary":switch(a.value){case".":var M=q(a.lhs);M.type==="path"?f=M:f={type:"path",steps:[M]},M.type==="parent"&&(f.seekingParent=[M.slot]);var J=q(a.rhs);J.type==="function"&&J.procedure.type==="path"&&J.procedure.steps.length===1&&J.procedure.steps[0].type==="name"&&f.steps[f.steps.length-1].type==="function"&&(f.steps[f.steps.length-1].nextFunction=J.procedure.steps[0].value),J.type==="path"?Array.prototype.push.apply(f.steps,J.steps):(typeof J.predicate<"u"&&(J.stages=J.predicate,delete J.predicate),f.steps.push(J)),f.steps.filter(function(T){if(T.type==="number"||T.type==="value")throw{code:"S0213",stack:new Error().stack,position:T.position,value:T.value};return T.type==="string"}).forEach(function(T){T.type="name"}),f.steps.filter(function(T){return T.keepArray===!0}).length>0&&(f.keepSingletonArray=!0);var ve=f.steps[0];ve.type==="unary"&&ve.value==="["&&(ve.consarray=!0);var ae=f.steps[f.steps.length-1];ae.type==="unary"&&ae.value==="["&&(ae.consarray=!0),$e(f);break;case"[":f=q(a.lhs);var c=f,p="predicate";if(f.type==="path"&&(c=f.steps[f.steps.length-1],p="stages"),typeof c.group<"u")throw{code:"S0209",stack:new Error().stack,position:a.position};typeof c[p]>"u"&&(c[p]=[]);var l=q(a.rhs);typeof l.seekingParent<"u"&&(l.seekingParent.forEach(T=>{T.level===1?re(c,T):T.level--}),B(c,l)),c[p].push({type:"filter",expr:l,position:a.position});break;case"{":if(f=q(a.lhs),typeof f.group<"u")throw{code:"S0210",stack:new Error().stack,position:a.position};f.group={lhs:a.rhs.map(function(T){return[q(T[0]),q(T[1])]}),position:a.position};break;case"^":f=q(a.lhs),f.type!=="path"&&(f={type:"path",steps:[f]});var w={type:"sort",position:a.position};w.terms=a.rhs.map(function(T){var L=q(T.expression);return B(w,L),{descending:T.descending,expression:L}}),f.steps.push(w),$e(f);break;case":=":f={type:"bind",value:a.value,position:a.position},f.lhs=q(a.lhs),f.rhs=q(a.rhs),B(f,f.rhs);break;case"@":if(f=q(a.lhs),c=f,f.type==="path"&&(c=f.steps[f.steps.length-1]),typeof c.stages<"u"||typeof c.predicate<"u")throw{code:"S0215",stack:new Error().stack,position:a.position};if(c.type==="sort")throw{code:"S0216",stack:new Error().stack,position:a.position};a.keepArray&&(c.keepArray=!0),c.focus=a.rhs.value,c.tuple=!0;break;case"#":f=q(a.lhs),c=f,f.type==="path"?c=f.steps[f.steps.length-1]:(f={type:"path",steps:[f]},typeof c.predicate<"u"&&(c.stages=c.predicate,delete c.predicate)),typeof c.stages>"u"?c.index=a.rhs.value:c.stages.push({type:"index",value:a.rhs.value,position:a.position}),c.tuple=!0;break;case"~>":f={type:"apply",value:a.value,position:a.position},f.lhs=q(a.lhs),f.rhs=q(a.rhs),f.keepArray=f.lhs.keepArray||f.rhs.keepArray;break;default:f={type:a.type,value:a.value,position:a.position},f.lhs=q(a.lhs),f.rhs=q(a.rhs),B(f,f.lhs),B(f,f.rhs)}break;case"unary":f={type:a.type,value:a.value,position:a.position},a.value==="["?f.expressions=a.expressions.map(function(T){var L=q(T);return B(f,L),L}):a.value==="{"?f.lhs=a.lhs.map(function(T){var L=q(T[0]);B(f,L);var X=q(T[1]);return B(f,X),[L,X]}):(f.expression=q(a.expression),a.value==="-"&&f.expression.type==="number"?(f=f.expression,f.value=-f.value):B(f,f.expression));break;case"function":case"partial":f={type:a.type,name:a.name,value:a.value,position:a.position},f.arguments=a.arguments.map(function(T){var L=q(T);return B(f,L),L}),f.procedure=q(a.procedure);break;case"lambda":f={type:a.type,arguments:a.arguments,signature:a.signature,position:a.position};var S=q(a.body);f.body=fe(S);break;case"condition":f={type:a.type,position:a.position},f.condition=q(a.condition),B(f,f.condition),f.then=q(a.then),B(f,f.then),typeof a.else<"u"&&(f.else=q(a.else),B(f,f.else));break;case"transform":f={type:a.type,position:a.position},f.pattern=q(a.pattern),f.update=q(a.update),typeof a.delete<"u"&&(f.delete=q(a.delete));break;case"block":f={type:a.type,position:a.position},f.expressions=a.expressions.map(function(T){var L=q(T);return B(f,L),(L.consarray||L.type==="path"&&L.steps[0].consarray)&&(f.consarray=!0),L});break;case"name":f={type:"path",steps:[a]},a.keepArray&&(f.keepSingletonArray=!0);break;case"parent":f={type:"parent",slot:{label:"!"+Q++,level:1,index:we++}},ze.push(f);break;case"string":case"number":case"value":case"wildcard":case"descendant":case"variable":case"regex":f=a;break;case"operator":if(a.value==="and"||a.value==="or"||a.value==="in")a.type="name",f=q(a);else if(a.value==="?")f=a;else throw{code:"S0201",stack:new Error().stack,position:a.position,token:a.value};break;case"error":f=a,a.lhs&&(f=q(a.lhs));break;default:var E="S0206";a.id==="(end)"&&(E="S0207");var y={code:E,position:a.position,token:a.value};if(v)return se.push(y),{type:"error",error:y};throw y.stack=new Error().stack,y}return a.keepArray&&(f.keepArray=!0),f};C=ie(D),O();var Te=d(0);if(b.id!=="(end)"){var We={code:"S0201",position:b.position,token:b.value};F(We)}if(Te=q(Te),Te.type==="parent"||typeof Te.seekingParent<"u")throw{code:"S0217",token:Te.type,position:Te.position};return se.length>0&&(Te.errors=se),Te};return de})();be.exports=g},{"./signature":5}],5:[function(ge,be,Je){var W=ge("./utils");let g=(()=>{"use strict";var R={a:"arrays",b:"booleans",f:"functions",n:"numbers",o:"objects",s:"strings"};function pe(ie){for(var de=1,D=[],v={},b=v;de<ie.length;){var C=ie.charAt(de);if(C===":")break;var H=function(){D.push(v),b=v,v={}},se=function(j,G,ne,oe){for(var fe=1,Q=G;Q<j.length;)if(Q++,C=j.charAt(Q),C===oe){if(fe--,fe===0)break}else C===ne&&fe++;return Q};switch(C){case"s":case"n":case"b":case"l":case"o":v.regex="["+C+"m]",v.type=C,H();break;case"a":v.regex="[asnblfom]",v.type=C,v.array=!0,H();break;case"f":v.regex="f",v.type=C,H();break;case"j":v.regex="[asnblom]",v.type=C,H();break;case"x":v.regex="[asnblfom]",v.type=C,H();break;case"-":b.context=!0,b.contextRegex=new RegExp(b.regex),b.regex+="?";break;case"?":case"+":b.regex+=C;break;case"(":var K=se(ie,de,"(",")"),A=ie.substring(de+1,K);if(A.indexOf("<")===-1)v.regex="["+A+"m]";else throw{code:"S0402",stack:new Error().stack,value:A,offset:de};v.type="("+A+")",de=K,H();break;case"<":if(b.type==="a"||b.type==="f"){var m=se(ie,de,"<",">");b.subtype=ie.substring(de+1,m),de=m}else throw{code:"S0401",stack:new Error().stack,value:b.type,offset:de};break}de++}var F="^"+D.map(function(j){return"("+j.regex+")"}).join("")+"$",O=new RegExp(F),d=function(j){var G;if(W.isFunction(j))G="f";else{var ne=typeof j;switch(ne){case"string":G="s";break;case"number":G="n";break;case"boolean":G="b";break;case"object":j===null?G="l":Array.isArray(j)?G="a":G="o";break;case"undefined":default:G="m"}}return G},P=function(j,G){for(var ne="^",oe=0,fe=0;fe<D.length;fe++){ne+=D[fe].regex;var Q=G.match(ne);if(Q===null)throw{code:"T0410",stack:new Error().stack,value:j[oe],index:oe+1};oe=Q[0].length}throw{code:"T0410",stack:new Error().stack,value:j[oe],index:oe+1}};return{definition:ie,validate:function(j,G){var ne="";j.forEach(function(we){ne+=d(we)});var oe=O.exec(ne);if(oe){var fe=[],Q=0;return D.forEach(function(we,ze){var re=j[Q],B=oe[ze+1];if(B==="")if(we.context&&we.contextRegex){var $e=d(G);if(we.contextRegex.test($e))fe.push(G);else throw{code:"T0411",stack:new Error().stack,value:G,index:Q+1}}else fe.push(re),Q++;else B.split("").forEach(function(q){if(we.type==="a"){if(q==="m")re=void 0;else{re=j[Q];var Te=!0;if(typeof we.subtype<"u"){if(q!=="a"&&B!==we.subtype)Te=!1;else if(q==="a"&&re.length>0){var We=d(re[0]);if(We!==we.subtype.charAt(0))Te=!1;else{var a=re.filter(function(f){return d(f)!==We});Te=a.length===0}}}if(!Te)throw{code:"T0412",stack:new Error().stack,value:re,index:Q+1,type:R[we.subtype]};q!=="a"&&(re=[re])}fe.push(re),Q++}else fe.push(re),Q++})}),fe}P(j,ne)}}}return pe})();be.exports=g},{"./utils":6}],6:[function(ge,be,Je){let W=(()=>{"use strict";function g(m){var F=!1;if(typeof m=="number"&&(F=!isNaN(m),F&&!isFinite(m)))throw{code:"D1001",value:m,stack:new Error().stack};return F}function R(m){var F=!1;return Array.isArray(m)&&(F=m.filter(function(O){return typeof O!="string"}).length===0),F}function pe(m){var F=!1;return Array.isArray(m)&&(F=m.filter(function(O){return!g(O)}).length===0),F}function ie(){var m=[];return m.sequence=!0,arguments.length===1&&m.push(arguments[0]),m}function de(m){return m.sequence===!0&&Array.isArray(m)}function D(m){return m&&(m._jsonata_function===!0||m._jsonata_lambda===!0)||typeof m=="function"}function v(m){var F=typeof m.arity=="number"?m.arity:typeof m.implementation=="function"?m.implementation.length:typeof m.length=="number"?m.length:m.arguments.length;return F}function b(m){return m&&m._jsonata_lambda===!0}var C=(typeof Symbol=="function"?Symbol:{}).iterator||"@@iterator";function H(m){return typeof m=="object"&&m!==null&&C in m&&"next"in m&&typeof m.next=="function"}function se(m,F){if(m===F)return!0;if(typeof m=="object"&&typeof F=="object"&&m!==null&&F!==null){if(Array.isArray(m)&&Array.isArray(F)){if(m.length!==F.length)return!1;for(var O=0;O<m.length;O++)if(!se(m[O],F[O]))return!1;return!0}var d=Object.getOwnPropertyNames(m),P=Object.getOwnPropertyNames(F);if(d.length!==P.length)return!1;for(d=d.sort(),P=P.sort(),O=0;O<d.length;O++)if(d[O]!==P[O])return!1;for(O=0;O<d.length;O++){var j=d[O];if(!se(m[j],F[j]))return!1}return!0}return!1}function K(m){return typeof m=="object"&&m!==null&&"then"in m&&typeof m.then=="function"}function A(m){var F=[];for(let O of m)F.push(O);return F}return{isNumeric:g,isArrayOfStrings:R,isArrayOfNumbers:pe,createSequence:ie,isSequence:de,isFunction:D,isLambda:b,isIterable:H,getFunctionArity:v,isDeepEqual:se,stringToArray:A,isPromise:K}})();be.exports=W},{}]},{},[3])(3)})});var St=Lt(Tt(),1),Dt=class{#t={};#n=!1;#e={results:{},variables:{global:{},locals:[]}};#r={set:null,get:null};constructor({functions:he={},explicitInitsOnly:Ce=!1}={}){this.#t=he,this.#n=Ce}async run({aliases:he={},inits:Ce={},connections:ge=[]}={}){if(this.#e.results={},this.#n&&Object.keys(Ce).length===0)throw new Error('When "explicitInitsOnly" is true, "inits" cannot be empty.');let be=W=>{let g=he[W]?this.#t[he[W]]:this.#t[W];if(!g)throw new Error(`Function or Alias ${W} not existing.`);return g};if(!this.#n){let W={};for(let g of ge){for(let R of g.from??[])W[R]=[];for(let R of g.to??[])W[R]&&delete W[R]}for(let g of Object.keys(W))Ce[g]||(Ce[g]=W[g])}for(let W of Object.keys(Ce)){if(!Array.isArray(Ce[W]))throw new Error(`The "inits.${W}" value must be an array.`);this.#e.results[W]=Promise.resolve(be(W)(...Ce[W]))}this.#e.variables={global:{},locals:new Array(ge.length).fill(null).map(()=>({}))},await(async()=>{let W;do{W=!1;for(let g=0;g<ge.length;g++){let R=ge[g],pe=!0,ie=[],de=R.from??[];if(de.length===0)throw new Error(`The connection ${g} from is an empty array.
Connection: ${JSON.stringify(R)}`);for(let D of de)if(Object.hasOwn(this.#e.results,D))ie.push(this.#e.results[D]);else{pe=!1;break}if(pe){let D={},v=A=>{let m=typeof A;if(m==="function"||m==="symbol"){let F=globalThis.crypto.randomUUID();return D[F]=A,F}else if(m==="object"){if(A===null)return null;let F=Array.isArray(A),O=F?[]:{};for(let d of F?A:Object.keys(A))F?O.push(v(d)):O[d]=v(A[d]);return O}else return A},b=A=>{let m=typeof A;if(m==="string"){for(let F of Object.keys(D))if(A===F)return D[F];return A}else if(m==="object"){if(A===null)return null;let F=Array.isArray(A),O=F?[]:{};for(let d of F?A:Object.keys(A))F?O.push(b(d)):O[d]=b(A[d]);return O}else return A},C=(await Promise.all(ie)).map(v);for(let A of de)delete this.#e.results[A];W=!0;let H=R.to??[],se={to:C.map(A=>[A]),global:this.#e.variables.global,local:this.#e.variables.locals[g]};if(R.transition)try{let A={from:C,global:this.#e.variables.global,local:this.#e.variables.locals[g]};se=await(0,St.default)(R.transition).evaluate(A)}catch(A){throw new Error(`Connection ${g} transition: ${A.message}`)}let K=se.to;if(this.#e.variables.global=se.global??this.#e.variables.global,this.#e.variables.locals[g]=se.local??this.#e.variables.locals[g],H.length>0){if(!Array.isArray(K))throw new Error(`The transition returned "to" value must be an array.
Returned: ${JSON.stringify(K)}
Connection: ${JSON.stringify(R)}`);if(K.length!=H.length)throw new Error(`The transition returned "to" value must be an array of the same length of the "connection.to" array.
Returned: ${JSON.stringify(K)}
Connection: ${JSON.stringify(R)}`);for(let A=0;A<H.length;A++){let m=H[A],F=b(K[A]);if(F!=null){if(!Array.isArray(F))throw new Error(`The transition returned "to" array value must contains only arrays of input parameters.
Returned: ${JSON.stringify(F)}
Connection: ${JSON.stringify(R)}`);this.#e.results[m]=Promise.resolve(be(m)(...F))}}}else this.#e.results["connection_"+g]=K}}}while(W)})();for(let W of Object.keys(this.#e.results))this.#e.results[W]=await this.#e.results[W];return{results:this.#e.results,variables:this.#e.variables}}};export{Dt as Orchestrator};
//# sourceMappingURL=index.min.js.map
