var Ft=Object.create;var At=Object.defineProperty;var Mt=Object.getOwnPropertyDescriptor;var Nt=Object.getOwnPropertyNames;var Ut=Object.getPrototypeOf,jt=Object.prototype.hasOwnProperty;var lt=(Ae=>typeof require<"u"?require:typeof Proxy<"u"?new Proxy(Ae,{get:(se,Re)=>(typeof require<"u"?require:se)[Re]}):Ae)(function(Ae){if(typeof require<"u")return require.apply(this,arguments);throw Error('Dynamic require of "'+Ae+'" is not supported')});var It=(Ae,se)=>()=>(se||Ae((se={exports:{}}).exports,se),se.exports);var Rt=(Ae,se,Re,Te)=>{if(se&&typeof se=="object"||typeof se=="function")for(let W of Nt(se))!jt.call(Ae,W)&&W!==Re&&At(Ae,W,{get:()=>se[W],enumerable:!(Te=Mt(se,W))||Te.enumerable});return Ae};var Lt=(Ae,se,Re)=>(Re=Ae!=null?Ft(Ut(Ae)):{},Rt(se||!Ae||!Ae.__esModule?At(Re,"default",{value:Ae,enumerable:!0}):Re,Ae));var Tt=It((Et,bt)=>{(function(Ae){if(typeof Et=="object"&&typeof bt<"u")bt.exports=Ae();else if(typeof define=="function"&&define.amd)define([],Ae);else{var se;typeof window<"u"?se=window:typeof global<"u"?se=global:typeof self<"u"?se=self:se=this,se.jsonata=Ae()}})(function(){var Ae,se,Re;return(function(){function Te(W,pe,ee){function b(Q,ce){if(!pe[Q]){if(!W[Q]){var D=typeof lt=="function"&&lt;if(!ce&&D)return D(Q,!0);if(q)return q(Q,!0);var v=new Error("Cannot find module '"+Q+"'");throw v.code="MODULE_NOT_FOUND",v}var g=pe[Q]={exports:{}};W[Q][0].call(g.exports,function(x){var X=W[Q][1][x];return b(X||x)},g,g.exports,Te,W,pe,ee)}return pe[Q].exports}for(var q=typeof lt=="function"&&lt,he=0;he<ee.length;he++)b(ee[he]);return b}return Te})()({1:[function(Te,W,pe){let ee=Te("./utils"),b=(function(){"use strict";let q=ee.stringToArray,he=["Zero","One","Two","Three","Four","Five","Six","Seven","Eight","Nine","Ten","Eleven","Twelve","Thirteen","Fourteen","Fifteen","Sixteen","Seventeen","Eighteen","Nineteen"],Q=["Zeroth","First","Second","Third","Fourth","Fifth","Sixth","Seventh","Eighth","Ninth","Tenth","Eleventh","Twelfth","Thirteenth","Fourteenth","Fifteenth","Sixteenth","Seventeenth","Eighteenth","Nineteenth"],ce=["Twenty","Thirty","Forty","Fifty","Sixty","Seventy","Eighty","Ninety","Hundred"],D=["Thousand","Million","Billion","Trillion"];function v(c,h){var l=function(T,A,y){var E="";if(T<=19)E=(A?" and ":"")+(y?Q[T]:he[T]);else if(T<100){let Z=Math.floor(T/10),te=T%10;E=(A?" and ":"")+ce[Z-2],te>0?E+="-"+l(te,!1,y):y&&(E=E.substring(0,E.length-1)+"ieth")}else if(T<1e3){let Z=Math.floor(T/100),te=T%100;E=(A?", ":"")+he[Z]+" Hundred",te>0?E+=l(te,!0,y):y&&(E+="th")}else{var j=Math.floor(Math.log10(T)/3);j>D.length&&(j=D.length);let Z=Math.pow(10,j*3),te=Math.floor(T/Z),U=T-te*Z;E=(A?", ":"")+l(te,!1,!1)+" "+D[j-1],U>0?E+=l(U,!0,y):y&&(E+="th")}return E},m=l(c,!1,h);return m}let g={};he.forEach(function(c,h){g[c.toLowerCase()]=h}),Q.forEach(function(c,h){g[c.toLowerCase()]=h}),ce.forEach(function(c,h){let l=c.toLowerCase();g[l]=(h+2)*10,g[l.substring(0,c.length-1)+"ieth"]=g[l]}),g.hundredth=100,D.forEach(function(c,h){let l=c.toLowerCase(),m=Math.pow(10,(h+1)*3);g[l]=m,g[l+"th"]=m});function x(c){let l=c.split(/,\s|\sand\s|[\s\\-]/).map(A=>g[A]),m=[0];return l.forEach(A=>{if(A<100){let y=m.pop();y>=1e3&&(m.push(y),y=0),m.push(y+A)}else m.push(m.pop()*A)}),m.reduce((A,y)=>A+y,0)}let X=[[1e3,"m"],[900,"cm"],[500,"d"],[400,"cd"],[100,"c"],[90,"xc"],[50,"l"],[40,"xl"],[10,"x"],[9,"ix"],[5,"v"],[4,"iv"],[1,"i"]],be={M:1e3,D:500,C:100,L:50,X:10,V:5,I:1};function ye(c){for(var h=0;h<X.length;h++){let l=X[h];if(c>=l[0])return l[1]+ye(c-l[0])}return""}function R(c){for(var h=0,l=1,m=c.length-1;m>=0;m--){let T=c[m],A=be[T];A<l?h-=A:(l=A,h+=A)}return h}function w(c,h){for(var l=[],m=h.charCodeAt(0);c>0;)l.unshift(String.fromCharCode((c-1)%26+m)),c=Math.floor((c-1)/26);return l.join("")}function _(c,h){for(var l=h.charCodeAt(0),m=0,T=0;T<c.length;T++)m+=(c.charCodeAt(c.length-T-1)-l+1)*Math.pow(26,T);return m}function P(c,h){if(typeof c>"u")return;c=Math.floor(c);let l=re(h);return F(c,l)}let p={DECIMAL:"decimal",LETTERS:"letters",ROMAN:"roman",WORDS:"words",SEQUENCE:"sequence"},S={UPPER:"upper",LOWER:"lower",TITLE:"title"};function F(c,h){let l,m=c<0;switch(c=Math.abs(c),h.primary){case p.LETTERS:l=w(c,h.case===S.UPPER?"A":"a");break;case p.ROMAN:l=ye(c),h.case===S.UPPER&&(l=l.toUpperCase());break;case p.WORDS:l=v(c,h.ordinal),h.case===S.UPPER?l=l.toUpperCase():h.case===S.LOWER&&(l=l.toLowerCase());break;case p.DECIMAL:l=""+c;var T=h.mandatoryDigits-l.length;if(T>0){var A=new Array(T+1).join("0");l=A+l}if(h.zeroCode!==48&&(l=q(l).map(Z=>String.fromCodePoint(Z.codePointAt(0)+h.zeroCode-48)).join("")),h.regular){let Z=Math.floor((l.length-1)/h.groupingSeparators.position);for(let te=Z;te>0;te--){let U=l.length-te*h.groupingSeparators.position;l=l.substr(0,U)+h.groupingSeparators.character+l.substr(U)}}else h.groupingSeparators.reverse().forEach(Z=>{let te=l.length-Z.position;l=l.substr(0,te)+Z.character+l.substr(te)});if(h.ordinal){var y={1:"st",2:"nd",3:"rd"},E=l[l.length-1],j=y[E];(!j||l.length>1&&l[l.length-2]==="1")&&(j="th"),l=l+j}break;case p.SEQUENCE:throw{code:"D3130",value:h.token}}return m&&(l="-"+l),l}let H=[48,1632,1776,1984,2406,2534,2662,2790,2918,3046,3174,3302,3430,3558,3664,3792,3872,4160,4240,6112,6160,6470,6608,6784,6800,6992,7088,7232,7248,42528,43216,43264,43472,43504,43600,44016,65296];function re(c){let h={type:"integer",primary:p.DECIMAL,case:S.LOWER,ordinal:!1},l,m,T=c.lastIndexOf(";");switch(T===-1?l=c:(l=c.substring(0,T),m=c.substring(T+1),m[0]==="o"&&(h.ordinal=!0)),l){case"A":h.case=S.UPPER;case"a":h.primary=p.LETTERS;break;case"I":h.case=S.UPPER;case"i":h.primary=p.ROMAN;break;case"W":h.case=S.UPPER,h.primary=p.WORDS;break;case"Ww":h.case=S.TITLE,h.primary=p.WORDS;break;case"w":h.primary=p.WORDS;break;default:{let A=null,y=0,E=0,j=[],Z=0;if(q(l).map(U=>U.codePointAt(0)).reverse().forEach(U=>{let L=!1;for(let J=0;J<H.length;J++){let N=H[J];if(U>=N&&U<=N+9){if(L=!0,y++,Z++,A===null)A=N;else if(N!==A)throw{code:"D3131"};break}}L||(U===35?(Z++,E++):j.push({position:Z,character:String.fromCodePoint(U)}))}),y>0){h.primary=p.DECIMAL,h.zeroCode=A,h.mandatoryDigits=y,h.optionalDigits=E;let L=function(J){if(J.length===0)return 0;let N=J[0].character;for(let Oe=1;Oe<J.length;Oe++)if(J[Oe].character!==N)return 0;let xe=J.map(Oe=>Oe.position),Be=function(Oe,Ue){return Ue===0?Oe:Be(Ue,Oe%Ue)},Ne=xe.reduce(Be);for(let Oe=1;Oe<=xe.length;Oe++)if(xe.indexOf(Oe*Ne)===-1)return 0;return Ne}(j);L>0?(h.regular=!0,h.groupingSeparators={position:L,character:j[0].character}):(h.regular=!1,h.groupingSeparators=j)}else h.primary=p.SEQUENCE,h.token=l}}return h}let oe={Y:"1",M:"1",D:"1",d:"1",F:"n",W:"1",w:"1",X:"1",x:"1",H:"1",h:"1",P:"n",m:"01",s:"01",f:"1",Z:"01:01",z:"01:01",C:"n",E:"n"};function ue(c){var h=[];let l={type:"datetime",parts:h},m=function(L,J){if(J>L){let N=c.substring(L,J);N=N.split("]]").join("]"),h.push({type:"literal",value:N})}};for(var T=0,A=0;A<c.length;){if(c.charAt(A)==="["){if(c.charAt(A+1)==="["){m(T,A),h.push({type:"literal",value:"["}),A+=2,T=A;continue}if(m(T,A),T=A,A=c.indexOf("]",T),A===-1)throw{code:"D3135"};let L=c.substring(T+1,A);L=L.split(/\s+/).join("");var y={type:"marker",component:L.charAt(0)},E=L.lastIndexOf(","),j;if(E!==-1){let J=L.substring(E+1),N=J.indexOf("-"),xe,Be,Ne=function(Ue){if(!(typeof Ue>"u"||Ue==="*"))return parseInt(Ue)};N===-1?xe=J:(xe=J.substring(0,N),Be=J.substring(N+1));let Oe={min:Ne(xe),max:Ne(Be)};y.width=Oe,j=L.substring(1,E)}else j=L.substring(1);if(j.length===1)y.presentation1=j;else if(j.length>1){var Z=j.charAt(j.length-1);"atco".indexOf(Z)!==-1?(y.presentation2=Z,Z==="o"&&(y.ordinal=!0),y.presentation1=j.substring(0,j.length-1)):y.presentation1=j}else y.presentation1=oe[y.component];if(typeof y.presentation1>"u")throw{code:"D3132",value:y.component};if(y.presentation1[0]==="n")y.names=S.LOWER;else if(y.presentation1[0]==="N")y.presentation1[1]==="n"?y.names=S.TITLE:y.names=S.UPPER;else if("YMDdFWwXxHhmsf".indexOf(y.component)!==-1){var te=y.presentation1;if(y.presentation2&&(te+=";"+y.presentation2),y.integerFormat=re(te),y.width&&y.width.min!==void 0&&y.integerFormat.mandatoryDigits<y.width.min&&(y.integerFormat.mandatoryDigits=y.width.min),y.component==="Y")if(y.n=-1,y.width&&y.width.max!==void 0)y.n=y.width.max,y.integerFormat.mandatoryDigits=y.n;else{var U=y.integerFormat.mandatoryDigits+y.integerFormat.optionalDigits;U>=2&&(y.n=U)}let J=h[h.length-1];J&&J.integerFormat&&(J.integerFormat.parseWidth=J.integerFormat.mandatoryDigits)}(y.component==="Z"||y.component==="z")&&(y.integerFormat=re(y.presentation1)),h.push(y),T=A+1}A++}return m(T,A),l}let K=["","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"],we=["January","February","March","April","May","June","July","August","September","October","November","December"],$e=1e3*60*60*24,ae=function(c){let h=Date.UTC(c.year,c.month);var l=new Date(h).getUTCDay();return l===0&&(l=7),l>4?h+(8-l)*$e:h-(l-1)*$e},B=function(c,h){return{year:c,month:h,nextMonth:function(){return h===11?B(c+1,0):B(c,h+1)},previousMonth:function(){return h===0?B(c-1,11):B(c,h-1)},nextYear:function(){return B(c+1,h)},previousYear:function(){return B(c-1,h)}}},_e=function(c,h){return(h-c)/($e*7)+1},$=(c,h)=>{let l;switch(h){case"Y":l=c.getUTCFullYear();break;case"M":l=c.getUTCMonth()+1;break;case"D":l=c.getUTCDate();break;case"d":{let m=Date.UTC(c.getUTCFullYear(),c.getUTCMonth(),c.getUTCDate()),T=Date.UTC(c.getUTCFullYear(),0);l=(m-T)/$e+1;break}case"F":l=c.getUTCDay(),l===0&&(l=7);break;case"W":{let m=B(c.getUTCFullYear(),0),T=ae(m),A=Date.UTC(m.year,c.getUTCMonth(),c.getUTCDate()),y=_e(T,A);if(y>52){let E=ae(m.nextYear());A>=E&&(y=1)}else if(y<1){let E=ae(m.previousYear());y=_e(E,A)}l=Math.floor(y);break}case"w":{let m=B(c.getUTCFullYear(),c.getUTCMonth()),T=ae(m),A=Date.UTC(m.year,m.month,c.getUTCDate()),y=_e(T,A);if(y>4){let E=ae(m.nextMonth());A>=E&&(y=1)}else if(y<1){let E=ae(m.previousMonth());y=_e(E,A)}l=Math.floor(y);break}case"X":{let m=B(c.getUTCFullYear(),0),T=ae(m),A=ae(m.nextYear()),y=c.getTime();y<T?l=m.year-1:y>=A?l=m.year+1:l=m.year;break}case"x":{let m=B(c.getUTCFullYear(),c.getUTCMonth()),T=ae(m),A=m.nextMonth(),y=ae(A),E=c.getTime();E<T?l=m.previousMonth().month+1:E>=y?l=A.month+1:l=m.month+1;break}case"H":l=c.getUTCHours();break;case"h":l=c.getUTCHours(),l=l%12,l===0&&(l=12);break;case"P":l=c.getUTCHours()>=12?"pm":"am";break;case"m":l=c.getUTCMinutes();break;case"s":l=c.getUTCSeconds();break;case"f":l=c.getUTCMilliseconds();break;case"Z":case"z":break;case"C":l="ISO";break;case"E":l="ISO";break}return l},De=null;function Ye(c,h,l){var m=0,T=0;if(typeof l<"u"){let te=parseInt(l);m=Math.floor(te/100),T=te%100}var A=function(te,U){var L=$(te,U.component);if("YMDdFWwXxHhms".indexOf(U.component)!==-1)if(U.component==="Y"&&U.n!==-1&&(L=L%Math.pow(10,U.n)),U.names){if(U.component==="M"||U.component==="x")L=we[L-1];else if(U.component==="F")L=K[L];else throw{code:"D3133",value:U.component};U.names===S.UPPER?L=L.toUpperCase():U.names===S.LOWER&&(L=L.toLowerCase()),U.width&&L.length>U.width.max&&(L=L.substring(0,U.width.max))}else L=F(L,U.integerFormat);else if(U.component==="f")L=F(L,U.integerFormat);else if(U.component==="Z"||U.component==="z"){let J=m*100+T;if(U.integerFormat.regular)L=F(J,U.integerFormat);else{let N=U.integerFormat.mandatoryDigits;if(N===1||N===2)L=F(m,U.integerFormat),T!==0&&(L+=":"+P(T,"00"));else if(N===3||N===4)L=F(J,U.integerFormat);else throw{code:"D3134",value:N}}J>=0&&(L="+"+L),U.component==="z"&&(L="GMT"+L),J===0&&U.presentation2==="t"&&(L="Z")}else U.component==="P"&&U.names===S.UPPER&&(L=L.toUpperCase());return L};let y;typeof h>"u"?(De===null&&(De=ue("[Y0001]-[M01]-[D01]T[H01]:[m01]:[s01].[f001][Z01:01t]")),y=De):y=ue(h);let E=(60*m+T)*60*1e3,j=new Date(c+E),Z="";return y.parts.forEach(function(te){te.type==="literal"?Z+=te.value:Z+=A(j,te)}),Z}function a(c){var h={};if(c.type==="datetime")h.type="datetime",h.parts=c.parts.map(function(l){var m={};if(l.type==="literal")m.regex=l.value.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");else if(l.component==="Z"||l.component==="z"){let A;Array.isArray(l.integerFormat.groupingSeparators)||(A=l.integerFormat.groupingSeparators),m.regex="",l.component==="z"&&(m.regex="GMT"),m.regex+="[-+][0-9]+",A&&(m.regex+=A.character+"[0-9]+"),m.parse=function(y){l.component==="z"&&(y=y.substring(3));let E=0,j=0;return A?(E=Number.parseInt(y.substring(0,y.indexOf(A.character))),j=Number.parseInt(y.substring(y.indexOf(A.character)+1))):y.length-1<=2?E=Number.parseInt(y):(E=Number.parseInt(y.substring(0,3)),j=Number.parseInt(y.substring(3))),E*60+j}}else if(l.integerFormat)m=a(l.integerFormat);else{m.regex="[a-zA-Z]+";var T={};if(l.component==="M"||l.component==="x")we.forEach(function(A,y){l.width&&l.width.max?T[A.substring(0,l.width.max)]=y+1:T[A]=y+1});else if(l.component==="F")K.forEach(function(A,y){y>0&&(l.width&&l.width.max?T[A.substring(0,l.width.max)]=y:T[A]=y)});else if(l.component==="P")T={am:0,AM:0,pm:1,PM:1};else throw{code:"D3133",value:l.component};m.parse=function(A){return T[A]}}return m.component=l.component,m});else{h.type="integer";let l=c.case===S.UPPER;switch(c.primary){case p.LETTERS:h.regex=l?"[A-Z]+":"[a-z]+",h.parse=function(m){return _(m,l?"A":"a")};break;case p.ROMAN:h.regex=l?"[MDCLXVI]+":"[mdclxvi]+",h.parse=function(m){return R(l?m:m.toUpperCase())};break;case p.WORDS:h.regex="(?:"+Object.keys(g).concat("and","[\\-, ]").join("|")+")+",h.parse=function(m){return x(m.toLowerCase())};break;case p.DECIMAL:h.regex="[0-9]",c.parseWidth?h.regex+=`{${c.parseWidth}}`:h.regex+="+",c.ordinal&&(h.regex+="(?:th|st|nd|rd)"),h.parse=function(m){let T=m;return c.ordinal&&(T=m.substring(0,m.length-2)),c.regular?T=T.split(",").join(""):c.groupingSeparators.forEach(A=>{T=T.split(A.character).join("")}),c.zeroCode!==48&&(T=T.split("").map(A=>String.fromCodePoint(A.codePointAt(0)-c.zeroCode+48)).join("")),parseInt(T)};break;case p.SEQUENCE:throw{code:"D3130",value:c.token}}}return h}function u(c,h){if(typeof c>"u")return;let l=re(h);return a(l).parse(c)}function C(c,h){let l=ue(h),m=a(l),T="^"+m.parts.map(j=>"("+j.regex+")").join("")+"$";var y=new RegExp(T,"i").exec(c);if(y!==null){let N={};for(let le=1;le<y.length;le++){let n=m.parts[le-1];n.parse&&(N[n.component]=n.parse(y[le]))}if(Object.getOwnPropertyNames(N).length===0)return;let xe=0,Be=le=>{xe<<=1,xe+=le?1:0},Ne=le=>!(~le&xe)&&!!(le&xe);"YXMxWwdD".split("").forEach(le=>Be(N[le]));let Ue=!Ne(161)&&Ne(130),Ze=Ne(84),Qe=!Ze&&Ne(72);xe=0,"PHhmsf".split("").forEach(le=>Be(N[le]));let Ke=!Ne(23)&&Ne(47),st=(Ue?"YD":Ze?"XxwF":Qe?"XWF":"YMD")+(Ke?"Phmsf":"Hmsf"),He=this.environment.timestamp,rt=!1,Ve=!1;if(st.split("").forEach(le=>{if(typeof N[le]>"u")rt?(N[le]="MDd".indexOf(le)!==-1?1:0,Ve=!0):N[le]=$(He,le);else if(rt=!0,Ve)throw{code:"D3136"}}),N.M>0?N.M-=1:N.M=0,Ue){let le=Date.UTC(N.Y,0),n=(N.d-1)*1e3*60*60*24,i=new Date(le+n);N.M=i.getUTCMonth(),N.D=i.getUTCDate()}if(Ze)throw{code:"D3136"};if(Qe)throw{code:"D3136"};Ke&&(N.H=N.h===12?0:N.h,N.P===1&&(N.H+=12));var E=Date.UTC(N.Y,N.M,N.D,N.H,N.m,N.s,N.f);return(N.Z||N.z)&&(E-=(N.Z||N.z)*60*1e3),E}}var G=new RegExp("^\\d{4}(-[01]\\d)*(-[0-3]\\d)*(T[0-2]\\d:[0-5]\\d:[0-5]\\d)*(\\.\\d+)?([+-][0-2]\\d:?[0-5]\\d|Z)?$");function ve(c,h){if(!(typeof c>"u"))if(typeof h>"u"){if(!G.test(c))throw{stack:new Error().stack,code:"D3110",value:c};return Date.parse(c)}else return C.call(this,c,h)}function ie(c,h,l){if(!(typeof c>"u"))return Ye.call(this,c,h,l)}return{formatInteger:P,parseInteger:u,fromMillis:ie,toMillis:ve}})();W.exports=b},{"./utils":6}],2:[function(Te,W,pe){(function(ee){(function(){var b=Te("./utils");let q=(()=>{"use strict";var he=b.isNumeric,Q=b.isArrayOfStrings,ce=b.isArrayOfNumbers,D=b.createSequence,v=b.isSequence,g=b.isFunction,x=b.isLambda,X=b.isPromise,be=b.getFunctionArity,ye=b.isDeepEqual,R=b.stringToArray;function w(e){if(!(typeof e>"u")){var t=0;return e.forEach(function(r){t+=r}),t}}function _(e){return typeof e>"u"?0:e.length}function P(e){if(!(typeof e>"u"||e.length===0))return Math.max.apply(Math,e)}function p(e){if(!(typeof e>"u"||e.length===0))return Math.min.apply(Math,e)}function S(e){if(!(typeof e>"u"||e.length===0)){var t=0;return e.forEach(function(r){t+=r}),t/e.length}}function F(e,t=!1){if(!(typeof e>"u")){var r;if(typeof e=="string")r=e;else if(g(e))r="";else{if(typeof e=="number"&&!isFinite(e))throw{code:"D3001",value:e,stack:new Error().stack};var f=t?2:0;Array.isArray(e)&&e.outerWrapper&&(e=e[0]),r=JSON.stringify(e,function(s,d){return typeof d<"u"&&d!==null&&d.toPrecision&&he(d)?Number(d.toPrecision(15)):d&&g(d)?"":d},f)}return r}}function H(e,t,r){if(!(typeof e>"u")){var f=R(e),s=f.length;if(s+t<0&&(t=0),typeof r<"u"){if(r<=0)return"";var d=t>=0?t+r:s+t+r;return f.slice(t,d).join("")}return f.slice(t).join("")}}function re(e,t){if(!(typeof e>"u")){var r=e.indexOf(t);return r>-1?e.substr(0,r):e}}function oe(e,t){if(!(typeof e>"u")){var r=e.indexOf(t);return r>-1?e.substr(r+t.length):e}}function ue(e){if(!(typeof e>"u"))return e.toLowerCase()}function K(e){if(!(typeof e>"u"))return e.toUpperCase()}function we(e){if(!(typeof e>"u"))return R(e).length}function $e(e){if(!(typeof e>"u")){var t=e.replace(/[ \t\n\r]+/gm," ");return t.charAt(0)===" "&&(t=t.substring(1)),t.charAt(t.length-1)===" "&&(t=t.substring(0,t.length-1)),t}}function ae(e,t,r){if(!(typeof e>"u")){(typeof r>"u"||r.length===0)&&(r=" ");var f;t=Math.trunc(t);var s=Math.abs(t)-we(e);if(s>0){var d=new Array(s+1).join(r);r.length>1&&(d=H(d,0,s)),t>0?f=e+d:f=d+e}else f=e;return f}}async function B(e,t){var r=e.apply(this,[t]);if(X(r)&&(r=await r),r&&!(typeof r.start=="number"||r.end==="number"||Array.isArray(r.groups)||g(r.next)))throw{code:"T1010",stack:new Error().stack};return r}async function _e(e,t){if(!(typeof e>"u")){var r;if(typeof t=="string")r=e.indexOf(t)!==-1;else{var f=await B(t,e);r=typeof f<"u"}return r}}async function $(e,t,r){if(!(typeof e>"u")){if(r<0)throw{stack:new Error().stack,value:r,code:"D3040",index:3};var f=D();if(typeof r>"u"||r>0){var s=0,d=await B(t,e);if(typeof d<"u")for(;typeof d<"u"&&(typeof r>"u"||s<r);)f.push({match:d.match,index:d.start,groups:d.groups}),d=await B(d.next),s++}return f}}async function De(e,t,r,f){if(!(typeof e>"u")){var s=this;if(t==="")throw{code:"D3010",stack:new Error().stack,value:t,index:2};if(f<0)throw{code:"D3011",stack:new Error().stack,value:f,index:4};var d;typeof r=="string"?d=function(fe){for(var Ce="",ne=0,Ee=r.indexOf("$",ne);Ee!==-1&&ne<r.length;){Ce+=r.substring(ne,Ee),ne=Ee+1;var Ge=r.charAt(ne);if(Ge==="$")Ce+="$",ne++;else if(Ge==="0")Ce+=fe.match,ne++;else{var Fe;if(fe.groups.length===0?Fe=1:Fe=Math.floor(Math.log(fe.groups.length)*Math.LOG10E)+1,Ee=parseInt(r.substring(ne,ne+Fe),10),Fe>1&&Ee>fe.groups.length&&(Ee=parseInt(r.substring(ne,ne+Fe-1),10)),isNaN(Ee))Ce+="$";else{if(fe.groups.length>0){var at=fe.groups[Ee-1];typeof at<"u"&&(Ce+=at)}ne+=Ee.toString().length}}Ee=r.indexOf("$",ne)}return Ce+=r.substring(ne),Ce}:d=r;var k="",M=0;if(typeof f>"u"||f>0){var I=0;if(typeof t=="string"){for(var de=e.indexOf(t,M);de!==-1&&(typeof f>"u"||I<f);)k+=e.substring(M,de),k+=r,M=de+t.length,I++,de=e.indexOf(t,M);k+=e.substring(M)}else{var V=await B(t,e);if(typeof V<"u"){for(;typeof V<"u"&&(typeof f>"u"||I<f);){k+=e.substring(M,V.start);var ge=d.apply(s,[V]);if(X(ge)&&(ge=await ge),typeof ge=="string")k+=ge;else throw{code:"D3012",stack:new Error().stack,value:ge};M=V.start+V.match.length,I++,V=await B(V.next)}k+=e.substring(M)}else k=e}}else k=e;return k}}function Ye(e){if(!(typeof e>"u")){var t=typeof window<"u"?window.btoa:function(r){return new ee.Buffer.from(r,"binary").toString("base64")};return t(e)}}function a(e){if(!(typeof e>"u")){var t=typeof window<"u"?window.atob:function(r){return new ee.Buffer.from(r,"base64").toString("binary")};return t(e)}}function u(e){if(!(typeof e>"u")){var t;try{t=encodeURIComponent(e)}catch{throw{code:"D3140",stack:new Error().stack,value:e,functionName:"encodeUrlComponent"}}return t}}function C(e){if(!(typeof e>"u")){var t;try{t=encodeURI(e)}catch{throw{code:"D3140",stack:new Error().stack,value:e,functionName:"encodeUrl"}}return t}}function G(e){if(!(typeof e>"u")){var t;try{t=decodeURIComponent(e)}catch{throw{code:"D3140",stack:new Error().stack,value:e,functionName:"decodeUrlComponent"}}return t}}function ve(e){if(!(typeof e>"u")){var t;try{t=decodeURI(e)}catch{throw{code:"D3140",stack:new Error().stack,value:e,functionName:"decodeUrl"}}return t}}async function ie(e,t,r){if(!(typeof e>"u")){if(r<0)throw{code:"D3020",stack:new Error().stack,value:r,index:3};var f=[];if(typeof r>"u"||r>0)if(typeof t=="string")f=e.split(t,r);else{var s=0,d=await B(t,e);if(typeof d<"u"){for(var k=0;typeof d<"u"&&(typeof r>"u"||s<r);)f.push(e.substring(k,d.start)),k=d.end,d=await B(d.next),s++;(typeof r>"u"||s<r)&&f.push(e.substring(k))}else f.push(e)}return f}}function c(e,t){if(!(typeof e>"u"))return typeof t>"u"&&(t=""),e.join(t)}function h(e,t,r){if(!(typeof e>"u")){var f={"decimal-separator":".","grouping-separator":",","exponent-separator":"e",infinity:"Infinity","minus-sign":"-",NaN:"NaN",percent:"%","per-mille":"\u2030","zero-digit":"0",digit:"#","pattern-separator":";"},s=f;typeof r<"u"&&Object.keys(r).forEach(function(z){s[z]=r[z]});for(var d=[],k=s["zero-digit"].charCodeAt(0),M=k;M<k+10;M++)d.push(String.fromCharCode(M));var I=d.concat([s["decimal-separator"],s["exponent-separator"],s["grouping-separator"],s.digit,s["pattern-separator"]]),de=t.split(s["pattern-separator"]);if(de.length>2)throw{code:"D3080",stack:new Error().stack};var V=function(z){var ke=(function(){for(var Pe,We=0;We<z.length;We++)if(Pe=z.charAt(We),I.indexOf(Pe)!==-1&&Pe!==s["exponent-separator"])return z.substring(0,We)})(),Ie=(function(){for(var Pe,We=z.length-1;We>=0;We--)if(Pe=z.charAt(We),I.indexOf(Pe)!==-1&&Pe!==s["exponent-separator"])return z.substring(We+1)})(),me=z.substring(ke.length,z.length-Ie.length),Le,et,ze,nt,qe=z.indexOf(s["exponent-separator"],ke.length);qe===-1||qe>z.length-Ie.length?(Le=me,et=void 0):(Le=me.substring(0,qe),et=me.substring(qe+1));var Je=Le.indexOf(s["decimal-separator"]);return Je===-1?(ze=Le,nt=Ie):(ze=Le.substring(0,Je),nt=Le.substring(Je+1)),{prefix:ke,suffix:Ie,activePart:me,mantissaPart:Le,exponentPart:et,integerPart:ze,fractionalPart:nt,subpicture:z}},ge=function(z){var ke,Ie,me=z.subpicture,Le=me.indexOf(s["decimal-separator"]);Le!==me.lastIndexOf(s["decimal-separator"])&&(ke="D3081"),me.indexOf(s.percent)!==me.lastIndexOf(s.percent)&&(ke="D3082"),me.indexOf(s["per-mille"])!==me.lastIndexOf(s["per-mille"])&&(ke="D3083"),me.indexOf(s.percent)!==-1&&me.indexOf(s["per-mille"])!==-1&&(ke="D3084");var et=!1;for(Ie=0;Ie<z.mantissaPart.length;Ie++){var ze=z.mantissaPart.charAt(Ie);if(d.indexOf(ze)!==-1||ze===s.digit){et=!0;break}}et||(ke="D3085");var nt=z.activePart.split("").map(function(Pe){return I.indexOf(Pe)===-1?"p":"a"}).join("");nt.indexOf("p")!==-1&&(ke="D3086"),Le!==-1?(me.charAt(Le-1)===s["grouping-separator"]||me.charAt(Le+1)===s["grouping-separator"])&&(ke="D3087"):z.integerPart.charAt(z.integerPart.length-1)===s["grouping-separator"]&&(ke="D3088"),me.indexOf(s["grouping-separator"]+s["grouping-separator"])!==-1&&(ke="D3089");var qe=z.integerPart.indexOf(s.digit);qe!==-1&&z.integerPart.substring(0,qe).split("").filter(function(Pe){return d.indexOf(Pe)>-1}).length>0&&(ke="D3090"),qe=z.fractionalPart.lastIndexOf(s.digit),qe!==-1&&z.fractionalPart.substring(qe).split("").filter(function(Pe){return d.indexOf(Pe)>-1}).length>0&&(ke="D3091");var Je=typeof z.exponentPart=="string";if(Je&&z.exponentPart.length>0&&(me.indexOf(s.percent)!==-1||me.indexOf(s["per-mille"])!==-1)&&(ke="D3092"),Je&&(z.exponentPart.length===0||z.exponentPart.split("").filter(function(Pe){return d.indexOf(Pe)===-1}).length>0)&&(ke="D3093"),ke)throw{code:ke,stack:new Error().stack}},fe=function(z){var ke=function(Me,yt){for(var ct=[],Xe=Me.indexOf(s["grouping-separator"]);Xe!==-1;){var gt=(yt?Me.substring(0,Xe):Me.substring(Xe)).split("").filter(function(ot){return d.indexOf(ot)!==-1||ot===s.digit}).length;ct.push(gt),Xe=z.integerPart.indexOf(s["grouping-separator"],Xe+1)}return ct},Ie=ke(z.integerPart),me=function(Me){if(Me.length===0)return 0;for(var yt=function(gt,ot){return ot===0?gt:yt(ot,gt%ot)},ct=Me.reduce(yt),Xe=1;Xe<=Me.length;Xe++)if(Me.indexOf(Xe*ct)===-1)return 0;return ct},Le=me(Ie),et=ke(z.fractionalPart,!0),ze=z.integerPart.split("").filter(function(Me){return d.indexOf(Me)!==-1}).length,nt=ze,qe=z.fractionalPart.split(""),Je=qe.filter(function(Me){return d.indexOf(Me)!==-1}).length,Pe=qe.filter(function(Me){return d.indexOf(Me)!==-1||Me===s.digit}).length,We=typeof z.exponentPart=="string";ze===0&&Pe===0&&(We?(Je=1,Pe=1):ze=1),We&&ze===0&&z.integerPart.indexOf(s.digit)!==-1&&(ze=1),ze===0&&Je===0&&(Je=1);var kt=0;return We&&(kt=z.exponentPart.split("").filter(function(Me){return d.indexOf(Me)!==-1}).length),{integerPartGroupingPositions:Ie,regularGrouping:Le,minimumIntegerPartSize:ze,scalingFactor:nt,prefix:z.prefix,fractionalPartGroupingPositions:et,minimumFactionalPartSize:Je,maximumFactionalPartSize:Pe,minimumExponentSize:kt,suffix:z.suffix,picture:z.subpicture}},Ce=de.map(V);Ce.forEach(ge);var ne=Ce.map(fe),Ee=s["minus-sign"],Ge=s["zero-digit"],Fe=s["decimal-separator"],at=s["grouping-separator"];ne.length===1&&(ne.push(JSON.parse(JSON.stringify(ne[0]))),ne[1].prefix=Ee+ne[1].prefix);var Se;e>=0?Se=ne[0]:Se=ne[1];var ut;Se.picture.indexOf(s.percent)!==-1?ut=e*100:Se.picture.indexOf(s["per-mille"])!==-1?ut=e*1e3:ut=e;var tt,it;if(Se.minimumExponentSize===0)tt=ut;else{var Ot=Math.pow(10,Se.scalingFactor),Pt=Math.pow(10,Se.scalingFactor-1);for(tt=ut,it=0;tt<Pt;)tt*=10,it-=1;for(;tt>Ot;)tt/=10,it+=1}var xt=E(tt,Se.maximumFactionalPartSize),mt=function(z,ke){var Ie=Math.abs(z).toFixed(ke);return Ge!=="0"&&(Ie=Ie.split("").map(function(me){return me>="0"&&me<="9"?d[me.charCodeAt(0)-48]:me}).join("")),Ie},Y=mt(xt,Se.maximumFactionalPartSize),je=Y.indexOf(".");for(je===-1?Y=Y+Fe:Y=Y.replace(".",Fe);Y.charAt(0)===Ge;)Y=Y.substring(1);for(;Y.charAt(Y.length-1)===Ge;)Y=Y.substring(0,Y.length-1);je=Y.indexOf(Fe);var ft=Se.minimumIntegerPartSize-je,wt=Se.minimumFactionalPartSize-(Y.length-je-1);if(Y=(ft>0?new Array(ft+1).join(Ge):"")+Y,Y=Y+(wt>0?new Array(wt+1).join(Ge):""),je=Y.indexOf(Fe),Se.regularGrouping>0)for(var Ct=Math.floor((je-1)/Se.regularGrouping),ht=1;ht<=Ct;ht++)Y=[Y.slice(0,je-ht*Se.regularGrouping),at,Y.slice(je-ht*Se.regularGrouping)].join("");else Se.integerPartGroupingPositions.forEach(function(z){Y=[Y.slice(0,je-z),at,Y.slice(je-z)].join(""),je++});if(je=Y.indexOf(Fe),Se.fractionalPartGroupingPositions.forEach(function(z){Y=[Y.slice(0,z+je+1),at,Y.slice(z+je+1)].join("")}),je=Y.indexOf(Fe),(Se.picture.indexOf(Fe)===-1||je===Y.length-1)&&(Y=Y.substring(0,Y.length-1)),typeof it<"u"){var vt=mt(it,0);ft=Se.minimumExponentSize-vt.length,ft>0&&(vt=new Array(ft+1).join(Ge)+vt),Y=Y+s["exponent-separator"]+(it<0?Ee:"")+vt}return Y=Se.prefix+Y+Se.suffix,Y}}function l(e,t){if(!(typeof e>"u")){if(e=E(e),typeof t>"u"?t=10:t=E(t),t<2||t>36)throw{code:"D3100",stack:new Error().stack,value:t};var r=e.toString(t);return r}}function m(e){var t;if(!(typeof e>"u")){if(typeof e=="number")t=e;else if(typeof e=="string"&&/^-?[0-9]+(\.[0-9]+)?([Ee][-+]?[0-9]+)?$/.test(e)&&!isNaN(parseFloat(e))&&isFinite(e))t=parseFloat(e);else if(typeof e=="string"&&/^(0[xX][0-9A-Fa-f]+)|(0[oO][0-7]+)|(0[bB][0-1]+)$/.test(e))t=Number(e);else if(e===!0)t=1;else if(e===!1)t=0;else throw{code:"D3030",value:e,stack:new Error().stack,index:1};return t}}function T(e){var t;if(!(typeof e>"u"))return t=Math.abs(e),t}function A(e){var t;if(!(typeof e>"u"))return t=Math.floor(e),t}function y(e){var t;if(!(typeof e>"u"))return t=Math.ceil(e),t}function E(e,t){var r;if(!(typeof e>"u")){if(t){var f=e.toString().split("e");e=+(f[0]+"e"+(f[1]?+f[1]+t:t))}r=Math.round(e);var s=r-e;return Math.abs(s)===.5&&Math.abs(r%2)===1&&(r=r-1),t&&(f=r.toString().split("e"),r=+(f[0]+"e"+(f[1]?+f[1]-t:-t))),Object.is(r,-0)&&(r=0),r}}function j(e){var t;if(!(typeof e>"u")){if(e<0)throw{stack:new Error().stack,code:"D3060",index:1,value:e};return t=Math.sqrt(e),t}}function Z(e,t){var r;if(!(typeof e>"u")){if(r=Math.pow(e,t),!isFinite(r))throw{stack:new Error().stack,code:"D3061",index:1,value:e,exp:t};return r}}function te(){return Math.random()}function U(e){if(!(typeof e>"u")){var t=!1;if(Array.isArray(e)){if(e.length===1)t=U(e[0]);else if(e.length>1){var r=e.filter(function(f){return U(f)});t=r.length>0}}else typeof e=="string"?e.length>0&&(t=!0):he(e)?e!==0&&(t=!0):e!==null&&typeof e=="object"&&!g(e)?Object.keys(e).length>0&&(t=!0):typeof e=="boolean"&&e===!0&&(t=!0);return t}}function L(e){if(!(typeof e>"u"))return!U(e)}function J(e,t,r,f){var s=[t],d=be(e);return d>=2&&s.push(r),d>=3&&s.push(f),s}async function N(e,t){if(!(typeof e>"u")){for(var r=D(),f=0;f<e.length;f++){var s=J(t,e[f],f,e),d=await t.apply(this,s);typeof d<"u"&&r.push(d)}return r}}async function xe(e,t){if(!(typeof e>"u")){for(var r=D(),f=0;f<e.length;f++){var s=e[f],d=J(t,s,f,e),k=await t.apply(this,d);U(k)&&r.push(s)}return r}}async function Be(e,t){if(!(typeof e>"u")){for(var r=!1,f,s=0;s<e.length;s++){var d=e[s],k=!0;if(typeof t<"u"){var M=J(t,d,s,e),I=await t.apply(this,M);k=U(I)}if(k)if(!r)f=d,r=!0;else throw{stack:new Error().stack,code:"D3138",index:s}}if(!r)throw{stack:new Error().stack,code:"D3139"};return f}}function Ne(){for(var e=[],t=Array.prototype.slice.call(arguments),r=Math.min.apply(Math,t.map(function(d){return Array.isArray(d)?d.length:0})),f=0;f<r;f++){var s=t.map(d=>d[f]);e.push(s)}return e}async function Oe(e,t,r){if(!(typeof e>"u")){var f,s=be(t);if(s<2)throw{stack:new Error().stack,code:"D3050",index:1};var d;for(typeof r>"u"&&e.length>0?(f=e[0],d=1):(f=r,d=0);d<e.length;){var k=[f,e[d]];s>=3&&k.push(d),s>=4&&k.push(e),f=await t.apply(this,k),d++}return f}}function Ue(e){var t=D();if(Array.isArray(e)){var r={};e.forEach(function(f){var s=Ue(f);s.forEach(function(d){r[d]=!0})}),t=Ue(r)}else e!==null&&typeof e=="object"&&!g(e)&&Object.keys(e).forEach(f=>t.push(f));return t}function Ze(e,t){var r;if(Array.isArray(e)){r=D();for(var f=0;f<e.length;f++){var s=Ze(e[f],t);typeof s<"u"&&(Array.isArray(s)?s.forEach(d=>r.push(d)):r.push(s))}}else e!==null&&typeof e=="object"&&!g(e)&&(r=e[t]);return r}function Qe(e,t){return typeof e>"u"?t:typeof t>"u"?e:(Array.isArray(e)||(e=D(e)),Array.isArray(t)||(t=[t]),e.concat(t))}function dt(e){return!(typeof e>"u")}function Ke(e){var t=D();if(Array.isArray(e))e.forEach(function(s){t=Qe(t,Ke(s))});else if(e!==null&&typeof e=="object"&&!x(e))for(var r in e){var f={};f[r]=e[r],t.push(f)}else t=e;return t}function O(e){if(!(typeof e>"u")){var t={};return e.forEach(function(r){for(var f in r)t[f]=r[f]}),t}}function pt(e){if(!(typeof e>"u")){if(e.length<=1)return e;for(var t=e.length,r=new Array(t),f=0;f<t;f++)r[t-f-1]=e[f];return r}}async function st(e,t){var r=D();for(var f in e){var s=J(t,e[f],f,e),d=await t.apply(this,s);typeof d<"u"&&r.push(d)}return r}function He(e){throw{code:"D3137",stack:new Error().stack,message:e||"$error() function evaluated"}}function rt(e,t){if(!e)throw{code:"D3141",stack:new Error().stack,message:t||"$assert() statement failed"}}function Ve(e){if(e!==void 0)return e===null?"null":he(e)?"number":typeof e=="string"?"string":typeof e=="boolean"?"boolean":Array.isArray(e)?"array":g(e)?"function":"object"}async function le(e,t){if(!(typeof e>"u")){if(e.length<=1)return e;var r;if(typeof t>"u"){if(!ce(e)&&!Q(e))throw{stack:new Error().stack,code:"D3070",index:1};r=async function(k,M){return k>M}}else r=t;var f=async function(k,M){var I=async function(V,ge,fe){ge.length===0?Array.prototype.push.apply(V,fe):fe.length===0?Array.prototype.push.apply(V,ge):await r(ge[0],fe[0])?(V.push(fe[0]),await I(V,ge,fe.slice(1))):(V.push(ge[0]),await I(V,ge.slice(1),fe))},de=[];return await I(de,k,M),de},s=async function(k){if(!Array.isArray(k)||k.length<=1)return k;var M=Math.floor(k.length/2),I=k.slice(0,M),de=k.slice(M);return I=await s(I),de=await s(de),await f(I,de)},d=await s(e);return d}}function n(e){if(!(typeof e>"u")){if(e.length<=1)return e;for(var t=new Array(e.length),r=0;r<e.length;r++){var f=Math.floor(Math.random()*(r+1));r!==f&&(t[r]=t[f]),t[f]=e[r]}return t}}function i(e){if(!(typeof e>"u")){if(!Array.isArray(e)||e.length<=1)return e;for(var t=v(e)?D():[],r=0;r<e.length;r++){for(var f=e[r],s=!1,d=0;d<t.length;d++)if(ye(f,t[d])){s=!0;break}s||t.push(f)}return t}}async function o(e,t){var r={};for(var f in e){var s=e[f],d=J(t,s,f,e),k=await t.apply(this,d);U(k)&&(r[f]=s)}return Object.keys(r).length===0&&(r=void 0),r}return{sum:w,count:_,max:P,min:p,average:S,string:F,substring:H,substringBefore:re,substringAfter:oe,lowercase:ue,uppercase:K,length:we,trim:$e,pad:ae,match:$,contains:_e,replace:De,split:ie,join:c,formatNumber:h,formatBase:l,number:m,floor:A,ceil:y,round:E,abs:T,sqrt:j,power:Z,random:te,boolean:U,not:L,map:N,zip:Ne,filter:xe,single:Be,foldLeft:Oe,sift:o,keys:Ue,lookup:Ze,append:Qe,exists:dt,spread:Ke,merge:O,reverse:pt,each:st,error:He,assert:rt,type:Ve,sort:le,shuffle:n,distinct:i,base64encode:Ye,base64decode:a,encodeUrlComponent:u,encodeUrl:C,decodeUrlComponent:G,decodeUrl:ve}})();W.exports=q}).call(this)}).call(this,typeof global<"u"?global:typeof self<"u"?self:typeof window<"u"?window:{})},{"./utils":6}],3:[function(Te,W,pe){var ee=Te("./datetime"),b=Te("./functions"),q=Te("./utils"),he=Te("./parser"),Q=Te("./signature"),ce=(function(){"use strict";var D=q.isNumeric,v=q.isArrayOfStrings,g=q.isArrayOfNumbers,x=q.createSequence,X=q.isSequence,be=q.isFunction,ye=q.isLambda,R=q.isIterable,w=q.isPromise,_=q.getFunctionArity,P=q.isDeepEqual,p=He(null);async function S(n,i,o){var e,t=o.lookup(Symbol.for("jsonata.__evaluate_entry"));switch(t&&await t(n,i,o),n.type){case"path":e=await F(n,i,o);break;case"binary":e=await we(n,i,o);break;case"unary":e=await $e(n,i,o);break;case"name":e=ae(n,i,o);break;case"string":case"number":case"value":e=B(n,i,o);break;case"wildcard":e=_e(n,i,o);break;case"descendant":e=De(n,i,o);break;case"parent":e=o.lookup(n.slot.label);break;case"condition":e=await A(n,i,o);break;case"block":e=await y(n,i,o);break;case"bind":e=await T(n,i,o);break;case"regex":e=E(n,i,o);break;case"function":e=await J(n,i,o);break;case"variable":e=j(n,i,o);break;case"lambda":e=Be(n,i,o);break;case"partial":e=await Ne(n,i,o);break;case"apply":e=await L(n,i,o);break;case"transform":e=te(n,i,o);break}if(Object.prototype.hasOwnProperty.call(n,"predicate"))for(var r=0;r<n.predicate.length;r++)e=await K(n.predicate[r].expr,e,o);n.type!=="path"&&Object.prototype.hasOwnProperty.call(n,"group")&&(e=await h(n.group,e,o));var f=o.lookup(Symbol.for("jsonata.__evaluate_exit"));return f&&await f(n,i,o,e),e&&X(e)&&!e.tupleStream&&(n.keepArray&&(e.keepSingleton=!0),e.length===0?e=void 0:e.length===1&&(e=e.keepSingleton?e:e[0])),e}async function F(n,i,o){var e;Array.isArray(i)&&n.steps[0].type!=="variable"?e=i:e=x(i);for(var t,r=!1,f=void 0,s=0;s<n.steps.length;s++){var d=n.steps[s];if(d.tuple&&(r=!0),s===0&&d.consarray?t=await S(d,e,o):r?f=await ue(d,e,f,o):t=await re(d,e,o,s===n.steps.length-1),!r&&(typeof t>"u"||t.length===0))break;typeof d.focus>"u"&&(e=t)}if(r)if(n.tuple)t=f;else for(t=x(),s=0;s<f.length;s++)t.push(f[s]["@"]);return n.keepSingletonArray&&(Array.isArray(t)&&t.cons&&!t.sequence&&(t=x(t)),t.keepSingleton=!0),n.hasOwnProperty("group")&&(t=await h(n.group,r?f:t,o)),t}function H(n,i){var o=He(n);for(let e in i)o.bind(e,i[e]);return o}async function re(n,i,o,e){var t;if(n.type==="sort")return t=await Z(n,i,o),n.stages&&(t=await oe(n.stages,t,o)),t;t=x();for(var r=0;r<i.length;r++){var f=await S(n,i[r],o);if(n.stages)for(var s=0;s<n.stages.length;s++)f=await K(n.stages[s].expr,f,o);typeof f<"u"&&t.push(f)}var d=x();return e&&t.length===1&&Array.isArray(t[0])&&!X(t[0])?d=t[0]:t.forEach(function(k){!Array.isArray(k)||k.cons?d.push(k):k.forEach(M=>d.push(M))}),d}async function oe(n,i,o){for(var e=i,t=0;t<n.length;t++){var r=n[t];switch(r.type){case"filter":e=await K(r.expr,e,o);break;case"index":for(var f=0;f<e.length;f++){var s=e[f];s[r.value]=f}break}}return e}async function ue(n,i,o,e){var t;if(n.type==="sort"){if(o)t=await Z(n,o,e);else{var r=await Z(n,i,e);t=x(),t.tupleStream=!0;for(var f=0;f<r.length;f++){var s={"@":r[f]};s[n.index]=f,t.push(s)}}return n.stages&&(t=await oe(n.stages,t,e)),t}t=x(),t.tupleStream=!0;var d=e;o===void 0&&(o=i.map(de=>({"@":de})));for(var k=0;k<o.length;k++){d=H(e,o[k]);var M=await S(n,o[k]["@"],d);if(typeof M<"u"){Array.isArray(M)||(M=[M]);for(var I=0;I<M.length;I++)s={},Object.assign(s,o[k]),M.tupleStream?Object.assign(s,M[I]):(n.focus?(s[n.focus]=M[I],s["@"]=o[k]["@"]):s["@"]=M[I],n.index&&(s[n.index]=I),n.ancestor&&(s[n.ancestor.label]=o[k]["@"])),t.push(s)}}return n.stages&&(t=await oe(n.stages,t,e)),t}async function K(n,i,o){var e=x();if(i&&i.tupleStream&&(e.tupleStream=!0),Array.isArray(i)||(i=x(i)),n.type==="number"){var t=Math.floor(n.value);t<0&&(t=i.length+t);var r=await i[t];typeof r<"u"&&(Array.isArray(r)?e=r:e.push(r))}else for(t=0;t<i.length;t++){var r=i[t],f=r,s=o;i.tupleStream&&(f=r["@"],s=H(o,r));var d=await S(n,f,s);D(d)&&(d=[d]),g(d)?d.forEach(function(M){var I=Math.floor(M);I<0&&(I=i.length+I),I===t&&e.push(r)}):b.boolean(d)&&e.push(r)}return e}async function we(n,i,o){var e,t=await S(n.lhs,i,o),r=n.value,f=async()=>await S(n.rhs,i,o);if(r==="and"||r==="or")try{return await ve(t,f,r)}catch(d){throw d.position=n.position,d.token=r,d}var s=await f();try{switch(r){case"+":case"-":case"*":case"/":case"%":e=a(t,s,r);break;case"=":case"!=":e=u(t,s,r);break;case"<":case"<=":case">":case">=":e=C(t,s,r);break;case"&":e=c(t,s);break;case"..":e=m(t,s);break;case"in":e=G(t,s);break}}catch(d){throw d.position=n.position,d.token=r,d}return e}async function $e(n,i,o){var e;switch(n.value){case"-":if(e=await S(n.expression,i,o),typeof e>"u")e=void 0;else if(D(e))e=-e;else throw{code:"D1002",stack:new Error().stack,position:n.position,token:n.value,value:e};break;case"[":e=[];let f=await Promise.all(n.expressions.map(async(s,d)=>(o.isParallelCall=d>0,[s,await S(s,i,o)])));for(let s of f){var[t,r]=s;typeof r<"u"&&(t.value==="["?e.push(r):e=b.append(e,r))}n.consarray&&Object.defineProperty(e,"cons",{enumerable:!1,configurable:!1,value:!0});break;case"{":e=await h(n,i,o);break}return e}function ae(n,i,o){return b.lookup(i,n.value)}function B(n){return n.value}function _e(n,i){var o=x();return Array.isArray(i)&&i.outerWrapper&&i.length>0&&(i=i[0]),i!==null&&typeof i=="object"&&Object.keys(i).forEach(function(e){var t=i[e];Array.isArray(t)?(t=$(t),o=b.append(o,t)):o.push(t)}),o}function $(n,i){return typeof i>"u"&&(i=[]),Array.isArray(n)?n.forEach(function(o){$(o,i)}):i.push(n),i}function De(n,i){var o,e=x();return typeof i<"u"&&(Ye(i,e),e.length===1?o=e[0]:o=e),o}function Ye(n,i){Array.isArray(n)||i.push(n),Array.isArray(n)?n.forEach(function(o){Ye(o,i)}):n!==null&&typeof n=="object"&&Object.keys(n).forEach(function(o){Ye(n[o],i)})}function a(n,i,o){var e;if(typeof n<"u"&&!D(n))throw{code:"T2001",stack:new Error().stack,value:n};if(typeof i<"u"&&!D(i))throw{code:"T2002",stack:new Error().stack,value:i};if(typeof n>"u"||typeof i>"u")return e;switch(o){case"+":e=n+i;break;case"-":e=n-i;break;case"*":e=n*i;break;case"/":e=n/i;break;case"%":e=n%i;break}return e}function u(n,i,o){var e,t=typeof n,r=typeof i;if(t==="undefined"||r==="undefined")return!1;switch(o){case"=":e=P(n,i);break;case"!=":e=!P(n,i);break}return e}function C(n,i,o){var e,t=typeof n,r=typeof i,f=t==="undefined"||t==="string"||t==="number",s=r==="undefined"||r==="string"||r==="number";if(!f||!s)throw{code:"T2010",stack:new Error().stack,value:t==="string"||t==="number"?i:n};if(!(t==="undefined"||r==="undefined")){if(t!==r)throw{code:"T2009",stack:new Error().stack,value:n,value2:i};switch(o){case"<":e=n<i;break;case"<=":e=n<=i;break;case">":e=n>i;break;case">=":e=n>=i;break}return e}}function G(n,i){var o=!1;if(typeof n>"u"||typeof i>"u")return!1;Array.isArray(i)||(i=[i]);for(var e=0;e<i.length;e++)if(i[e]===n){o=!0;break}return o}async function ve(n,i,o){var e,t=ie(n);switch(o){case"and":e=t&&ie(await i());break;case"or":e=t||ie(await i());break}return e}function ie(n){var i=b.boolean(n);return typeof i>"u"?!1:i}function c(n,i){var o,e="",t="";return typeof n<"u"&&(e=b.string(n)),typeof i<"u"&&(t=b.string(i)),o=e.concat(t),o}async function h(n,i,o){var e={},t={},r=!!(i&&i.tupleStream);Array.isArray(i)||(i=x(i)),i.length===0&&i.push(void 0);for(var f=0;f<i.length;f++)for(var s=i[f],d=r?H(o,s):o,k=0;k<n.lhs.length;k++){var M=n.lhs[k],I=await S(M[0],r?s["@"]:s,d);if(typeof I!="string"&&I!==void 0)throw{code:"T1003",stack:new Error().stack,position:n.position,value:I};if(I!==void 0){var de={data:s,exprIndex:k};if(t.hasOwnProperty(I)){if(t[I].exprIndex!==k)throw{code:"D1009",stack:new Error().stack,position:n.position,value:I};t[I].data=b.append(t[I].data,s)}else t[I]=de}}let V=await Promise.all(Object.keys(t).map(async(fe,Ce)=>{let ne=t[fe];var Ee=ne.data,Ge=o;if(r){var Fe=l(ne.data);Ee=Fe["@"],delete Fe["@"],Ge=H(o,Fe)}return o.isParallelCall=Ce>0,[fe,await S(n.lhs[ne.exprIndex][1],Ee,Ge)]}));for(let fe of V){var[I,ge]=await fe;typeof ge<"u"&&(e[I]=ge)}return e}function l(n){if(!Array.isArray(n))return n;var i={};Object.assign(i,n[0]);for(var o=1;o<n.length;o++)for(let e in n[o])i[e]=b.append(i[e],n[o][e]);return i}function m(n,i){var o;if(typeof n<"u"&&!Number.isInteger(n))throw{code:"T2003",stack:new Error().stack,value:n};if(typeof i<"u"&&!Number.isInteger(i))throw{code:"T2004",stack:new Error().stack,value:i};if(typeof n>"u"||typeof i>"u"||n>i)return o;var e=i-n+1;if(e>1e7)throw{code:"D2014",stack:new Error().stack,value:e};o=new Array(e);for(var t=n,r=0;t<=i;t++,r++)o[r]=t;return o.sequence=!0,o}async function T(n,i,o){var e=await S(n.rhs,i,o);return o.bind(n.lhs.value,e),e}async function A(n,i,o){var e,t=await S(n.condition,i,o);return b.boolean(t)?e=await S(n.then,i,o):typeof n.else<"u"&&(e=await S(n.else,i,o)),e}async function y(n,i,o){for(var e,t=He(o),r=0;r<n.expressions.length;r++)e=await S(n.expressions[r],i,t);return e}function E(n){var i=new le.RegexEngine(n.value),o=function(e,t){var r;i.lastIndex=t||0;var f=i.exec(e);if(f!==null){if(r={match:f[0],start:f.index,end:f.index+f[0].length,groups:[]},f.length>1)for(var s=1;s<f.length;s++)r.groups.push(f[s]);r.next=function(){if(!(i.lastIndex>=e.length)){var d=o(e,i.lastIndex);if(d&&d.match==="")throw{code:"D1004",stack:new Error().stack,position:n.position,value:n.value.source};return d}}}return r};return o}function j(n,i,o){var e;return n.value===""?e=i&&i.outerWrapper?i[0]:i:e=o.lookup(n.value),e}async function Z(n,i,o){var e,t=i,r=!!i.tupleStream,f=async function(d,k){for(var M=0,I=0;M===0&&I<n.terms.length;I++){var de=n.terms[I],V=d,ge=o;r&&(V=d["@"],ge=H(o,d));var fe=await S(de.expression,V,ge);V=k,ge=o,r&&(V=k["@"],ge=H(o,k));var Ce=await S(de.expression,V,ge),ne=typeof fe,Ee=typeof Ce;if(ne==="undefined"){M=Ee==="undefined"?0:1;continue}if(Ee==="undefined"){M=-1;continue}if(!(ne==="string"||ne==="number")||!(Ee==="string"||Ee==="number"))throw{code:"T2008",stack:new Error().stack,position:n.position,value:ne==="string"||ne==="number"?Ce:fe};if(ne!==Ee)throw{code:"T2007",stack:new Error().stack,position:n.position,value:fe,value2:Ce};fe!==Ce&&(fe<Ce?M=-1:M=1,de.descending===!0&&(M=-M))}return M===1},s={environment:o,input:i};return e=await b.sort.apply(s,[t,f]),e}function te(n,i,o){var e=async function(t){if(!(typeof t>"u")){var r=o.lookup("clone");if(!be(r))throw{code:"T2013",stack:new Error().stack,position:n.position};var f=await N(r,[t],null,o),s=await S(n.pattern,f,o);if(typeof s<"u"){Array.isArray(s)||(s=[s]);for(var d=0;d<s.length;d++){var k=s[d];if(k&&(k.isPrototypeOf(f)||k instanceof Object.constructor))throw{code:"D1010",stack:new Error().stack,position:n.position};var M=await S(n.update,k,o),I=typeof M;if(I!=="undefined"){if(I!=="object"||M===null||Array.isArray(M))throw{code:"T2011",stack:new Error().stack,position:n.update.position,value:M};for(var de in M)k[de]=M[de]}if(typeof n.delete<"u"){var V=await S(n.delete,k,o);if(typeof V<"u"){var ge=V;if(Array.isArray(V)||(V=[V]),!v(V))throw{code:"T2012",stack:new Error().stack,position:n.delete.position,value:ge};for(var fe=0;fe<V.length;fe++)typeof k=="object"&&k!==null&&delete k[V[fe]]}}}}return f}};return O(e,"<(oa):o>")}var U=he("function($f, $g) { function($x){ $g($f($x)) } }");async function L(n,i,o){var e,t=await S(n.lhs,i,o);if(n.rhs.type==="function")e=await J(n.rhs,i,o,{context:t});else{var r=await S(n.rhs,i,o);if(!be(r))throw{code:"T2006",stack:new Error().stack,position:n.position,value:r};if(be(t)){var f=await S(U,null,o);e=await N(f,[t,r],null,o)}else e=await N(r,[t],null,o)}return e}async function J(n,i,o,e){var t,r=await S(n.procedure,i,o);if(typeof r>"u"&&n.procedure.type==="path"&&o.lookup(n.procedure.steps[0].value))throw{code:"T1005",stack:new Error().stack,position:n.position,token:n.procedure.steps[0].value};var f=[];typeof e<"u"&&f.push(e.context);for(var s=0;s<n.arguments.length;s++){let k=await S(n.arguments[s],i,o);if(be(k)){let M=async function(...I){return await N(k,I,null,o)};M.arity=_(k),f.push(M)}else f.push(k)}var d=n.procedure.type==="path"?n.procedure.steps[0].value:n.procedure.value;try{typeof r=="object"&&(r.token=d,r.position=n.position),t=await N(r,f,i,o)}catch(k){throw k.position||(k.position=n.position),k.token||(k.token=d),k}return t}async function N(n,i,o,e){var t;for(t=await xe(n,i,o,e);ye(t)&&t.thunk===!0;){var r=await S(t.body.procedure,t.input,t.environment);t.body.procedure.type==="variable"&&(r.token=t.body.procedure.value),r.position=t.body.procedure.position;for(var f=[],s=0;s<t.body.arguments.length;s++)f.push(await S(t.body.arguments[s],t.input,t.environment));t=await xe(r,f,o,e)}return t}async function xe(n,i,o,e){var t;try{var r=i;if(n&&(r=Oe(n.signature,i,o)),ye(n))t=await Ue(n,r);else if(n&&n._jsonata_function===!0){var f={environment:e,input:o};t=n.implementation.apply(f,r),R(t)&&(t=t.next().value),w(t)&&(t=await t)}else if(typeof n=="function")t=n.apply(o,r),w(t)&&(t=await t);else throw{code:"T1006",stack:new Error().stack}}catch(s){throw n&&(typeof s.token>"u"&&typeof n.token<"u"&&(s.token=n.token),s.position=n.position||s.position),s}return t}function Be(n,i,o){var e={_jsonata_lambda:!0,input:i,environment:o,arguments:n.arguments,signature:n.signature,body:n.body};return n.thunk===!0&&(e.thunk=!0),e.apply=async function(t,r){return await N(e,r,i,t?t.environment:o)},e}async function Ne(n,i,o){for(var e,t=[],r=0;r<n.arguments.length;r++){var f=n.arguments[r];f.type==="operator"&&f.value==="?"?t.push(f):t.push(await S(f,i,o))}var s=await S(n.procedure,i,o);if(typeof s>"u"&&n.procedure.type==="path"&&o.lookup(n.procedure.steps[0].value))throw{code:"T1007",stack:new Error().stack,position:n.position,token:n.procedure.steps[0].value};if(ye(s))e=Ze(s,t);else if(s&&s._jsonata_function===!0)e=Qe(s.implementation,t);else if(typeof s=="function")e=Qe(s,t);else throw{code:"T1008",stack:new Error().stack,position:n.position,token:n.procedure.type==="path"?n.procedure.steps[0].value:n.procedure.value};return e}function Oe(n,i,o){if(typeof n>"u")return i;var e=n.validate(i,o);return e}async function Ue(n,i){var o,e=He(n.environment);return n.arguments.forEach(function(t,r){e.bind(t.value,i[r])}),typeof n.body=="function"?o=await dt(n.body,e):o=await S(n.body,n.input,e),o}function Ze(n,i){var o=He(n.environment),e=[];n.arguments.forEach(function(r,f){var s=i[f];s&&s.type==="operator"&&s.value==="?"?e.push(r):o.bind(r.value,s)});var t={_jsonata_lambda:!0,input:n.input,environment:o,arguments:e,body:n.body};return t}function Qe(n,i){var o=Ke(n);o=o.map(function(f){return"$"+f.trim()});var e="function("+o.join(", ")+"){ _ }",t=he(e);t.body=n;var r=Ze(t,i);return r}async function dt(n,i){var o=Ke(n),e=o.map(function(f){return i.lookup(f.trim())}),t={environment:i},r=n.apply(t,e);return w(r)&&(r=await r),r}function Ke(n){var i=n.toString(),o=/\(([^)]*)\)/.exec(i)[1],e=o.split(",");return e}function O(n,i){var o={_jsonata_function:!0,implementation:n};return typeof i<"u"&&(o.signature=Q(i)),o}async function pt(n,i){if(!(typeof n>"u")){var o=this.input;typeof i<"u"&&(o=i,Array.isArray(o)&&!X(o)&&(o=x(o),o.outerWrapper=!0));try{var e=he(n,!1)}catch(r){throw Ve(r),{stack:new Error().stack,code:"D3120",value:r.message,error:r}}try{var t=await S(e,o,this.environment)}catch(r){throw Ve(r),{stack:new Error().stack,code:"D3121",value:r.message,error:r}}return t}}function st(n){if(!(typeof n>"u"))return JSON.parse(b.string(n))}function He(n){var i={};let o={bind:function(t,r){i[t]=r},lookup:function(t){var r;return i.hasOwnProperty(t)?r=i[t]:n&&(r=n.lookup(t)),r},timestamp:n?n.timestamp:null,async:n?n.async:!1,isParallelCall:n?n.isParallelCall:!1,global:n?n.global:{ancestry:[null]}};if(n){var e=n.lookup(Symbol.for("jsonata.__createFrame_push"));e&&e(n,o)}return o}p.bind("sum",O(b.sum,"<a<n>:n>")),p.bind("count",O(b.count,"<a:n>")),p.bind("max",O(b.max,"<a<n>:n>")),p.bind("min",O(b.min,"<a<n>:n>")),p.bind("average",O(b.average,"<a<n>:n>")),p.bind("string",O(b.string,"<x-b?:s>")),p.bind("substring",O(b.substring,"<s-nn?:s>")),p.bind("substringBefore",O(b.substringBefore,"<s-s:s>")),p.bind("substringAfter",O(b.substringAfter,"<s-s:s>")),p.bind("lowercase",O(b.lowercase,"<s-:s>")),p.bind("uppercase",O(b.uppercase,"<s-:s>")),p.bind("length",O(b.length,"<s-:n>")),p.bind("trim",O(b.trim,"<s-:s>")),p.bind("pad",O(b.pad,"<s-ns?:s>")),p.bind("match",O(b.match,"<s-f<s:o>n?:a<o>>")),p.bind("contains",O(b.contains,"<s-(sf):b>")),p.bind("replace",O(b.replace,"<s-(sf)(sf)n?:s>")),p.bind("split",O(b.split,"<s-(sf)n?:a<s>>")),p.bind("join",O(b.join,"<a<s>s?:s>")),p.bind("formatNumber",O(b.formatNumber,"<n-so?:s>")),p.bind("formatBase",O(b.formatBase,"<n-n?:s>")),p.bind("formatInteger",O(ee.formatInteger,"<n-s:s>")),p.bind("parseInteger",O(ee.parseInteger,"<s-s:n>")),p.bind("number",O(b.number,"<(nsb)-:n>")),p.bind("floor",O(b.floor,"<n-:n>")),p.bind("ceil",O(b.ceil,"<n-:n>")),p.bind("round",O(b.round,"<n-n?:n>")),p.bind("abs",O(b.abs,"<n-:n>")),p.bind("sqrt",O(b.sqrt,"<n-:n>")),p.bind("power",O(b.power,"<n-n:n>")),p.bind("random",O(b.random,"<:n>")),p.bind("boolean",O(b.boolean,"<x-:b>")),p.bind("not",O(b.not,"<x-:b>")),p.bind("map",O(b.map,"<af>")),p.bind("zip",O(b.zip,"<a+>")),p.bind("filter",O(b.filter,"<af>")),p.bind("single",O(b.single,"<af?>")),p.bind("reduce",O(b.foldLeft,"<afj?:j>")),p.bind("sift",O(b.sift,"<o-f?:o>")),p.bind("keys",O(b.keys,"<x-:a<s>>")),p.bind("lookup",O(b.lookup,"<x-s:x>")),p.bind("append",O(b.append,"<xx:a>")),p.bind("exists",O(b.exists,"<x:b>")),p.bind("spread",O(b.spread,"<x-:a<o>>")),p.bind("merge",O(b.merge,"<a<o>:o>")),p.bind("reverse",O(b.reverse,"<a:a>")),p.bind("each",O(b.each,"<o-f:a>")),p.bind("error",O(b.error,"<s?:x>")),p.bind("assert",O(b.assert,"<bs?:x>")),p.bind("type",O(b.type,"<x:s>")),p.bind("sort",O(b.sort,"<af?:a>")),p.bind("shuffle",O(b.shuffle,"<a:a>")),p.bind("distinct",O(b.distinct,"<x:x>")),p.bind("base64encode",O(b.base64encode,"<s-:s>")),p.bind("base64decode",O(b.base64decode,"<s-:s>")),p.bind("encodeUrlComponent",O(b.encodeUrlComponent,"<s-:s>")),p.bind("encodeUrl",O(b.encodeUrl,"<s-:s>")),p.bind("decodeUrlComponent",O(b.decodeUrlComponent,"<s-:s>")),p.bind("decodeUrl",O(b.decodeUrl,"<s-:s>")),p.bind("eval",O(pt,"<sx?:x>")),p.bind("toMillis",O(ee.toMillis,"<s-s?:n>")),p.bind("fromMillis",O(ee.fromMillis,"<n-s?s?:s>")),p.bind("clone",O(st,"<(oa)-:o>"));var rt={S0101:"String literal must be terminated by a matching quote",S0102:"Number out of range: {{token}}",S0103:"Unsupported escape sequence: \\{{token}}",S0104:"The escape sequence \\u must be followed by 4 hex digits",S0105:"Quoted property name must be terminated with a backquote (`)",S0106:"Comment has no closing tag",S0201:"Syntax error: {{token}}",S0202:"Expected {{value}}, got {{token}}",S0203:"Expected {{value}} before end of expression",S0204:"Unknown operator: {{token}}",S0205:"Unexpected token: {{token}}",S0206:"Unknown expression type: {{token}}",S0207:"Unexpected end of expression",S0208:"Parameter {{value}} of function definition must be a variable name (start with $)",S0209:"A predicate cannot follow a grouping expression in a step",S0210:"Each step can only have one grouping expression",S0211:"The symbol {{token}} cannot be used as a unary operator",S0212:"The left side of := must be a variable name (start with $)",S0213:"The literal value {{value}} cannot be used as a step within a path expression",S0214:"The right side of {{token}} must be a variable name (start with $)",S0215:"A context variable binding must precede any predicates on a step",S0216:"A context variable binding must precede the 'order-by' clause on a step",S0217:"The object representing the 'parent' cannot be derived from this expression",S0301:"Empty regular expressions are not allowed",S0302:"No terminating / in regular expression",S0402:"Choice groups containing parameterized types are not supported",S0401:"Type parameters can only be applied to functions and arrays",S0500:"Attempted to evaluate an expression containing syntax error(s)",T0410:"Argument {{index}} of function {{token}} does not match function signature",T0411:"Context value is not a compatible type with argument {{index}} of function {{token}}",T0412:"Argument {{index}} of function {{token}} must be an array of {{type}}",D1001:"Number out of range: {{value}}",D1002:"Cannot negate a non-numeric value: {{value}}",T1003:"Key in object structure must evaluate to a string; got: {{value}}",D1004:"Regular expression matches zero length string",T1005:"Attempted to invoke a non-function. Did you mean ${{{token}}}?",T1006:"Attempted to invoke a non-function",T1007:"Attempted to partially apply a non-function. Did you mean ${{{token}}}?",T1008:"Attempted to partially apply a non-function",D1009:"Multiple key definitions evaluate to same key: {{value}}",D1010:"Attempted to access the Javascript object prototype",T1010:"The matcher function argument passed to function {{token}} does not return the correct object structure",T2001:"The left side of the {{token}} operator must evaluate to a number",T2002:"The right side of the {{token}} operator must evaluate to a number",T2003:"The left side of the range operator (..) must evaluate to an integer",T2004:"The right side of the range operator (..) must evaluate to an integer",D2005:"The left side of := must be a variable name (start with $)",T2006:"The right side of the function application operator ~> must be a function",T2007:"Type mismatch when comparing values {{value}} and {{value2}} in order-by clause",T2008:"The expressions within an order-by clause must evaluate to numeric or string values",T2009:"The values {{value}} and {{value2}} either side of operator {{token}} must be of the same data type",T2010:"The expressions either side of operator {{token}} must evaluate to numeric or string values",T2011:"The insert/update clause of the transform expression must evaluate to an object: {{value}}",T2012:"The delete clause of the transform expression must evaluate to a string or array of strings: {{value}}",T2013:"The transform expression clones the input object using the $clone() function.  This has been overridden in the current scope by a non-function.",D2014:"The size of the sequence allocated by the range operator (..) must not exceed 1e6.  Attempted to allocate {{value}}.",D3001:"Attempting to invoke string function on Infinity or NaN",D3010:"Second argument of replace function cannot be an empty string",D3011:"Fourth argument of replace function must evaluate to a positive number",D3012:"Attempted to replace a matched string with a non-string value",D3020:"Third argument of split function must evaluate to a positive number",D3030:"Unable to cast value to a number: {{value}}",D3040:"Third argument of match function must evaluate to a positive number",D3050:"The second argument of reduce function must be a function with at least two arguments",D3060:"The sqrt function cannot be applied to a negative number: {{value}}",D3061:"The power function has resulted in a value that cannot be represented as a JSON number: base={{value}}, exponent={{exp}}",D3070:"The single argument form of the sort function can only be applied to an array of strings or an array of numbers.  Use the second argument to specify a comparison function",D3080:"The picture string must only contain a maximum of two sub-pictures",D3081:"The sub-picture must not contain more than one instance of the 'decimal-separator' character",D3082:"The sub-picture must not contain more than one instance of the 'percent' character",D3083:"The sub-picture must not contain more than one instance of the 'per-mille' character",D3084:"The sub-picture must not contain both a 'percent' and a 'per-mille' character",D3085:"The mantissa part of a sub-picture must contain at least one character that is either an 'optional digit character' or a member of the 'decimal digit family'",D3086:"The sub-picture must not contain a passive character that is preceded by an active character and that is followed by another active character",D3087:"The sub-picture must not contain a 'grouping-separator' character that appears adjacent to a 'decimal-separator' character",D3088:"The sub-picture must not contain a 'grouping-separator' at the end of the integer part",D3089:"The sub-picture must not contain two adjacent instances of the 'grouping-separator' character",D3090:"The integer part of the sub-picture must not contain a member of the 'decimal digit family' that is followed by an instance of the 'optional digit character'",D3091:"The fractional part of the sub-picture must not contain an instance of the 'optional digit character' that is followed by a member of the 'decimal digit family'",D3092:"A sub-picture that contains a 'percent' or 'per-mille' character must not contain a character treated as an 'exponent-separator'",D3093:"The exponent part of the sub-picture must comprise only of one or more characters that are members of the 'decimal digit family'",D3100:"The radix of the formatBase function must be between 2 and 36.  It was given {{value}}",D3110:"The argument of the toMillis function must be an ISO 8601 formatted timestamp. Given {{value}}",D3120:"Syntax error in expression passed to function eval: {{value}}",D3121:"Dynamic error evaluating the expression passed to function eval: {{value}}",D3130:"Formatting or parsing an integer as a sequence starting with {{value}} is not supported by this implementation",D3131:"In a decimal digit pattern, all digits must be from the same decimal group",D3132:"Unknown component specifier {{value}} in date/time picture string",D3133:"The 'name' modifier can only be applied to months and days in the date/time picture string, not {{value}}",D3134:"The timezone integer format specifier cannot have more than four digits",D3135:"No matching closing bracket ']' in date/time picture string",D3136:"The date/time picture string is missing specifiers required to parse the timestamp",D3137:"{{{message}}}",D3138:"The $single() function expected exactly 1 matching result.  Instead it matched more.",D3139:"The $single() function expected exactly 1 matching result.  Instead it matched 0.",D3140:"Malformed URL passed to ${{{functionName}}}(): {{value}}",D3141:"{{{message}}}"};function Ve(n){var i=rt[n.code];if(typeof i<"u"){var o=i.replace(/\{\{\{([^}]+)}}}/g,function(){return n[arguments[1]]});o=o.replace(/\{\{([^}]+)}}/g,function(){return JSON.stringify(n[arguments[1]])}),n.message=o}}function le(n,i){var o,e;try{o=he(n,i&&i.recover),e=o.errors,delete o.errors}catch(f){throw Ve(f),f}var t=He(p),r=new Date;return t.bind("now",O(function(f,s){return ee.fromMillis(r.getTime(),f,s)},"<s?s?:s>")),t.bind("millis",O(function(){return r.getTime()},"<:n>")),i&&i.RegexEngine?le.RegexEngine=i.RegexEngine:le.RegexEngine=RegExp,{evaluate:async function(f,s,d){if(typeof e<"u"){var k={code:"S0500",position:0};throw Ve(k),k}if(typeof s<"u"){var M;M=He(t);for(var I in s)M.bind(I,s[I])}else M=t;M.bind("$",f),r=new Date,M.timestamp=r,Array.isArray(f)&&!X(f)&&(f=x(f),f.outerWrapper=!0);var de;try{return de=await S(o,f,M),typeof d=="function"&&d(null,de),de}catch(V){throw Ve(V),V}},assign:function(f,s){t.bind(f,s)},registerFunction:function(f,s,d){var k=O(s,d);t.bind(f,k)},ast:function(){return o},errors:function(){return e}}}return le.parser=he,le})();W.exports=ce},{"./datetime":1,"./functions":2,"./parser":4,"./signature":5,"./utils":6}],4:[function(Te,W,pe){var ee=Te("./signature");let b=(()=>{"use strict";var q={".":75,"[":80,"]":0,"{":70,"}":0,"(":80,")":0,",":0,"@":80,"#":80,";":80,":":80,"?":20,"+":50,"-":50,"*":60,"/":60,"%":60,"|":20,"=":40,"<":40,">":40,"^":40,"**":60,"..":20,":=":10,"!=":40,"<=":40,">=":40,"~>":40,"?:":40,"??":40,and:30,or:25,in:40,"&":50,"!":0,"~":0},he={'"':'"',"\\":"\\","/":"/",b:"\b",f:"\f",n:`
`,r:"\r",t:"	"},Q=function(D){var v=0,g=D.length,x=function(ye,R){var w={type:ye,value:R,position:v};return w},X=function(){for(var ye=v,R=0,w,_,P=function(S){if(D.charAt(S)==="/"&&R===0){for(var F=0;D.charAt(S-(F+1))==="\\";)F++;if(F%2===0)return!0}return!1};v<g;){var p=D.charAt(v);if(P(v)){if(w=D.substring(ye,v),w==="")throw{code:"S0301",stack:new Error().stack,position:v};for(v++,p=D.charAt(v),ye=v;p==="i"||p==="m";)v++,p=D.charAt(v);return _=D.substring(ye,v)+"g",new RegExp(w,_)}(p==="("||p==="["||p==="{")&&D.charAt(v-1)!=="\\"&&R++,(p===")"||p==="]"||p==="}")&&D.charAt(v-1)!=="\\"&&R--,v++}throw{code:"S0302",stack:new Error().stack,position:v}},be=function(ye){if(v>=g)return null;for(var R=D.charAt(v);v<g&&` 	
\r\v`.indexOf(R)>-1;)v++,R=D.charAt(v);if(R==="/"&&D.charAt(v+1)==="*"){var w=v;for(v+=2,R=D.charAt(v);!(R==="*"&&D.charAt(v+1)==="/");)if(R=D.charAt(++v),v>=g)throw{code:"S0106",stack:new Error().stack,position:w};return v+=2,R=D.charAt(v),be(ye)}if(ye!==!0&&R==="/")return v++,x("regex",X());if(R==="."&&D.charAt(v+1)===".")return v+=2,x("operator","..");if(R===":"&&D.charAt(v+1)==="=")return v+=2,x("operator",":=");if(R==="!"&&D.charAt(v+1)==="=")return v+=2,x("operator","!=");if(R===">"&&D.charAt(v+1)==="=")return v+=2,x("operator",">=");if(R==="<"&&D.charAt(v+1)==="=")return v+=2,x("operator","<=");if(R==="*"&&D.charAt(v+1)==="*")return v+=2,x("operator","**");if(R==="~"&&D.charAt(v+1)===">")return v+=2,x("operator","~>");if(R==="?"&&D.charAt(v+1)===":")return v+=2,x("operator","?:");if(R==="?"&&D.charAt(v+1)==="?")return v+=2,x("operator","??");if(Object.prototype.hasOwnProperty.call(q,R))return v++,x("operator",R);if(R==='"'||R==="'"){var _=R;v++;for(var P="";v<g;){if(R=D.charAt(v),R==="\\")if(v++,R=D.charAt(v),Object.prototype.hasOwnProperty.call(he,R))P+=he[R];else if(R==="u"){var p=D.substr(v+1,4);if(/^[0-9a-fA-F]+$/.test(p)){var S=parseInt(p,16);P+=String.fromCharCode(S),v+=4}else throw{code:"S0104",stack:new Error().stack,position:v}}else throw{code:"S0103",stack:new Error().stack,position:v,token:R};else{if(R===_)return v++,x("string",P);P+=R}v++}throw{code:"S0101",stack:new Error().stack,position:v}}var F=/^-?(0|([1-9][0-9]*))(\.[0-9]+)?([Ee][-+]?[0-9]+)?/,H=F.exec(D.substring(v));if(H!==null){var re=parseFloat(H[0]);if(!isNaN(re)&&isFinite(re))return v+=H[0].length,x("number",re);throw{code:"S0102",stack:new Error().stack,position:v,token:H[0]}}var oe;if(R==="`"){v++;var ue=D.indexOf("`",v);if(ue!==-1)return oe=D.substring(v,ue),v=ue+1,x("name",oe);throw v=g,{code:"S0105",stack:new Error().stack,position:v}}for(var K=v,we;;)if(we=D.charAt(K),K===g||` 	
\r\v`.indexOf(we)>-1||Object.prototype.hasOwnProperty.call(q,we)){if(D.charAt(v)==="$")return oe=D.substring(v+1,K),v=K,x("variable",oe);switch(oe=D.substring(v,K),v=K,oe){case"or":case"in":case"and":return x("operator",oe);case"true":return x("value",!0);case"false":return x("value",!1);case"null":return x("value",null);default:return v===g&&oe===""?null:x("name",oe)}}else K++};return be},ce=function(D,v){var g,x,X={},be=[],ye=function(){var a=[];g.id!=="(end)"&&a.push({type:g.type,value:g.value,position:g.position});for(var u=x();u!==null;)a.push(u),u=x();return a},R={nud:function(){var a={code:"S0211",token:this.value,position:this.position};if(v)return a.remaining=ye(),a.type="error",be.push(a),a;throw a.stack=new Error().stack,a}},w=function(a,u){var C=X[a];return u=u||0,C?u>=C.lbp&&(C.lbp=u):(C=Object.create(R),C.id=C.value=a,C.lbp=u,X[a]=C),C},_=function(a){if(v){a.remaining=ye(),be.push(a);var u=X["(error)"];return g=Object.create(u),g.error=a,g.type="(error)",g}else throw a.stack=new Error().stack,a},P=function(a,u){if(a&&g.id!==a){var C;g.id==="(end)"?C="S0203":C="S0202";var G={code:C,position:g.position,token:g.value,value:a};return _(G)}var ve=x(u);if(ve===null)return g=X["(end)"],g.position=D.length,g;var ie=ve.value,c=ve.type,h;switch(c){case"name":case"variable":h=X["(name)"];break;case"operator":if(h=X[ie],!h)return _({code:"S0204",stack:new Error().stack,position:ve.position,token:ie});break;case"string":case"number":case"value":h=X["(literal)"];break;case"regex":c="regex",h=X["(regex)"];break;default:return _({code:"S0205",stack:new Error().stack,position:ve.position,token:ie})}return g=Object.create(h),g.value=ie,g.type=c,g.position=ve.position,g},p=function(a){var u,C=g;for(P(null,!0),u=C.nud();a<g.lbp;)C=g,P(),u=C.led(u);return u},S=function(a){var u=w(a,0);u.nud=function(){return this}},F=function(a,u,C){var G=u||q[a],ve=w(a,G);return ve.led=C||function(ie){return this.lhs=ie,this.rhs=p(G),this.type="binary",this},ve},H=function(a,u,C){var G=w(a,u);return G.led=C,G},re=function(a,u){var C=w(a);return C.nud=u||function(){return this.expression=p(70),this.type="unary",this},C};S("(end)"),S("(name)"),S("(literal)"),S("(regex)"),w(":"),w(";"),w(","),w(")"),w("]"),w("}"),w(".."),F("."),F("+"),F("-"),F("*"),F("/"),F("%"),F("="),F("<"),F(">"),F("!="),F("<="),F(">="),F("&"),F("and"),F("or"),F("in"),S("and"),S("or"),S("in"),re("-"),F("~>"),F("??",q["??"],function(a){return this.type="condition",this.condition={type:"function",value:"(",procedure:{type:"variable",value:"exists"},arguments:[a]},this.then=a,this.else=p(0),this}),H("(error)",10,function(a){return this.lhs=a,this.error=g.error,this.remaining=ye(),this.type="error",this}),re("*",function(){return this.type="wildcard",this}),re("**",function(){return this.type="descendant",this}),re("%",function(){return this.type="parent",this}),F("(",q["("],function(a){if(this.procedure=a,this.type="function",this.arguments=[],g.id!==")")for(;g.type==="operator"&&g.id==="?"?(this.type="partial",this.arguments.push(g),P("?")):this.arguments.push(p(0)),g.id===",";)P(",");if(P(")",!0),a.type==="name"&&(a.value==="function"||a.value==="\u03BB")){if(this.arguments.forEach(function(ie,c){if(ie.type!=="variable")return _({code:"S0208",stack:new Error().stack,position:ie.position,token:ie.value,value:c+1})}),this.type="lambda",g.id==="<"){for(var u=g.position,C=1,G="<";C>0&&g.id!=="{"&&g.id!=="(end)";){var ve=P();ve.id===">"?C--:ve.id==="<"&&C++,G+=ve.value}P(">");try{this.signature=ee(G)}catch(ie){return ie.position=u+ie.offset,_(ie)}}P("{"),this.body=p(0),P("}")}return this}),re("(",function(){for(var a=[];g.id!==")"&&(a.push(p(0)),g.id===";");)P(";");return P(")",!0),this.type="block",this.expressions=a,this}),re("[",function(){var a=[];if(g.id!=="]")for(;;){var u=p(0);if(g.id===".."){var C={type:"binary",value:"..",position:g.position,lhs:u};P(".."),C.rhs=p(0),u=C}if(a.push(u),g.id!==",")break;P(",")}return P("]",!0),this.expressions=a,this.type="unary",this}),F("[",q["["],function(a){if(g.id==="]"){for(var u=a;u&&u.type==="binary"&&u.value==="[";)u=u.lhs;return u.keepArray=!0,P("]"),a}else return this.lhs=a,this.rhs=p(q["]"]),this.type="binary",P("]",!0),this}),F("^",q["^"],function(a){P("(");for(var u=[];;){var C={descending:!1};if(g.id==="<"?P("<"):g.id===">"&&(C.descending=!0,P(">")),C.expression=p(0),u.push(C),g.id!==",")break;P(",")}return P(")"),this.lhs=a,this.rhs=u,this.type="binary",this});var oe=function(a){var u=[];if(g.id!=="}")for(;;){var C=p(0);P(":");var G=p(0);if(u.push([C,G]),g.id!==",")break;P(",")}return P("}",!0),typeof a>"u"?(this.lhs=u,this.type="unary"):(this.lhs=a,this.rhs=u,this.type="binary"),this};re("{",oe),F("{",q["{"],oe),H(":=",q[":="],function(a){return a.type!=="variable"?_({code:"S0212",stack:new Error().stack,position:a.position,token:a.value}):(this.lhs=a,this.rhs=p(q[":="]-1),this.type="binary",this)}),F("@",q["@"],function(a){return this.lhs=a,this.rhs=p(q["@"]),this.rhs.type!=="variable"?_({code:"S0214",stack:new Error().stack,position:this.rhs.position,token:"@"}):(this.type="binary",this)}),F("#",q["#"],function(a){return this.lhs=a,this.rhs=p(q["#"]),this.rhs.type!=="variable"?_({code:"S0214",stack:new Error().stack,position:this.rhs.position,token:"#"}):(this.type="binary",this)}),F("?",q["?"],function(a){return this.type="condition",this.condition=a,this.then=p(0),g.id===":"&&(P(":"),this.else=p(0)),this}),F("?:",q["?:"],function(a){return this.type="condition",this.condition=a,this.then=a,this.else=p(0),this}),re("|",function(){return this.type="transform",this.pattern=p(0),P("|"),this.update=p(0),g.id===","&&(P(","),this.delete=p(0)),P("|"),this});var ue=function(a){var u;if(a.type==="function"&&!a.predicate){var C={type:"lambda",thunk:!0,arguments:[],position:a.position};C.body=a,u=C}else if(a.type==="condition")a.then=ue(a.then),typeof a.else<"u"&&(a.else=ue(a.else)),u=a;else if(a.type==="block"){var G=a.expressions.length;G>0&&(a.expressions[G-1]=ue(a.expressions[G-1])),u=a}else u=a;return u},K=0,we=0,$e=[],ae=function(a,u){switch(a.type){case"name":case"wildcard":u.level--,u.level===0&&(typeof a.ancestor>"u"||($e[u.index].slot.label=a.ancestor.label),a.ancestor=u,a.tuple=!0);break;case"parent":u.level++;break;case"block":a.expressions.length>0&&(a.tuple=!0,u=ae(a.expressions[a.expressions.length-1],u));break;case"path":a.tuple=!0;var C=a.steps.length-1;for(u=ae(a.steps[C--],u);u.level>0&&C>=0;)u=ae(a.steps[C--],u);break;default:throw{code:"S0217",token:a.type,position:a.position}}return u},B=function(a,u){if(typeof u.seekingParent<"u"||u.type==="parent"){var C=typeof u.seekingParent<"u"?u.seekingParent:[];u.type==="parent"&&C.push(u.slot),typeof a.seekingParent>"u"?a.seekingParent=C:Array.prototype.push.apply(a.seekingParent,C)}},_e=function(a){var u=a.steps.length-1,C=a.steps[u],G=typeof C.seekingParent<"u"?C.seekingParent:[];C.type==="parent"&&G.push(C.slot);for(var ve=0;ve<G.length;ve++){var ie=G[ve];for(u=a.steps.length-2;ie.level>0;){if(u<0){typeof a.seekingParent>"u"?a.seekingParent=[ie]:a.seekingParent.push(ie);break}for(var c=a.steps[u--];u>=0&&c.focus&&a.steps[u].focus;)c=a.steps[u--];ie=ae(c,ie)}}},$=function(a){var u;switch(a.type){case"binary":switch(a.value){case".":var C=$(a.lhs);C.type==="path"?u=C:u={type:"path",steps:[C]},C.type==="parent"&&(u.seekingParent=[C.slot]);var G=$(a.rhs);G.type==="function"&&G.procedure.type==="path"&&G.procedure.steps.length===1&&G.procedure.steps[0].type==="name"&&u.steps[u.steps.length-1].type==="function"&&(u.steps[u.steps.length-1].nextFunction=G.procedure.steps[0].value),G.type==="path"?Array.prototype.push.apply(u.steps,G.steps):(typeof G.predicate<"u"&&(G.stages=G.predicate,delete G.predicate),u.steps.push(G)),u.steps.filter(function(E){if(E.type==="number"||E.type==="value")throw{code:"S0213",stack:new Error().stack,position:E.position,value:E.value};return E.type==="string"}).forEach(function(E){E.type="name"}),u.steps.filter(function(E){return E.keepArray===!0}).length>0&&(u.keepSingletonArray=!0);var ve=u.steps[0];ve.type==="unary"&&ve.value==="["&&(ve.consarray=!0);var ie=u.steps[u.steps.length-1];ie.type==="unary"&&ie.value==="["&&(ie.consarray=!0),_e(u);break;case"[":u=$(a.lhs);var c=u,h="predicate";if(u.type==="path"&&(c=u.steps[u.steps.length-1],h="stages"),typeof c.group<"u")throw{code:"S0209",stack:new Error().stack,position:a.position};typeof c[h]>"u"&&(c[h]=[]);var l=$(a.rhs);typeof l.seekingParent<"u"&&(l.seekingParent.forEach(E=>{E.level===1?ae(c,E):E.level--}),B(c,l)),c[h].push({type:"filter",expr:l,position:a.position});break;case"{":if(u=$(a.lhs),typeof u.group<"u")throw{code:"S0210",stack:new Error().stack,position:a.position};u.group={lhs:a.rhs.map(function(E){return[$(E[0]),$(E[1])]}),position:a.position};break;case"^":u=$(a.lhs),u.type!=="path"&&(u={type:"path",steps:[u]});var m={type:"sort",position:a.position};m.terms=a.rhs.map(function(E){var j=$(E.expression);return B(m,j),{descending:E.descending,expression:j}}),u.steps.push(m),_e(u);break;case":=":u={type:"bind",value:a.value,position:a.position},u.lhs=$(a.lhs),u.rhs=$(a.rhs),B(u,u.rhs);break;case"@":if(u=$(a.lhs),c=u,u.type==="path"&&(c=u.steps[u.steps.length-1]),typeof c.stages<"u"||typeof c.predicate<"u")throw{code:"S0215",stack:new Error().stack,position:a.position};if(c.type==="sort")throw{code:"S0216",stack:new Error().stack,position:a.position};a.keepArray&&(c.keepArray=!0),c.focus=a.rhs.value,c.tuple=!0;break;case"#":u=$(a.lhs),c=u,u.type==="path"?c=u.steps[u.steps.length-1]:(u={type:"path",steps:[u]},typeof c.predicate<"u"&&(c.stages=c.predicate,delete c.predicate)),typeof c.stages>"u"?c.index=a.rhs.value:c.stages.push({type:"index",value:a.rhs.value,position:a.position}),c.tuple=!0;break;case"~>":u={type:"apply",value:a.value,position:a.position},u.lhs=$(a.lhs),u.rhs=$(a.rhs),u.keepArray=u.lhs.keepArray||u.rhs.keepArray;break;default:u={type:a.type,value:a.value,position:a.position},u.lhs=$(a.lhs),u.rhs=$(a.rhs),B(u,u.lhs),B(u,u.rhs)}break;case"unary":u={type:a.type,value:a.value,position:a.position},a.value==="["?u.expressions=a.expressions.map(function(E){var j=$(E);return B(u,j),j}):a.value==="{"?u.lhs=a.lhs.map(function(E){var j=$(E[0]);B(u,j);var Z=$(E[1]);return B(u,Z),[j,Z]}):(u.expression=$(a.expression),a.value==="-"&&u.expression.type==="number"?(u=u.expression,u.value=-u.value):B(u,u.expression));break;case"function":case"partial":u={type:a.type,name:a.name,value:a.value,position:a.position},u.arguments=a.arguments.map(function(E){var j=$(E);return B(u,j),j}),u.procedure=$(a.procedure);break;case"lambda":u={type:a.type,arguments:a.arguments,signature:a.signature,position:a.position};var T=$(a.body);u.body=ue(T);break;case"condition":u={type:a.type,position:a.position},u.condition=$(a.condition),B(u,u.condition),u.then=$(a.then),B(u,u.then),typeof a.else<"u"&&(u.else=$(a.else),B(u,u.else));break;case"transform":u={type:a.type,position:a.position},u.pattern=$(a.pattern),u.update=$(a.update),typeof a.delete<"u"&&(u.delete=$(a.delete));break;case"block":u={type:a.type,position:a.position},u.expressions=a.expressions.map(function(E){var j=$(E);return B(u,j),(j.consarray||j.type==="path"&&j.steps[0].consarray)&&(u.consarray=!0),j});break;case"name":u={type:"path",steps:[a]},a.keepArray&&(u.keepSingletonArray=!0);break;case"parent":u={type:"parent",slot:{label:"!"+K++,level:1,index:we++}},$e.push(u);break;case"string":case"number":case"value":case"wildcard":case"descendant":case"variable":case"regex":u=a;break;case"operator":if(a.value==="and"||a.value==="or"||a.value==="in")a.type="name",u=$(a);else if(a.value==="?")u=a;else throw{code:"S0201",stack:new Error().stack,position:a.position,token:a.value};break;case"error":u=a,a.lhs&&(u=$(a.lhs));break;default:var A="S0206";a.id==="(end)"&&(A="S0207");var y={code:A,position:a.position,token:a.value};if(v)return be.push(y),{type:"error",error:y};throw y.stack=new Error().stack,y}return a.keepArray&&(u.keepArray=!0),u};x=Q(D),P();var De=p(0);if(g.id!=="(end)"){var Ye={code:"S0201",position:g.position,token:g.value};_(Ye)}if(De=$(De),De.type==="parent"||typeof De.seekingParent<"u")throw{code:"S0217",token:De.type,position:De.position};return be.length>0&&(De.errors=be),De};return ce})();W.exports=b},{"./signature":5}],5:[function(Te,W,pe){var ee=Te("./utils");let b=(()=>{"use strict";var q={a:"arrays",b:"booleans",f:"functions",n:"numbers",o:"objects",s:"strings"};function he(Q){for(var ce=1,D=[],v={},g=v;ce<Q.length;){var x=Q.charAt(ce);if(x===":")break;var X=function(){D.push(v),g=v,v={}},be=function(F,H,re,oe){for(var ue=1,K=H;K<F.length;)if(K++,x=F.charAt(K),x===oe){if(ue--,ue===0)break}else x===re&&ue++;return K};switch(x){case"s":case"n":case"b":case"l":case"o":v.regex="["+x+"m]",v.type=x,X();break;case"a":v.regex="[asnblfom]",v.type=x,v.array=!0,X();break;case"f":v.regex="f",v.type=x,X();break;case"j":v.regex="[asnblom]",v.type=x,X();break;case"x":v.regex="[asnblfom]",v.type=x,X();break;case"-":g.context=!0,g.contextRegex=new RegExp(g.regex),g.regex+="?";break;case"?":case"+":g.regex+=x;break;case"(":var ye=be(Q,ce,"(",")"),R=Q.substring(ce+1,ye);if(R.indexOf("<")===-1)v.regex="["+R+"m]";else throw{code:"S0402",stack:new Error().stack,value:R,offset:ce};v.type="("+R+")",ce=ye,X();break;case"<":if(g.type==="a"||g.type==="f"){var w=be(Q,ce,"<",">");g.subtype=Q.substring(ce+1,w),ce=w}else throw{code:"S0401",stack:new Error().stack,value:g.type,offset:ce};break}ce++}var _="^"+D.map(function(F){return"("+F.regex+")"}).join("")+"$",P=new RegExp(_),p=function(F){var H;if(ee.isFunction(F))H="f";else{var re=typeof F;switch(re){case"string":H="s";break;case"number":H="n";break;case"boolean":H="b";break;case"object":F===null?H="l":Array.isArray(F)?H="a":H="o";break;case"undefined":default:H="m"}}return H},S=function(F,H){for(var re="^",oe=0,ue=0;ue<D.length;ue++){re+=D[ue].regex;var K=H.match(re);if(K===null)throw{code:"T0410",stack:new Error().stack,value:F[oe],index:oe+1};oe=K[0].length}throw{code:"T0410",stack:new Error().stack,value:F[oe],index:oe+1}};return{definition:Q,validate:function(F,H){var re="";F.forEach(function(we){re+=p(we)});var oe=P.exec(re);if(oe){var ue=[],K=0;return D.forEach(function(we,$e){var ae=F[K],B=oe[$e+1];if(B==="")if(we.context&&we.contextRegex){var _e=p(H);if(we.contextRegex.test(_e))ue.push(H);else throw{code:"T0411",stack:new Error().stack,value:H,index:K+1}}else ue.push(ae),K++;else B.split("").forEach(function($){if(we.type==="a"){if($==="m")ae=void 0;else{ae=F[K];var De=!0;if(typeof we.subtype<"u"){if($!=="a"&&B!==we.subtype)De=!1;else if($==="a"&&ae.length>0){var Ye=p(ae[0]);if(Ye!==we.subtype.charAt(0))De=!1;else{var a=ae.filter(function(u){return p(u)!==Ye});De=a.length===0}}}if(!De)throw{code:"T0412",stack:new Error().stack,value:ae,index:K+1,type:q[we.subtype]};$!=="a"&&(ae=[ae])}ue.push(ae),K++}else ue.push(ae),K++})}),ue}S(F,re)}}}return he})();W.exports=b},{"./utils":6}],6:[function(Te,W,pe){let ee=(()=>{"use strict";function b(w){var _=!1;if(typeof w=="number"&&(_=!isNaN(w),_&&!isFinite(w)))throw{code:"D1001",value:w,stack:new Error().stack};return _}function q(w){var _=!1;return Array.isArray(w)&&(_=w.filter(function(P){return typeof P!="string"}).length===0),_}function he(w){var _=!1;return Array.isArray(w)&&(_=w.filter(function(P){return!b(P)}).length===0),_}function Q(){var w=[];return w.sequence=!0,arguments.length===1&&w.push(arguments[0]),w}function ce(w){return w.sequence===!0&&Array.isArray(w)}function D(w){return w&&(w._jsonata_function===!0||w._jsonata_lambda===!0)||typeof w=="function"}function v(w){var _=typeof w.arity=="number"?w.arity:typeof w.implementation=="function"?w.implementation.length:typeof w.length=="number"?w.length:w.arguments.length;return _}function g(w){return w&&w._jsonata_lambda===!0}var x=(typeof Symbol=="function"?Symbol:{}).iterator||"@@iterator";function X(w){return typeof w=="object"&&w!==null&&x in w&&"next"in w&&typeof w.next=="function"}function be(w,_){if(w===_)return!0;if(typeof w=="object"&&typeof _=="object"&&w!==null&&_!==null){if(Array.isArray(w)&&Array.isArray(_)){if(w.length!==_.length)return!1;for(var P=0;P<w.length;P++)if(!be(w[P],_[P]))return!1;return!0}var p=Object.getOwnPropertyNames(w),S=Object.getOwnPropertyNames(_);if(p.length!==S.length)return!1;for(p=p.sort(),S=S.sort(),P=0;P<p.length;P++)if(p[P]!==S[P])return!1;for(P=0;P<p.length;P++){var F=p[P];if(!be(w[F],_[F]))return!1}return!0}return!1}function ye(w){return typeof w=="object"&&w!==null&&"then"in w&&typeof w.then=="function"}function R(w){var _=[];for(let P of w)_.push(P);return _}return{isNumeric:b,isArrayOfStrings:q,isArrayOfNumbers:he,createSequence:Q,isSequence:ce,isFunction:D,isLambda:g,isIterable:X,getFunctionArity:v,isDeepEqual:be,stringToArray:R,isPromise:ye}})();W.exports=ee},{}]},{},[3])(3)})});var St=Lt(Tt(),1),Dt=class{#t={};#n=!1;#e={results:{},variables:{global:{},locals:[]}};#r={set:null,get:null};constructor({functions:se={},explicitItisOnly:Re=!1}={}){this.#t=se,this.#n=Re}async run({inits:se={},connections:Re=[]}={}){if(this.#e.results={},this.#n&&Object.keys(se).length===0)throw new Error('When "explicitItisOnly" is true, "inits" cannot be empty.');if(!this.#n){let W={};for(let pe of Re){for(let ee of pe.from??[])W[ee]=[];for(let ee of pe.to??[])W[ee]&&delete W[ee]}for(let pe of Object.keys(W))se[pe]||(se[pe]=W[pe])}for(let W of Object.keys(se))this.#t[W]&&(this.#e.results[W]=Promise.resolve(this.#t[W](...se[W])));this.#e.variables={global:{},locals:new Array(Re.length).fill(null).map(()=>({}))},await(async()=>{let W;do{W=!1;for(let pe=0;pe<Re.length;pe++){let ee=Re[pe],b=!0,q=[],he=ee.from??[];if(he.length===0)throw new Error(`The connection ${pe} from is an empty array.
Connection: ${JSON.stringify(ee)}`);for(let Q of he)if(Object.hasOwn(this.#e.results,Q))q.push(this.#e.results[Q]);else{b=!1;break}if(b){let Q=await Promise.all(q);for(let g of he)delete this.#e.results[g];W=!0;let ce=ee.to??[],D={to:Q.map(g=>[g]),global:this.#e.variables.global,local:this.#e.variables.locals[pe]};if(ee.transition)try{let g={from:Q,global:this.#e.variables.global,local:this.#e.variables.locals[pe]};D=await(0,St.default)(ee.transition).evaluate(g)}catch(g){throw new Error(`Connection ${pe} transition: ${g.message}`)}let v=D.to;if(this.#e.variables.global=D.global??this.#e.variables.global,this.#e.variables.locals[pe]=D.local??this.#e.variables.locals[pe],ce.length>0){if(!Array.isArray(v))throw new Error(`The transition returned value must be an array.
Returned: ${JSON.stringify(v)}
Connection: ${JSON.stringify(ee)}`);if(v.length!=ce.length)throw new Error(`The transition returned value must be an array of the same length of the connection.to array.
Returned: ${JSON.stringify(v)}
Connection: ${JSON.stringify(ee)}`);for(let g=0;g<ce.length;g++){let x=ce[g],X=v[g];X!=null&&(this.#e.results[x]=Promise.resolve(this.#t?.[x](...X)))}}else this.#e.results["connection_"+pe]=v}}}while(W)})();for(let W of Object.keys(this.#e.results))this.#e.results[W]=await this.#e.results[W];return{results:this.#e.results,variables:this.#e.variables}}};export{Dt as Orchestrator};
//# sourceMappingURL=index.min.js.map
