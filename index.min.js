var xt=Object.create;var At=Object.defineProperty;var Ut=Object.getOwnPropertyDescriptor;var jt=Object.getOwnPropertyNames;var Mt=Object.getPrototypeOf,It=Object.prototype.hasOwnProperty;var dt=(pe=>typeof require<"u"?require:typeof Proxy<"u"?new Proxy(pe,{get:(K,De)=>(typeof require<"u"?require:K)[De]}):pe)(function(pe){if(typeof require<"u")return require.apply(this,arguments);throw Error('Dynamic require of "'+pe+'" is not supported')});var Nt=(pe,K)=>()=>(K||pe((K={exports:{}}).exports,K),K.exports);var Rt=(pe,K,De,k)=>{if(K&&typeof K=="object"||typeof K=="function")for(let be of jt(K))!It.call(pe,be)&&be!==De&&At(pe,be,{get:()=>K[be],enumerable:!(k=Ut(K,be))||k.enumerable});return pe};var Lt=(pe,K,De)=>(De=pe!=null?xt(Mt(pe)):{},Rt(K||!pe||!pe.__esModule?At(De,"default",{value:pe,enumerable:!0}):De,pe));var Dt=Nt((Tt,wt)=>{(function(pe){if(typeof Tt=="object"&&typeof wt<"u")wt.exports=pe();else if(typeof define=="function"&&define.amd)define([],pe);else{var K;typeof window<"u"?K=window:typeof global<"u"?K=global:typeof self<"u"?K=self:K=this,K.jsonata=pe()}})(function(){var pe,K,De;return(function(){function k(be,Ge,we){function T(z,oe){if(!Ge[z]){if(!be[z]){var F=typeof dt=="function"&&dt;if(!oe&&F)return F(z,!0);if(N)return N(z,!0);var m=new Error("Cannot find module '"+z+"'");throw m.code="MODULE_NOT_FOUND",m}var D=Ge[z]={exports:{}};be[z][0].call(D.exports,function(M){var se=be[z][1][M];return T(se||M)},D,D.exports,k,be,Ge,we)}return Ge[z].exports}for(var N=typeof dt=="function"&&dt,ue=0;ue<we.length;ue++)T(we[ue]);return T}return k})()({1:[function(k,be,Ge){let we=k("./utils"),T=(function(){"use strict";let N=we.stringToArray,ue=["Zero","One","Two","Three","Four","Five","Six","Seven","Eight","Nine","Ten","Eleven","Twelve","Thirteen","Fourteen","Fifteen","Sixteen","Seventeen","Eighteen","Nineteen"],z=["Zeroth","First","Second","Third","Fourth","Fifth","Sixth","Seventh","Eighth","Ninth","Tenth","Eleventh","Twelfth","Thirteenth","Fourteenth","Fifteenth","Sixteenth","Seventeenth","Eighteenth","Nineteenth"],oe=["Twenty","Thirty","Forty","Fifty","Sixty","Seventy","Eighty","Ninety","Hundred"],F=["Thousand","Million","Billion","Trillion"];function m(c,d){var p=function(b,A,v){var E="";if(b<=19)E=(A?" and ":"")+(v?z[b]:ue[b]);else if(b<100){let re=Math.floor(b/10),le=b%10;E=(A?" and ":"")+oe[re-2],le>0?E+="-"+p(le,!1,v):v&&(E=E.substring(0,E.length-1)+"ieth")}else if(b<1e3){let re=Math.floor(b/100),le=b%100;E=(A?", ":"")+ue[re]+" Hundred",le>0?E+=p(le,!0,v):v&&(E+="th")}else{var $=Math.floor(Math.log10(b)/3);$>F.length&&($=F.length);let re=Math.pow(10,$*3),le=Math.floor(b/re),G=b-le*re;E=(A?", ":"")+p(le,!1,!1)+" "+F[$-1],G>0?E+=p(G,!0,v):v&&(E+="th")}return E},i=p(c,!1,d);return i}let D={};ue.forEach(function(c,d){D[c.toLowerCase()]=d}),z.forEach(function(c,d){D[c.toLowerCase()]=d}),oe.forEach(function(c,d){let p=c.toLowerCase();D[p]=(d+2)*10,D[p.substring(0,c.length-1)+"ieth"]=D[p]}),D.hundredth=100,F.forEach(function(c,d){let p=c.toLowerCase(),i=Math.pow(10,(d+1)*3);D[p]=i,D[p+"th"]=i});function M(c){let p=c.split(/,\s|\sand\s|[\s\\-]/).map(A=>D[A]),i=[0];return p.forEach(A=>{if(A<100){let v=i.pop();v>=1e3&&(i.push(v),v=0),i.push(v+A)}else i.push(i.pop()*A)}),i.reduce((A,v)=>A+v,0)}let se=[[1e3,"m"],[900,"cm"],[500,"d"],[400,"cd"],[100,"c"],[90,"xc"],[50,"l"],[40,"xl"],[10,"x"],[9,"ix"],[5,"v"],[4,"iv"],[1,"i"]],Z={M:1e3,D:500,C:100,L:50,X:10,V:5,I:1};function te(c){for(var d=0;d<se.length;d++){let p=se[d];if(c>=p[0])return p[1]+te(c-p[0])}return""}function x(c){for(var d=0,p=1,i=c.length-1;i>=0;i--){let b=c[i],A=Z[b];A<p?d-=A:(p=A,d+=A)}return d}function O(c,d){for(var p=[],i=d.charCodeAt(0);c>0;)p.unshift(String.fromCharCode((c-1)%26+i)),c=Math.floor((c-1)/26);return p.join("")}function Y(c,d){for(var p=d.charCodeAt(0),i=0,b=0;b<c.length;b++)i+=(c.charCodeAt(c.length-b-1)-p+1)*Math.pow(26,b);return i}function w(c,d){if(typeof c>"u")return;c=Math.floor(c);let p=V(d);return U(c,p)}let g={DECIMAL:"decimal",LETTERS:"letters",ROMAN:"roman",WORDS:"words",SEQUENCE:"sequence"},C={UPPER:"upper",LOWER:"lower",TITLE:"title"};function U(c,d){let p,i=c<0;switch(c=Math.abs(c),d.primary){case g.LETTERS:p=O(c,d.case===C.UPPER?"A":"a");break;case g.ROMAN:p=te(c),d.case===C.UPPER&&(p=p.toUpperCase());break;case g.WORDS:p=m(c,d.ordinal),d.case===C.UPPER?p=p.toUpperCase():d.case===C.LOWER&&(p=p.toLowerCase());break;case g.DECIMAL:p=""+c;var b=d.mandatoryDigits-p.length;if(b>0){var A=new Array(b+1).join("0");p=A+p}if(d.zeroCode!==48&&(p=N(p).map(re=>String.fromCodePoint(re.codePointAt(0)+d.zeroCode-48)).join("")),d.regular){let re=Math.floor((p.length-1)/d.groupingSeparators.position);for(let le=re;le>0;le--){let G=p.length-le*d.groupingSeparators.position;p=p.substr(0,G)+d.groupingSeparators.character+p.substr(G)}}else d.groupingSeparators.reverse().forEach(re=>{let le=p.length-re.position;p=p.substr(0,le)+re.character+p.substr(le)});if(d.ordinal){var v={1:"st",2:"nd",3:"rd"},E=p[p.length-1],$=v[E];(!$||p.length>1&&p[p.length-2]==="1")&&($="th"),p=p+$}break;case g.SEQUENCE:throw{code:"D3130",value:d.token}}return i&&(p="-"+p),p}let X=[48,1632,1776,1984,2406,2534,2662,2790,2918,3046,3174,3302,3430,3558,3664,3792,3872,4160,4240,6112,6160,6470,6608,6784,6800,6992,7088,7232,7248,42528,43216,43264,43472,43504,43600,44016,65296];function V(c){let d={type:"integer",primary:g.DECIMAL,case:C.LOWER,ordinal:!1},p,i,b=c.lastIndexOf(";");switch(b===-1?p=c:(p=c.substring(0,b),i=c.substring(b+1),i[0]==="o"&&(d.ordinal=!0)),p){case"A":d.case=C.UPPER;case"a":d.primary=g.LETTERS;break;case"I":d.case=C.UPPER;case"i":d.primary=g.ROMAN;break;case"W":d.case=C.UPPER,d.primary=g.WORDS;break;case"Ww":d.case=C.TITLE,d.primary=g.WORDS;break;case"w":d.primary=g.WORDS;break;default:{let A=null,v=0,E=0,$=[],re=0;if(N(p).map(G=>G.codePointAt(0)).reverse().forEach(G=>{let _=!1;for(let ie=0;ie<X.length;ie++){let B=X[ie];if(G>=B&&G<=B+9){if(_=!0,v++,re++,A===null)A=B;else if(B!==A)throw{code:"D3131"};break}}_||(G===35?(re++,E++):$.push({position:re,character:String.fromCodePoint(G)}))}),v>0){d.primary=g.DECIMAL,d.zeroCode=A,d.mandatoryDigits=v,d.optionalDigits=E;let _=function(ie){if(ie.length===0)return 0;let B=ie[0].character;for(let Fe=1;Fe<ie.length;Fe++)if(ie[Fe].character!==B)return 0;let $e=ie.map(Fe=>Fe.position),Ye=function(Fe,Ne){return Ne===0?Fe:Ye(Ne,Fe%Ne)},Ie=$e.reduce(Ye);for(let Fe=1;Fe<=$e.length;Fe++)if($e.indexOf(Fe*Ie)===-1)return 0;return Ie}($);_>0?(d.regular=!0,d.groupingSeparators={position:_,character:$[0].character}):(d.regular=!1,d.groupingSeparators=$)}else d.primary=g.SEQUENCE,d.token=p}}return d}let fe={Y:"1",M:"1",D:"1",d:"1",F:"n",W:"1",w:"1",X:"1",x:"1",H:"1",h:"1",P:"n",m:"01",s:"01",f:"1",Z:"01:01",z:"01:01",C:"n",E:"n"};function he(c){var d=[];let p={type:"datetime",parts:d},i=function(_,ie){if(ie>_){let B=c.substring(_,ie);B=B.split("]]").join("]"),d.push({type:"literal",value:B})}};for(var b=0,A=0;A<c.length;){if(c.charAt(A)==="["){if(c.charAt(A+1)==="["){i(b,A),d.push({type:"literal",value:"["}),A+=2,b=A;continue}if(i(b,A),b=A,A=c.indexOf("]",b),A===-1)throw{code:"D3135"};let _=c.substring(b+1,A);_=_.split(/\s+/).join("");var v={type:"marker",component:_.charAt(0)},E=_.lastIndexOf(","),$;if(E!==-1){let ie=_.substring(E+1),B=ie.indexOf("-"),$e,Ye,Ie=function(Ne){if(!(typeof Ne>"u"||Ne==="*"))return parseInt(Ne)};B===-1?$e=ie:($e=ie.substring(0,B),Ye=ie.substring(B+1));let Fe={min:Ie($e),max:Ie(Ye)};v.width=Fe,$=_.substring(1,E)}else $=_.substring(1);if($.length===1)v.presentation1=$;else if($.length>1){var re=$.charAt($.length-1);"atco".indexOf(re)!==-1?(v.presentation2=re,re==="o"&&(v.ordinal=!0),v.presentation1=$.substring(0,$.length-1)):v.presentation1=$}else v.presentation1=fe[v.component];if(typeof v.presentation1>"u")throw{code:"D3132",value:v.component};if(v.presentation1[0]==="n")v.names=C.LOWER;else if(v.presentation1[0]==="N")v.presentation1[1]==="n"?v.names=C.TITLE:v.names=C.UPPER;else if("YMDdFWwXxHhmsf".indexOf(v.component)!==-1){var le=v.presentation1;if(v.presentation2&&(le+=";"+v.presentation2),v.integerFormat=V(le),v.width&&v.width.min!==void 0&&v.integerFormat.mandatoryDigits<v.width.min&&(v.integerFormat.mandatoryDigits=v.width.min),v.component==="Y")if(v.n=-1,v.width&&v.width.max!==void 0)v.n=v.width.max,v.integerFormat.mandatoryDigits=v.n;else{var G=v.integerFormat.mandatoryDigits+v.integerFormat.optionalDigits;G>=2&&(v.n=G)}let ie=d[d.length-1];ie&&ie.integerFormat&&(ie.integerFormat.parseWidth=ie.integerFormat.mandatoryDigits)}(v.component==="Z"||v.component==="z")&&(v.integerFormat=V(v.presentation1)),d.push(v),b=A+1}A++}return i(b,A),p}let ne=["","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"],me=["January","February","March","April","May","June","July","August","September","October","November","December"],xe=1e3*60*60*24,ce=function(c){let d=Date.UTC(c.year,c.month);var p=new Date(d).getUTCDay();return p===0&&(p=7),p>4?d+(8-p)*xe:d-(p-1)*xe},Q=function(c,d){return{year:c,month:d,nextMonth:function(){return d===11?Q(c+1,0):Q(c,d+1)},previousMonth:function(){return d===0?Q(c-1,11):Q(c,d-1)},nextYear:function(){return Q(c+1,d)},previousYear:function(){return Q(c-1,d)}}},Me=function(c,d){return(d-c)/(xe*7)+1},H=(c,d)=>{let p;switch(d){case"Y":p=c.getUTCFullYear();break;case"M":p=c.getUTCMonth()+1;break;case"D":p=c.getUTCDate();break;case"d":{let i=Date.UTC(c.getUTCFullYear(),c.getUTCMonth(),c.getUTCDate()),b=Date.UTC(c.getUTCFullYear(),0);p=(i-b)/xe+1;break}case"F":p=c.getUTCDay(),p===0&&(p=7);break;case"W":{let i=Q(c.getUTCFullYear(),0),b=ce(i),A=Date.UTC(i.year,c.getUTCMonth(),c.getUTCDate()),v=Me(b,A);if(v>52){let E=ce(i.nextYear());A>=E&&(v=1)}else if(v<1){let E=ce(i.previousYear());v=Me(E,A)}p=Math.floor(v);break}case"w":{let i=Q(c.getUTCFullYear(),c.getUTCMonth()),b=ce(i),A=Date.UTC(i.year,i.month,c.getUTCDate()),v=Me(b,A);if(v>4){let E=ce(i.nextMonth());A>=E&&(v=1)}else if(v<1){let E=ce(i.previousMonth());v=Me(E,A)}p=Math.floor(v);break}case"X":{let i=Q(c.getUTCFullYear(),0),b=ce(i),A=ce(i.nextYear()),v=c.getTime();v<b?p=i.year-1:v>=A?p=i.year+1:p=i.year;break}case"x":{let i=Q(c.getUTCFullYear(),c.getUTCMonth()),b=ce(i),A=i.nextMonth(),v=ce(A),E=c.getTime();E<b?p=i.previousMonth().month+1:E>=v?p=A.month+1:p=i.month+1;break}case"H":p=c.getUTCHours();break;case"h":p=c.getUTCHours(),p=p%12,p===0&&(p=12);break;case"P":p=c.getUTCHours()>=12?"pm":"am";break;case"m":p=c.getUTCMinutes();break;case"s":p=c.getUTCSeconds();break;case"f":p=c.getUTCMilliseconds();break;case"Z":case"z":break;case"C":p="ISO";break;case"E":p="ISO";break}return p},Ee=null;function Be(c,d,p){var i=0,b=0;if(typeof p<"u"){let le=parseInt(p);i=Math.floor(le/100),b=le%100}var A=function(le,G){var _=H(le,G.component);if("YMDdFWwXxHhms".indexOf(G.component)!==-1)if(G.component==="Y"&&G.n!==-1&&(_=_%Math.pow(10,G.n)),G.names){if(G.component==="M"||G.component==="x")_=me[_-1];else if(G.component==="F")_=ne[_];else throw{code:"D3133",value:G.component};G.names===C.UPPER?_=_.toUpperCase():G.names===C.LOWER&&(_=_.toLowerCase()),G.width&&_.length>G.width.max&&(_=_.substring(0,G.width.max))}else _=U(_,G.integerFormat);else if(G.component==="f")_=U(_,G.integerFormat);else if(G.component==="Z"||G.component==="z"){let ie=i*100+b;if(G.integerFormat.regular)_=U(ie,G.integerFormat);else{let B=G.integerFormat.mandatoryDigits;if(B===1||B===2)_=U(i,G.integerFormat),b!==0&&(_+=":"+w(b,"00"));else if(B===3||B===4)_=U(ie,G.integerFormat);else throw{code:"D3134",value:B}}ie>=0&&(_="+"+_),G.component==="z"&&(_="GMT"+_),ie===0&&G.presentation2==="t"&&(_="Z")}else G.component==="P"&&G.names===C.UPPER&&(_=_.toUpperCase());return _};let v;typeof d>"u"?(Ee===null&&(Ee=he("[Y0001]-[M01]-[D01]T[H01]:[m01]:[s01].[f001][Z01:01t]")),v=Ee):v=he(d);let E=(60*i+b)*60*1e3,$=new Date(c+E),re="";return v.parts.forEach(function(le){le.type==="literal"?re+=le.value:re+=A($,le)}),re}function a(c){var d={};if(c.type==="datetime")d.type="datetime",d.parts=c.parts.map(function(p){var i={};if(p.type==="literal")i.regex=p.value.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");else if(p.component==="Z"||p.component==="z"){let A;Array.isArray(p.integerFormat.groupingSeparators)||(A=p.integerFormat.groupingSeparators),i.regex="",p.component==="z"&&(i.regex="GMT"),i.regex+="[-+][0-9]+",A&&(i.regex+=A.character+"[0-9]+"),i.parse=function(v){p.component==="z"&&(v=v.substring(3));let E=0,$=0;return A?(E=Number.parseInt(v.substring(0,v.indexOf(A.character))),$=Number.parseInt(v.substring(v.indexOf(A.character)+1))):v.length-1<=2?E=Number.parseInt(v):(E=Number.parseInt(v.substring(0,3)),$=Number.parseInt(v.substring(3))),E*60+$}}else if(p.integerFormat)i=a(p.integerFormat);else{i.regex="[a-zA-Z]+";var b={};if(p.component==="M"||p.component==="x")me.forEach(function(A,v){p.width&&p.width.max?b[A.substring(0,p.width.max)]=v+1:b[A]=v+1});else if(p.component==="F")ne.forEach(function(A,v){v>0&&(p.width&&p.width.max?b[A.substring(0,p.width.max)]=v:b[A]=v)});else if(p.component==="P")b={am:0,AM:0,pm:1,PM:1};else throw{code:"D3133",value:p.component};i.parse=function(A){return b[A]}}return i.component=p.component,i});else{d.type="integer";let p=c.case===C.UPPER;switch(c.primary){case g.LETTERS:d.regex=p?"[A-Z]+":"[a-z]+",d.parse=function(i){return Y(i,p?"A":"a")};break;case g.ROMAN:d.regex=p?"[MDCLXVI]+":"[mdclxvi]+",d.parse=function(i){return x(p?i:i.toUpperCase())};break;case g.WORDS:d.regex="(?:"+Object.keys(D).concat("and","[\\-, ]").join("|")+")+",d.parse=function(i){return M(i.toLowerCase())};break;case g.DECIMAL:d.regex="[0-9]",c.parseWidth?d.regex+=`{${c.parseWidth}}`:d.regex+="+",c.ordinal&&(d.regex+="(?:th|st|nd|rd)"),d.parse=function(i){let b=i;return c.ordinal&&(b=i.substring(0,i.length-2)),c.regular?b=b.split(",").join(""):c.groupingSeparators.forEach(A=>{b=b.split(A.character).join("")}),c.zeroCode!==48&&(b=b.split("").map(A=>String.fromCodePoint(A.codePointAt(0)-c.zeroCode+48)).join("")),parseInt(b)};break;case g.SEQUENCE:throw{code:"D3130",value:c.token}}}return d}function u(c,d){if(typeof c>"u")return;let p=V(d);return a(p).parse(c)}function I(c,d){let p=he(d),i=a(p),b="^"+i.parts.map($=>"("+$.regex+")").join("")+"$";var v=new RegExp(b,"i").exec(c);if(v!==null){let B={};for(let ye=1;ye<v.length;ye++){let n=i.parts[ye-1];n.parse&&(B[n.component]=n.parse(v[ye]))}if(Object.getOwnPropertyNames(B).length===0)return;let $e=0,Ye=ye=>{$e<<=1,$e+=ye?1:0},Ie=ye=>!(~ye&$e)&&!!(ye&$e);"YXMxWwdD".split("").forEach(ye=>Ye(B[ye]));let Ne=!Ie(161)&&Ie(130),Xe=Ie(84),Ke=!Xe&&Ie(72);$e=0,"PHhmsf".split("").forEach(ye=>Ye(B[ye]));let et=!Ie(23)&&Ie(47),ft=(Ne?"YD":Xe?"XxwF":Ke?"XWF":"YMD")+(et?"Phmsf":"Hmsf"),Je=this.environment.timestamp,it=!1,Ze=!1;if(ft.split("").forEach(ye=>{if(typeof B[ye]>"u")it?(B[ye]="MDd".indexOf(ye)!==-1?1:0,Ze=!0):B[ye]=H(Je,ye);else if(it=!0,Ze)throw{code:"D3136"}}),B.M>0?B.M-=1:B.M=0,Ne){let ye=Date.UTC(B.Y,0),n=(B.d-1)*1e3*60*60*24,o=new Date(ye+n);B.M=o.getUTCMonth(),B.D=o.getUTCDate()}if(Xe)throw{code:"D3136"};if(Ke)throw{code:"D3136"};et&&(B.H=B.h===12?0:B.h,B.P===1&&(B.H+=12));var E=Date.UTC(B.Y,B.M,B.D,B.H,B.m,B.s,B.f);return(B.Z||B.z)&&(E-=(B.Z||B.z)*60*1e3),E}}var h=new RegExp("^\\d{4}(-[01]\\d)*(-[0-3]\\d)*(T[0-2]\\d:[0-5]\\d:[0-5]\\d)*(\\.\\d+)?([+-][0-2]\\d:?[0-5]\\d|Z)?$");function P(c,d){if(!(typeof c>"u"))if(typeof d>"u"){if(!h.test(c))throw{stack:new Error().stack,code:"D3110",value:c};return Date.parse(c)}else return I.call(this,c,d)}function L(c,d,p){if(!(typeof c>"u"))return Be.call(this,c,d,p)}return{formatInteger:w,parseInteger:u,fromMillis:L,toMillis:P}})();be.exports=T},{"./utils":6}],2:[function(k,be,Ge){(function(we){(function(){var T=k("./utils");let N=(()=>{"use strict";var ue=T.isNumeric,z=T.isArrayOfStrings,oe=T.isArrayOfNumbers,F=T.createSequence,m=T.isSequence,D=T.isFunction,M=T.isLambda,se=T.isPromise,Z=T.getFunctionArity,te=T.isDeepEqual,x=T.stringToArray;function O(e){if(!(typeof e>"u")){var t=0;return e.forEach(function(r){t+=r}),t}}function Y(e){return typeof e>"u"?0:e.length}function w(e){if(!(typeof e>"u"||e.length===0))return Math.max.apply(Math,e)}function g(e){if(!(typeof e>"u"||e.length===0))return Math.min.apply(Math,e)}function C(e){if(!(typeof e>"u"||e.length===0)){var t=0;return e.forEach(function(r){t+=r}),t/e.length}}function U(e,t=!1){if(!(typeof e>"u")){var r;if(typeof e=="string")r=e;else if(D(e))r="";else{if(typeof e=="number"&&!isFinite(e))throw{code:"D3001",value:e,stack:new Error().stack};var l=t?2:0;Array.isArray(e)&&e.outerWrapper&&(e=e[0]),r=JSON.stringify(e,function(f,y){return typeof y<"u"&&y!==null&&y.toPrecision&&ue(y)?Number(y.toPrecision(15)):y&&D(y)?"":y},l)}return r}}function X(e,t,r){if(!(typeof e>"u")){var l=x(e),f=l.length;if(f+t<0&&(t=0),typeof r<"u"){if(r<=0)return"";var y=t>=0?t+r:f+t+r;return l.slice(t,y).join("")}return l.slice(t).join("")}}function V(e,t){if(!(typeof e>"u")){var r=e.indexOf(t);return r>-1?e.substr(0,r):e}}function fe(e,t){if(!(typeof e>"u")){var r=e.indexOf(t);return r>-1?e.substr(r+t.length):e}}function he(e){if(!(typeof e>"u"))return e.toLowerCase()}function ne(e){if(!(typeof e>"u"))return e.toUpperCase()}function me(e){if(!(typeof e>"u"))return x(e).length}function xe(e){if(!(typeof e>"u")){var t=e.replace(/[ \t\n\r]+/gm," ");return t.charAt(0)===" "&&(t=t.substring(1)),t.charAt(t.length-1)===" "&&(t=t.substring(0,t.length-1)),t}}function ce(e,t,r){if(!(typeof e>"u")){(typeof r>"u"||r.length===0)&&(r=" ");var l;t=Math.trunc(t);var f=Math.abs(t)-me(e);if(f>0){var y=new Array(f+1).join(r);r.length>1&&(y=X(y,0,f)),t>0?l=e+y:l=y+e}else l=e;return l}}async function Q(e,t){var r=e.apply(this,[t]);if(se(r)&&(r=await r),r&&!(typeof r.start=="number"||r.end==="number"||Array.isArray(r.groups)||D(r.next)))throw{code:"T1010",stack:new Error().stack};return r}async function Me(e,t){if(!(typeof e>"u")){var r;if(typeof t=="string")r=e.indexOf(t)!==-1;else{var l=await Q(t,e);r=typeof l<"u"}return r}}async function H(e,t,r){if(!(typeof e>"u")){if(r<0)throw{stack:new Error().stack,value:r,code:"D3040",index:3};var l=F();if(typeof r>"u"||r>0){var f=0,y=await Q(t,e);if(typeof y<"u")for(;typeof y<"u"&&(typeof r>"u"||f<r);)l.push({match:y.match,index:y.start,groups:y.groups}),y=await Q(y.next),f++}return l}}async function Ee(e,t,r,l){if(!(typeof e>"u")){var f=this;if(t==="")throw{code:"D3010",stack:new Error().stack,value:t,index:2};if(l<0)throw{code:"D3011",stack:new Error().stack,value:l,index:4};var y;typeof r=="string"?y=function(ve){for(var Ce="",de=0,Oe=r.indexOf("$",de);Oe!==-1&&de<r.length;){Ce+=r.substring(de,Oe),de=Oe+1;var He=r.charAt(de);if(He==="$")Ce+="$",de++;else if(He==="0")Ce+=ve.match,de++;else{var Ue;if(ve.groups.length===0?Ue=1:Ue=Math.floor(Math.log(ve.groups.length)*Math.LOG10E)+1,Oe=parseInt(r.substring(de,de+Ue),10),Ue>1&&Oe>ve.groups.length&&(Oe=parseInt(r.substring(de,de+Ue-1),10)),isNaN(Oe))Ce+="$";else{if(ve.groups.length>0){var at=ve.groups[Oe-1];typeof at<"u"&&(Ce+=at)}de+=Oe.toString().length}}Oe=r.indexOf("$",de)}return Ce+=r.substring(de),Ce}:y=r;var S="",R=0;if(typeof l>"u"||l>0){var W=0;if(typeof t=="string"){for(var ge=e.indexOf(t,R);ge!==-1&&(typeof l>"u"||W<l);)S+=e.substring(R,ge),S+=r,R=ge+t.length,W++,ge=e.indexOf(t,R);S+=e.substring(R)}else{var ae=await Q(t,e);if(typeof ae<"u"){for(;typeof ae<"u"&&(typeof l>"u"||W<l);){S+=e.substring(R,ae.start);var ke=y.apply(f,[ae]);if(se(ke)&&(ke=await ke),typeof ke=="string")S+=ke;else throw{code:"D3012",stack:new Error().stack,value:ke};R=ae.start+ae.match.length,W++,ae=await Q(ae.next)}S+=e.substring(R)}else S=e}}else S=e;return S}}function Be(e){if(!(typeof e>"u")){var t=typeof window<"u"?window.btoa:function(r){return new we.Buffer.from(r,"binary").toString("base64")};return t(e)}}function a(e){if(!(typeof e>"u")){var t=typeof window<"u"?window.atob:function(r){return new we.Buffer.from(r,"base64").toString("binary")};return t(e)}}function u(e){if(!(typeof e>"u")){var t;try{t=encodeURIComponent(e)}catch{throw{code:"D3140",stack:new Error().stack,value:e,functionName:"encodeUrlComponent"}}return t}}function I(e){if(!(typeof e>"u")){var t;try{t=encodeURI(e)}catch{throw{code:"D3140",stack:new Error().stack,value:e,functionName:"encodeUrl"}}return t}}function h(e){if(!(typeof e>"u")){var t;try{t=decodeURIComponent(e)}catch{throw{code:"D3140",stack:new Error().stack,value:e,functionName:"decodeUrlComponent"}}return t}}function P(e){if(!(typeof e>"u")){var t;try{t=decodeURI(e)}catch{throw{code:"D3140",stack:new Error().stack,value:e,functionName:"decodeUrl"}}return t}}async function L(e,t,r){if(!(typeof e>"u")){if(r<0)throw{code:"D3020",stack:new Error().stack,value:r,index:3};var l=[];if(typeof r>"u"||r>0)if(typeof t=="string")l=e.split(t,r);else{var f=0,y=await Q(t,e);if(typeof y<"u"){for(var S=0;typeof y<"u"&&(typeof r>"u"||f<r);)l.push(e.substring(S,y.start)),S=y.end,y=await Q(y.next),f++;(typeof r>"u"||f<r)&&l.push(e.substring(S))}else l.push(e)}return l}}function c(e,t){if(!(typeof e>"u"))return typeof t>"u"&&(t=""),e.join(t)}function d(e,t,r){if(!(typeof e>"u")){var l={"decimal-separator":".","grouping-separator":",","exponent-separator":"e",infinity:"Infinity","minus-sign":"-",NaN:"NaN",percent:"%","per-mille":"\u2030","zero-digit":"0",digit:"#","pattern-separator":";"},f=l;typeof r<"u"&&Object.keys(r).forEach(function(J){f[J]=r[J]});for(var y=[],S=f["zero-digit"].charCodeAt(0),R=S;R<S+10;R++)y.push(String.fromCharCode(R));var W=y.concat([f["decimal-separator"],f["exponent-separator"],f["grouping-separator"],f.digit,f["pattern-separator"]]),ge=t.split(f["pattern-separator"]);if(ge.length>2)throw{code:"D3080",stack:new Error().stack};var ae=function(J){var Te=(function(){for(var Pe,qe=0;qe<J.length;qe++)if(Pe=J.charAt(qe),W.indexOf(Pe)!==-1&&Pe!==f["exponent-separator"])return J.substring(0,qe)})(),Le=(function(){for(var Pe,qe=J.length-1;qe>=0;qe--)if(Pe=J.charAt(qe),W.indexOf(Pe)!==-1&&Pe!==f["exponent-separator"])return J.substring(qe+1)})(),Ae=J.substring(Te.length,J.length-Le.length),ze,tt,We,rt,_e=J.indexOf(f["exponent-separator"],Te.length);_e===-1||_e>J.length-Le.length?(ze=Ae,tt=void 0):(ze=Ae.substring(0,_e),tt=Ae.substring(_e+1));var Ve=ze.indexOf(f["decimal-separator"]);return Ve===-1?(We=ze,rt=Le):(We=ze.substring(0,Ve),rt=ze.substring(Ve+1)),{prefix:Te,suffix:Le,activePart:Ae,mantissaPart:ze,exponentPart:tt,integerPart:We,fractionalPart:rt,subpicture:J}},ke=function(J){var Te,Le,Ae=J.subpicture,ze=Ae.indexOf(f["decimal-separator"]);ze!==Ae.lastIndexOf(f["decimal-separator"])&&(Te="D3081"),Ae.indexOf(f.percent)!==Ae.lastIndexOf(f.percent)&&(Te="D3082"),Ae.indexOf(f["per-mille"])!==Ae.lastIndexOf(f["per-mille"])&&(Te="D3083"),Ae.indexOf(f.percent)!==-1&&Ae.indexOf(f["per-mille"])!==-1&&(Te="D3084");var tt=!1;for(Le=0;Le<J.mantissaPart.length;Le++){var We=J.mantissaPart.charAt(Le);if(y.indexOf(We)!==-1||We===f.digit){tt=!0;break}}tt||(Te="D3085");var rt=J.activePart.split("").map(function(Pe){return W.indexOf(Pe)===-1?"p":"a"}).join("");rt.indexOf("p")!==-1&&(Te="D3086"),ze!==-1?(Ae.charAt(ze-1)===f["grouping-separator"]||Ae.charAt(ze+1)===f["grouping-separator"])&&(Te="D3087"):J.integerPart.charAt(J.integerPart.length-1)===f["grouping-separator"]&&(Te="D3088"),Ae.indexOf(f["grouping-separator"]+f["grouping-separator"])!==-1&&(Te="D3089");var _e=J.integerPart.indexOf(f.digit);_e!==-1&&J.integerPart.substring(0,_e).split("").filter(function(Pe){return y.indexOf(Pe)>-1}).length>0&&(Te="D3090"),_e=J.fractionalPart.lastIndexOf(f.digit),_e!==-1&&J.fractionalPart.substring(_e).split("").filter(function(Pe){return y.indexOf(Pe)>-1}).length>0&&(Te="D3091");var Ve=typeof J.exponentPart=="string";if(Ve&&J.exponentPart.length>0&&(Ae.indexOf(f.percent)!==-1||Ae.indexOf(f["per-mille"])!==-1)&&(Te="D3092"),Ve&&(J.exponentPart.length===0||J.exponentPart.split("").filter(function(Pe){return y.indexOf(Pe)===-1}).length>0)&&(Te="D3093"),Te)throw{code:Te,stack:new Error().stack}},ve=function(J){var Te=function(je,gt){for(var lt=[],Qe=je.indexOf(f["grouping-separator"]);Qe!==-1;){var bt=(gt?je.substring(0,Qe):je.substring(Qe)).split("").filter(function(st){return y.indexOf(st)!==-1||st===f.digit}).length;lt.push(bt),Qe=J.integerPart.indexOf(f["grouping-separator"],Qe+1)}return lt},Le=Te(J.integerPart),Ae=function(je){if(je.length===0)return 0;for(var gt=function(bt,st){return st===0?bt:gt(st,bt%st)},lt=je.reduce(gt),Qe=1;Qe<=je.length;Qe++)if(je.indexOf(Qe*lt)===-1)return 0;return lt},ze=Ae(Le),tt=Te(J.fractionalPart,!0),We=J.integerPart.split("").filter(function(je){return y.indexOf(je)!==-1}).length,rt=We,_e=J.fractionalPart.split(""),Ve=_e.filter(function(je){return y.indexOf(je)!==-1}).length,Pe=_e.filter(function(je){return y.indexOf(je)!==-1||je===f.digit}).length,qe=typeof J.exponentPart=="string";We===0&&Pe===0&&(qe?(Ve=1,Pe=1):We=1),qe&&We===0&&J.integerPart.indexOf(f.digit)!==-1&&(We=1),We===0&&Ve===0&&(Ve=1);var Et=0;return qe&&(Et=J.exponentPart.split("").filter(function(je){return y.indexOf(je)!==-1}).length),{integerPartGroupingPositions:Le,regularGrouping:ze,minimumIntegerPartSize:We,scalingFactor:rt,prefix:J.prefix,fractionalPartGroupingPositions:tt,minimumFactionalPartSize:Ve,maximumFactionalPartSize:Pe,minimumExponentSize:Et,suffix:J.suffix,picture:J.subpicture}},Ce=ge.map(ae);Ce.forEach(ke);var de=Ce.map(ve),Oe=f["minus-sign"],He=f["zero-digit"],Ue=f["decimal-separator"],at=f["grouping-separator"];de.length===1&&(de.push(JSON.parse(JSON.stringify(de[0]))),de[1].prefix=Oe+de[1].prefix);var Se;e>=0?Se=de[0]:Se=de[1];var ut;Se.picture.indexOf(f.percent)!==-1?ut=e*100:Se.picture.indexOf(f["per-mille"])!==-1?ut=e*1e3:ut=e;var nt,ot;if(Se.minimumExponentSize===0)nt=ut;else{var Ft=Math.pow(10,Se.scalingFactor),Pt=Math.pow(10,Se.scalingFactor-1);for(nt=ut,ot=0;nt<Pt;)nt*=10,ot-=1;for(;nt>Ft;)nt/=10,ot+=1}var $t=E(nt,Se.maximumFactionalPartSize),mt=function(J,Te){var Le=Math.abs(J).toFixed(Te);return He!=="0"&&(Le=Le.split("").map(function(Ae){return Ae>="0"&&Ae<="9"?y[Ae.charCodeAt(0)-48]:Ae}).join("")),Le},ee=mt($t,Se.maximumFactionalPartSize),Re=ee.indexOf(".");for(Re===-1?ee=ee+Ue:ee=ee.replace(".",Ue);ee.charAt(0)===He;)ee=ee.substring(1);for(;ee.charAt(ee.length-1)===He;)ee=ee.substring(0,ee.length-1);Re=ee.indexOf(Ue);var ct=Se.minimumIntegerPartSize-Re,kt=Se.minimumFactionalPartSize-(ee.length-Re-1);if(ee=(ct>0?new Array(ct+1).join(He):"")+ee,ee=ee+(kt>0?new Array(kt+1).join(He):""),Re=ee.indexOf(Ue),Se.regularGrouping>0)for(var Ct=Math.floor((Re-1)/Se.regularGrouping),vt=1;vt<=Ct;vt++)ee=[ee.slice(0,Re-vt*Se.regularGrouping),at,ee.slice(Re-vt*Se.regularGrouping)].join("");else Se.integerPartGroupingPositions.forEach(function(J){ee=[ee.slice(0,Re-J),at,ee.slice(Re-J)].join(""),Re++});if(Re=ee.indexOf(Ue),Se.fractionalPartGroupingPositions.forEach(function(J){ee=[ee.slice(0,J+Re+1),at,ee.slice(J+Re+1)].join("")}),Re=ee.indexOf(Ue),(Se.picture.indexOf(Ue)===-1||Re===ee.length-1)&&(ee=ee.substring(0,ee.length-1)),typeof ot<"u"){var yt=mt(ot,0);ct=Se.minimumExponentSize-yt.length,ct>0&&(yt=new Array(ct+1).join(He)+yt),ee=ee+f["exponent-separator"]+(ot<0?Oe:"")+yt}return ee=Se.prefix+ee+Se.suffix,ee}}function p(e,t){if(!(typeof e>"u")){if(e=E(e),typeof t>"u"?t=10:t=E(t),t<2||t>36)throw{code:"D3100",stack:new Error().stack,value:t};var r=e.toString(t);return r}}function i(e){var t;if(!(typeof e>"u")){if(typeof e=="number")t=e;else if(typeof e=="string"&&/^-?[0-9]+(\.[0-9]+)?([Ee][-+]?[0-9]+)?$/.test(e)&&!isNaN(parseFloat(e))&&isFinite(e))t=parseFloat(e);else if(typeof e=="string"&&/^(0[xX][0-9A-Fa-f]+)|(0[oO][0-7]+)|(0[bB][0-1]+)$/.test(e))t=Number(e);else if(e===!0)t=1;else if(e===!1)t=0;else throw{code:"D3030",value:e,stack:new Error().stack,index:1};return t}}function b(e){var t;if(!(typeof e>"u"))return t=Math.abs(e),t}function A(e){var t;if(!(typeof e>"u"))return t=Math.floor(e),t}function v(e){var t;if(!(typeof e>"u"))return t=Math.ceil(e),t}function E(e,t){var r;if(!(typeof e>"u")){if(t){var l=e.toString().split("e");e=+(l[0]+"e"+(l[1]?+l[1]+t:t))}r=Math.round(e);var f=r-e;return Math.abs(f)===.5&&Math.abs(r%2)===1&&(r=r-1),t&&(l=r.toString().split("e"),r=+(l[0]+"e"+(l[1]?+l[1]-t:-t))),Object.is(r,-0)&&(r=0),r}}function $(e){var t;if(!(typeof e>"u")){if(e<0)throw{stack:new Error().stack,code:"D3060",index:1,value:e};return t=Math.sqrt(e),t}}function re(e,t){var r;if(!(typeof e>"u")){if(r=Math.pow(e,t),!isFinite(r))throw{stack:new Error().stack,code:"D3061",index:1,value:e,exp:t};return r}}function le(){return Math.random()}function G(e){if(!(typeof e>"u")){var t=!1;if(Array.isArray(e)){if(e.length===1)t=G(e[0]);else if(e.length>1){var r=e.filter(function(l){return G(l)});t=r.length>0}}else typeof e=="string"?e.length>0&&(t=!0):ue(e)?e!==0&&(t=!0):e!==null&&typeof e=="object"&&!D(e)?Object.keys(e).length>0&&(t=!0):typeof e=="boolean"&&e===!0&&(t=!0);return t}}function _(e){if(!(typeof e>"u"))return!G(e)}function ie(e,t,r,l){var f=[t],y=Z(e);return y>=2&&f.push(r),y>=3&&f.push(l),f}async function B(e,t){if(!(typeof e>"u")){for(var r=F(),l=0;l<e.length;l++){var f=ie(t,e[l],l,e),y=await t.apply(this,f);typeof y<"u"&&r.push(y)}return r}}async function $e(e,t){if(!(typeof e>"u")){for(var r=F(),l=0;l<e.length;l++){var f=e[l],y=ie(t,f,l,e),S=await t.apply(this,y);G(S)&&r.push(f)}return r}}async function Ye(e,t){if(!(typeof e>"u")){for(var r=!1,l,f=0;f<e.length;f++){var y=e[f],S=!0;if(typeof t<"u"){var R=ie(t,y,f,e),W=await t.apply(this,R);S=G(W)}if(S)if(!r)l=y,r=!0;else throw{stack:new Error().stack,code:"D3138",index:f}}if(!r)throw{stack:new Error().stack,code:"D3139"};return l}}function Ie(){for(var e=[],t=Array.prototype.slice.call(arguments),r=Math.min.apply(Math,t.map(function(y){return Array.isArray(y)?y.length:0})),l=0;l<r;l++){var f=t.map(y=>y[l]);e.push(f)}return e}async function Fe(e,t,r){if(!(typeof e>"u")){var l,f=Z(t);if(f<2)throw{stack:new Error().stack,code:"D3050",index:1};var y;for(typeof r>"u"&&e.length>0?(l=e[0],y=1):(l=r,y=0);y<e.length;){var S=[l,e[y]];f>=3&&S.push(y),f>=4&&S.push(e),l=await t.apply(this,S),y++}return l}}function Ne(e){var t=F();if(Array.isArray(e)){var r={};e.forEach(function(l){var f=Ne(l);f.forEach(function(y){r[y]=!0})}),t=Ne(r)}else e!==null&&typeof e=="object"&&!D(e)&&Object.keys(e).forEach(l=>t.push(l));return t}function Xe(e,t){var r;if(Array.isArray(e)){r=F();for(var l=0;l<e.length;l++){var f=Xe(e[l],t);typeof f<"u"&&(Array.isArray(f)?f.forEach(y=>r.push(y)):r.push(f))}}else e!==null&&typeof e=="object"&&!D(e)&&(r=e[t]);return r}function Ke(e,t){return typeof e>"u"?t:typeof t>"u"?e:(Array.isArray(e)||(e=F(e)),Array.isArray(t)||(t=[t]),e.concat(t))}function pt(e){return!(typeof e>"u")}function et(e){var t=F();if(Array.isArray(e))e.forEach(function(f){t=Ke(t,et(f))});else if(e!==null&&typeof e=="object"&&!M(e))for(var r in e){var l={};l[r]=e[r],t.push(l)}else t=e;return t}function j(e){if(!(typeof e>"u")){var t={};return e.forEach(function(r){for(var l in r)t[l]=r[l]}),t}}function ht(e){if(!(typeof e>"u")){if(e.length<=1)return e;for(var t=e.length,r=new Array(t),l=0;l<t;l++)r[t-l-1]=e[l];return r}}async function ft(e,t){var r=F();for(var l in e){var f=ie(t,e[l],l,e),y=await t.apply(this,f);typeof y<"u"&&r.push(y)}return r}function Je(e){throw{code:"D3137",stack:new Error().stack,message:e||"$error() function evaluated"}}function it(e,t){if(!e)throw{code:"D3141",stack:new Error().stack,message:t||"$assert() statement failed"}}function Ze(e){if(e!==void 0)return e===null?"null":ue(e)?"number":typeof e=="string"?"string":typeof e=="boolean"?"boolean":Array.isArray(e)?"array":D(e)?"function":"object"}async function ye(e,t){if(!(typeof e>"u")){if(e.length<=1)return e;var r;if(typeof t>"u"){if(!oe(e)&&!z(e))throw{stack:new Error().stack,code:"D3070",index:1};r=async function(S,R){return S>R}}else r=t;var l=async function(S,R){var W=async function(ae,ke,ve){ke.length===0?Array.prototype.push.apply(ae,ve):ve.length===0?Array.prototype.push.apply(ae,ke):await r(ke[0],ve[0])?(ae.push(ve[0]),await W(ae,ke,ve.slice(1))):(ae.push(ke[0]),await W(ae,ke.slice(1),ve))},ge=[];return await W(ge,S,R),ge},f=async function(S){if(!Array.isArray(S)||S.length<=1)return S;var R=Math.floor(S.length/2),W=S.slice(0,R),ge=S.slice(R);return W=await f(W),ge=await f(ge),await l(W,ge)},y=await f(e);return y}}function n(e){if(!(typeof e>"u")){if(e.length<=1)return e;for(var t=new Array(e.length),r=0;r<e.length;r++){var l=Math.floor(Math.random()*(r+1));r!==l&&(t[r]=t[l]),t[l]=e[r]}return t}}function o(e){if(!(typeof e>"u")){if(!Array.isArray(e)||e.length<=1)return e;for(var t=m(e)?F():[],r=0;r<e.length;r++){for(var l=e[r],f=!1,y=0;y<t.length;y++)if(te(l,t[y])){f=!0;break}f||t.push(l)}return t}}async function s(e,t){var r={};for(var l in e){var f=e[l],y=ie(t,f,l,e),S=await t.apply(this,y);G(S)&&(r[l]=f)}return Object.keys(r).length===0&&(r=void 0),r}return{sum:O,count:Y,max:w,min:g,average:C,string:U,substring:X,substringBefore:V,substringAfter:fe,lowercase:he,uppercase:ne,length:me,trim:xe,pad:ce,match:H,contains:Me,replace:Ee,split:L,join:c,formatNumber:d,formatBase:p,number:i,floor:A,ceil:v,round:E,abs:b,sqrt:$,power:re,random:le,boolean:G,not:_,map:B,zip:Ie,filter:$e,single:Ye,foldLeft:Fe,sift:s,keys:Ne,lookup:Xe,append:Ke,exists:pt,spread:et,merge:j,reverse:ht,each:ft,error:Je,assert:it,type:Ze,sort:ye,shuffle:n,distinct:o,base64encode:Be,base64decode:a,encodeUrlComponent:u,encodeUrl:I,decodeUrlComponent:h,decodeUrl:P}})();be.exports=N}).call(this)}).call(this,typeof global<"u"?global:typeof self<"u"?self:typeof window<"u"?window:{})},{"./utils":6}],3:[function(k,be,Ge){var we=k("./datetime"),T=k("./functions"),N=k("./utils"),ue=k("./parser"),z=k("./signature"),oe=(function(){"use strict";var F=N.isNumeric,m=N.isArrayOfStrings,D=N.isArrayOfNumbers,M=N.createSequence,se=N.isSequence,Z=N.isFunction,te=N.isLambda,x=N.isIterable,O=N.isPromise,Y=N.getFunctionArity,w=N.isDeepEqual,g=Je(null);async function C(n,o,s){var e,t=s.lookup(Symbol.for("jsonata.__evaluate_entry"));switch(t&&await t(n,o,s),n.type){case"path":e=await U(n,o,s);break;case"binary":e=await me(n,o,s);break;case"unary":e=await xe(n,o,s);break;case"name":e=ce(n,o,s);break;case"string":case"number":case"value":e=Q(n,o,s);break;case"wildcard":e=Me(n,o,s);break;case"descendant":e=Ee(n,o,s);break;case"parent":e=s.lookup(n.slot.label);break;case"condition":e=await A(n,o,s);break;case"block":e=await v(n,o,s);break;case"bind":e=await b(n,o,s);break;case"regex":e=E(n,o,s);break;case"function":e=await ie(n,o,s);break;case"variable":e=$(n,o,s);break;case"lambda":e=Ye(n,o,s);break;case"partial":e=await Ie(n,o,s);break;case"apply":e=await _(n,o,s);break;case"transform":e=le(n,o,s);break}if(Object.prototype.hasOwnProperty.call(n,"predicate"))for(var r=0;r<n.predicate.length;r++)e=await ne(n.predicate[r].expr,e,s);n.type!=="path"&&Object.prototype.hasOwnProperty.call(n,"group")&&(e=await d(n.group,e,s));var l=s.lookup(Symbol.for("jsonata.__evaluate_exit"));return l&&await l(n,o,s,e),e&&se(e)&&!e.tupleStream&&(n.keepArray&&(e.keepSingleton=!0),e.length===0?e=void 0:e.length===1&&(e=e.keepSingleton?e:e[0])),e}async function U(n,o,s){var e;Array.isArray(o)&&n.steps[0].type!=="variable"?e=o:e=M(o);for(var t,r=!1,l=void 0,f=0;f<n.steps.length;f++){var y=n.steps[f];if(y.tuple&&(r=!0),f===0&&y.consarray?t=await C(y,e,s):r?l=await he(y,e,l,s):t=await V(y,e,s,f===n.steps.length-1),!r&&(typeof t>"u"||t.length===0))break;typeof y.focus>"u"&&(e=t)}if(r)if(n.tuple)t=l;else for(t=M(),f=0;f<l.length;f++)t.push(l[f]["@"]);return n.keepSingletonArray&&(Array.isArray(t)&&t.cons&&!t.sequence&&(t=M(t)),t.keepSingleton=!0),n.hasOwnProperty("group")&&(t=await d(n.group,r?l:t,s)),t}function X(n,o){var s=Je(n);for(let e in o)s.bind(e,o[e]);return s}async function V(n,o,s,e){var t;if(n.type==="sort")return t=await re(n,o,s),n.stages&&(t=await fe(n.stages,t,s)),t;t=M();for(var r=0;r<o.length;r++){var l=await C(n,o[r],s);if(n.stages)for(var f=0;f<n.stages.length;f++)l=await ne(n.stages[f].expr,l,s);typeof l<"u"&&t.push(l)}var y=M();return e&&t.length===1&&Array.isArray(t[0])&&!se(t[0])?y=t[0]:t.forEach(function(S){!Array.isArray(S)||S.cons?y.push(S):S.forEach(R=>y.push(R))}),y}async function fe(n,o,s){for(var e=o,t=0;t<n.length;t++){var r=n[t];switch(r.type){case"filter":e=await ne(r.expr,e,s);break;case"index":for(var l=0;l<e.length;l++){var f=e[l];f[r.value]=l}break}}return e}async function he(n,o,s,e){var t;if(n.type==="sort"){if(s)t=await re(n,s,e);else{var r=await re(n,o,e);t=M(),t.tupleStream=!0;for(var l=0;l<r.length;l++){var f={"@":r[l]};f[n.index]=l,t.push(f)}}return n.stages&&(t=await fe(n.stages,t,e)),t}t=M(),t.tupleStream=!0;var y=e;s===void 0&&(s=o.map(ge=>({"@":ge})));for(var S=0;S<s.length;S++){y=X(e,s[S]);var R=await C(n,s[S]["@"],y);if(typeof R<"u"){Array.isArray(R)||(R=[R]);for(var W=0;W<R.length;W++)f={},Object.assign(f,s[S]),R.tupleStream?Object.assign(f,R[W]):(n.focus?(f[n.focus]=R[W],f["@"]=s[S]["@"]):f["@"]=R[W],n.index&&(f[n.index]=W),n.ancestor&&(f[n.ancestor.label]=s[S]["@"])),t.push(f)}}return n.stages&&(t=await fe(n.stages,t,e)),t}async function ne(n,o,s){var e=M();if(o&&o.tupleStream&&(e.tupleStream=!0),Array.isArray(o)||(o=M(o)),n.type==="number"){var t=Math.floor(n.value);t<0&&(t=o.length+t);var r=await o[t];typeof r<"u"&&(Array.isArray(r)?e=r:e.push(r))}else for(t=0;t<o.length;t++){var r=o[t],l=r,f=s;o.tupleStream&&(l=r["@"],f=X(s,r));var y=await C(n,l,f);F(y)&&(y=[y]),D(y)?y.forEach(function(R){var W=Math.floor(R);W<0&&(W=o.length+W),W===t&&e.push(r)}):T.boolean(y)&&e.push(r)}return e}async function me(n,o,s){var e,t=await C(n.lhs,o,s),r=n.value,l=async()=>await C(n.rhs,o,s);if(r==="and"||r==="or")try{return await P(t,l,r)}catch(y){throw y.position=n.position,y.token=r,y}var f=await l();try{switch(r){case"+":case"-":case"*":case"/":case"%":e=a(t,f,r);break;case"=":case"!=":e=u(t,f,r);break;case"<":case"<=":case">":case">=":e=I(t,f,r);break;case"&":e=c(t,f);break;case"..":e=i(t,f);break;case"in":e=h(t,f);break}}catch(y){throw y.position=n.position,y.token=r,y}return e}async function xe(n,o,s){var e;switch(n.value){case"-":if(e=await C(n.expression,o,s),typeof e>"u")e=void 0;else if(F(e))e=-e;else throw{code:"D1002",stack:new Error().stack,position:n.position,token:n.value,value:e};break;case"[":e=[];let l=await Promise.all(n.expressions.map(async(f,y)=>(s.isParallelCall=y>0,[f,await C(f,o,s)])));for(let f of l){var[t,r]=f;typeof r<"u"&&(t.value==="["?e.push(r):e=T.append(e,r))}n.consarray&&Object.defineProperty(e,"cons",{enumerable:!1,configurable:!1,value:!0});break;case"{":e=await d(n,o,s);break}return e}function ce(n,o,s){return T.lookup(o,n.value)}function Q(n){return n.value}function Me(n,o){var s=M();return Array.isArray(o)&&o.outerWrapper&&o.length>0&&(o=o[0]),o!==null&&typeof o=="object"&&Object.keys(o).forEach(function(e){var t=o[e];Array.isArray(t)?(t=H(t),s=T.append(s,t)):s.push(t)}),s}function H(n,o){return typeof o>"u"&&(o=[]),Array.isArray(n)?n.forEach(function(s){H(s,o)}):o.push(n),o}function Ee(n,o){var s,e=M();return typeof o<"u"&&(Be(o,e),e.length===1?s=e[0]:s=e),s}function Be(n,o){Array.isArray(n)||o.push(n),Array.isArray(n)?n.forEach(function(s){Be(s,o)}):n!==null&&typeof n=="object"&&Object.keys(n).forEach(function(s){Be(n[s],o)})}function a(n,o,s){var e;if(typeof n<"u"&&!F(n))throw{code:"T2001",stack:new Error().stack,value:n};if(typeof o<"u"&&!F(o))throw{code:"T2002",stack:new Error().stack,value:o};if(typeof n>"u"||typeof o>"u")return e;switch(s){case"+":e=n+o;break;case"-":e=n-o;break;case"*":e=n*o;break;case"/":e=n/o;break;case"%":e=n%o;break}return e}function u(n,o,s){var e,t=typeof n,r=typeof o;if(t==="undefined"||r==="undefined")return!1;switch(s){case"=":e=w(n,o);break;case"!=":e=!w(n,o);break}return e}function I(n,o,s){var e,t=typeof n,r=typeof o,l=t==="undefined"||t==="string"||t==="number",f=r==="undefined"||r==="string"||r==="number";if(!l||!f)throw{code:"T2010",stack:new Error().stack,value:t==="string"||t==="number"?o:n};if(!(t==="undefined"||r==="undefined")){if(t!==r)throw{code:"T2009",stack:new Error().stack,value:n,value2:o};switch(s){case"<":e=n<o;break;case"<=":e=n<=o;break;case">":e=n>o;break;case">=":e=n>=o;break}return e}}function h(n,o){var s=!1;if(typeof n>"u"||typeof o>"u")return!1;Array.isArray(o)||(o=[o]);for(var e=0;e<o.length;e++)if(o[e]===n){s=!0;break}return s}async function P(n,o,s){var e,t=L(n);switch(s){case"and":e=t&&L(await o());break;case"or":e=t||L(await o());break}return e}function L(n){var o=T.boolean(n);return typeof o>"u"?!1:o}function c(n,o){var s,e="",t="";return typeof n<"u"&&(e=T.string(n)),typeof o<"u"&&(t=T.string(o)),s=e.concat(t),s}async function d(n,o,s){var e={},t={},r=!!(o&&o.tupleStream);Array.isArray(o)||(o=M(o)),o.length===0&&o.push(void 0);for(var l=0;l<o.length;l++)for(var f=o[l],y=r?X(s,f):s,S=0;S<n.lhs.length;S++){var R=n.lhs[S],W=await C(R[0],r?f["@"]:f,y);if(typeof W!="string"&&W!==void 0)throw{code:"T1003",stack:new Error().stack,position:n.position,value:W};if(W!==void 0){var ge={data:f,exprIndex:S};if(t.hasOwnProperty(W)){if(t[W].exprIndex!==S)throw{code:"D1009",stack:new Error().stack,position:n.position,value:W};t[W].data=T.append(t[W].data,f)}else t[W]=ge}}let ae=await Promise.all(Object.keys(t).map(async(ve,Ce)=>{let de=t[ve];var Oe=de.data,He=s;if(r){var Ue=p(de.data);Oe=Ue["@"],delete Ue["@"],He=X(s,Ue)}return s.isParallelCall=Ce>0,[ve,await C(n.lhs[de.exprIndex][1],Oe,He)]}));for(let ve of ae){var[W,ke]=await ve;typeof ke<"u"&&(e[W]=ke)}return e}function p(n){if(!Array.isArray(n))return n;var o={};Object.assign(o,n[0]);for(var s=1;s<n.length;s++)for(let e in n[s])o[e]=T.append(o[e],n[s][e]);return o}function i(n,o){var s;if(typeof n<"u"&&!Number.isInteger(n))throw{code:"T2003",stack:new Error().stack,value:n};if(typeof o<"u"&&!Number.isInteger(o))throw{code:"T2004",stack:new Error().stack,value:o};if(typeof n>"u"||typeof o>"u"||n>o)return s;var e=o-n+1;if(e>1e7)throw{code:"D2014",stack:new Error().stack,value:e};s=new Array(e);for(var t=n,r=0;t<=o;t++,r++)s[r]=t;return s.sequence=!0,s}async function b(n,o,s){var e=await C(n.rhs,o,s);return s.bind(n.lhs.value,e),e}async function A(n,o,s){var e,t=await C(n.condition,o,s);return T.boolean(t)?e=await C(n.then,o,s):typeof n.else<"u"&&(e=await C(n.else,o,s)),e}async function v(n,o,s){for(var e,t=Je(s),r=0;r<n.expressions.length;r++)e=await C(n.expressions[r],o,t);return e}function E(n){var o=new ye.RegexEngine(n.value),s=function(e,t){var r;o.lastIndex=t||0;var l=o.exec(e);if(l!==null){if(r={match:l[0],start:l.index,end:l.index+l[0].length,groups:[]},l.length>1)for(var f=1;f<l.length;f++)r.groups.push(l[f]);r.next=function(){if(!(o.lastIndex>=e.length)){var y=s(e,o.lastIndex);if(y&&y.match==="")throw{code:"D1004",stack:new Error().stack,position:n.position,value:n.value.source};return y}}}return r};return s}function $(n,o,s){var e;return n.value===""?e=o&&o.outerWrapper?o[0]:o:e=s.lookup(n.value),e}async function re(n,o,s){var e,t=o,r=!!o.tupleStream,l=async function(y,S){for(var R=0,W=0;R===0&&W<n.terms.length;W++){var ge=n.terms[W],ae=y,ke=s;r&&(ae=y["@"],ke=X(s,y));var ve=await C(ge.expression,ae,ke);ae=S,ke=s,r&&(ae=S["@"],ke=X(s,S));var Ce=await C(ge.expression,ae,ke),de=typeof ve,Oe=typeof Ce;if(de==="undefined"){R=Oe==="undefined"?0:1;continue}if(Oe==="undefined"){R=-1;continue}if(!(de==="string"||de==="number")||!(Oe==="string"||Oe==="number"))throw{code:"T2008",stack:new Error().stack,position:n.position,value:de==="string"||de==="number"?Ce:ve};if(de!==Oe)throw{code:"T2007",stack:new Error().stack,position:n.position,value:ve,value2:Ce};ve!==Ce&&(ve<Ce?R=-1:R=1,ge.descending===!0&&(R=-R))}return R===1},f={environment:s,input:o};return e=await T.sort.apply(f,[t,l]),e}function le(n,o,s){var e=async function(t){if(!(typeof t>"u")){var r=s.lookup("clone");if(!Z(r))throw{code:"T2013",stack:new Error().stack,position:n.position};var l=await B(r,[t],null,s),f=await C(n.pattern,l,s);if(typeof f<"u"){Array.isArray(f)||(f=[f]);for(var y=0;y<f.length;y++){var S=f[y];if(S&&(S.isPrototypeOf(l)||S instanceof Object.constructor))throw{code:"D1010",stack:new Error().stack,position:n.position};var R=await C(n.update,S,s),W=typeof R;if(W!=="undefined"){if(W!=="object"||R===null||Array.isArray(R))throw{code:"T2011",stack:new Error().stack,position:n.update.position,value:R};for(var ge in R)S[ge]=R[ge]}if(typeof n.delete<"u"){var ae=await C(n.delete,S,s);if(typeof ae<"u"){var ke=ae;if(Array.isArray(ae)||(ae=[ae]),!m(ae))throw{code:"T2012",stack:new Error().stack,position:n.delete.position,value:ke};for(var ve=0;ve<ae.length;ve++)typeof S=="object"&&S!==null&&delete S[ae[ve]]}}}}return l}};return j(e,"<(oa):o>")}var G=ue("function($f, $g) { function($x){ $g($f($x)) } }");async function _(n,o,s){var e,t=await C(n.lhs,o,s);if(n.rhs.type==="function")e=await ie(n.rhs,o,s,{context:t});else{var r=await C(n.rhs,o,s);if(!Z(r))throw{code:"T2006",stack:new Error().stack,position:n.position,value:r};if(Z(t)){var l=await C(G,null,s);e=await B(l,[t,r],null,s)}else e=await B(r,[t],null,s)}return e}async function ie(n,o,s,e){var t,r=await C(n.procedure,o,s);if(typeof r>"u"&&n.procedure.type==="path"&&s.lookup(n.procedure.steps[0].value))throw{code:"T1005",stack:new Error().stack,position:n.position,token:n.procedure.steps[0].value};var l=[];typeof e<"u"&&l.push(e.context);for(var f=0;f<n.arguments.length;f++){let S=await C(n.arguments[f],o,s);if(Z(S)){let R=async function(...W){return await B(S,W,null,s)};R.arity=Y(S),l.push(R)}else l.push(S)}var y=n.procedure.type==="path"?n.procedure.steps[0].value:n.procedure.value;try{typeof r=="object"&&(r.token=y,r.position=n.position),t=await B(r,l,o,s)}catch(S){throw S.position||(S.position=n.position),S.token||(S.token=y),S}return t}async function B(n,o,s,e){var t;for(t=await $e(n,o,s,e);te(t)&&t.thunk===!0;){var r=await C(t.body.procedure,t.input,t.environment);t.body.procedure.type==="variable"&&(r.token=t.body.procedure.value),r.position=t.body.procedure.position;for(var l=[],f=0;f<t.body.arguments.length;f++)l.push(await C(t.body.arguments[f],t.input,t.environment));t=await $e(r,l,s,e)}return t}async function $e(n,o,s,e){var t;try{var r=o;if(n&&(r=Fe(n.signature,o,s)),te(n))t=await Ne(n,r);else if(n&&n._jsonata_function===!0){var l={environment:e,input:s};t=n.implementation.apply(l,r),x(t)&&(t=t.next().value),O(t)&&(t=await t)}else if(typeof n=="function")t=n.apply(s,r),O(t)&&(t=await t);else throw{code:"T1006",stack:new Error().stack}}catch(f){throw n&&(typeof f.token>"u"&&typeof n.token<"u"&&(f.token=n.token),f.position=n.position||f.position),f}return t}function Ye(n,o,s){var e={_jsonata_lambda:!0,input:o,environment:s,arguments:n.arguments,signature:n.signature,body:n.body};return n.thunk===!0&&(e.thunk=!0),e.apply=async function(t,r){return await B(e,r,o,t?t.environment:s)},e}async function Ie(n,o,s){for(var e,t=[],r=0;r<n.arguments.length;r++){var l=n.arguments[r];l.type==="operator"&&l.value==="?"?t.push(l):t.push(await C(l,o,s))}var f=await C(n.procedure,o,s);if(typeof f>"u"&&n.procedure.type==="path"&&s.lookup(n.procedure.steps[0].value))throw{code:"T1007",stack:new Error().stack,position:n.position,token:n.procedure.steps[0].value};if(te(f))e=Xe(f,t);else if(f&&f._jsonata_function===!0)e=Ke(f.implementation,t);else if(typeof f=="function")e=Ke(f,t);else throw{code:"T1008",stack:new Error().stack,position:n.position,token:n.procedure.type==="path"?n.procedure.steps[0].value:n.procedure.value};return e}function Fe(n,o,s){if(typeof n>"u")return o;var e=n.validate(o,s);return e}async function Ne(n,o){var s,e=Je(n.environment);return n.arguments.forEach(function(t,r){e.bind(t.value,o[r])}),typeof n.body=="function"?s=await pt(n.body,e):s=await C(n.body,n.input,e),s}function Xe(n,o){var s=Je(n.environment),e=[];n.arguments.forEach(function(r,l){var f=o[l];f&&f.type==="operator"&&f.value==="?"?e.push(r):s.bind(r.value,f)});var t={_jsonata_lambda:!0,input:n.input,environment:s,arguments:e,body:n.body};return t}function Ke(n,o){var s=et(n);s=s.map(function(l){return"$"+l.trim()});var e="function("+s.join(", ")+"){ _ }",t=ue(e);t.body=n;var r=Xe(t,o);return r}async function pt(n,o){var s=et(n),e=s.map(function(l){return o.lookup(l.trim())}),t={environment:o},r=n.apply(t,e);return O(r)&&(r=await r),r}function et(n){var o=n.toString(),s=/\(([^)]*)\)/.exec(o)[1],e=s.split(",");return e}function j(n,o){var s={_jsonata_function:!0,implementation:n};return typeof o<"u"&&(s.signature=z(o)),s}async function ht(n,o){if(!(typeof n>"u")){var s=this.input;typeof o<"u"&&(s=o,Array.isArray(s)&&!se(s)&&(s=M(s),s.outerWrapper=!0));try{var e=ue(n,!1)}catch(r){throw Ze(r),{stack:new Error().stack,code:"D3120",value:r.message,error:r}}try{var t=await C(e,s,this.environment)}catch(r){throw Ze(r),{stack:new Error().stack,code:"D3121",value:r.message,error:r}}return t}}function ft(n){if(!(typeof n>"u"))return JSON.parse(T.string(n))}function Je(n){var o={};let s={bind:function(t,r){o[t]=r},lookup:function(t){var r;return o.hasOwnProperty(t)?r=o[t]:n&&(r=n.lookup(t)),r},timestamp:n?n.timestamp:null,async:n?n.async:!1,isParallelCall:n?n.isParallelCall:!1,global:n?n.global:{ancestry:[null]}};if(n){var e=n.lookup(Symbol.for("jsonata.__createFrame_push"));e&&e(n,s)}return s}g.bind("sum",j(T.sum,"<a<n>:n>")),g.bind("count",j(T.count,"<a:n>")),g.bind("max",j(T.max,"<a<n>:n>")),g.bind("min",j(T.min,"<a<n>:n>")),g.bind("average",j(T.average,"<a<n>:n>")),g.bind("string",j(T.string,"<x-b?:s>")),g.bind("substring",j(T.substring,"<s-nn?:s>")),g.bind("substringBefore",j(T.substringBefore,"<s-s:s>")),g.bind("substringAfter",j(T.substringAfter,"<s-s:s>")),g.bind("lowercase",j(T.lowercase,"<s-:s>")),g.bind("uppercase",j(T.uppercase,"<s-:s>")),g.bind("length",j(T.length,"<s-:n>")),g.bind("trim",j(T.trim,"<s-:s>")),g.bind("pad",j(T.pad,"<s-ns?:s>")),g.bind("match",j(T.match,"<s-f<s:o>n?:a<o>>")),g.bind("contains",j(T.contains,"<s-(sf):b>")),g.bind("replace",j(T.replace,"<s-(sf)(sf)n?:s>")),g.bind("split",j(T.split,"<s-(sf)n?:a<s>>")),g.bind("join",j(T.join,"<a<s>s?:s>")),g.bind("formatNumber",j(T.formatNumber,"<n-so?:s>")),g.bind("formatBase",j(T.formatBase,"<n-n?:s>")),g.bind("formatInteger",j(we.formatInteger,"<n-s:s>")),g.bind("parseInteger",j(we.parseInteger,"<s-s:n>")),g.bind("number",j(T.number,"<(nsb)-:n>")),g.bind("floor",j(T.floor,"<n-:n>")),g.bind("ceil",j(T.ceil,"<n-:n>")),g.bind("round",j(T.round,"<n-n?:n>")),g.bind("abs",j(T.abs,"<n-:n>")),g.bind("sqrt",j(T.sqrt,"<n-:n>")),g.bind("power",j(T.power,"<n-n:n>")),g.bind("random",j(T.random,"<:n>")),g.bind("boolean",j(T.boolean,"<x-:b>")),g.bind("not",j(T.not,"<x-:b>")),g.bind("map",j(T.map,"<af>")),g.bind("zip",j(T.zip,"<a+>")),g.bind("filter",j(T.filter,"<af>")),g.bind("single",j(T.single,"<af?>")),g.bind("reduce",j(T.foldLeft,"<afj?:j>")),g.bind("sift",j(T.sift,"<o-f?:o>")),g.bind("keys",j(T.keys,"<x-:a<s>>")),g.bind("lookup",j(T.lookup,"<x-s:x>")),g.bind("append",j(T.append,"<xx:a>")),g.bind("exists",j(T.exists,"<x:b>")),g.bind("spread",j(T.spread,"<x-:a<o>>")),g.bind("merge",j(T.merge,"<a<o>:o>")),g.bind("reverse",j(T.reverse,"<a:a>")),g.bind("each",j(T.each,"<o-f:a>")),g.bind("error",j(T.error,"<s?:x>")),g.bind("assert",j(T.assert,"<bs?:x>")),g.bind("type",j(T.type,"<x:s>")),g.bind("sort",j(T.sort,"<af?:a>")),g.bind("shuffle",j(T.shuffle,"<a:a>")),g.bind("distinct",j(T.distinct,"<x:x>")),g.bind("base64encode",j(T.base64encode,"<s-:s>")),g.bind("base64decode",j(T.base64decode,"<s-:s>")),g.bind("encodeUrlComponent",j(T.encodeUrlComponent,"<s-:s>")),g.bind("encodeUrl",j(T.encodeUrl,"<s-:s>")),g.bind("decodeUrlComponent",j(T.decodeUrlComponent,"<s-:s>")),g.bind("decodeUrl",j(T.decodeUrl,"<s-:s>")),g.bind("eval",j(ht,"<sx?:x>")),g.bind("toMillis",j(we.toMillis,"<s-s?:n>")),g.bind("fromMillis",j(we.fromMillis,"<n-s?s?:s>")),g.bind("clone",j(ft,"<(oa)-:o>"));var it={S0101:"String literal must be terminated by a matching quote",S0102:"Number out of range: {{token}}",S0103:"Unsupported escape sequence: \\{{token}}",S0104:"The escape sequence \\u must be followed by 4 hex digits",S0105:"Quoted property name must be terminated with a backquote (`)",S0106:"Comment has no closing tag",S0201:"Syntax error: {{token}}",S0202:"Expected {{value}}, got {{token}}",S0203:"Expected {{value}} before end of expression",S0204:"Unknown operator: {{token}}",S0205:"Unexpected token: {{token}}",S0206:"Unknown expression type: {{token}}",S0207:"Unexpected end of expression",S0208:"Parameter {{value}} of function definition must be a variable name (start with $)",S0209:"A predicate cannot follow a grouping expression in a step",S0210:"Each step can only have one grouping expression",S0211:"The symbol {{token}} cannot be used as a unary operator",S0212:"The left side of := must be a variable name (start with $)",S0213:"The literal value {{value}} cannot be used as a step within a path expression",S0214:"The right side of {{token}} must be a variable name (start with $)",S0215:"A context variable binding must precede any predicates on a step",S0216:"A context variable binding must precede the 'order-by' clause on a step",S0217:"The object representing the 'parent' cannot be derived from this expression",S0301:"Empty regular expressions are not allowed",S0302:"No terminating / in regular expression",S0402:"Choice groups containing parameterized types are not supported",S0401:"Type parameters can only be applied to functions and arrays",S0500:"Attempted to evaluate an expression containing syntax error(s)",T0410:"Argument {{index}} of function {{token}} does not match function signature",T0411:"Context value is not a compatible type with argument {{index}} of function {{token}}",T0412:"Argument {{index}} of function {{token}} must be an array of {{type}}",D1001:"Number out of range: {{value}}",D1002:"Cannot negate a non-numeric value: {{value}}",T1003:"Key in object structure must evaluate to a string; got: {{value}}",D1004:"Regular expression matches zero length string",T1005:"Attempted to invoke a non-function. Did you mean ${{{token}}}?",T1006:"Attempted to invoke a non-function",T1007:"Attempted to partially apply a non-function. Did you mean ${{{token}}}?",T1008:"Attempted to partially apply a non-function",D1009:"Multiple key definitions evaluate to same key: {{value}}",D1010:"Attempted to access the Javascript object prototype",T1010:"The matcher function argument passed to function {{token}} does not return the correct object structure",T2001:"The left side of the {{token}} operator must evaluate to a number",T2002:"The right side of the {{token}} operator must evaluate to a number",T2003:"The left side of the range operator (..) must evaluate to an integer",T2004:"The right side of the range operator (..) must evaluate to an integer",D2005:"The left side of := must be a variable name (start with $)",T2006:"The right side of the function application operator ~> must be a function",T2007:"Type mismatch when comparing values {{value}} and {{value2}} in order-by clause",T2008:"The expressions within an order-by clause must evaluate to numeric or string values",T2009:"The values {{value}} and {{value2}} either side of operator {{token}} must be of the same data type",T2010:"The expressions either side of operator {{token}} must evaluate to numeric or string values",T2011:"The insert/update clause of the transform expression must evaluate to an object: {{value}}",T2012:"The delete clause of the transform expression must evaluate to a string or array of strings: {{value}}",T2013:"The transform expression clones the input object using the $clone() function.  This has been overridden in the current scope by a non-function.",D2014:"The size of the sequence allocated by the range operator (..) must not exceed 1e6.  Attempted to allocate {{value}}.",D3001:"Attempting to invoke string function on Infinity or NaN",D3010:"Second argument of replace function cannot be an empty string",D3011:"Fourth argument of replace function must evaluate to a positive number",D3012:"Attempted to replace a matched string with a non-string value",D3020:"Third argument of split function must evaluate to a positive number",D3030:"Unable to cast value to a number: {{value}}",D3040:"Third argument of match function must evaluate to a positive number",D3050:"The second argument of reduce function must be a function with at least two arguments",D3060:"The sqrt function cannot be applied to a negative number: {{value}}",D3061:"The power function has resulted in a value that cannot be represented as a JSON number: base={{value}}, exponent={{exp}}",D3070:"The single argument form of the sort function can only be applied to an array of strings or an array of numbers.  Use the second argument to specify a comparison function",D3080:"The picture string must only contain a maximum of two sub-pictures",D3081:"The sub-picture must not contain more than one instance of the 'decimal-separator' character",D3082:"The sub-picture must not contain more than one instance of the 'percent' character",D3083:"The sub-picture must not contain more than one instance of the 'per-mille' character",D3084:"The sub-picture must not contain both a 'percent' and a 'per-mille' character",D3085:"The mantissa part of a sub-picture must contain at least one character that is either an 'optional digit character' or a member of the 'decimal digit family'",D3086:"The sub-picture must not contain a passive character that is preceded by an active character and that is followed by another active character",D3087:"The sub-picture must not contain a 'grouping-separator' character that appears adjacent to a 'decimal-separator' character",D3088:"The sub-picture must not contain a 'grouping-separator' at the end of the integer part",D3089:"The sub-picture must not contain two adjacent instances of the 'grouping-separator' character",D3090:"The integer part of the sub-picture must not contain a member of the 'decimal digit family' that is followed by an instance of the 'optional digit character'",D3091:"The fractional part of the sub-picture must not contain an instance of the 'optional digit character' that is followed by a member of the 'decimal digit family'",D3092:"A sub-picture that contains a 'percent' or 'per-mille' character must not contain a character treated as an 'exponent-separator'",D3093:"The exponent part of the sub-picture must comprise only of one or more characters that are members of the 'decimal digit family'",D3100:"The radix of the formatBase function must be between 2 and 36.  It was given {{value}}",D3110:"The argument of the toMillis function must be an ISO 8601 formatted timestamp. Given {{value}}",D3120:"Syntax error in expression passed to function eval: {{value}}",D3121:"Dynamic error evaluating the expression passed to function eval: {{value}}",D3130:"Formatting or parsing an integer as a sequence starting with {{value}} is not supported by this implementation",D3131:"In a decimal digit pattern, all digits must be from the same decimal group",D3132:"Unknown component specifier {{value}} in date/time picture string",D3133:"The 'name' modifier can only be applied to months and days in the date/time picture string, not {{value}}",D3134:"The timezone integer format specifier cannot have more than four digits",D3135:"No matching closing bracket ']' in date/time picture string",D3136:"The date/time picture string is missing specifiers required to parse the timestamp",D3137:"{{{message}}}",D3138:"The $single() function expected exactly 1 matching result.  Instead it matched more.",D3139:"The $single() function expected exactly 1 matching result.  Instead it matched 0.",D3140:"Malformed URL passed to ${{{functionName}}}(): {{value}}",D3141:"{{{message}}}"};function Ze(n){var o=it[n.code];if(typeof o<"u"){var s=o.replace(/\{\{\{([^}]+)}}}/g,function(){return n[arguments[1]]});s=s.replace(/\{\{([^}]+)}}/g,function(){return JSON.stringify(n[arguments[1]])}),n.message=s}}function ye(n,o){var s,e;try{s=ue(n,o&&o.recover),e=s.errors,delete s.errors}catch(l){throw Ze(l),l}var t=Je(g),r=new Date;return t.bind("now",j(function(l,f){return we.fromMillis(r.getTime(),l,f)},"<s?s?:s>")),t.bind("millis",j(function(){return r.getTime()},"<:n>")),o&&o.RegexEngine?ye.RegexEngine=o.RegexEngine:ye.RegexEngine=RegExp,{evaluate:async function(l,f,y){if(typeof e<"u"){var S={code:"S0500",position:0};throw Ze(S),S}if(typeof f<"u"){var R;R=Je(t);for(var W in f)R.bind(W,f[W])}else R=t;R.bind("$",l),r=new Date,R.timestamp=r,Array.isArray(l)&&!se(l)&&(l=M(l),l.outerWrapper=!0);var ge;try{return ge=await C(s,l,R),typeof y=="function"&&y(null,ge),ge}catch(ae){throw Ze(ae),ae}},assign:function(l,f){t.bind(l,f)},registerFunction:function(l,f,y){var S=j(f,y);t.bind(l,S)},ast:function(){return s},errors:function(){return e}}}return ye.parser=ue,ye})();be.exports=oe},{"./datetime":1,"./functions":2,"./parser":4,"./signature":5,"./utils":6}],4:[function(k,be,Ge){var we=k("./signature");let T=(()=>{"use strict";var N={".":75,"[":80,"]":0,"{":70,"}":0,"(":80,")":0,",":0,"@":80,"#":80,";":80,":":80,"?":20,"+":50,"-":50,"*":60,"/":60,"%":60,"|":20,"=":40,"<":40,">":40,"^":40,"**":60,"..":20,":=":10,"!=":40,"<=":40,">=":40,"~>":40,"?:":40,"??":40,and:30,or:25,in:40,"&":50,"!":0,"~":0},ue={'"':'"',"\\":"\\","/":"/",b:"\b",f:"\f",n:`
`,r:"\r",t:"	"},z=function(F){var m=0,D=F.length,M=function(te,x){var O={type:te,value:x,position:m};return O},se=function(){for(var te=m,x=0,O,Y,w=function(C){if(F.charAt(C)==="/"&&x===0){for(var U=0;F.charAt(C-(U+1))==="\\";)U++;if(U%2===0)return!0}return!1};m<D;){var g=F.charAt(m);if(w(m)){if(O=F.substring(te,m),O==="")throw{code:"S0301",stack:new Error().stack,position:m};for(m++,g=F.charAt(m),te=m;g==="i"||g==="m";)m++,g=F.charAt(m);return Y=F.substring(te,m)+"g",new RegExp(O,Y)}(g==="("||g==="["||g==="{")&&F.charAt(m-1)!=="\\"&&x++,(g===")"||g==="]"||g==="}")&&F.charAt(m-1)!=="\\"&&x--,m++}throw{code:"S0302",stack:new Error().stack,position:m}},Z=function(te){if(m>=D)return null;for(var x=F.charAt(m);m<D&&` 	
\r\v`.indexOf(x)>-1;)m++,x=F.charAt(m);if(x==="/"&&F.charAt(m+1)==="*"){var O=m;for(m+=2,x=F.charAt(m);!(x==="*"&&F.charAt(m+1)==="/");)if(x=F.charAt(++m),m>=D)throw{code:"S0106",stack:new Error().stack,position:O};return m+=2,x=F.charAt(m),Z(te)}if(te!==!0&&x==="/")return m++,M("regex",se());if(x==="."&&F.charAt(m+1)===".")return m+=2,M("operator","..");if(x===":"&&F.charAt(m+1)==="=")return m+=2,M("operator",":=");if(x==="!"&&F.charAt(m+1)==="=")return m+=2,M("operator","!=");if(x===">"&&F.charAt(m+1)==="=")return m+=2,M("operator",">=");if(x==="<"&&F.charAt(m+1)==="=")return m+=2,M("operator","<=");if(x==="*"&&F.charAt(m+1)==="*")return m+=2,M("operator","**");if(x==="~"&&F.charAt(m+1)===">")return m+=2,M("operator","~>");if(x==="?"&&F.charAt(m+1)===":")return m+=2,M("operator","?:");if(x==="?"&&F.charAt(m+1)==="?")return m+=2,M("operator","??");if(Object.prototype.hasOwnProperty.call(N,x))return m++,M("operator",x);if(x==='"'||x==="'"){var Y=x;m++;for(var w="";m<D;){if(x=F.charAt(m),x==="\\")if(m++,x=F.charAt(m),Object.prototype.hasOwnProperty.call(ue,x))w+=ue[x];else if(x==="u"){var g=F.substr(m+1,4);if(/^[0-9a-fA-F]+$/.test(g)){var C=parseInt(g,16);w+=String.fromCharCode(C),m+=4}else throw{code:"S0104",stack:new Error().stack,position:m}}else throw{code:"S0103",stack:new Error().stack,position:m,token:x};else{if(x===Y)return m++,M("string",w);w+=x}m++}throw{code:"S0101",stack:new Error().stack,position:m}}var U=/^-?(0|([1-9][0-9]*))(\.[0-9]+)?([Ee][-+]?[0-9]+)?/,X=U.exec(F.substring(m));if(X!==null){var V=parseFloat(X[0]);if(!isNaN(V)&&isFinite(V))return m+=X[0].length,M("number",V);throw{code:"S0102",stack:new Error().stack,position:m,token:X[0]}}var fe;if(x==="`"){m++;var he=F.indexOf("`",m);if(he!==-1)return fe=F.substring(m,he),m=he+1,M("name",fe);throw m=D,{code:"S0105",stack:new Error().stack,position:m}}for(var ne=m,me;;)if(me=F.charAt(ne),ne===D||` 	
\r\v`.indexOf(me)>-1||Object.prototype.hasOwnProperty.call(N,me)){if(F.charAt(m)==="$")return fe=F.substring(m+1,ne),m=ne,M("variable",fe);switch(fe=F.substring(m,ne),m=ne,fe){case"or":case"in":case"and":return M("operator",fe);case"true":return M("value",!0);case"false":return M("value",!1);case"null":return M("value",null);default:return m===D&&fe===""?null:M("name",fe)}}else ne++};return Z},oe=function(F,m){var D,M,se={},Z=[],te=function(){var a=[];D.id!=="(end)"&&a.push({type:D.type,value:D.value,position:D.position});for(var u=M();u!==null;)a.push(u),u=M();return a},x={nud:function(){var a={code:"S0211",token:this.value,position:this.position};if(m)return a.remaining=te(),a.type="error",Z.push(a),a;throw a.stack=new Error().stack,a}},O=function(a,u){var I=se[a];return u=u||0,I?u>=I.lbp&&(I.lbp=u):(I=Object.create(x),I.id=I.value=a,I.lbp=u,se[a]=I),I},Y=function(a){if(m){a.remaining=te(),Z.push(a);var u=se["(error)"];return D=Object.create(u),D.error=a,D.type="(error)",D}else throw a.stack=new Error().stack,a},w=function(a,u){if(a&&D.id!==a){var I;D.id==="(end)"?I="S0203":I="S0202";var h={code:I,position:D.position,token:D.value,value:a};return Y(h)}var P=M(u);if(P===null)return D=se["(end)"],D.position=F.length,D;var L=P.value,c=P.type,d;switch(c){case"name":case"variable":d=se["(name)"];break;case"operator":if(d=se[L],!d)return Y({code:"S0204",stack:new Error().stack,position:P.position,token:L});break;case"string":case"number":case"value":d=se["(literal)"];break;case"regex":c="regex",d=se["(regex)"];break;default:return Y({code:"S0205",stack:new Error().stack,position:P.position,token:L})}return D=Object.create(d),D.value=L,D.type=c,D.position=P.position,D},g=function(a){var u,I=D;for(w(null,!0),u=I.nud();a<D.lbp;)I=D,w(),u=I.led(u);return u},C=function(a){var u=O(a,0);u.nud=function(){return this}},U=function(a,u,I){var h=u||N[a],P=O(a,h);return P.led=I||function(L){return this.lhs=L,this.rhs=g(h),this.type="binary",this},P},X=function(a,u,I){var h=O(a,u);return h.led=I,h},V=function(a,u){var I=O(a);return I.nud=u||function(){return this.expression=g(70),this.type="unary",this},I};C("(end)"),C("(name)"),C("(literal)"),C("(regex)"),O(":"),O(";"),O(","),O(")"),O("]"),O("}"),O(".."),U("."),U("+"),U("-"),U("*"),U("/"),U("%"),U("="),U("<"),U(">"),U("!="),U("<="),U(">="),U("&"),U("and"),U("or"),U("in"),C("and"),C("or"),C("in"),V("-"),U("~>"),U("??",N["??"],function(a){return this.type="condition",this.condition={type:"function",value:"(",procedure:{type:"variable",value:"exists"},arguments:[a]},this.then=a,this.else=g(0),this}),X("(error)",10,function(a){return this.lhs=a,this.error=D.error,this.remaining=te(),this.type="error",this}),V("*",function(){return this.type="wildcard",this}),V("**",function(){return this.type="descendant",this}),V("%",function(){return this.type="parent",this}),U("(",N["("],function(a){if(this.procedure=a,this.type="function",this.arguments=[],D.id!==")")for(;D.type==="operator"&&D.id==="?"?(this.type="partial",this.arguments.push(D),w("?")):this.arguments.push(g(0)),D.id===",";)w(",");if(w(")",!0),a.type==="name"&&(a.value==="function"||a.value==="\u03BB")){if(this.arguments.forEach(function(L,c){if(L.type!=="variable")return Y({code:"S0208",stack:new Error().stack,position:L.position,token:L.value,value:c+1})}),this.type="lambda",D.id==="<"){for(var u=D.position,I=1,h="<";I>0&&D.id!=="{"&&D.id!=="(end)";){var P=w();P.id===">"?I--:P.id==="<"&&I++,h+=P.value}w(">");try{this.signature=we(h)}catch(L){return L.position=u+L.offset,Y(L)}}w("{"),this.body=g(0),w("}")}return this}),V("(",function(){for(var a=[];D.id!==")"&&(a.push(g(0)),D.id===";");)w(";");return w(")",!0),this.type="block",this.expressions=a,this}),V("[",function(){var a=[];if(D.id!=="]")for(;;){var u=g(0);if(D.id===".."){var I={type:"binary",value:"..",position:D.position,lhs:u};w(".."),I.rhs=g(0),u=I}if(a.push(u),D.id!==",")break;w(",")}return w("]",!0),this.expressions=a,this.type="unary",this}),U("[",N["["],function(a){if(D.id==="]"){for(var u=a;u&&u.type==="binary"&&u.value==="[";)u=u.lhs;return u.keepArray=!0,w("]"),a}else return this.lhs=a,this.rhs=g(N["]"]),this.type="binary",w("]",!0),this}),U("^",N["^"],function(a){w("(");for(var u=[];;){var I={descending:!1};if(D.id==="<"?w("<"):D.id===">"&&(I.descending=!0,w(">")),I.expression=g(0),u.push(I),D.id!==",")break;w(",")}return w(")"),this.lhs=a,this.rhs=u,this.type="binary",this});var fe=function(a){var u=[];if(D.id!=="}")for(;;){var I=g(0);w(":");var h=g(0);if(u.push([I,h]),D.id!==",")break;w(",")}return w("}",!0),typeof a>"u"?(this.lhs=u,this.type="unary"):(this.lhs=a,this.rhs=u,this.type="binary"),this};V("{",fe),U("{",N["{"],fe),X(":=",N[":="],function(a){return a.type!=="variable"?Y({code:"S0212",stack:new Error().stack,position:a.position,token:a.value}):(this.lhs=a,this.rhs=g(N[":="]-1),this.type="binary",this)}),U("@",N["@"],function(a){return this.lhs=a,this.rhs=g(N["@"]),this.rhs.type!=="variable"?Y({code:"S0214",stack:new Error().stack,position:this.rhs.position,token:"@"}):(this.type="binary",this)}),U("#",N["#"],function(a){return this.lhs=a,this.rhs=g(N["#"]),this.rhs.type!=="variable"?Y({code:"S0214",stack:new Error().stack,position:this.rhs.position,token:"#"}):(this.type="binary",this)}),U("?",N["?"],function(a){return this.type="condition",this.condition=a,this.then=g(0),D.id===":"&&(w(":"),this.else=g(0)),this}),U("?:",N["?:"],function(a){return this.type="condition",this.condition=a,this.then=a,this.else=g(0),this}),V("|",function(){return this.type="transform",this.pattern=g(0),w("|"),this.update=g(0),D.id===","&&(w(","),this.delete=g(0)),w("|"),this});var he=function(a){var u;if(a.type==="function"&&!a.predicate){var I={type:"lambda",thunk:!0,arguments:[],position:a.position};I.body=a,u=I}else if(a.type==="condition")a.then=he(a.then),typeof a.else<"u"&&(a.else=he(a.else)),u=a;else if(a.type==="block"){var h=a.expressions.length;h>0&&(a.expressions[h-1]=he(a.expressions[h-1])),u=a}else u=a;return u},ne=0,me=0,xe=[],ce=function(a,u){switch(a.type){case"name":case"wildcard":u.level--,u.level===0&&(typeof a.ancestor>"u"||(xe[u.index].slot.label=a.ancestor.label),a.ancestor=u,a.tuple=!0);break;case"parent":u.level++;break;case"block":a.expressions.length>0&&(a.tuple=!0,u=ce(a.expressions[a.expressions.length-1],u));break;case"path":a.tuple=!0;var I=a.steps.length-1;for(u=ce(a.steps[I--],u);u.level>0&&I>=0;)u=ce(a.steps[I--],u);break;default:throw{code:"S0217",token:a.type,position:a.position}}return u},Q=function(a,u){if(typeof u.seekingParent<"u"||u.type==="parent"){var I=typeof u.seekingParent<"u"?u.seekingParent:[];u.type==="parent"&&I.push(u.slot),typeof a.seekingParent>"u"?a.seekingParent=I:Array.prototype.push.apply(a.seekingParent,I)}},Me=function(a){var u=a.steps.length-1,I=a.steps[u],h=typeof I.seekingParent<"u"?I.seekingParent:[];I.type==="parent"&&h.push(I.slot);for(var P=0;P<h.length;P++){var L=h[P];for(u=a.steps.length-2;L.level>0;){if(u<0){typeof a.seekingParent>"u"?a.seekingParent=[L]:a.seekingParent.push(L);break}for(var c=a.steps[u--];u>=0&&c.focus&&a.steps[u].focus;)c=a.steps[u--];L=ce(c,L)}}},H=function(a){var u;switch(a.type){case"binary":switch(a.value){case".":var I=H(a.lhs);I.type==="path"?u=I:u={type:"path",steps:[I]},I.type==="parent"&&(u.seekingParent=[I.slot]);var h=H(a.rhs);h.type==="function"&&h.procedure.type==="path"&&h.procedure.steps.length===1&&h.procedure.steps[0].type==="name"&&u.steps[u.steps.length-1].type==="function"&&(u.steps[u.steps.length-1].nextFunction=h.procedure.steps[0].value),h.type==="path"?Array.prototype.push.apply(u.steps,h.steps):(typeof h.predicate<"u"&&(h.stages=h.predicate,delete h.predicate),u.steps.push(h)),u.steps.filter(function(E){if(E.type==="number"||E.type==="value")throw{code:"S0213",stack:new Error().stack,position:E.position,value:E.value};return E.type==="string"}).forEach(function(E){E.type="name"}),u.steps.filter(function(E){return E.keepArray===!0}).length>0&&(u.keepSingletonArray=!0);var P=u.steps[0];P.type==="unary"&&P.value==="["&&(P.consarray=!0);var L=u.steps[u.steps.length-1];L.type==="unary"&&L.value==="["&&(L.consarray=!0),Me(u);break;case"[":u=H(a.lhs);var c=u,d="predicate";if(u.type==="path"&&(c=u.steps[u.steps.length-1],d="stages"),typeof c.group<"u")throw{code:"S0209",stack:new Error().stack,position:a.position};typeof c[d]>"u"&&(c[d]=[]);var p=H(a.rhs);typeof p.seekingParent<"u"&&(p.seekingParent.forEach(E=>{E.level===1?ce(c,E):E.level--}),Q(c,p)),c[d].push({type:"filter",expr:p,position:a.position});break;case"{":if(u=H(a.lhs),typeof u.group<"u")throw{code:"S0210",stack:new Error().stack,position:a.position};u.group={lhs:a.rhs.map(function(E){return[H(E[0]),H(E[1])]}),position:a.position};break;case"^":u=H(a.lhs),u.type!=="path"&&(u={type:"path",steps:[u]});var i={type:"sort",position:a.position};i.terms=a.rhs.map(function(E){var $=H(E.expression);return Q(i,$),{descending:E.descending,expression:$}}),u.steps.push(i),Me(u);break;case":=":u={type:"bind",value:a.value,position:a.position},u.lhs=H(a.lhs),u.rhs=H(a.rhs),Q(u,u.rhs);break;case"@":if(u=H(a.lhs),c=u,u.type==="path"&&(c=u.steps[u.steps.length-1]),typeof c.stages<"u"||typeof c.predicate<"u")throw{code:"S0215",stack:new Error().stack,position:a.position};if(c.type==="sort")throw{code:"S0216",stack:new Error().stack,position:a.position};a.keepArray&&(c.keepArray=!0),c.focus=a.rhs.value,c.tuple=!0;break;case"#":u=H(a.lhs),c=u,u.type==="path"?c=u.steps[u.steps.length-1]:(u={type:"path",steps:[u]},typeof c.predicate<"u"&&(c.stages=c.predicate,delete c.predicate)),typeof c.stages>"u"?c.index=a.rhs.value:c.stages.push({type:"index",value:a.rhs.value,position:a.position}),c.tuple=!0;break;case"~>":u={type:"apply",value:a.value,position:a.position},u.lhs=H(a.lhs),u.rhs=H(a.rhs),u.keepArray=u.lhs.keepArray||u.rhs.keepArray;break;default:u={type:a.type,value:a.value,position:a.position},u.lhs=H(a.lhs),u.rhs=H(a.rhs),Q(u,u.lhs),Q(u,u.rhs)}break;case"unary":u={type:a.type,value:a.value,position:a.position},a.value==="["?u.expressions=a.expressions.map(function(E){var $=H(E);return Q(u,$),$}):a.value==="{"?u.lhs=a.lhs.map(function(E){var $=H(E[0]);Q(u,$);var re=H(E[1]);return Q(u,re),[$,re]}):(u.expression=H(a.expression),a.value==="-"&&u.expression.type==="number"?(u=u.expression,u.value=-u.value):Q(u,u.expression));break;case"function":case"partial":u={type:a.type,name:a.name,value:a.value,position:a.position},u.arguments=a.arguments.map(function(E){var $=H(E);return Q(u,$),$}),u.procedure=H(a.procedure);break;case"lambda":u={type:a.type,arguments:a.arguments,signature:a.signature,position:a.position};var b=H(a.body);u.body=he(b);break;case"condition":u={type:a.type,position:a.position},u.condition=H(a.condition),Q(u,u.condition),u.then=H(a.then),Q(u,u.then),typeof a.else<"u"&&(u.else=H(a.else),Q(u,u.else));break;case"transform":u={type:a.type,position:a.position},u.pattern=H(a.pattern),u.update=H(a.update),typeof a.delete<"u"&&(u.delete=H(a.delete));break;case"block":u={type:a.type,position:a.position},u.expressions=a.expressions.map(function(E){var $=H(E);return Q(u,$),($.consarray||$.type==="path"&&$.steps[0].consarray)&&(u.consarray=!0),$});break;case"name":u={type:"path",steps:[a]},a.keepArray&&(u.keepSingletonArray=!0);break;case"parent":u={type:"parent",slot:{label:"!"+ne++,level:1,index:me++}},xe.push(u);break;case"string":case"number":case"value":case"wildcard":case"descendant":case"variable":case"regex":u=a;break;case"operator":if(a.value==="and"||a.value==="or"||a.value==="in")a.type="name",u=H(a);else if(a.value==="?")u=a;else throw{code:"S0201",stack:new Error().stack,position:a.position,token:a.value};break;case"error":u=a,a.lhs&&(u=H(a.lhs));break;default:var A="S0206";a.id==="(end)"&&(A="S0207");var v={code:A,position:a.position,token:a.value};if(m)return Z.push(v),{type:"error",error:v};throw v.stack=new Error().stack,v}return a.keepArray&&(u.keepArray=!0),u};M=z(F),w();var Ee=g(0);if(D.id!=="(end)"){var Be={code:"S0201",position:D.position,token:D.value};Y(Be)}if(Ee=H(Ee),Ee.type==="parent"||typeof Ee.seekingParent<"u")throw{code:"S0217",token:Ee.type,position:Ee.position};return Z.length>0&&(Ee.errors=Z),Ee};return oe})();be.exports=T},{"./signature":5}],5:[function(k,be,Ge){var we=k("./utils");let T=(()=>{"use strict";var N={a:"arrays",b:"booleans",f:"functions",n:"numbers",o:"objects",s:"strings"};function ue(z){for(var oe=1,F=[],m={},D=m;oe<z.length;){var M=z.charAt(oe);if(M===":")break;var se=function(){F.push(m),D=m,m={}},Z=function(U,X,V,fe){for(var he=1,ne=X;ne<U.length;)if(ne++,M=U.charAt(ne),M===fe){if(he--,he===0)break}else M===V&&he++;return ne};switch(M){case"s":case"n":case"b":case"l":case"o":m.regex="["+M+"m]",m.type=M,se();break;case"a":m.regex="[asnblfom]",m.type=M,m.array=!0,se();break;case"f":m.regex="f",m.type=M,se();break;case"j":m.regex="[asnblom]",m.type=M,se();break;case"x":m.regex="[asnblfom]",m.type=M,se();break;case"-":D.context=!0,D.contextRegex=new RegExp(D.regex),D.regex+="?";break;case"?":case"+":D.regex+=M;break;case"(":var te=Z(z,oe,"(",")"),x=z.substring(oe+1,te);if(x.indexOf("<")===-1)m.regex="["+x+"m]";else throw{code:"S0402",stack:new Error().stack,value:x,offset:oe};m.type="("+x+")",oe=te,se();break;case"<":if(D.type==="a"||D.type==="f"){var O=Z(z,oe,"<",">");D.subtype=z.substring(oe+1,O),oe=O}else throw{code:"S0401",stack:new Error().stack,value:D.type,offset:oe};break}oe++}var Y="^"+F.map(function(U){return"("+U.regex+")"}).join("")+"$",w=new RegExp(Y),g=function(U){var X;if(we.isFunction(U))X="f";else{var V=typeof U;switch(V){case"string":X="s";break;case"number":X="n";break;case"boolean":X="b";break;case"object":U===null?X="l":Array.isArray(U)?X="a":X="o";break;case"undefined":default:X="m"}}return X},C=function(U,X){for(var V="^",fe=0,he=0;he<F.length;he++){V+=F[he].regex;var ne=X.match(V);if(ne===null)throw{code:"T0410",stack:new Error().stack,value:U[fe],index:fe+1};fe=ne[0].length}throw{code:"T0410",stack:new Error().stack,value:U[fe],index:fe+1}};return{definition:z,validate:function(U,X){var V="";U.forEach(function(me){V+=g(me)});var fe=w.exec(V);if(fe){var he=[],ne=0;return F.forEach(function(me,xe){var ce=U[ne],Q=fe[xe+1];if(Q==="")if(me.context&&me.contextRegex){var Me=g(X);if(me.contextRegex.test(Me))he.push(X);else throw{code:"T0411",stack:new Error().stack,value:X,index:ne+1}}else he.push(ce),ne++;else Q.split("").forEach(function(H){if(me.type==="a"){if(H==="m")ce=void 0;else{ce=U[ne];var Ee=!0;if(typeof me.subtype<"u"){if(H!=="a"&&Q!==me.subtype)Ee=!1;else if(H==="a"&&ce.length>0){var Be=g(ce[0]);if(Be!==me.subtype.charAt(0))Ee=!1;else{var a=ce.filter(function(u){return g(u)!==Be});Ee=a.length===0}}}if(!Ee)throw{code:"T0412",stack:new Error().stack,value:ce,index:ne+1,type:N[me.subtype]};H!=="a"&&(ce=[ce])}he.push(ce),ne++}else he.push(ce),ne++})}),he}C(U,V)}}}return ue})();be.exports=T},{"./utils":6}],6:[function(k,be,Ge){let we=(()=>{"use strict";function T(O){var Y=!1;if(typeof O=="number"&&(Y=!isNaN(O),Y&&!isFinite(O)))throw{code:"D1001",value:O,stack:new Error().stack};return Y}function N(O){var Y=!1;return Array.isArray(O)&&(Y=O.filter(function(w){return typeof w!="string"}).length===0),Y}function ue(O){var Y=!1;return Array.isArray(O)&&(Y=O.filter(function(w){return!T(w)}).length===0),Y}function z(){var O=[];return O.sequence=!0,arguments.length===1&&O.push(arguments[0]),O}function oe(O){return O.sequence===!0&&Array.isArray(O)}function F(O){return O&&(O._jsonata_function===!0||O._jsonata_lambda===!0)||typeof O=="function"}function m(O){var Y=typeof O.arity=="number"?O.arity:typeof O.implementation=="function"?O.implementation.length:typeof O.length=="number"?O.length:O.arguments.length;return Y}function D(O){return O&&O._jsonata_lambda===!0}var M=(typeof Symbol=="function"?Symbol:{}).iterator||"@@iterator";function se(O){return typeof O=="object"&&O!==null&&M in O&&"next"in O&&typeof O.next=="function"}function Z(O,Y){if(O===Y)return!0;if(typeof O=="object"&&typeof Y=="object"&&O!==null&&Y!==null){if(Array.isArray(O)&&Array.isArray(Y)){if(O.length!==Y.length)return!1;for(var w=0;w<O.length;w++)if(!Z(O[w],Y[w]))return!1;return!0}var g=Object.getOwnPropertyNames(O),C=Object.getOwnPropertyNames(Y);if(g.length!==C.length)return!1;for(g=g.sort(),C=C.sort(),w=0;w<g.length;w++)if(g[w]!==C[w])return!1;for(w=0;w<g.length;w++){var U=g[w];if(!Z(O[U],Y[U]))return!1}return!0}return!1}function te(O){return typeof O=="object"&&O!==null&&"then"in O&&typeof O.then=="function"}function x(O){var Y=[];for(let w of O)Y.push(w);return Y}return{isNumeric:T,isArrayOfStrings:N,isArrayOfNumbers:ue,createSequence:z,isSequence:oe,isFunction:F,isLambda:D,isIterable:se,getFunctionArity:m,isDeepEqual:Z,stringToArray:x,isPromise:te}})();be.exports=we},{}]},{},[3])(3)})});var St=Lt(Dt(),1),Ot=class extends EventTarget{#e=!1;#t={};constructor(K={}){super(),q(K,["object"],"Invalid type for config"),q(K.functions,["object","undefined"],"Invalid type for config.functions");let De=K.functions??{};for(let k of Object.keys(De))q(De[k],["function"],`Invalid type for config.functions["${k}"]`);this.#t=De}run(K={},De={},k={}){return new Promise((be,Ge)=>{let we=new Set,T=new Set,N=new Set,ue=new Set,z=new Map,oe=new Set,F=new Set,m=new Set,D=new Set,M=new Map,se=[],Z=K?.functions??{},te=K?.events??{},x=K?.connections??[],O=De?.signal,Y=new Array(x.length),w=(h,P)=>this.dispatchEvent(new CustomEvent("logs",{detail:{level:{ALL:0,DEBUG:1,INFO:2,WARN:3,ERROR:4,FATAL:5}[h],type:h,message:P}})),g=(h,P,L)=>{let c=L===null?{}:(k.waitings??=new Array(x.length),k.waitings[L]??={}),d=h.reduce((i,b)=>(i[b]=(i[b]??0)+1,i),{}),p=i=>{let b=i.detail;if((c[i.type]??=[]).push(b),L===null&&(k.receiveds??={},k.receiveds[i.type]??=[]).push(b),w("INFO",L!=null?`Connection ${L} received event ${i.type}`:`Received event ${i.type}`),w("DEBUG",`${i.type} detail:`),w("DEBUG",b),Object.keys(d).map(v=>c[v]&&c[v].length>=d[v]).every(Boolean)){let v=h.map(E=>c[E].shift());Object.keys(c).forEach(E=>c[E].length===0?delete c[E]:null),P(v)}else X()};for(let i of h)this.addEventListener(i,p),se.push({event:i,callback:p})},C=()=>{w("INFO","clearListeners");for(let h of se)this.removeEventListener(h.event,h.callback);se=[],O&&O instanceof AbortSignal&&O.removeEventListener("abort",Me)},U=(h,P)=>{C(),h?(w("INFO","end with success"),this.dispatchEvent(new CustomEvent("success",{detail:P})),be(P)):(w("FATAL","end with error:"),w("FATAL",P.error),this.dispatchEvent(new CustomEvent("error",{detail:P})),Ge(P)),w("DEBUG","state:"),w("DEBUG",P.state),this.#e=!1},X=()=>{if((k.runnings??[]).length>0)return;w("DEBUG","checkTerminate: state.runnings.length === 0");let h=!0;for(let P=0;P<x.length;P++){let L=Y[P],c=k.waitings?.[P]??{},d=0,p=!1;for(let b of Object.keys(L)){let A=V(b)!=null,v=te[b]?.once===!0&&z.get(b).counter>0;if(L[b]>(c[A?`functions.${b}`:`events.${b}`]??[]).length&&(d++,w("DEBUG",`checkTerminate: connection ${P} missing "${b}"`),A||v)){p=!0,w("DEBUG",`checkTerminate: connection ${P} hasDeadlock on "${b}" (isFunction=${A}, isOnceAlreadyReceived=${v}))`);break}}if(!(d===0||p)){w("DEBUG",`checkTerminate: connection ${P} NOT allowsTermination (missingCount=${d}, hasDeadlock=${p}))`),h=!1;break}}h&&U(!0,{state:k})},V=h=>Z[h]?.ref?this.#t[Z[h].ref]:this.#t[h],fe=(h,P,L)=>{let c=L??{id:h,inputs:P};L||Be(c),w("INFO",`Function ${h} start`),w("DEBUG",`Function ${h} inputs: `),w("DEBUG",P),he(h,P).then(d=>{a(c),Object.hasOwn(d,"result")?(w("INFO",`Function ${h} end`),w("DEBUG",`Function ${h} result:`),w("DEBUG",d.result),this.dispatchEvent(new CustomEvent(`functions.${h}`,{detail:d.result})),this.dispatchEvent(new CustomEvent("functions",{detail:{[h]:d.result}})),oe.has(h)&&Ee(h,d.result)):(w("ERROR",`Function ${h} end with errors`),w("ERROR",`Function ${h} error:`),w("ERROR",d.error),this.dispatchEvent(new CustomEvent("errors",{detail:{[h]:d.error}})),this.dispatchEvent(new CustomEvent(`errors.${h}`,{detail:d.error})),(k.errors??={},k.errors[h]??=[]).push(d.error)),X()}).catch(d=>{a(c),U(!1,{state:k,error:d})})},he=async(h,P)=>{let L=V(h),c=null;if(Z[h]?.inputsTransformation)try{w("DEBUG",`Function ${h} inputsTransformation inputs:`),w("DEBUG",P),P=await Q(Z[h]?.inputsTransformation,P),q(P,["array"],"Invalid type returned"),w("DEBUG",`Function ${h} inputsTransformation results:`),w("DEBUG",P)}catch(d){throw w("FATAL",`Function ${h} inputsTransformation error:`),w("FATAL",d),new Error(`Function ${h} inputsTransformation: ${d.message}`)}try{c={result:await L(...P)}}catch(d){if(Z[h]?.throws)throw new Error(`${h}: ${d.message??d}`);c={error:d}}if(Object.hasOwn(c,"result")&&Z[h]?.outputTransformation)try{w("DEBUG",`Function ${h} outputTransformation inputs:`),w("DEBUG",c.result),c.result=await Q(Z[h]?.outputTransformation,c.result),w("DEBUG",`Function ${h} outputTransformation result:`),w("DEBUG",c.result)}catch(d){throw w("FATAL",`Function ${h} outputTransformation error:`),w("FATAL",d),new Error(`Function ${h} outputTransformation: ${d.message}`)}return c},ne=h=>te[h]?te[h].ref?te[h]?.ref:h:null,me=(h,P,L)=>{if(w("DEBUG",`Run ${L?'"to"':'"from"'} event ${h}`),!L&&z.has(h)&&(z.get(h).counter++,w("DEBUG",`Once Event ${h} counter: ${z.get(h).counter}`),z.get(h).counter>1)){U(!1,{state:k,error:new Error(`The events["${h}"].once == true but the event as been received ${z.get(h).counter} times`)});return}oe.has(h)&&Ee(h,P),this.dispatchEvent(new CustomEvent("events",{detail:{[h]:P}}));let c=L?ne(h)??h:`events.${h}`;w("INFO",`Event ${c} dispatch`),w("DEBUG",`Event ${c} detail:`),w("DEBUG",P),this.dispatchEvent(new CustomEvent(c,{detail:P}))},xe=(h,P,L)=>{let c=L??{id:h,inputs:P};L||Be(c),w("INFO",`Connection ${h} start`),w("DEBUG",`Connection ${h} inputs:`),w("DEBUG",P),ce(h,P).then(d=>{if(a(c),w("INFO",`Connection ${h} end`),w("DEBUG",`Connection ${h} result:`),w("DEBUG",d),d.toSave)Ee(h,d.toSave);else for(let p of d.toRun)p.event?me(p.to,p.inputs,!0):fe(p.to,p.inputs,void 0);H(),X()}).catch(d=>{a(c),U(!1,{state:k,error:d})})},ce=async(h,P)=>{let L=x[h],c=L.from??[],d=L.to??[],p=[];for(let v of P)p.push(v);let i={to:c.length>0?p.map(v=>v===null?null:[v]):new Array(d.length).fill(null).map(()=>[]),global:k.variables?.global,local:k.variables?.locals?.[h]};if(L.transition)try{let v={from:p,global:k.variables?.global,local:k.variables?.locals?.[h]};w("DEBUG",`Connection ${h} transition inputs:`),w("DEBUG",v),i=await Q(L.transition,v),w("DEBUG",`Connection ${h} transition result:`),w("DEBUG",i)}catch(v){throw w("FATAL",`Connection ${h} transition error:`),w("FATAL",v),new Error(`Connection ${h} transition: ${v.message}`)}let b=i.to;q(i.global,["object","undefined"],`Invalid type of global variable returned by the transition of connection ${h}`),i.global&&u(i.global),q(i.local,["object","undefined"],`Invalid type of local variable returned by the transition of connection ${h}`),i.local&&I(i.local,h);let A={toRun:[],toSave:null};if(d.length>0){if(q(b,["array"],`Invalid type of "to" value returned by the transition of connection ${h}`),b.length!=d.length)throw new TypeError(`The connection ${h} transition returned "to" value must be an array of the same length of the "connection.to" array (length=${d.length}).
Returned: ${JSON.stringify(b)} (length=${b.length})`);for(let v=0;v<d.length;v++){let E=d[v],$=b[v];$!=null&&(V(E)?(q($,["array"],`Invalid type of "to[${v}]" value returned by the transition of connection ${h}`),A.toRun.push({event:!1,to:E,inputs:$})):A.toRun.push({event:!0,to:E,inputs:$}))}return A}else return A.toSave=b,A},Q=(h,P)=>Bt(h,P),Me=()=>U(!1,{state:k,error:O?.reason}),H=()=>this.dispatchEvent(new CustomEvent("state.change",{detail:{state:k}})),Ee=(h,P)=>{k.finals??={},k.finals.connections??=new Array(x.length),k.finals.events??={},k.finals.functions??={},typeof h=="number"?(k.finals.connections[h]??=[]).push(P):V(h)?(k.finals.functions[h]??=[]).push(P):(k.finals.events[h]??=[]).push(P)},Be=h=>k.runnings?.push(h),a=h=>k.runnings?.splice(k.runnings.indexOf(h),1),u=h=>(k.variables??={}).global=h,I=(h,P)=>(k.variables??={},k.variables.locals??=new Array(x.length).fill(null).map(()=>({})))[P]=h;try{if(q(K,["object"],"Invalid type for config"),q(De,["object"],"Invalid type for options"),q(k,["object"],"Invalid type for state"),q(K.functions,["object","undefined"],"Invalid type for config.functions"),q(K.events,["object","undefined"],"Invalid type for config.events"),q(K.connections,["array","undefined"],"Invalid type for config.connections"),O&&!(O instanceof AbortSignal))throw new TypeError("The provided signal must be an instance of AbortSignal");if(this.#e)throw new Error("The Orchestration is already running");if(this.#e=!0,O&&(O.addEventListener("abort",Me,{once:!0}),O.aborted)){U(!1,{state:k,error:O.reason});return}for(let[i,b]of x.entries()){q(b,["object"],`Invalid type for connection[${i}]`),q(b.from,["array","undefined"],`Invalid type for connection[${i}].from`);let A=b.from??[];if(A.forEach((E,$)=>{q(E,["string"],`Invalid type for connection[${i}].from[${$}]`),we.add(E),V(E)||(N.add(E),te[E]?.once&&z.set(E,{counter:0}))}),Y[i]=A.reduce((E,$)=>(E[$]=(E[$]??0)+1,E),{}),q(b.to,["array","undefined"],`Invalid type for connection[${i}].to`),(b.to??[]).forEach((E,$)=>{q(E,["string"],`Invalid type for connection[${i}].to[${$}]`),T.add(E),V(E)||ue.add(E)}),q(b.transition,["string","undefined"],`Invalid type for connection[${i}].transition`),A.length!==0){let E=A.map($=>V($)?`functions.${$}`:`events.${$}`);g(E,$=>xe(i,$,void 0),i),E.forEach(($,re)=>M.set($,A[re]))}}T.forEach(i=>{we.has(i)||oe.add(i)}),we.forEach(i=>{T.has(i)||m.add(i)}),ue.forEach(i=>{we.has(i)||F.add(i)}),N.forEach(i=>{T.has(i)||D.add(i)});let h={};Object.keys(Z).forEach(i=>{if(q(Z[i],["object"],`Invalid type for functions["${i}"]`),q(Z[i].args,["array","undefined"],`Invalid type for functions["${i}"].args`),q(Z[i].ref,["string","undefined"],`Invalid type for functions["${i}"].ref`),q(Z[i].throws,["boolean","undefined"],`Invalid type for functions["${i}"].throws`),q(Z[i].inputsTransformation,["string","undefined"],`Invalid type for functions["${i}"].inputsTransformation`),q(Z[i].outputTransformation,["string","undefined"],`Invalid type for functions["${i}"].outputTransformation`),!V(i))throw new TypeError(`Function ${i} not valid. ${Z[i].ref?"The provided ref do not point to a valid function":"The parameter ref is not provided and the function name do not match any valid function"}`);Z[i].args&&(h[i]=Z[i].args)}),Object.keys(h).length===0&&we.forEach(i=>{V(i)&&!T.has(i)&&(h[i]=[])}),Object.keys(te).forEach(i=>{if(q(te[i],["object"],`Invalid type for events["${i}"]`),q(te[i].ref,["string","undefined"],`Invalid type for events["${i}"].ref`),te[i].ref&&(M.has(te[i].ref)||N.has(te[i].ref)))throw new TypeError(`Invalid ref for events["${i}"]. A listener with the same name already exist`);if(q(te[i].once,["boolean","undefined"],`Invalid type for events["${i}"].once`),V(i))throw new TypeError(`Invalid name for events["${i}"]. A function with the same name already exist`)});for(let i of N)g([ne(i)??i],b=>me(i,b[0],!1),null),M.set(ne(i)??i,i);if(q(k.variables,["object","undefined"],"Invalid type for state.variables"),k.variables??={},q(k.variables.global,["object","undefined"],"Invalid type for state.variables.global"),k.variables.global??={},q(k.variables.locals,["array","undefined"],"Invalid type for state.variables.locals"),k.variables.locals??=new Array(x.length).fill(null).map(()=>({})),k.variables.locals.forEach((i,b)=>q(i,["object"],`Invalid type for state.variables.locals[${b}]`)),k.variables.locals.length!=x.length)throw new TypeError(`Invalid length for array state.variables.locals. Expected ${x.length} but provided ${k.variables.locals.length}`);if(q(k.finals,["object","undefined"],"Invalid type for state.finals"),k.finals??={},q(k.finals.connections,["array","undefined"],"Invalid type for state.finals.connections"),k.finals.connections??=new Array(x.length),k.finals.connections.length!=x.length)throw new TypeError(`Invalid length for array state.finals.connections. Expected ${x.length} but provided ${k.finals.connections.length}`);k.finals.connections.forEach((i,b)=>q(i,["array","undefined"],`Invalid type for state.finals.connections[${b}]`)),q(k.finals.events,["object","undefined"],"Invalid type for state.finals.events"),k.finals.events??={};let P=k.finals.events;Object.keys(P).forEach(i=>{if(!F.has(i))throw new TypeError(`Invalid event name in state.finals.events: ${i}`);q(P[i],["array"],`Invalid type for state.finals.events["${i}"]`)}),q(k.finals.functions,["object","undefined"],"Invalid type for state.finals.functions"),k.finals.functions??={};let L=k.finals.functions;Object.keys(L).forEach(i=>{if(!V(i))throw new TypeError(`Invalid function name in state.finals.functions: ${i}`);q(L[i],["array"],`Invalid type for state.finals.functions["${i}"]`)}),q(k.errors,["object","undefined"],"Invalid type for state.errors"),k.errors??={};let c=k.errors;if(Object.keys(k.errors).forEach(i=>{if(!V(i))throw new TypeError(`Invalid function name in state.errors: ${i}`);q(c[i],["array"],`Invalid type for state.errors["${i}"]`)}),q(k.waitings,["array","undefined"],"Invalid type for state.waitings"),k.waitings??=new Array(x.length).fill(null).map(()=>({})),k.waitings.length!=x.length)throw new TypeError(`Invalid length for array state.waitings. Expected ${x.length} but provided ${k.waitings.length}`);k.waitings.forEach((i,b)=>{q(i,["object"],`Invalid type for state.waitings[${b}]`),Object.keys(i).forEach(A=>{let v=A.split(".");if(v[0]==="functions"&&!V(v[1])||v[0]==="events"&&!N.has(v[1]))throw new TypeError(`Invalid name in state.waitings[${b}]: ${A}`);q(i[A],["array"],`Invalid type for state.waitings[${b}]["${A}"]`),v[0]==="events"&&z.has(v[1])&&z.get(v[1]).counter===0&&(z.get(v[1]).counter=i[A].length)})}),q(k.runnings,["array","undefined"],"Invalid type for state.runnings"),k.runnings??=[],k.runnings.forEach((i,b)=>{q(i,["object"],`Invalid type for state.runnings[${b}]`),q(i.id,["string","number"],`Invalid type for state.runnings[${b}].id`),q(i.inputs,["array"],`Invalid type for state.runnings[${b}].inputs`)}),q(k.receiveds,["object","undefined"],"Invalid type for state.receiveds"),k.receiveds??={};let d=k.receiveds;if(Object.keys(k.receiveds).forEach(i=>{if(!M.has(i))throw new TypeError(`Invalid event name in state.receiveds: ${i}`);q(d[i],["array"],`Invalid type for state.receiveds["${i}"]`);let b=M.get(i);z.has(b)&&z.get(b).counter===0&&(z.get(b).counter=d[i].length)}),k.runnings.length>0||k.waitings.map(i=>Object.keys(i).length>0).some(Boolean)||Object.keys(k.errors).length>0||Object.keys(k.finals.functions).length>0||Object.keys(k.finals.events).length>0||k.finals.connections.map(i=>i&&i.length>0).some(Boolean))for(let i of k.runnings)typeof i.id=="string"?fe(i.id,i.inputs,i):xe(i.id,i.inputs,i);else for(let i of Object.keys(h))fe(i,h[i],void 0);for(let[i,b]of x.entries())(b.from??[]).length===0&&xe(i,[],void 0);X()}catch(h){U(!1,{state:k,error:h})}})}};async function Bt(pe,K){let De={},k=N=>{let ue=typeof N;if(ue==="function"||ue==="symbol"){let z=globalThis.crypto.randomUUID();return De[z]=N,z}else if(ue==="object"){if(N===null)return null;let z=Array.isArray(N),oe=z?[]:{};for(let F of z?N:Object.keys(N))z?oe.push(k(F)):oe[F]=k(N[F]);return oe}else return N},be=N=>{let ue=typeof N;if(ue==="string"){for(let z of Object.keys(De))if(N===z)return De[z];return N}else if(ue==="object"){if(N===null)return null;let z=Array.isArray(N),oe=z?[]:{};for(let F of z?N:Object.keys(N))z?oe.push(be(F)):oe[F]=be(N[F]);return oe}else return N},Ge=k(K),we=await(0,St.default)(pe).evaluate(Ge);return be(we)}function q(pe,K,De="Error"){let k=Array.isArray(pe)?"array":typeof pe;if(!(pe===void 0&&K.includes("undefined"))){if(pe==null)throw new TypeError(`${De}. Missing required value`);if(!K.includes(k))throw new TypeError(`${De}. Expected ${K.join(" or ")} but provided ${k}: ${JSON.stringify(pe)}`)}}export{Ot as Orchestrator};
//# sourceMappingURL=index.min.js.map
