var xt=Object.create;var At=Object.defineProperty;var Ut=Object.getOwnPropertyDescriptor;var jt=Object.getOwnPropertyNames;var Mt=Object.getPrototypeOf,It=Object.prototype.hasOwnProperty;var dt=(he=>typeof require<"u"?require:typeof Proxy<"u"?new Proxy(he,{get:(K,De)=>(typeof require<"u"?require:K)[De]}):he)(function(he){if(typeof require<"u")return require.apply(this,arguments);throw Error('Dynamic require of "'+he+'" is not supported')});var Nt=(he,K)=>()=>(K||he((K={exports:{}}).exports,K),K.exports);var Rt=(he,K,De,m)=>{if(K&&typeof K=="object"||typeof K=="function")for(let be of jt(K))!It.call(he,be)&&be!==De&&At(he,be,{get:()=>K[be],enumerable:!(m=Ut(K,be))||m.enumerable});return he};var Lt=(he,K,De)=>(De=he!=null?xt(Mt(he)):{},Rt(K||!he||!he.__esModule?At(De,"default",{value:he,enumerable:!0}):De,he));var Dt=Nt((Tt,wt)=>{(function(he){if(typeof Tt=="object"&&typeof wt<"u")wt.exports=he();else if(typeof define=="function"&&define.amd)define([],he);else{var K;typeof window<"u"?K=window:typeof global<"u"?K=global:typeof self<"u"?K=self:K=this,K.jsonata=he()}})(function(){var he,K,De;return(function(){function m(be,Be,we){function E(z,ne){if(!Be[z]){if(!be[z]){var S=typeof dt=="function"&&dt;if(!ne&&S)return S(z,!0);if(M)return M(z,!0);var w=new Error("Cannot find module '"+z+"'");throw w.code="MODULE_NOT_FOUND",w}var T=Be[z]={exports:{}};be[z][0].call(T.exports,function(j){var _=be[z][1][j];return E(_||j)},T,T.exports,m,be,Be,we)}return Be[z].exports}for(var M=typeof dt=="function"&&dt,ue=0;ue<we.length;ue++)E(we[ue]);return E}return m})()({1:[function(m,be,Be){let we=m("./utils"),E=(function(){"use strict";let M=we.stringToArray,ue=["Zero","One","Two","Three","Four","Five","Six","Seven","Eight","Nine","Ten","Eleven","Twelve","Thirteen","Fourteen","Fifteen","Sixteen","Seventeen","Eighteen","Nineteen"],z=["Zeroth","First","Second","Third","Fourth","Fifth","Sixth","Seventh","Eighth","Ninth","Tenth","Eleventh","Twelfth","Thirteenth","Fourteenth","Fifteenth","Sixteenth","Seventeenth","Eighteenth","Nineteenth"],ne=["Twenty","Thirty","Forty","Fifty","Sixty","Seventy","Eighty","Ninety","Hundred"],S=["Thousand","Million","Billion","Trillion"];function w(l,d){var a=function(k,A,g){var D="";if(k<=19)D=(A?" and ":"")+(g?z[k]:ue[k]);else if(k<100){let oe=Math.floor(k/10),de=k%10;D=(A?" and ":"")+ne[oe-2],de>0?D+="-"+a(de,!1,g):g&&(D=D.substring(0,D.length-1)+"ieth")}else if(k<1e3){let oe=Math.floor(k/100),de=k%100;D=(A?", ":"")+ue[oe]+" Hundred",de>0?D+=a(de,!0,g):g&&(D+="th")}else{var B=Math.floor(Math.log10(k)/3);B>S.length&&(B=S.length);let oe=Math.pow(10,B*3),de=Math.floor(k/oe),G=k-de*oe;D=(A?", ":"")+a(de,!1,!1)+" "+S[B-1],G>0?D+=a(G,!0,g):g&&(D+="th")}return D},y=a(l,!1,d);return y}let T={};ue.forEach(function(l,d){T[l.toLowerCase()]=d}),z.forEach(function(l,d){T[l.toLowerCase()]=d}),ne.forEach(function(l,d){let a=l.toLowerCase();T[a]=(d+2)*10,T[a.substring(0,l.length-1)+"ieth"]=T[a]}),T.hundredth=100,S.forEach(function(l,d){let a=l.toLowerCase(),y=Math.pow(10,(d+1)*3);T[a]=y,T[a+"th"]=y});function j(l){let a=l.split(/,\s|\sand\s|[\s\\-]/).map(A=>T[A]),y=[0];return a.forEach(A=>{if(A<100){let g=y.pop();g>=1e3&&(y.push(g),g=0),y.push(g+A)}else y.push(y.pop()*A)}),y.reduce((A,g)=>A+g,0)}let _=[[1e3,"m"],[900,"cm"],[500,"d"],[400,"cd"],[100,"c"],[90,"xc"],[50,"l"],[40,"xl"],[10,"x"],[9,"ix"],[5,"v"],[4,"iv"],[1,"i"]],re={M:1e3,D:500,C:100,L:50,X:10,V:5,I:1};function Z(l){for(var d=0;d<_.length;d++){let a=_[d];if(l>=a[0])return a[1]+Z(l-a[0])}return""}function I(l){for(var d=0,a=1,y=l.length-1;y>=0;y--){let k=l[y],A=re[k];A<a?d-=A:(a=A,d+=A)}return d}function h(l,d){for(var a=[],y=d.charCodeAt(0);l>0;)a.unshift(String.fromCharCode((l-1)%26+y)),l=Math.floor((l-1)/26);return a.join("")}function J(l,d){for(var a=d.charCodeAt(0),y=0,k=0;k<l.length;k++)y+=(l.charCodeAt(l.length-k-1)-a+1)*Math.pow(26,k);return y}function x(l,d){if(typeof l>"u")return;l=Math.floor(l);let a=ce(d);return F(l,a)}let p={DECIMAL:"decimal",LETTERS:"letters",ROMAN:"roman",WORDS:"words",SEQUENCE:"sequence"},$={UPPER:"upper",LOWER:"lower",TITLE:"title"};function F(l,d){let a,y=l<0;switch(l=Math.abs(l),d.primary){case p.LETTERS:a=h(l,d.case===$.UPPER?"A":"a");break;case p.ROMAN:a=Z(l),d.case===$.UPPER&&(a=a.toUpperCase());break;case p.WORDS:a=w(l,d.ordinal),d.case===$.UPPER?a=a.toUpperCase():d.case===$.LOWER&&(a=a.toLowerCase());break;case p.DECIMAL:a=""+l;var k=d.mandatoryDigits-a.length;if(k>0){var A=new Array(k+1).join("0");a=A+a}if(d.zeroCode!==48&&(a=M(a).map(oe=>String.fromCodePoint(oe.codePointAt(0)+d.zeroCode-48)).join("")),d.regular){let oe=Math.floor((a.length-1)/d.groupingSeparators.position);for(let de=oe;de>0;de--){let G=a.length-de*d.groupingSeparators.position;a=a.substr(0,G)+d.groupingSeparators.character+a.substr(G)}}else d.groupingSeparators.reverse().forEach(oe=>{let de=a.length-oe.position;a=a.substr(0,de)+oe.character+a.substr(de)});if(d.ordinal){var g={1:"st",2:"nd",3:"rd"},D=a[a.length-1],B=g[D];(!B||a.length>1&&a[a.length-2]==="1")&&(B="th"),a=a+B}break;case p.SEQUENCE:throw{code:"D3130",value:d.token}}return y&&(a="-"+a),a}let X=[48,1632,1776,1984,2406,2534,2662,2790,2918,3046,3174,3302,3430,3558,3664,3792,3872,4160,4240,6112,6160,6470,6608,6784,6800,6992,7088,7232,7248,42528,43216,43264,43472,43504,43600,44016,65296];function ce(l){let d={type:"integer",primary:p.DECIMAL,case:$.LOWER,ordinal:!1},a,y,k=l.lastIndexOf(";");switch(k===-1?a=l:(a=l.substring(0,k),y=l.substring(k+1),y[0]==="o"&&(d.ordinal=!0)),a){case"A":d.case=$.UPPER;case"a":d.primary=p.LETTERS;break;case"I":d.case=$.UPPER;case"i":d.primary=p.ROMAN;break;case"W":d.case=$.UPPER,d.primary=p.WORDS;break;case"Ww":d.case=$.TITLE,d.primary=p.WORDS;break;case"w":d.primary=p.WORDS;break;default:{let A=null,g=0,D=0,B=[],oe=0;if(M(a).map(G=>G.codePointAt(0)).reverse().forEach(G=>{let q=!1;for(let ie=0;ie<X.length;ie++){let L=X[ie];if(G>=L&&G<=L+9){if(q=!0,g++,oe++,A===null)A=L;else if(L!==A)throw{code:"D3131"};break}}q||(G===35?(oe++,D++):B.push({position:oe,character:String.fromCodePoint(G)}))}),g>0){d.primary=p.DECIMAL,d.zeroCode=A,d.mandatoryDigits=g,d.optionalDigits=D;let q=function(ie){if(ie.length===0)return 0;let L=ie[0].character;for(let Fe=1;Fe<ie.length;Fe++)if(ie[Fe].character!==L)return 0;let $e=ie.map(Fe=>Fe.position),Ye=function(Fe,Ne){return Ne===0?Fe:Ye(Ne,Fe%Ne)},Ie=$e.reduce(Ye);for(let Fe=1;Fe<=$e.length;Fe++)if($e.indexOf(Fe*Ie)===-1)return 0;return Ie}(B);q>0?(d.regular=!0,d.groupingSeparators={position:q,character:B[0].character}):(d.regular=!1,d.groupingSeparators=B)}else d.primary=p.SEQUENCE,d.token=a}}return d}let se={Y:"1",M:"1",D:"1",d:"1",F:"n",W:"1",w:"1",X:"1",x:"1",H:"1",h:"1",P:"n",m:"01",s:"01",f:"1",Z:"01:01",z:"01:01",C:"n",E:"n"};function le(l){var d=[];let a={type:"datetime",parts:d},y=function(q,ie){if(ie>q){let L=l.substring(q,ie);L=L.split("]]").join("]"),d.push({type:"literal",value:L})}};for(var k=0,A=0;A<l.length;){if(l.charAt(A)==="["){if(l.charAt(A+1)==="["){y(k,A),d.push({type:"literal",value:"["}),A+=2,k=A;continue}if(y(k,A),k=A,A=l.indexOf("]",k),A===-1)throw{code:"D3135"};let q=l.substring(k+1,A);q=q.split(/\s+/).join("");var g={type:"marker",component:q.charAt(0)},D=q.lastIndexOf(","),B;if(D!==-1){let ie=q.substring(D+1),L=ie.indexOf("-"),$e,Ye,Ie=function(Ne){if(!(typeof Ne>"u"||Ne==="*"))return parseInt(Ne)};L===-1?$e=ie:($e=ie.substring(0,L),Ye=ie.substring(L+1));let Fe={min:Ie($e),max:Ie(Ye)};g.width=Fe,B=q.substring(1,D)}else B=q.substring(1);if(B.length===1)g.presentation1=B;else if(B.length>1){var oe=B.charAt(B.length-1);"atco".indexOf(oe)!==-1?(g.presentation2=oe,oe==="o"&&(g.ordinal=!0),g.presentation1=B.substring(0,B.length-1)):g.presentation1=B}else g.presentation1=se[g.component];if(typeof g.presentation1>"u")throw{code:"D3132",value:g.component};if(g.presentation1[0]==="n")g.names=$.LOWER;else if(g.presentation1[0]==="N")g.presentation1[1]==="n"?g.names=$.TITLE:g.names=$.UPPER;else if("YMDdFWwXxHhmsf".indexOf(g.component)!==-1){var de=g.presentation1;if(g.presentation2&&(de+=";"+g.presentation2),g.integerFormat=ce(de),g.width&&g.width.min!==void 0&&g.integerFormat.mandatoryDigits<g.width.min&&(g.integerFormat.mandatoryDigits=g.width.min),g.component==="Y")if(g.n=-1,g.width&&g.width.max!==void 0)g.n=g.width.max,g.integerFormat.mandatoryDigits=g.n;else{var G=g.integerFormat.mandatoryDigits+g.integerFormat.optionalDigits;G>=2&&(g.n=G)}let ie=d[d.length-1];ie&&ie.integerFormat&&(ie.integerFormat.parseWidth=ie.integerFormat.mandatoryDigits)}(g.component==="Z"||g.component==="z")&&(g.integerFormat=ce(g.presentation1)),d.push(g),k=A+1}A++}return y(k,A),a}let te=["","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"],me=["January","February","March","April","May","June","July","August","September","October","November","December"],xe=1e3*60*60*24,fe=function(l){let d=Date.UTC(l.year,l.month);var a=new Date(d).getUTCDay();return a===0&&(a=7),a>4?d+(8-a)*xe:d-(a-1)*xe},Q=function(l,d){return{year:l,month:d,nextMonth:function(){return d===11?Q(l+1,0):Q(l,d+1)},previousMonth:function(){return d===0?Q(l-1,11):Q(l,d-1)},nextYear:function(){return Q(l+1,d)},previousYear:function(){return Q(l-1,d)}}},Ue=function(l,d){return(d-l)/(xe*7)+1},H=(l,d)=>{let a;switch(d){case"Y":a=l.getUTCFullYear();break;case"M":a=l.getUTCMonth()+1;break;case"D":a=l.getUTCDate();break;case"d":{let y=Date.UTC(l.getUTCFullYear(),l.getUTCMonth(),l.getUTCDate()),k=Date.UTC(l.getUTCFullYear(),0);a=(y-k)/xe+1;break}case"F":a=l.getUTCDay(),a===0&&(a=7);break;case"W":{let y=Q(l.getUTCFullYear(),0),k=fe(y),A=Date.UTC(y.year,l.getUTCMonth(),l.getUTCDate()),g=Ue(k,A);if(g>52){let D=fe(y.nextYear());A>=D&&(g=1)}else if(g<1){let D=fe(y.previousYear());g=Ue(D,A)}a=Math.floor(g);break}case"w":{let y=Q(l.getUTCFullYear(),l.getUTCMonth()),k=fe(y),A=Date.UTC(y.year,y.month,l.getUTCDate()),g=Ue(k,A);if(g>4){let D=fe(y.nextMonth());A>=D&&(g=1)}else if(g<1){let D=fe(y.previousMonth());g=Ue(D,A)}a=Math.floor(g);break}case"X":{let y=Q(l.getUTCFullYear(),0),k=fe(y),A=fe(y.nextYear()),g=l.getTime();g<k?a=y.year-1:g>=A?a=y.year+1:a=y.year;break}case"x":{let y=Q(l.getUTCFullYear(),l.getUTCMonth()),k=fe(y),A=y.nextMonth(),g=fe(A),D=l.getTime();D<k?a=y.previousMonth().month+1:D>=g?a=A.month+1:a=y.month+1;break}case"H":a=l.getUTCHours();break;case"h":a=l.getUTCHours(),a=a%12,a===0&&(a=12);break;case"P":a=l.getUTCHours()>=12?"pm":"am";break;case"m":a=l.getUTCMinutes();break;case"s":a=l.getUTCSeconds();break;case"f":a=l.getUTCMilliseconds();break;case"Z":case"z":break;case"C":a="ISO";break;case"E":a="ISO";break}return a},ke=null;function Ge(l,d,a){var y=0,k=0;if(typeof a<"u"){let de=parseInt(a);y=Math.floor(de/100),k=de%100}var A=function(de,G){var q=H(de,G.component);if("YMDdFWwXxHhms".indexOf(G.component)!==-1)if(G.component==="Y"&&G.n!==-1&&(q=q%Math.pow(10,G.n)),G.names){if(G.component==="M"||G.component==="x")q=me[q-1];else if(G.component==="F")q=te[q];else throw{code:"D3133",value:G.component};G.names===$.UPPER?q=q.toUpperCase():G.names===$.LOWER&&(q=q.toLowerCase()),G.width&&q.length>G.width.max&&(q=q.substring(0,G.width.max))}else q=F(q,G.integerFormat);else if(G.component==="f")q=F(q,G.integerFormat);else if(G.component==="Z"||G.component==="z"){let ie=y*100+k;if(G.integerFormat.regular)q=F(ie,G.integerFormat);else{let L=G.integerFormat.mandatoryDigits;if(L===1||L===2)q=F(y,G.integerFormat),k!==0&&(q+=":"+x(k,"00"));else if(L===3||L===4)q=F(ie,G.integerFormat);else throw{code:"D3134",value:L}}ie>=0&&(q="+"+q),G.component==="z"&&(q="GMT"+q),ie===0&&G.presentation2==="t"&&(q="Z")}else G.component==="P"&&G.names===$.UPPER&&(q=q.toUpperCase());return q};let g;typeof d>"u"?(ke===null&&(ke=le("[Y0001]-[M01]-[D01]T[H01]:[m01]:[s01].[f001][Z01:01t]")),g=ke):g=le(d);let D=(60*y+k)*60*1e3,B=new Date(l+D),oe="";return g.parts.forEach(function(de){de.type==="literal"?oe+=de.value:oe+=A(B,de)}),oe}function o(l){var d={};if(l.type==="datetime")d.type="datetime",d.parts=l.parts.map(function(a){var y={};if(a.type==="literal")y.regex=a.value.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");else if(a.component==="Z"||a.component==="z"){let A;Array.isArray(a.integerFormat.groupingSeparators)||(A=a.integerFormat.groupingSeparators),y.regex="",a.component==="z"&&(y.regex="GMT"),y.regex+="[-+][0-9]+",A&&(y.regex+=A.character+"[0-9]+"),y.parse=function(g){a.component==="z"&&(g=g.substring(3));let D=0,B=0;return A?(D=Number.parseInt(g.substring(0,g.indexOf(A.character))),B=Number.parseInt(g.substring(g.indexOf(A.character)+1))):g.length-1<=2?D=Number.parseInt(g):(D=Number.parseInt(g.substring(0,3)),B=Number.parseInt(g.substring(3))),D*60+B}}else if(a.integerFormat)y=o(a.integerFormat);else{y.regex="[a-zA-Z]+";var k={};if(a.component==="M"||a.component==="x")me.forEach(function(A,g){a.width&&a.width.max?k[A.substring(0,a.width.max)]=g+1:k[A]=g+1});else if(a.component==="F")te.forEach(function(A,g){g>0&&(a.width&&a.width.max?k[A.substring(0,a.width.max)]=g:k[A]=g)});else if(a.component==="P")k={am:0,AM:0,pm:1,PM:1};else throw{code:"D3133",value:a.component};y.parse=function(A){return k[A]}}return y.component=a.component,y});else{d.type="integer";let a=l.case===$.UPPER;switch(l.primary){case p.LETTERS:d.regex=a?"[A-Z]+":"[a-z]+",d.parse=function(y){return J(y,a?"A":"a")};break;case p.ROMAN:d.regex=a?"[MDCLXVI]+":"[mdclxvi]+",d.parse=function(y){return I(a?y:y.toUpperCase())};break;case p.WORDS:d.regex="(?:"+Object.keys(T).concat("and","[\\-, ]").join("|")+")+",d.parse=function(y){return j(y.toLowerCase())};break;case p.DECIMAL:d.regex="[0-9]",l.parseWidth?d.regex+=`{${l.parseWidth}}`:d.regex+="+",l.ordinal&&(d.regex+="(?:th|st|nd|rd)"),d.parse=function(y){let k=y;return l.ordinal&&(k=y.substring(0,y.length-2)),l.regular?k=k.split(",").join(""):l.groupingSeparators.forEach(A=>{k=k.split(A.character).join("")}),l.zeroCode!==48&&(k=k.split("").map(A=>String.fromCodePoint(A.codePointAt(0)-l.zeroCode+48)).join("")),parseInt(k)};break;case p.SEQUENCE:throw{code:"D3130",value:l.token}}}return d}function n(l,d){if(typeof l>"u")return;let a=ce(d);return o(a).parse(l)}function b(l,d){let a=le(d),y=o(a),k="^"+y.parts.map(B=>"("+B.regex+")").join("")+"$";var g=new RegExp(k,"i").exec(l);if(g!==null){let L={};for(let ye=1;ye<g.length;ye++){let r=y.parts[ye-1];r.parse&&(L[r.component]=r.parse(g[ye]))}if(Object.getOwnPropertyNames(L).length===0)return;let $e=0,Ye=ye=>{$e<<=1,$e+=ye?1:0},Ie=ye=>!(~ye&$e)&&!!(ye&$e);"YXMxWwdD".split("").forEach(ye=>Ye(L[ye]));let Ne=!Ie(161)&&Ie(130),Xe=Ie(84),Ke=!Xe&&Ie(72);$e=0,"PHhmsf".split("").forEach(ye=>Ye(L[ye]));let et=!Ie(23)&&Ie(47),ft=(Ne?"YD":Xe?"XxwF":Ke?"XWF":"YMD")+(et?"Phmsf":"Hmsf"),Je=this.environment.timestamp,it=!1,Ze=!1;if(ft.split("").forEach(ye=>{if(typeof L[ye]>"u")it?(L[ye]="MDd".indexOf(ye)!==-1?1:0,Ze=!0):L[ye]=H(Je,ye);else if(it=!0,Ze)throw{code:"D3136"}}),L.M>0?L.M-=1:L.M=0,Ne){let ye=Date.UTC(L.Y,0),r=(L.d-1)*1e3*60*60*24,s=new Date(ye+r);L.M=s.getUTCMonth(),L.D=s.getUTCDate()}if(Xe)throw{code:"D3136"};if(Ke)throw{code:"D3136"};et&&(L.H=L.h===12?0:L.h,L.P===1&&(L.H+=12));var D=Date.UTC(L.Y,L.M,L.D,L.H,L.m,L.s,L.f);return(L.Z||L.z)&&(D-=(L.Z||L.z)*60*1e3),D}}var U=new RegExp("^\\d{4}(-[01]\\d)*(-[0-3]\\d)*(T[0-2]\\d:[0-5]\\d:[0-5]\\d)*(\\.\\d+)?([+-][0-2]\\d:?[0-5]\\d|Z)?$");function N(l,d){if(!(typeof l>"u"))if(typeof d>"u"){if(!U.test(l))throw{stack:new Error().stack,code:"D3110",value:l};return Date.parse(l)}else return b.call(this,l,d)}function P(l,d,a){if(!(typeof l>"u"))return Ge.call(this,l,d,a)}return{formatInteger:x,parseInteger:n,fromMillis:P,toMillis:N}})();be.exports=E},{"./utils":6}],2:[function(m,be,Be){(function(we){(function(){var E=m("./utils");let M=(()=>{"use strict";var ue=E.isNumeric,z=E.isArrayOfStrings,ne=E.isArrayOfNumbers,S=E.createSequence,w=E.isSequence,T=E.isFunction,j=E.isLambda,_=E.isPromise,re=E.getFunctionArity,Z=E.isDeepEqual,I=E.stringToArray;function h(e){if(!(typeof e>"u")){var t=0;return e.forEach(function(i){t+=i}),t}}function J(e){return typeof e>"u"?0:e.length}function x(e){if(!(typeof e>"u"||e.length===0))return Math.max.apply(Math,e)}function p(e){if(!(typeof e>"u"||e.length===0))return Math.min.apply(Math,e)}function $(e){if(!(typeof e>"u"||e.length===0)){var t=0;return e.forEach(function(i){t+=i}),t/e.length}}function F(e,t=!1){if(!(typeof e>"u")){var i;if(typeof e=="string")i=e;else if(T(e))i="";else{if(typeof e=="number"&&!isFinite(e))throw{code:"D3001",value:e,stack:new Error().stack};var c=t?2:0;Array.isArray(e)&&e.outerWrapper&&(e=e[0]),i=JSON.stringify(e,function(u,v){return typeof v<"u"&&v!==null&&v.toPrecision&&ue(v)?Number(v.toPrecision(15)):v&&T(v)?"":v},c)}return i}}function X(e,t,i){if(!(typeof e>"u")){var c=I(e),u=c.length;if(u+t<0&&(t=0),typeof i<"u"){if(i<=0)return"";var v=t>=0?t+i:u+t+i;return c.slice(t,v).join("")}return c.slice(t).join("")}}function ce(e,t){if(!(typeof e>"u")){var i=e.indexOf(t);return i>-1?e.substr(0,i):e}}function se(e,t){if(!(typeof e>"u")){var i=e.indexOf(t);return i>-1?e.substr(i+t.length):e}}function le(e){if(!(typeof e>"u"))return e.toLowerCase()}function te(e){if(!(typeof e>"u"))return e.toUpperCase()}function me(e){if(!(typeof e>"u"))return I(e).length}function xe(e){if(!(typeof e>"u")){var t=e.replace(/[ \t\n\r]+/gm," ");return t.charAt(0)===" "&&(t=t.substring(1)),t.charAt(t.length-1)===" "&&(t=t.substring(0,t.length-1)),t}}function fe(e,t,i){if(!(typeof e>"u")){(typeof i>"u"||i.length===0)&&(i=" ");var c;t=Math.trunc(t);var u=Math.abs(t)-me(e);if(u>0){var v=new Array(u+1).join(i);i.length>1&&(v=X(v,0,u)),t>0?c=e+v:c=v+e}else c=e;return c}}async function Q(e,t){var i=e.apply(this,[t]);if(_(i)&&(i=await i),i&&!(typeof i.start=="number"||i.end==="number"||Array.isArray(i.groups)||T(i.next)))throw{code:"T1010",stack:new Error().stack};return i}async function Ue(e,t){if(!(typeof e>"u")){var i;if(typeof t=="string")i=e.indexOf(t)!==-1;else{var c=await Q(t,e);i=typeof c<"u"}return i}}async function H(e,t,i){if(!(typeof e>"u")){if(i<0)throw{stack:new Error().stack,value:i,code:"D3040",index:3};var c=S();if(typeof i>"u"||i>0){var u=0,v=await Q(t,e);if(typeof v<"u")for(;typeof v<"u"&&(typeof i>"u"||u<i);)c.push({match:v.match,index:v.start,groups:v.groups}),v=await Q(v.next),u++}return c}}async function ke(e,t,i,c){if(!(typeof e>"u")){var u=this;if(t==="")throw{code:"D3010",stack:new Error().stack,value:t,index:2};if(c<0)throw{code:"D3011",stack:new Error().stack,value:c,index:4};var v;typeof i=="string"?v=function(ve){for(var Ce="",pe=0,Oe=i.indexOf("$",pe);Oe!==-1&&pe<i.length;){Ce+=i.substring(pe,Oe),pe=Oe+1;var He=i.charAt(pe);if(He==="$")Ce+="$",pe++;else if(He==="0")Ce+=ve.match,pe++;else{var je;if(ve.groups.length===0?je=1:je=Math.floor(Math.log(ve.groups.length)*Math.LOG10E)+1,Oe=parseInt(i.substring(pe,pe+je),10),je>1&&Oe>ve.groups.length&&(Oe=parseInt(i.substring(pe,pe+je-1),10)),isNaN(Oe))Ce+="$";else{if(ve.groups.length>0){var at=ve.groups[Oe-1];typeof at<"u"&&(Ce+=at)}pe+=Oe.toString().length}}Oe=i.indexOf("$",pe)}return Ce+=i.substring(pe),Ce}:v=i;var O="",R=0;if(typeof c>"u"||c>0){var W=0;if(typeof t=="string"){for(var ge=e.indexOf(t,R);ge!==-1&&(typeof c>"u"||W<c);)O+=e.substring(R,ge),O+=i,R=ge+t.length,W++,ge=e.indexOf(t,R);O+=e.substring(R)}else{var ae=await Q(t,e);if(typeof ae<"u"){for(;typeof ae<"u"&&(typeof c>"u"||W<c);){O+=e.substring(R,ae.start);var Ee=v.apply(u,[ae]);if(_(Ee)&&(Ee=await Ee),typeof Ee=="string")O+=Ee;else throw{code:"D3012",stack:new Error().stack,value:Ee};R=ae.start+ae.match.length,W++,ae=await Q(ae.next)}O+=e.substring(R)}else O=e}}else O=e;return O}}function Ge(e){if(!(typeof e>"u")){var t=typeof window<"u"?window.btoa:function(i){return new we.Buffer.from(i,"binary").toString("base64")};return t(e)}}function o(e){if(!(typeof e>"u")){var t=typeof window<"u"?window.atob:function(i){return new we.Buffer.from(i,"base64").toString("binary")};return t(e)}}function n(e){if(!(typeof e>"u")){var t;try{t=encodeURIComponent(e)}catch{throw{code:"D3140",stack:new Error().stack,value:e,functionName:"encodeUrlComponent"}}return t}}function b(e){if(!(typeof e>"u")){var t;try{t=encodeURI(e)}catch{throw{code:"D3140",stack:new Error().stack,value:e,functionName:"encodeUrl"}}return t}}function U(e){if(!(typeof e>"u")){var t;try{t=decodeURIComponent(e)}catch{throw{code:"D3140",stack:new Error().stack,value:e,functionName:"decodeUrlComponent"}}return t}}function N(e){if(!(typeof e>"u")){var t;try{t=decodeURI(e)}catch{throw{code:"D3140",stack:new Error().stack,value:e,functionName:"decodeUrl"}}return t}}async function P(e,t,i){if(!(typeof e>"u")){if(i<0)throw{code:"D3020",stack:new Error().stack,value:i,index:3};var c=[];if(typeof i>"u"||i>0)if(typeof t=="string")c=e.split(t,i);else{var u=0,v=await Q(t,e);if(typeof v<"u"){for(var O=0;typeof v<"u"&&(typeof i>"u"||u<i);)c.push(e.substring(O,v.start)),O=v.end,v=await Q(v.next),u++;(typeof i>"u"||u<i)&&c.push(e.substring(O))}else c.push(e)}return c}}function l(e,t){if(!(typeof e>"u"))return typeof t>"u"&&(t=""),e.join(t)}function d(e,t,i){if(!(typeof e>"u")){var c={"decimal-separator":".","grouping-separator":",","exponent-separator":"e",infinity:"Infinity","minus-sign":"-",NaN:"NaN",percent:"%","per-mille":"\u2030","zero-digit":"0",digit:"#","pattern-separator":";"},u=c;typeof i<"u"&&Object.keys(i).forEach(function(V){u[V]=i[V]});for(var v=[],O=u["zero-digit"].charCodeAt(0),R=O;R<O+10;R++)v.push(String.fromCharCode(R));var W=v.concat([u["decimal-separator"],u["exponent-separator"],u["grouping-separator"],u.digit,u["pattern-separator"]]),ge=t.split(u["pattern-separator"]);if(ge.length>2)throw{code:"D3080",stack:new Error().stack};var ae=function(V){var Te=(function(){for(var Pe,qe=0;qe<V.length;qe++)if(Pe=V.charAt(qe),W.indexOf(Pe)!==-1&&Pe!==u["exponent-separator"])return V.substring(0,qe)})(),Le=(function(){for(var Pe,qe=V.length-1;qe>=0;qe--)if(Pe=V.charAt(qe),W.indexOf(Pe)!==-1&&Pe!==u["exponent-separator"])return V.substring(qe+1)})(),Ae=V.substring(Te.length,V.length-Le.length),ze,tt,We,rt,_e=V.indexOf(u["exponent-separator"],Te.length);_e===-1||_e>V.length-Le.length?(ze=Ae,tt=void 0):(ze=Ae.substring(0,_e),tt=Ae.substring(_e+1));var Ve=ze.indexOf(u["decimal-separator"]);return Ve===-1?(We=ze,rt=Le):(We=ze.substring(0,Ve),rt=ze.substring(Ve+1)),{prefix:Te,suffix:Le,activePart:Ae,mantissaPart:ze,exponentPart:tt,integerPart:We,fractionalPart:rt,subpicture:V}},Ee=function(V){var Te,Le,Ae=V.subpicture,ze=Ae.indexOf(u["decimal-separator"]);ze!==Ae.lastIndexOf(u["decimal-separator"])&&(Te="D3081"),Ae.indexOf(u.percent)!==Ae.lastIndexOf(u.percent)&&(Te="D3082"),Ae.indexOf(u["per-mille"])!==Ae.lastIndexOf(u["per-mille"])&&(Te="D3083"),Ae.indexOf(u.percent)!==-1&&Ae.indexOf(u["per-mille"])!==-1&&(Te="D3084");var tt=!1;for(Le=0;Le<V.mantissaPart.length;Le++){var We=V.mantissaPart.charAt(Le);if(v.indexOf(We)!==-1||We===u.digit){tt=!0;break}}tt||(Te="D3085");var rt=V.activePart.split("").map(function(Pe){return W.indexOf(Pe)===-1?"p":"a"}).join("");rt.indexOf("p")!==-1&&(Te="D3086"),ze!==-1?(Ae.charAt(ze-1)===u["grouping-separator"]||Ae.charAt(ze+1)===u["grouping-separator"])&&(Te="D3087"):V.integerPart.charAt(V.integerPart.length-1)===u["grouping-separator"]&&(Te="D3088"),Ae.indexOf(u["grouping-separator"]+u["grouping-separator"])!==-1&&(Te="D3089");var _e=V.integerPart.indexOf(u.digit);_e!==-1&&V.integerPart.substring(0,_e).split("").filter(function(Pe){return v.indexOf(Pe)>-1}).length>0&&(Te="D3090"),_e=V.fractionalPart.lastIndexOf(u.digit),_e!==-1&&V.fractionalPart.substring(_e).split("").filter(function(Pe){return v.indexOf(Pe)>-1}).length>0&&(Te="D3091");var Ve=typeof V.exponentPart=="string";if(Ve&&V.exponentPart.length>0&&(Ae.indexOf(u.percent)!==-1||Ae.indexOf(u["per-mille"])!==-1)&&(Te="D3092"),Ve&&(V.exponentPart.length===0||V.exponentPart.split("").filter(function(Pe){return v.indexOf(Pe)===-1}).length>0)&&(Te="D3093"),Te)throw{code:Te,stack:new Error().stack}},ve=function(V){var Te=function(Me,gt){for(var lt=[],Qe=Me.indexOf(u["grouping-separator"]);Qe!==-1;){var bt=(gt?Me.substring(0,Qe):Me.substring(Qe)).split("").filter(function(st){return v.indexOf(st)!==-1||st===u.digit}).length;lt.push(bt),Qe=V.integerPart.indexOf(u["grouping-separator"],Qe+1)}return lt},Le=Te(V.integerPart),Ae=function(Me){if(Me.length===0)return 0;for(var gt=function(bt,st){return st===0?bt:gt(st,bt%st)},lt=Me.reduce(gt),Qe=1;Qe<=Me.length;Qe++)if(Me.indexOf(Qe*lt)===-1)return 0;return lt},ze=Ae(Le),tt=Te(V.fractionalPart,!0),We=V.integerPart.split("").filter(function(Me){return v.indexOf(Me)!==-1}).length,rt=We,_e=V.fractionalPart.split(""),Ve=_e.filter(function(Me){return v.indexOf(Me)!==-1}).length,Pe=_e.filter(function(Me){return v.indexOf(Me)!==-1||Me===u.digit}).length,qe=typeof V.exponentPart=="string";We===0&&Pe===0&&(qe?(Ve=1,Pe=1):We=1),qe&&We===0&&V.integerPart.indexOf(u.digit)!==-1&&(We=1),We===0&&Ve===0&&(Ve=1);var Et=0;return qe&&(Et=V.exponentPart.split("").filter(function(Me){return v.indexOf(Me)!==-1}).length),{integerPartGroupingPositions:Le,regularGrouping:ze,minimumIntegerPartSize:We,scalingFactor:rt,prefix:V.prefix,fractionalPartGroupingPositions:tt,minimumFactionalPartSize:Ve,maximumFactionalPartSize:Pe,minimumExponentSize:Et,suffix:V.suffix,picture:V.subpicture}},Ce=ge.map(ae);Ce.forEach(Ee);var pe=Ce.map(ve),Oe=u["minus-sign"],He=u["zero-digit"],je=u["decimal-separator"],at=u["grouping-separator"];pe.length===1&&(pe.push(JSON.parse(JSON.stringify(pe[0]))),pe[1].prefix=Oe+pe[1].prefix);var Se;e>=0?Se=pe[0]:Se=pe[1];var ut;Se.picture.indexOf(u.percent)!==-1?ut=e*100:Se.picture.indexOf(u["per-mille"])!==-1?ut=e*1e3:ut=e;var nt,ot;if(Se.minimumExponentSize===0)nt=ut;else{var Ft=Math.pow(10,Se.scalingFactor),Pt=Math.pow(10,Se.scalingFactor-1);for(nt=ut,ot=0;nt<Pt;)nt*=10,ot-=1;for(;nt>Ft;)nt/=10,ot+=1}var $t=D(nt,Se.maximumFactionalPartSize),mt=function(V,Te){var Le=Math.abs(V).toFixed(Te);return He!=="0"&&(Le=Le.split("").map(function(Ae){return Ae>="0"&&Ae<="9"?v[Ae.charCodeAt(0)-48]:Ae}).join("")),Le},ee=mt($t,Se.maximumFactionalPartSize),Re=ee.indexOf(".");for(Re===-1?ee=ee+je:ee=ee.replace(".",je);ee.charAt(0)===He;)ee=ee.substring(1);for(;ee.charAt(ee.length-1)===He;)ee=ee.substring(0,ee.length-1);Re=ee.indexOf(je);var ct=Se.minimumIntegerPartSize-Re,kt=Se.minimumFactionalPartSize-(ee.length-Re-1);if(ee=(ct>0?new Array(ct+1).join(He):"")+ee,ee=ee+(kt>0?new Array(kt+1).join(He):""),Re=ee.indexOf(je),Se.regularGrouping>0)for(var Ct=Math.floor((Re-1)/Se.regularGrouping),vt=1;vt<=Ct;vt++)ee=[ee.slice(0,Re-vt*Se.regularGrouping),at,ee.slice(Re-vt*Se.regularGrouping)].join("");else Se.integerPartGroupingPositions.forEach(function(V){ee=[ee.slice(0,Re-V),at,ee.slice(Re-V)].join(""),Re++});if(Re=ee.indexOf(je),Se.fractionalPartGroupingPositions.forEach(function(V){ee=[ee.slice(0,V+Re+1),at,ee.slice(V+Re+1)].join("")}),Re=ee.indexOf(je),(Se.picture.indexOf(je)===-1||Re===ee.length-1)&&(ee=ee.substring(0,ee.length-1)),typeof ot<"u"){var yt=mt(ot,0);ct=Se.minimumExponentSize-yt.length,ct>0&&(yt=new Array(ct+1).join(He)+yt),ee=ee+u["exponent-separator"]+(ot<0?Oe:"")+yt}return ee=Se.prefix+ee+Se.suffix,ee}}function a(e,t){if(!(typeof e>"u")){if(e=D(e),typeof t>"u"?t=10:t=D(t),t<2||t>36)throw{code:"D3100",stack:new Error().stack,value:t};var i=e.toString(t);return i}}function y(e){var t;if(!(typeof e>"u")){if(typeof e=="number")t=e;else if(typeof e=="string"&&/^-?[0-9]+(\.[0-9]+)?([Ee][-+]?[0-9]+)?$/.test(e)&&!isNaN(parseFloat(e))&&isFinite(e))t=parseFloat(e);else if(typeof e=="string"&&/^(0[xX][0-9A-Fa-f]+)|(0[oO][0-7]+)|(0[bB][0-1]+)$/.test(e))t=Number(e);else if(e===!0)t=1;else if(e===!1)t=0;else throw{code:"D3030",value:e,stack:new Error().stack,index:1};return t}}function k(e){var t;if(!(typeof e>"u"))return t=Math.abs(e),t}function A(e){var t;if(!(typeof e>"u"))return t=Math.floor(e),t}function g(e){var t;if(!(typeof e>"u"))return t=Math.ceil(e),t}function D(e,t){var i;if(!(typeof e>"u")){if(t){var c=e.toString().split("e");e=+(c[0]+"e"+(c[1]?+c[1]+t:t))}i=Math.round(e);var u=i-e;return Math.abs(u)===.5&&Math.abs(i%2)===1&&(i=i-1),t&&(c=i.toString().split("e"),i=+(c[0]+"e"+(c[1]?+c[1]-t:-t))),Object.is(i,-0)&&(i=0),i}}function B(e){var t;if(!(typeof e>"u")){if(e<0)throw{stack:new Error().stack,code:"D3060",index:1,value:e};return t=Math.sqrt(e),t}}function oe(e,t){var i;if(!(typeof e>"u")){if(i=Math.pow(e,t),!isFinite(i))throw{stack:new Error().stack,code:"D3061",index:1,value:e,exp:t};return i}}function de(){return Math.random()}function G(e){if(!(typeof e>"u")){var t=!1;if(Array.isArray(e)){if(e.length===1)t=G(e[0]);else if(e.length>1){var i=e.filter(function(c){return G(c)});t=i.length>0}}else typeof e=="string"?e.length>0&&(t=!0):ue(e)?e!==0&&(t=!0):e!==null&&typeof e=="object"&&!T(e)?Object.keys(e).length>0&&(t=!0):typeof e=="boolean"&&e===!0&&(t=!0);return t}}function q(e){if(!(typeof e>"u"))return!G(e)}function ie(e,t,i,c){var u=[t],v=re(e);return v>=2&&u.push(i),v>=3&&u.push(c),u}async function L(e,t){if(!(typeof e>"u")){for(var i=S(),c=0;c<e.length;c++){var u=ie(t,e[c],c,e),v=await t.apply(this,u);typeof v<"u"&&i.push(v)}return i}}async function $e(e,t){if(!(typeof e>"u")){for(var i=S(),c=0;c<e.length;c++){var u=e[c],v=ie(t,u,c,e),O=await t.apply(this,v);G(O)&&i.push(u)}return i}}async function Ye(e,t){if(!(typeof e>"u")){for(var i=!1,c,u=0;u<e.length;u++){var v=e[u],O=!0;if(typeof t<"u"){var R=ie(t,v,u,e),W=await t.apply(this,R);O=G(W)}if(O)if(!i)c=v,i=!0;else throw{stack:new Error().stack,code:"D3138",index:u}}if(!i)throw{stack:new Error().stack,code:"D3139"};return c}}function Ie(){for(var e=[],t=Array.prototype.slice.call(arguments),i=Math.min.apply(Math,t.map(function(v){return Array.isArray(v)?v.length:0})),c=0;c<i;c++){var u=t.map(v=>v[c]);e.push(u)}return e}async function Fe(e,t,i){if(!(typeof e>"u")){var c,u=re(t);if(u<2)throw{stack:new Error().stack,code:"D3050",index:1};var v;for(typeof i>"u"&&e.length>0?(c=e[0],v=1):(c=i,v=0);v<e.length;){var O=[c,e[v]];u>=3&&O.push(v),u>=4&&O.push(e),c=await t.apply(this,O),v++}return c}}function Ne(e){var t=S();if(Array.isArray(e)){var i={};e.forEach(function(c){var u=Ne(c);u.forEach(function(v){i[v]=!0})}),t=Ne(i)}else e!==null&&typeof e=="object"&&!T(e)&&Object.keys(e).forEach(c=>t.push(c));return t}function Xe(e,t){var i;if(Array.isArray(e)){i=S();for(var c=0;c<e.length;c++){var u=Xe(e[c],t);typeof u<"u"&&(Array.isArray(u)?u.forEach(v=>i.push(v)):i.push(u))}}else e!==null&&typeof e=="object"&&!T(e)&&(i=e[t]);return i}function Ke(e,t){return typeof e>"u"?t:typeof t>"u"?e:(Array.isArray(e)||(e=S(e)),Array.isArray(t)||(t=[t]),e.concat(t))}function pt(e){return!(typeof e>"u")}function et(e){var t=S();if(Array.isArray(e))e.forEach(function(u){t=Ke(t,et(u))});else if(e!==null&&typeof e=="object"&&!j(e))for(var i in e){var c={};c[i]=e[i],t.push(c)}else t=e;return t}function C(e){if(!(typeof e>"u")){var t={};return e.forEach(function(i){for(var c in i)t[c]=i[c]}),t}}function ht(e){if(!(typeof e>"u")){if(e.length<=1)return e;for(var t=e.length,i=new Array(t),c=0;c<t;c++)i[t-c-1]=e[c];return i}}async function ft(e,t){var i=S();for(var c in e){var u=ie(t,e[c],c,e),v=await t.apply(this,u);typeof v<"u"&&i.push(v)}return i}function Je(e){throw{code:"D3137",stack:new Error().stack,message:e||"$error() function evaluated"}}function it(e,t){if(!e)throw{code:"D3141",stack:new Error().stack,message:t||"$assert() statement failed"}}function Ze(e){if(e!==void 0)return e===null?"null":ue(e)?"number":typeof e=="string"?"string":typeof e=="boolean"?"boolean":Array.isArray(e)?"array":T(e)?"function":"object"}async function ye(e,t){if(!(typeof e>"u")){if(e.length<=1)return e;var i;if(typeof t>"u"){if(!ne(e)&&!z(e))throw{stack:new Error().stack,code:"D3070",index:1};i=async function(O,R){return O>R}}else i=t;var c=async function(O,R){var W=async function(ae,Ee,ve){Ee.length===0?Array.prototype.push.apply(ae,ve):ve.length===0?Array.prototype.push.apply(ae,Ee):await i(Ee[0],ve[0])?(ae.push(ve[0]),await W(ae,Ee,ve.slice(1))):(ae.push(Ee[0]),await W(ae,Ee.slice(1),ve))},ge=[];return await W(ge,O,R),ge},u=async function(O){if(!Array.isArray(O)||O.length<=1)return O;var R=Math.floor(O.length/2),W=O.slice(0,R),ge=O.slice(R);return W=await u(W),ge=await u(ge),await c(W,ge)},v=await u(e);return v}}function r(e){if(!(typeof e>"u")){if(e.length<=1)return e;for(var t=new Array(e.length),i=0;i<e.length;i++){var c=Math.floor(Math.random()*(i+1));i!==c&&(t[i]=t[c]),t[c]=e[i]}return t}}function s(e){if(!(typeof e>"u")){if(!Array.isArray(e)||e.length<=1)return e;for(var t=w(e)?S():[],i=0;i<e.length;i++){for(var c=e[i],u=!1,v=0;v<t.length;v++)if(Z(c,t[v])){u=!0;break}u||t.push(c)}return t}}async function f(e,t){var i={};for(var c in e){var u=e[c],v=ie(t,u,c,e),O=await t.apply(this,v);G(O)&&(i[c]=u)}return Object.keys(i).length===0&&(i=void 0),i}return{sum:h,count:J,max:x,min:p,average:$,string:F,substring:X,substringBefore:ce,substringAfter:se,lowercase:le,uppercase:te,length:me,trim:xe,pad:fe,match:H,contains:Ue,replace:ke,split:P,join:l,formatNumber:d,formatBase:a,number:y,floor:A,ceil:g,round:D,abs:k,sqrt:B,power:oe,random:de,boolean:G,not:q,map:L,zip:Ie,filter:$e,single:Ye,foldLeft:Fe,sift:f,keys:Ne,lookup:Xe,append:Ke,exists:pt,spread:et,merge:C,reverse:ht,each:ft,error:Je,assert:it,type:Ze,sort:ye,shuffle:r,distinct:s,base64encode:Ge,base64decode:o,encodeUrlComponent:n,encodeUrl:b,decodeUrlComponent:U,decodeUrl:N}})();be.exports=M}).call(this)}).call(this,typeof global<"u"?global:typeof self<"u"?self:typeof window<"u"?window:{})},{"./utils":6}],3:[function(m,be,Be){var we=m("./datetime"),E=m("./functions"),M=m("./utils"),ue=m("./parser"),z=m("./signature"),ne=(function(){"use strict";var S=M.isNumeric,w=M.isArrayOfStrings,T=M.isArrayOfNumbers,j=M.createSequence,_=M.isSequence,re=M.isFunction,Z=M.isLambda,I=M.isIterable,h=M.isPromise,J=M.getFunctionArity,x=M.isDeepEqual,p=Je(null);async function $(r,s,f){var e,t=f.lookup(Symbol.for("jsonata.__evaluate_entry"));switch(t&&await t(r,s,f),r.type){case"path":e=await F(r,s,f);break;case"binary":e=await me(r,s,f);break;case"unary":e=await xe(r,s,f);break;case"name":e=fe(r,s,f);break;case"string":case"number":case"value":e=Q(r,s,f);break;case"wildcard":e=Ue(r,s,f);break;case"descendant":e=ke(r,s,f);break;case"parent":e=f.lookup(r.slot.label);break;case"condition":e=await A(r,s,f);break;case"block":e=await g(r,s,f);break;case"bind":e=await k(r,s,f);break;case"regex":e=D(r,s,f);break;case"function":e=await ie(r,s,f);break;case"variable":e=B(r,s,f);break;case"lambda":e=Ye(r,s,f);break;case"partial":e=await Ie(r,s,f);break;case"apply":e=await q(r,s,f);break;case"transform":e=de(r,s,f);break}if(Object.prototype.hasOwnProperty.call(r,"predicate"))for(var i=0;i<r.predicate.length;i++)e=await te(r.predicate[i].expr,e,f);r.type!=="path"&&Object.prototype.hasOwnProperty.call(r,"group")&&(e=await d(r.group,e,f));var c=f.lookup(Symbol.for("jsonata.__evaluate_exit"));return c&&await c(r,s,f,e),e&&_(e)&&!e.tupleStream&&(r.keepArray&&(e.keepSingleton=!0),e.length===0?e=void 0:e.length===1&&(e=e.keepSingleton?e:e[0])),e}async function F(r,s,f){var e;Array.isArray(s)&&r.steps[0].type!=="variable"?e=s:e=j(s);for(var t,i=!1,c=void 0,u=0;u<r.steps.length;u++){var v=r.steps[u];if(v.tuple&&(i=!0),u===0&&v.consarray?t=await $(v,e,f):i?c=await le(v,e,c,f):t=await ce(v,e,f,u===r.steps.length-1),!i&&(typeof t>"u"||t.length===0))break;typeof v.focus>"u"&&(e=t)}if(i)if(r.tuple)t=c;else for(t=j(),u=0;u<c.length;u++)t.push(c[u]["@"]);return r.keepSingletonArray&&(Array.isArray(t)&&t.cons&&!t.sequence&&(t=j(t)),t.keepSingleton=!0),r.hasOwnProperty("group")&&(t=await d(r.group,i?c:t,f)),t}function X(r,s){var f=Je(r);for(let e in s)f.bind(e,s[e]);return f}async function ce(r,s,f,e){var t;if(r.type==="sort")return t=await oe(r,s,f),r.stages&&(t=await se(r.stages,t,f)),t;t=j();for(var i=0;i<s.length;i++){var c=await $(r,s[i],f);if(r.stages)for(var u=0;u<r.stages.length;u++)c=await te(r.stages[u].expr,c,f);typeof c<"u"&&t.push(c)}var v=j();return e&&t.length===1&&Array.isArray(t[0])&&!_(t[0])?v=t[0]:t.forEach(function(O){!Array.isArray(O)||O.cons?v.push(O):O.forEach(R=>v.push(R))}),v}async function se(r,s,f){for(var e=s,t=0;t<r.length;t++){var i=r[t];switch(i.type){case"filter":e=await te(i.expr,e,f);break;case"index":for(var c=0;c<e.length;c++){var u=e[c];u[i.value]=c}break}}return e}async function le(r,s,f,e){var t;if(r.type==="sort"){if(f)t=await oe(r,f,e);else{var i=await oe(r,s,e);t=j(),t.tupleStream=!0;for(var c=0;c<i.length;c++){var u={"@":i[c]};u[r.index]=c,t.push(u)}}return r.stages&&(t=await se(r.stages,t,e)),t}t=j(),t.tupleStream=!0;var v=e;f===void 0&&(f=s.map(ge=>({"@":ge})));for(var O=0;O<f.length;O++){v=X(e,f[O]);var R=await $(r,f[O]["@"],v);if(typeof R<"u"){Array.isArray(R)||(R=[R]);for(var W=0;W<R.length;W++)u={},Object.assign(u,f[O]),R.tupleStream?Object.assign(u,R[W]):(r.focus?(u[r.focus]=R[W],u["@"]=f[O]["@"]):u["@"]=R[W],r.index&&(u[r.index]=W),r.ancestor&&(u[r.ancestor.label]=f[O]["@"])),t.push(u)}}return r.stages&&(t=await se(r.stages,t,e)),t}async function te(r,s,f){var e=j();if(s&&s.tupleStream&&(e.tupleStream=!0),Array.isArray(s)||(s=j(s)),r.type==="number"){var t=Math.floor(r.value);t<0&&(t=s.length+t);var i=await s[t];typeof i<"u"&&(Array.isArray(i)?e=i:e.push(i))}else for(t=0;t<s.length;t++){var i=s[t],c=i,u=f;s.tupleStream&&(c=i["@"],u=X(f,i));var v=await $(r,c,u);S(v)&&(v=[v]),T(v)?v.forEach(function(R){var W=Math.floor(R);W<0&&(W=s.length+W),W===t&&e.push(i)}):E.boolean(v)&&e.push(i)}return e}async function me(r,s,f){var e,t=await $(r.lhs,s,f),i=r.value,c=async()=>await $(r.rhs,s,f);if(i==="and"||i==="or")try{return await N(t,c,i)}catch(v){throw v.position=r.position,v.token=i,v}var u=await c();try{switch(i){case"+":case"-":case"*":case"/":case"%":e=o(t,u,i);break;case"=":case"!=":e=n(t,u,i);break;case"<":case"<=":case">":case">=":e=b(t,u,i);break;case"&":e=l(t,u);break;case"..":e=y(t,u);break;case"in":e=U(t,u);break}}catch(v){throw v.position=r.position,v.token=i,v}return e}async function xe(r,s,f){var e;switch(r.value){case"-":if(e=await $(r.expression,s,f),typeof e>"u")e=void 0;else if(S(e))e=-e;else throw{code:"D1002",stack:new Error().stack,position:r.position,token:r.value,value:e};break;case"[":e=[];let c=await Promise.all(r.expressions.map(async(u,v)=>(f.isParallelCall=v>0,[u,await $(u,s,f)])));for(let u of c){var[t,i]=u;typeof i<"u"&&(t.value==="["?e.push(i):e=E.append(e,i))}r.consarray&&Object.defineProperty(e,"cons",{enumerable:!1,configurable:!1,value:!0});break;case"{":e=await d(r,s,f);break}return e}function fe(r,s,f){return E.lookup(s,r.value)}function Q(r){return r.value}function Ue(r,s){var f=j();return Array.isArray(s)&&s.outerWrapper&&s.length>0&&(s=s[0]),s!==null&&typeof s=="object"&&Object.keys(s).forEach(function(e){var t=s[e];Array.isArray(t)?(t=H(t),f=E.append(f,t)):f.push(t)}),f}function H(r,s){return typeof s>"u"&&(s=[]),Array.isArray(r)?r.forEach(function(f){H(f,s)}):s.push(r),s}function ke(r,s){var f,e=j();return typeof s<"u"&&(Ge(s,e),e.length===1?f=e[0]:f=e),f}function Ge(r,s){Array.isArray(r)||s.push(r),Array.isArray(r)?r.forEach(function(f){Ge(f,s)}):r!==null&&typeof r=="object"&&Object.keys(r).forEach(function(f){Ge(r[f],s)})}function o(r,s,f){var e;if(typeof r<"u"&&!S(r))throw{code:"T2001",stack:new Error().stack,value:r};if(typeof s<"u"&&!S(s))throw{code:"T2002",stack:new Error().stack,value:s};if(typeof r>"u"||typeof s>"u")return e;switch(f){case"+":e=r+s;break;case"-":e=r-s;break;case"*":e=r*s;break;case"/":e=r/s;break;case"%":e=r%s;break}return e}function n(r,s,f){var e,t=typeof r,i=typeof s;if(t==="undefined"||i==="undefined")return!1;switch(f){case"=":e=x(r,s);break;case"!=":e=!x(r,s);break}return e}function b(r,s,f){var e,t=typeof r,i=typeof s,c=t==="undefined"||t==="string"||t==="number",u=i==="undefined"||i==="string"||i==="number";if(!c||!u)throw{code:"T2010",stack:new Error().stack,value:t==="string"||t==="number"?s:r};if(!(t==="undefined"||i==="undefined")){if(t!==i)throw{code:"T2009",stack:new Error().stack,value:r,value2:s};switch(f){case"<":e=r<s;break;case"<=":e=r<=s;break;case">":e=r>s;break;case">=":e=r>=s;break}return e}}function U(r,s){var f=!1;if(typeof r>"u"||typeof s>"u")return!1;Array.isArray(s)||(s=[s]);for(var e=0;e<s.length;e++)if(s[e]===r){f=!0;break}return f}async function N(r,s,f){var e,t=P(r);switch(f){case"and":e=t&&P(await s());break;case"or":e=t||P(await s());break}return e}function P(r){var s=E.boolean(r);return typeof s>"u"?!1:s}function l(r,s){var f,e="",t="";return typeof r<"u"&&(e=E.string(r)),typeof s<"u"&&(t=E.string(s)),f=e.concat(t),f}async function d(r,s,f){var e={},t={},i=!!(s&&s.tupleStream);Array.isArray(s)||(s=j(s)),s.length===0&&s.push(void 0);for(var c=0;c<s.length;c++)for(var u=s[c],v=i?X(f,u):f,O=0;O<r.lhs.length;O++){var R=r.lhs[O],W=await $(R[0],i?u["@"]:u,v);if(typeof W!="string"&&W!==void 0)throw{code:"T1003",stack:new Error().stack,position:r.position,value:W};if(W!==void 0){var ge={data:u,exprIndex:O};if(t.hasOwnProperty(W)){if(t[W].exprIndex!==O)throw{code:"D1009",stack:new Error().stack,position:r.position,value:W};t[W].data=E.append(t[W].data,u)}else t[W]=ge}}let ae=await Promise.all(Object.keys(t).map(async(ve,Ce)=>{let pe=t[ve];var Oe=pe.data,He=f;if(i){var je=a(pe.data);Oe=je["@"],delete je["@"],He=X(f,je)}return f.isParallelCall=Ce>0,[ve,await $(r.lhs[pe.exprIndex][1],Oe,He)]}));for(let ve of ae){var[W,Ee]=await ve;typeof Ee<"u"&&(e[W]=Ee)}return e}function a(r){if(!Array.isArray(r))return r;var s={};Object.assign(s,r[0]);for(var f=1;f<r.length;f++)for(let e in r[f])s[e]=E.append(s[e],r[f][e]);return s}function y(r,s){var f;if(typeof r<"u"&&!Number.isInteger(r))throw{code:"T2003",stack:new Error().stack,value:r};if(typeof s<"u"&&!Number.isInteger(s))throw{code:"T2004",stack:new Error().stack,value:s};if(typeof r>"u"||typeof s>"u"||r>s)return f;var e=s-r+1;if(e>1e7)throw{code:"D2014",stack:new Error().stack,value:e};f=new Array(e);for(var t=r,i=0;t<=s;t++,i++)f[i]=t;return f.sequence=!0,f}async function k(r,s,f){var e=await $(r.rhs,s,f);return f.bind(r.lhs.value,e),e}async function A(r,s,f){var e,t=await $(r.condition,s,f);return E.boolean(t)?e=await $(r.then,s,f):typeof r.else<"u"&&(e=await $(r.else,s,f)),e}async function g(r,s,f){for(var e,t=Je(f),i=0;i<r.expressions.length;i++)e=await $(r.expressions[i],s,t);return e}function D(r){var s=new ye.RegexEngine(r.value),f=function(e,t){var i;s.lastIndex=t||0;var c=s.exec(e);if(c!==null){if(i={match:c[0],start:c.index,end:c.index+c[0].length,groups:[]},c.length>1)for(var u=1;u<c.length;u++)i.groups.push(c[u]);i.next=function(){if(!(s.lastIndex>=e.length)){var v=f(e,s.lastIndex);if(v&&v.match==="")throw{code:"D1004",stack:new Error().stack,position:r.position,value:r.value.source};return v}}}return i};return f}function B(r,s,f){var e;return r.value===""?e=s&&s.outerWrapper?s[0]:s:e=f.lookup(r.value),e}async function oe(r,s,f){var e,t=s,i=!!s.tupleStream,c=async function(v,O){for(var R=0,W=0;R===0&&W<r.terms.length;W++){var ge=r.terms[W],ae=v,Ee=f;i&&(ae=v["@"],Ee=X(f,v));var ve=await $(ge.expression,ae,Ee);ae=O,Ee=f,i&&(ae=O["@"],Ee=X(f,O));var Ce=await $(ge.expression,ae,Ee),pe=typeof ve,Oe=typeof Ce;if(pe==="undefined"){R=Oe==="undefined"?0:1;continue}if(Oe==="undefined"){R=-1;continue}if(!(pe==="string"||pe==="number")||!(Oe==="string"||Oe==="number"))throw{code:"T2008",stack:new Error().stack,position:r.position,value:pe==="string"||pe==="number"?Ce:ve};if(pe!==Oe)throw{code:"T2007",stack:new Error().stack,position:r.position,value:ve,value2:Ce};ve!==Ce&&(ve<Ce?R=-1:R=1,ge.descending===!0&&(R=-R))}return R===1},u={environment:f,input:s};return e=await E.sort.apply(u,[t,c]),e}function de(r,s,f){var e=async function(t){if(!(typeof t>"u")){var i=f.lookup("clone");if(!re(i))throw{code:"T2013",stack:new Error().stack,position:r.position};var c=await L(i,[t],null,f),u=await $(r.pattern,c,f);if(typeof u<"u"){Array.isArray(u)||(u=[u]);for(var v=0;v<u.length;v++){var O=u[v];if(O&&(O.isPrototypeOf(c)||O instanceof Object.constructor))throw{code:"D1010",stack:new Error().stack,position:r.position};var R=await $(r.update,O,f),W=typeof R;if(W!=="undefined"){if(W!=="object"||R===null||Array.isArray(R))throw{code:"T2011",stack:new Error().stack,position:r.update.position,value:R};for(var ge in R)O[ge]=R[ge]}if(typeof r.delete<"u"){var ae=await $(r.delete,O,f);if(typeof ae<"u"){var Ee=ae;if(Array.isArray(ae)||(ae=[ae]),!w(ae))throw{code:"T2012",stack:new Error().stack,position:r.delete.position,value:Ee};for(var ve=0;ve<ae.length;ve++)typeof O=="object"&&O!==null&&delete O[ae[ve]]}}}}return c}};return C(e,"<(oa):o>")}var G=ue("function($f, $g) { function($x){ $g($f($x)) } }");async function q(r,s,f){var e,t=await $(r.lhs,s,f);if(r.rhs.type==="function")e=await ie(r.rhs,s,f,{context:t});else{var i=await $(r.rhs,s,f);if(!re(i))throw{code:"T2006",stack:new Error().stack,position:r.position,value:i};if(re(t)){var c=await $(G,null,f);e=await L(c,[t,i],null,f)}else e=await L(i,[t],null,f)}return e}async function ie(r,s,f,e){var t,i=await $(r.procedure,s,f);if(typeof i>"u"&&r.procedure.type==="path"&&f.lookup(r.procedure.steps[0].value))throw{code:"T1005",stack:new Error().stack,position:r.position,token:r.procedure.steps[0].value};var c=[];typeof e<"u"&&c.push(e.context);for(var u=0;u<r.arguments.length;u++){let O=await $(r.arguments[u],s,f);if(re(O)){let R=async function(...W){return await L(O,W,null,f)};R.arity=J(O),c.push(R)}else c.push(O)}var v=r.procedure.type==="path"?r.procedure.steps[0].value:r.procedure.value;try{typeof i=="object"&&(i.token=v,i.position=r.position),t=await L(i,c,s,f)}catch(O){throw O.position||(O.position=r.position),O.token||(O.token=v),O}return t}async function L(r,s,f,e){var t;for(t=await $e(r,s,f,e);Z(t)&&t.thunk===!0;){var i=await $(t.body.procedure,t.input,t.environment);t.body.procedure.type==="variable"&&(i.token=t.body.procedure.value),i.position=t.body.procedure.position;for(var c=[],u=0;u<t.body.arguments.length;u++)c.push(await $(t.body.arguments[u],t.input,t.environment));t=await $e(i,c,f,e)}return t}async function $e(r,s,f,e){var t;try{var i=s;if(r&&(i=Fe(r.signature,s,f)),Z(r))t=await Ne(r,i);else if(r&&r._jsonata_function===!0){var c={environment:e,input:f};t=r.implementation.apply(c,i),I(t)&&(t=t.next().value),h(t)&&(t=await t)}else if(typeof r=="function")t=r.apply(f,i),h(t)&&(t=await t);else throw{code:"T1006",stack:new Error().stack}}catch(u){throw r&&(typeof u.token>"u"&&typeof r.token<"u"&&(u.token=r.token),u.position=r.position||u.position),u}return t}function Ye(r,s,f){var e={_jsonata_lambda:!0,input:s,environment:f,arguments:r.arguments,signature:r.signature,body:r.body};return r.thunk===!0&&(e.thunk=!0),e.apply=async function(t,i){return await L(e,i,s,t?t.environment:f)},e}async function Ie(r,s,f){for(var e,t=[],i=0;i<r.arguments.length;i++){var c=r.arguments[i];c.type==="operator"&&c.value==="?"?t.push(c):t.push(await $(c,s,f))}var u=await $(r.procedure,s,f);if(typeof u>"u"&&r.procedure.type==="path"&&f.lookup(r.procedure.steps[0].value))throw{code:"T1007",stack:new Error().stack,position:r.position,token:r.procedure.steps[0].value};if(Z(u))e=Xe(u,t);else if(u&&u._jsonata_function===!0)e=Ke(u.implementation,t);else if(typeof u=="function")e=Ke(u,t);else throw{code:"T1008",stack:new Error().stack,position:r.position,token:r.procedure.type==="path"?r.procedure.steps[0].value:r.procedure.value};return e}function Fe(r,s,f){if(typeof r>"u")return s;var e=r.validate(s,f);return e}async function Ne(r,s){var f,e=Je(r.environment);return r.arguments.forEach(function(t,i){e.bind(t.value,s[i])}),typeof r.body=="function"?f=await pt(r.body,e):f=await $(r.body,r.input,e),f}function Xe(r,s){var f=Je(r.environment),e=[];r.arguments.forEach(function(i,c){var u=s[c];u&&u.type==="operator"&&u.value==="?"?e.push(i):f.bind(i.value,u)});var t={_jsonata_lambda:!0,input:r.input,environment:f,arguments:e,body:r.body};return t}function Ke(r,s){var f=et(r);f=f.map(function(c){return"$"+c.trim()});var e="function("+f.join(", ")+"){ _ }",t=ue(e);t.body=r;var i=Xe(t,s);return i}async function pt(r,s){var f=et(r),e=f.map(function(c){return s.lookup(c.trim())}),t={environment:s},i=r.apply(t,e);return h(i)&&(i=await i),i}function et(r){var s=r.toString(),f=/\(([^)]*)\)/.exec(s)[1],e=f.split(",");return e}function C(r,s){var f={_jsonata_function:!0,implementation:r};return typeof s<"u"&&(f.signature=z(s)),f}async function ht(r,s){if(!(typeof r>"u")){var f=this.input;typeof s<"u"&&(f=s,Array.isArray(f)&&!_(f)&&(f=j(f),f.outerWrapper=!0));try{var e=ue(r,!1)}catch(i){throw Ze(i),{stack:new Error().stack,code:"D3120",value:i.message,error:i}}try{var t=await $(e,f,this.environment)}catch(i){throw Ze(i),{stack:new Error().stack,code:"D3121",value:i.message,error:i}}return t}}function ft(r){if(!(typeof r>"u"))return JSON.parse(E.string(r))}function Je(r){var s={};let f={bind:function(t,i){s[t]=i},lookup:function(t){var i;return s.hasOwnProperty(t)?i=s[t]:r&&(i=r.lookup(t)),i},timestamp:r?r.timestamp:null,async:r?r.async:!1,isParallelCall:r?r.isParallelCall:!1,global:r?r.global:{ancestry:[null]}};if(r){var e=r.lookup(Symbol.for("jsonata.__createFrame_push"));e&&e(r,f)}return f}p.bind("sum",C(E.sum,"<a<n>:n>")),p.bind("count",C(E.count,"<a:n>")),p.bind("max",C(E.max,"<a<n>:n>")),p.bind("min",C(E.min,"<a<n>:n>")),p.bind("average",C(E.average,"<a<n>:n>")),p.bind("string",C(E.string,"<x-b?:s>")),p.bind("substring",C(E.substring,"<s-nn?:s>")),p.bind("substringBefore",C(E.substringBefore,"<s-s:s>")),p.bind("substringAfter",C(E.substringAfter,"<s-s:s>")),p.bind("lowercase",C(E.lowercase,"<s-:s>")),p.bind("uppercase",C(E.uppercase,"<s-:s>")),p.bind("length",C(E.length,"<s-:n>")),p.bind("trim",C(E.trim,"<s-:s>")),p.bind("pad",C(E.pad,"<s-ns?:s>")),p.bind("match",C(E.match,"<s-f<s:o>n?:a<o>>")),p.bind("contains",C(E.contains,"<s-(sf):b>")),p.bind("replace",C(E.replace,"<s-(sf)(sf)n?:s>")),p.bind("split",C(E.split,"<s-(sf)n?:a<s>>")),p.bind("join",C(E.join,"<a<s>s?:s>")),p.bind("formatNumber",C(E.formatNumber,"<n-so?:s>")),p.bind("formatBase",C(E.formatBase,"<n-n?:s>")),p.bind("formatInteger",C(we.formatInteger,"<n-s:s>")),p.bind("parseInteger",C(we.parseInteger,"<s-s:n>")),p.bind("number",C(E.number,"<(nsb)-:n>")),p.bind("floor",C(E.floor,"<n-:n>")),p.bind("ceil",C(E.ceil,"<n-:n>")),p.bind("round",C(E.round,"<n-n?:n>")),p.bind("abs",C(E.abs,"<n-:n>")),p.bind("sqrt",C(E.sqrt,"<n-:n>")),p.bind("power",C(E.power,"<n-n:n>")),p.bind("random",C(E.random,"<:n>")),p.bind("boolean",C(E.boolean,"<x-:b>")),p.bind("not",C(E.not,"<x-:b>")),p.bind("map",C(E.map,"<af>")),p.bind("zip",C(E.zip,"<a+>")),p.bind("filter",C(E.filter,"<af>")),p.bind("single",C(E.single,"<af?>")),p.bind("reduce",C(E.foldLeft,"<afj?:j>")),p.bind("sift",C(E.sift,"<o-f?:o>")),p.bind("keys",C(E.keys,"<x-:a<s>>")),p.bind("lookup",C(E.lookup,"<x-s:x>")),p.bind("append",C(E.append,"<xx:a>")),p.bind("exists",C(E.exists,"<x:b>")),p.bind("spread",C(E.spread,"<x-:a<o>>")),p.bind("merge",C(E.merge,"<a<o>:o>")),p.bind("reverse",C(E.reverse,"<a:a>")),p.bind("each",C(E.each,"<o-f:a>")),p.bind("error",C(E.error,"<s?:x>")),p.bind("assert",C(E.assert,"<bs?:x>")),p.bind("type",C(E.type,"<x:s>")),p.bind("sort",C(E.sort,"<af?:a>")),p.bind("shuffle",C(E.shuffle,"<a:a>")),p.bind("distinct",C(E.distinct,"<x:x>")),p.bind("base64encode",C(E.base64encode,"<s-:s>")),p.bind("base64decode",C(E.base64decode,"<s-:s>")),p.bind("encodeUrlComponent",C(E.encodeUrlComponent,"<s-:s>")),p.bind("encodeUrl",C(E.encodeUrl,"<s-:s>")),p.bind("decodeUrlComponent",C(E.decodeUrlComponent,"<s-:s>")),p.bind("decodeUrl",C(E.decodeUrl,"<s-:s>")),p.bind("eval",C(ht,"<sx?:x>")),p.bind("toMillis",C(we.toMillis,"<s-s?:n>")),p.bind("fromMillis",C(we.fromMillis,"<n-s?s?:s>")),p.bind("clone",C(ft,"<(oa)-:o>"));var it={S0101:"String literal must be terminated by a matching quote",S0102:"Number out of range: {{token}}",S0103:"Unsupported escape sequence: \\{{token}}",S0104:"The escape sequence \\u must be followed by 4 hex digits",S0105:"Quoted property name must be terminated with a backquote (`)",S0106:"Comment has no closing tag",S0201:"Syntax error: {{token}}",S0202:"Expected {{value}}, got {{token}}",S0203:"Expected {{value}} before end of expression",S0204:"Unknown operator: {{token}}",S0205:"Unexpected token: {{token}}",S0206:"Unknown expression type: {{token}}",S0207:"Unexpected end of expression",S0208:"Parameter {{value}} of function definition must be a variable name (start with $)",S0209:"A predicate cannot follow a grouping expression in a step",S0210:"Each step can only have one grouping expression",S0211:"The symbol {{token}} cannot be used as a unary operator",S0212:"The left side of := must be a variable name (start with $)",S0213:"The literal value {{value}} cannot be used as a step within a path expression",S0214:"The right side of {{token}} must be a variable name (start with $)",S0215:"A context variable binding must precede any predicates on a step",S0216:"A context variable binding must precede the 'order-by' clause on a step",S0217:"The object representing the 'parent' cannot be derived from this expression",S0301:"Empty regular expressions are not allowed",S0302:"No terminating / in regular expression",S0402:"Choice groups containing parameterized types are not supported",S0401:"Type parameters can only be applied to functions and arrays",S0500:"Attempted to evaluate an expression containing syntax error(s)",T0410:"Argument {{index}} of function {{token}} does not match function signature",T0411:"Context value is not a compatible type with argument {{index}} of function {{token}}",T0412:"Argument {{index}} of function {{token}} must be an array of {{type}}",D1001:"Number out of range: {{value}}",D1002:"Cannot negate a non-numeric value: {{value}}",T1003:"Key in object structure must evaluate to a string; got: {{value}}",D1004:"Regular expression matches zero length string",T1005:"Attempted to invoke a non-function. Did you mean ${{{token}}}?",T1006:"Attempted to invoke a non-function",T1007:"Attempted to partially apply a non-function. Did you mean ${{{token}}}?",T1008:"Attempted to partially apply a non-function",D1009:"Multiple key definitions evaluate to same key: {{value}}",D1010:"Attempted to access the Javascript object prototype",T1010:"The matcher function argument passed to function {{token}} does not return the correct object structure",T2001:"The left side of the {{token}} operator must evaluate to a number",T2002:"The right side of the {{token}} operator must evaluate to a number",T2003:"The left side of the range operator (..) must evaluate to an integer",T2004:"The right side of the range operator (..) must evaluate to an integer",D2005:"The left side of := must be a variable name (start with $)",T2006:"The right side of the function application operator ~> must be a function",T2007:"Type mismatch when comparing values {{value}} and {{value2}} in order-by clause",T2008:"The expressions within an order-by clause must evaluate to numeric or string values",T2009:"The values {{value}} and {{value2}} either side of operator {{token}} must be of the same data type",T2010:"The expressions either side of operator {{token}} must evaluate to numeric or string values",T2011:"The insert/update clause of the transform expression must evaluate to an object: {{value}}",T2012:"The delete clause of the transform expression must evaluate to a string or array of strings: {{value}}",T2013:"The transform expression clones the input object using the $clone() function.  This has been overridden in the current scope by a non-function.",D2014:"The size of the sequence allocated by the range operator (..) must not exceed 1e6.  Attempted to allocate {{value}}.",D3001:"Attempting to invoke string function on Infinity or NaN",D3010:"Second argument of replace function cannot be an empty string",D3011:"Fourth argument of replace function must evaluate to a positive number",D3012:"Attempted to replace a matched string with a non-string value",D3020:"Third argument of split function must evaluate to a positive number",D3030:"Unable to cast value to a number: {{value}}",D3040:"Third argument of match function must evaluate to a positive number",D3050:"The second argument of reduce function must be a function with at least two arguments",D3060:"The sqrt function cannot be applied to a negative number: {{value}}",D3061:"The power function has resulted in a value that cannot be represented as a JSON number: base={{value}}, exponent={{exp}}",D3070:"The single argument form of the sort function can only be applied to an array of strings or an array of numbers.  Use the second argument to specify a comparison function",D3080:"The picture string must only contain a maximum of two sub-pictures",D3081:"The sub-picture must not contain more than one instance of the 'decimal-separator' character",D3082:"The sub-picture must not contain more than one instance of the 'percent' character",D3083:"The sub-picture must not contain more than one instance of the 'per-mille' character",D3084:"The sub-picture must not contain both a 'percent' and a 'per-mille' character",D3085:"The mantissa part of a sub-picture must contain at least one character that is either an 'optional digit character' or a member of the 'decimal digit family'",D3086:"The sub-picture must not contain a passive character that is preceded by an active character and that is followed by another active character",D3087:"The sub-picture must not contain a 'grouping-separator' character that appears adjacent to a 'decimal-separator' character",D3088:"The sub-picture must not contain a 'grouping-separator' at the end of the integer part",D3089:"The sub-picture must not contain two adjacent instances of the 'grouping-separator' character",D3090:"The integer part of the sub-picture must not contain a member of the 'decimal digit family' that is followed by an instance of the 'optional digit character'",D3091:"The fractional part of the sub-picture must not contain an instance of the 'optional digit character' that is followed by a member of the 'decimal digit family'",D3092:"A sub-picture that contains a 'percent' or 'per-mille' character must not contain a character treated as an 'exponent-separator'",D3093:"The exponent part of the sub-picture must comprise only of one or more characters that are members of the 'decimal digit family'",D3100:"The radix of the formatBase function must be between 2 and 36.  It was given {{value}}",D3110:"The argument of the toMillis function must be an ISO 8601 formatted timestamp. Given {{value}}",D3120:"Syntax error in expression passed to function eval: {{value}}",D3121:"Dynamic error evaluating the expression passed to function eval: {{value}}",D3130:"Formatting or parsing an integer as a sequence starting with {{value}} is not supported by this implementation",D3131:"In a decimal digit pattern, all digits must be from the same decimal group",D3132:"Unknown component specifier {{value}} in date/time picture string",D3133:"The 'name' modifier can only be applied to months and days in the date/time picture string, not {{value}}",D3134:"The timezone integer format specifier cannot have more than four digits",D3135:"No matching closing bracket ']' in date/time picture string",D3136:"The date/time picture string is missing specifiers required to parse the timestamp",D3137:"{{{message}}}",D3138:"The $single() function expected exactly 1 matching result.  Instead it matched more.",D3139:"The $single() function expected exactly 1 matching result.  Instead it matched 0.",D3140:"Malformed URL passed to ${{{functionName}}}(): {{value}}",D3141:"{{{message}}}"};function Ze(r){var s=it[r.code];if(typeof s<"u"){var f=s.replace(/\{\{\{([^}]+)}}}/g,function(){return r[arguments[1]]});f=f.replace(/\{\{([^}]+)}}/g,function(){return JSON.stringify(r[arguments[1]])}),r.message=f}}function ye(r,s){var f,e;try{f=ue(r,s&&s.recover),e=f.errors,delete f.errors}catch(c){throw Ze(c),c}var t=Je(p),i=new Date;return t.bind("now",C(function(c,u){return we.fromMillis(i.getTime(),c,u)},"<s?s?:s>")),t.bind("millis",C(function(){return i.getTime()},"<:n>")),s&&s.RegexEngine?ye.RegexEngine=s.RegexEngine:ye.RegexEngine=RegExp,{evaluate:async function(c,u,v){if(typeof e<"u"){var O={code:"S0500",position:0};throw Ze(O),O}if(typeof u<"u"){var R;R=Je(t);for(var W in u)R.bind(W,u[W])}else R=t;R.bind("$",c),i=new Date,R.timestamp=i,Array.isArray(c)&&!_(c)&&(c=j(c),c.outerWrapper=!0);var ge;try{return ge=await $(f,c,R),typeof v=="function"&&v(null,ge),ge}catch(ae){throw Ze(ae),ae}},assign:function(c,u){t.bind(c,u)},registerFunction:function(c,u,v){var O=C(u,v);t.bind(c,O)},ast:function(){return f},errors:function(){return e}}}return ye.parser=ue,ye})();be.exports=ne},{"./datetime":1,"./functions":2,"./parser":4,"./signature":5,"./utils":6}],4:[function(m,be,Be){var we=m("./signature");let E=(()=>{"use strict";var M={".":75,"[":80,"]":0,"{":70,"}":0,"(":80,")":0,",":0,"@":80,"#":80,";":80,":":80,"?":20,"+":50,"-":50,"*":60,"/":60,"%":60,"|":20,"=":40,"<":40,">":40,"^":40,"**":60,"..":20,":=":10,"!=":40,"<=":40,">=":40,"~>":40,"?:":40,"??":40,and:30,or:25,in:40,"&":50,"!":0,"~":0},ue={'"':'"',"\\":"\\","/":"/",b:"\b",f:"\f",n:`
`,r:"\r",t:"	"},z=function(S){var w=0,T=S.length,j=function(Z,I){var h={type:Z,value:I,position:w};return h},_=function(){for(var Z=w,I=0,h,J,x=function($){if(S.charAt($)==="/"&&I===0){for(var F=0;S.charAt($-(F+1))==="\\";)F++;if(F%2===0)return!0}return!1};w<T;){var p=S.charAt(w);if(x(w)){if(h=S.substring(Z,w),h==="")throw{code:"S0301",stack:new Error().stack,position:w};for(w++,p=S.charAt(w),Z=w;p==="i"||p==="m";)w++,p=S.charAt(w);return J=S.substring(Z,w)+"g",new RegExp(h,J)}(p==="("||p==="["||p==="{")&&S.charAt(w-1)!=="\\"&&I++,(p===")"||p==="]"||p==="}")&&S.charAt(w-1)!=="\\"&&I--,w++}throw{code:"S0302",stack:new Error().stack,position:w}},re=function(Z){if(w>=T)return null;for(var I=S.charAt(w);w<T&&` 	
\r\v`.indexOf(I)>-1;)w++,I=S.charAt(w);if(I==="/"&&S.charAt(w+1)==="*"){var h=w;for(w+=2,I=S.charAt(w);!(I==="*"&&S.charAt(w+1)==="/");)if(I=S.charAt(++w),w>=T)throw{code:"S0106",stack:new Error().stack,position:h};return w+=2,I=S.charAt(w),re(Z)}if(Z!==!0&&I==="/")return w++,j("regex",_());if(I==="."&&S.charAt(w+1)===".")return w+=2,j("operator","..");if(I===":"&&S.charAt(w+1)==="=")return w+=2,j("operator",":=");if(I==="!"&&S.charAt(w+1)==="=")return w+=2,j("operator","!=");if(I===">"&&S.charAt(w+1)==="=")return w+=2,j("operator",">=");if(I==="<"&&S.charAt(w+1)==="=")return w+=2,j("operator","<=");if(I==="*"&&S.charAt(w+1)==="*")return w+=2,j("operator","**");if(I==="~"&&S.charAt(w+1)===">")return w+=2,j("operator","~>");if(I==="?"&&S.charAt(w+1)===":")return w+=2,j("operator","?:");if(I==="?"&&S.charAt(w+1)==="?")return w+=2,j("operator","??");if(Object.prototype.hasOwnProperty.call(M,I))return w++,j("operator",I);if(I==='"'||I==="'"){var J=I;w++;for(var x="";w<T;){if(I=S.charAt(w),I==="\\")if(w++,I=S.charAt(w),Object.prototype.hasOwnProperty.call(ue,I))x+=ue[I];else if(I==="u"){var p=S.substr(w+1,4);if(/^[0-9a-fA-F]+$/.test(p)){var $=parseInt(p,16);x+=String.fromCharCode($),w+=4}else throw{code:"S0104",stack:new Error().stack,position:w}}else throw{code:"S0103",stack:new Error().stack,position:w,token:I};else{if(I===J)return w++,j("string",x);x+=I}w++}throw{code:"S0101",stack:new Error().stack,position:w}}var F=/^-?(0|([1-9][0-9]*))(\.[0-9]+)?([Ee][-+]?[0-9]+)?/,X=F.exec(S.substring(w));if(X!==null){var ce=parseFloat(X[0]);if(!isNaN(ce)&&isFinite(ce))return w+=X[0].length,j("number",ce);throw{code:"S0102",stack:new Error().stack,position:w,token:X[0]}}var se;if(I==="`"){w++;var le=S.indexOf("`",w);if(le!==-1)return se=S.substring(w,le),w=le+1,j("name",se);throw w=T,{code:"S0105",stack:new Error().stack,position:w}}for(var te=w,me;;)if(me=S.charAt(te),te===T||` 	
\r\v`.indexOf(me)>-1||Object.prototype.hasOwnProperty.call(M,me)){if(S.charAt(w)==="$")return se=S.substring(w+1,te),w=te,j("variable",se);switch(se=S.substring(w,te),w=te,se){case"or":case"in":case"and":return j("operator",se);case"true":return j("value",!0);case"false":return j("value",!1);case"null":return j("value",null);default:return w===T&&se===""?null:j("name",se)}}else te++};return re},ne=function(S,w){var T,j,_={},re=[],Z=function(){var o=[];T.id!=="(end)"&&o.push({type:T.type,value:T.value,position:T.position});for(var n=j();n!==null;)o.push(n),n=j();return o},I={nud:function(){var o={code:"S0211",token:this.value,position:this.position};if(w)return o.remaining=Z(),o.type="error",re.push(o),o;throw o.stack=new Error().stack,o}},h=function(o,n){var b=_[o];return n=n||0,b?n>=b.lbp&&(b.lbp=n):(b=Object.create(I),b.id=b.value=o,b.lbp=n,_[o]=b),b},J=function(o){if(w){o.remaining=Z(),re.push(o);var n=_["(error)"];return T=Object.create(n),T.error=o,T.type="(error)",T}else throw o.stack=new Error().stack,o},x=function(o,n){if(o&&T.id!==o){var b;T.id==="(end)"?b="S0203":b="S0202";var U={code:b,position:T.position,token:T.value,value:o};return J(U)}var N=j(n);if(N===null)return T=_["(end)"],T.position=S.length,T;var P=N.value,l=N.type,d;switch(l){case"name":case"variable":d=_["(name)"];break;case"operator":if(d=_[P],!d)return J({code:"S0204",stack:new Error().stack,position:N.position,token:P});break;case"string":case"number":case"value":d=_["(literal)"];break;case"regex":l="regex",d=_["(regex)"];break;default:return J({code:"S0205",stack:new Error().stack,position:N.position,token:P})}return T=Object.create(d),T.value=P,T.type=l,T.position=N.position,T},p=function(o){var n,b=T;for(x(null,!0),n=b.nud();o<T.lbp;)b=T,x(),n=b.led(n);return n},$=function(o){var n=h(o,0);n.nud=function(){return this}},F=function(o,n,b){var U=n||M[o],N=h(o,U);return N.led=b||function(P){return this.lhs=P,this.rhs=p(U),this.type="binary",this},N},X=function(o,n,b){var U=h(o,n);return U.led=b,U},ce=function(o,n){var b=h(o);return b.nud=n||function(){return this.expression=p(70),this.type="unary",this},b};$("(end)"),$("(name)"),$("(literal)"),$("(regex)"),h(":"),h(";"),h(","),h(")"),h("]"),h("}"),h(".."),F("."),F("+"),F("-"),F("*"),F("/"),F("%"),F("="),F("<"),F(">"),F("!="),F("<="),F(">="),F("&"),F("and"),F("or"),F("in"),$("and"),$("or"),$("in"),ce("-"),F("~>"),F("??",M["??"],function(o){return this.type="condition",this.condition={type:"function",value:"(",procedure:{type:"variable",value:"exists"},arguments:[o]},this.then=o,this.else=p(0),this}),X("(error)",10,function(o){return this.lhs=o,this.error=T.error,this.remaining=Z(),this.type="error",this}),ce("*",function(){return this.type="wildcard",this}),ce("**",function(){return this.type="descendant",this}),ce("%",function(){return this.type="parent",this}),F("(",M["("],function(o){if(this.procedure=o,this.type="function",this.arguments=[],T.id!==")")for(;T.type==="operator"&&T.id==="?"?(this.type="partial",this.arguments.push(T),x("?")):this.arguments.push(p(0)),T.id===",";)x(",");if(x(")",!0),o.type==="name"&&(o.value==="function"||o.value==="\u03BB")){if(this.arguments.forEach(function(P,l){if(P.type!=="variable")return J({code:"S0208",stack:new Error().stack,position:P.position,token:P.value,value:l+1})}),this.type="lambda",T.id==="<"){for(var n=T.position,b=1,U="<";b>0&&T.id!=="{"&&T.id!=="(end)";){var N=x();N.id===">"?b--:N.id==="<"&&b++,U+=N.value}x(">");try{this.signature=we(U)}catch(P){return P.position=n+P.offset,J(P)}}x("{"),this.body=p(0),x("}")}return this}),ce("(",function(){for(var o=[];T.id!==")"&&(o.push(p(0)),T.id===";");)x(";");return x(")",!0),this.type="block",this.expressions=o,this}),ce("[",function(){var o=[];if(T.id!=="]")for(;;){var n=p(0);if(T.id===".."){var b={type:"binary",value:"..",position:T.position,lhs:n};x(".."),b.rhs=p(0),n=b}if(o.push(n),T.id!==",")break;x(",")}return x("]",!0),this.expressions=o,this.type="unary",this}),F("[",M["["],function(o){if(T.id==="]"){for(var n=o;n&&n.type==="binary"&&n.value==="[";)n=n.lhs;return n.keepArray=!0,x("]"),o}else return this.lhs=o,this.rhs=p(M["]"]),this.type="binary",x("]",!0),this}),F("^",M["^"],function(o){x("(");for(var n=[];;){var b={descending:!1};if(T.id==="<"?x("<"):T.id===">"&&(b.descending=!0,x(">")),b.expression=p(0),n.push(b),T.id!==",")break;x(",")}return x(")"),this.lhs=o,this.rhs=n,this.type="binary",this});var se=function(o){var n=[];if(T.id!=="}")for(;;){var b=p(0);x(":");var U=p(0);if(n.push([b,U]),T.id!==",")break;x(",")}return x("}",!0),typeof o>"u"?(this.lhs=n,this.type="unary"):(this.lhs=o,this.rhs=n,this.type="binary"),this};ce("{",se),F("{",M["{"],se),X(":=",M[":="],function(o){return o.type!=="variable"?J({code:"S0212",stack:new Error().stack,position:o.position,token:o.value}):(this.lhs=o,this.rhs=p(M[":="]-1),this.type="binary",this)}),F("@",M["@"],function(o){return this.lhs=o,this.rhs=p(M["@"]),this.rhs.type!=="variable"?J({code:"S0214",stack:new Error().stack,position:this.rhs.position,token:"@"}):(this.type="binary",this)}),F("#",M["#"],function(o){return this.lhs=o,this.rhs=p(M["#"]),this.rhs.type!=="variable"?J({code:"S0214",stack:new Error().stack,position:this.rhs.position,token:"#"}):(this.type="binary",this)}),F("?",M["?"],function(o){return this.type="condition",this.condition=o,this.then=p(0),T.id===":"&&(x(":"),this.else=p(0)),this}),F("?:",M["?:"],function(o){return this.type="condition",this.condition=o,this.then=o,this.else=p(0),this}),ce("|",function(){return this.type="transform",this.pattern=p(0),x("|"),this.update=p(0),T.id===","&&(x(","),this.delete=p(0)),x("|"),this});var le=function(o){var n;if(o.type==="function"&&!o.predicate){var b={type:"lambda",thunk:!0,arguments:[],position:o.position};b.body=o,n=b}else if(o.type==="condition")o.then=le(o.then),typeof o.else<"u"&&(o.else=le(o.else)),n=o;else if(o.type==="block"){var U=o.expressions.length;U>0&&(o.expressions[U-1]=le(o.expressions[U-1])),n=o}else n=o;return n},te=0,me=0,xe=[],fe=function(o,n){switch(o.type){case"name":case"wildcard":n.level--,n.level===0&&(typeof o.ancestor>"u"||(xe[n.index].slot.label=o.ancestor.label),o.ancestor=n,o.tuple=!0);break;case"parent":n.level++;break;case"block":o.expressions.length>0&&(o.tuple=!0,n=fe(o.expressions[o.expressions.length-1],n));break;case"path":o.tuple=!0;var b=o.steps.length-1;for(n=fe(o.steps[b--],n);n.level>0&&b>=0;)n=fe(o.steps[b--],n);break;default:throw{code:"S0217",token:o.type,position:o.position}}return n},Q=function(o,n){if(typeof n.seekingParent<"u"||n.type==="parent"){var b=typeof n.seekingParent<"u"?n.seekingParent:[];n.type==="parent"&&b.push(n.slot),typeof o.seekingParent>"u"?o.seekingParent=b:Array.prototype.push.apply(o.seekingParent,b)}},Ue=function(o){var n=o.steps.length-1,b=o.steps[n],U=typeof b.seekingParent<"u"?b.seekingParent:[];b.type==="parent"&&U.push(b.slot);for(var N=0;N<U.length;N++){var P=U[N];for(n=o.steps.length-2;P.level>0;){if(n<0){typeof o.seekingParent>"u"?o.seekingParent=[P]:o.seekingParent.push(P);break}for(var l=o.steps[n--];n>=0&&l.focus&&o.steps[n].focus;)l=o.steps[n--];P=fe(l,P)}}},H=function(o){var n;switch(o.type){case"binary":switch(o.value){case".":var b=H(o.lhs);b.type==="path"?n=b:n={type:"path",steps:[b]},b.type==="parent"&&(n.seekingParent=[b.slot]);var U=H(o.rhs);U.type==="function"&&U.procedure.type==="path"&&U.procedure.steps.length===1&&U.procedure.steps[0].type==="name"&&n.steps[n.steps.length-1].type==="function"&&(n.steps[n.steps.length-1].nextFunction=U.procedure.steps[0].value),U.type==="path"?Array.prototype.push.apply(n.steps,U.steps):(typeof U.predicate<"u"&&(U.stages=U.predicate,delete U.predicate),n.steps.push(U)),n.steps.filter(function(D){if(D.type==="number"||D.type==="value")throw{code:"S0213",stack:new Error().stack,position:D.position,value:D.value};return D.type==="string"}).forEach(function(D){D.type="name"}),n.steps.filter(function(D){return D.keepArray===!0}).length>0&&(n.keepSingletonArray=!0);var N=n.steps[0];N.type==="unary"&&N.value==="["&&(N.consarray=!0);var P=n.steps[n.steps.length-1];P.type==="unary"&&P.value==="["&&(P.consarray=!0),Ue(n);break;case"[":n=H(o.lhs);var l=n,d="predicate";if(n.type==="path"&&(l=n.steps[n.steps.length-1],d="stages"),typeof l.group<"u")throw{code:"S0209",stack:new Error().stack,position:o.position};typeof l[d]>"u"&&(l[d]=[]);var a=H(o.rhs);typeof a.seekingParent<"u"&&(a.seekingParent.forEach(D=>{D.level===1?fe(l,D):D.level--}),Q(l,a)),l[d].push({type:"filter",expr:a,position:o.position});break;case"{":if(n=H(o.lhs),typeof n.group<"u")throw{code:"S0210",stack:new Error().stack,position:o.position};n.group={lhs:o.rhs.map(function(D){return[H(D[0]),H(D[1])]}),position:o.position};break;case"^":n=H(o.lhs),n.type!=="path"&&(n={type:"path",steps:[n]});var y={type:"sort",position:o.position};y.terms=o.rhs.map(function(D){var B=H(D.expression);return Q(y,B),{descending:D.descending,expression:B}}),n.steps.push(y),Ue(n);break;case":=":n={type:"bind",value:o.value,position:o.position},n.lhs=H(o.lhs),n.rhs=H(o.rhs),Q(n,n.rhs);break;case"@":if(n=H(o.lhs),l=n,n.type==="path"&&(l=n.steps[n.steps.length-1]),typeof l.stages<"u"||typeof l.predicate<"u")throw{code:"S0215",stack:new Error().stack,position:o.position};if(l.type==="sort")throw{code:"S0216",stack:new Error().stack,position:o.position};o.keepArray&&(l.keepArray=!0),l.focus=o.rhs.value,l.tuple=!0;break;case"#":n=H(o.lhs),l=n,n.type==="path"?l=n.steps[n.steps.length-1]:(n={type:"path",steps:[n]},typeof l.predicate<"u"&&(l.stages=l.predicate,delete l.predicate)),typeof l.stages>"u"?l.index=o.rhs.value:l.stages.push({type:"index",value:o.rhs.value,position:o.position}),l.tuple=!0;break;case"~>":n={type:"apply",value:o.value,position:o.position},n.lhs=H(o.lhs),n.rhs=H(o.rhs),n.keepArray=n.lhs.keepArray||n.rhs.keepArray;break;default:n={type:o.type,value:o.value,position:o.position},n.lhs=H(o.lhs),n.rhs=H(o.rhs),Q(n,n.lhs),Q(n,n.rhs)}break;case"unary":n={type:o.type,value:o.value,position:o.position},o.value==="["?n.expressions=o.expressions.map(function(D){var B=H(D);return Q(n,B),B}):o.value==="{"?n.lhs=o.lhs.map(function(D){var B=H(D[0]);Q(n,B);var oe=H(D[1]);return Q(n,oe),[B,oe]}):(n.expression=H(o.expression),o.value==="-"&&n.expression.type==="number"?(n=n.expression,n.value=-n.value):Q(n,n.expression));break;case"function":case"partial":n={type:o.type,name:o.name,value:o.value,position:o.position},n.arguments=o.arguments.map(function(D){var B=H(D);return Q(n,B),B}),n.procedure=H(o.procedure);break;case"lambda":n={type:o.type,arguments:o.arguments,signature:o.signature,position:o.position};var k=H(o.body);n.body=le(k);break;case"condition":n={type:o.type,position:o.position},n.condition=H(o.condition),Q(n,n.condition),n.then=H(o.then),Q(n,n.then),typeof o.else<"u"&&(n.else=H(o.else),Q(n,n.else));break;case"transform":n={type:o.type,position:o.position},n.pattern=H(o.pattern),n.update=H(o.update),typeof o.delete<"u"&&(n.delete=H(o.delete));break;case"block":n={type:o.type,position:o.position},n.expressions=o.expressions.map(function(D){var B=H(D);return Q(n,B),(B.consarray||B.type==="path"&&B.steps[0].consarray)&&(n.consarray=!0),B});break;case"name":n={type:"path",steps:[o]},o.keepArray&&(n.keepSingletonArray=!0);break;case"parent":n={type:"parent",slot:{label:"!"+te++,level:1,index:me++}},xe.push(n);break;case"string":case"number":case"value":case"wildcard":case"descendant":case"variable":case"regex":n=o;break;case"operator":if(o.value==="and"||o.value==="or"||o.value==="in")o.type="name",n=H(o);else if(o.value==="?")n=o;else throw{code:"S0201",stack:new Error().stack,position:o.position,token:o.value};break;case"error":n=o,o.lhs&&(n=H(o.lhs));break;default:var A="S0206";o.id==="(end)"&&(A="S0207");var g={code:A,position:o.position,token:o.value};if(w)return re.push(g),{type:"error",error:g};throw g.stack=new Error().stack,g}return o.keepArray&&(n.keepArray=!0),n};j=z(S),x();var ke=p(0);if(T.id!=="(end)"){var Ge={code:"S0201",position:T.position,token:T.value};J(Ge)}if(ke=H(ke),ke.type==="parent"||typeof ke.seekingParent<"u")throw{code:"S0217",token:ke.type,position:ke.position};return re.length>0&&(ke.errors=re),ke};return ne})();be.exports=E},{"./signature":5}],5:[function(m,be,Be){var we=m("./utils");let E=(()=>{"use strict";var M={a:"arrays",b:"booleans",f:"functions",n:"numbers",o:"objects",s:"strings"};function ue(z){for(var ne=1,S=[],w={},T=w;ne<z.length;){var j=z.charAt(ne);if(j===":")break;var _=function(){S.push(w),T=w,w={}},re=function(F,X,ce,se){for(var le=1,te=X;te<F.length;)if(te++,j=F.charAt(te),j===se){if(le--,le===0)break}else j===ce&&le++;return te};switch(j){case"s":case"n":case"b":case"l":case"o":w.regex="["+j+"m]",w.type=j,_();break;case"a":w.regex="[asnblfom]",w.type=j,w.array=!0,_();break;case"f":w.regex="f",w.type=j,_();break;case"j":w.regex="[asnblom]",w.type=j,_();break;case"x":w.regex="[asnblfom]",w.type=j,_();break;case"-":T.context=!0,T.contextRegex=new RegExp(T.regex),T.regex+="?";break;case"?":case"+":T.regex+=j;break;case"(":var Z=re(z,ne,"(",")"),I=z.substring(ne+1,Z);if(I.indexOf("<")===-1)w.regex="["+I+"m]";else throw{code:"S0402",stack:new Error().stack,value:I,offset:ne};w.type="("+I+")",ne=Z,_();break;case"<":if(T.type==="a"||T.type==="f"){var h=re(z,ne,"<",">");T.subtype=z.substring(ne+1,h),ne=h}else throw{code:"S0401",stack:new Error().stack,value:T.type,offset:ne};break}ne++}var J="^"+S.map(function(F){return"("+F.regex+")"}).join("")+"$",x=new RegExp(J),p=function(F){var X;if(we.isFunction(F))X="f";else{var ce=typeof F;switch(ce){case"string":X="s";break;case"number":X="n";break;case"boolean":X="b";break;case"object":F===null?X="l":Array.isArray(F)?X="a":X="o";break;case"undefined":default:X="m"}}return X},$=function(F,X){for(var ce="^",se=0,le=0;le<S.length;le++){ce+=S[le].regex;var te=X.match(ce);if(te===null)throw{code:"T0410",stack:new Error().stack,value:F[se],index:se+1};se=te[0].length}throw{code:"T0410",stack:new Error().stack,value:F[se],index:se+1}};return{definition:z,validate:function(F,X){var ce="";F.forEach(function(me){ce+=p(me)});var se=x.exec(ce);if(se){var le=[],te=0;return S.forEach(function(me,xe){var fe=F[te],Q=se[xe+1];if(Q==="")if(me.context&&me.contextRegex){var Ue=p(X);if(me.contextRegex.test(Ue))le.push(X);else throw{code:"T0411",stack:new Error().stack,value:X,index:te+1}}else le.push(fe),te++;else Q.split("").forEach(function(H){if(me.type==="a"){if(H==="m")fe=void 0;else{fe=F[te];var ke=!0;if(typeof me.subtype<"u"){if(H!=="a"&&Q!==me.subtype)ke=!1;else if(H==="a"&&fe.length>0){var Ge=p(fe[0]);if(Ge!==me.subtype.charAt(0))ke=!1;else{var o=fe.filter(function(n){return p(n)!==Ge});ke=o.length===0}}}if(!ke)throw{code:"T0412",stack:new Error().stack,value:fe,index:te+1,type:M[me.subtype]};H!=="a"&&(fe=[fe])}le.push(fe),te++}else le.push(fe),te++})}),le}$(F,ce)}}}return ue})();be.exports=E},{"./utils":6}],6:[function(m,be,Be){let we=(()=>{"use strict";function E(h){var J=!1;if(typeof h=="number"&&(J=!isNaN(h),J&&!isFinite(h)))throw{code:"D1001",value:h,stack:new Error().stack};return J}function M(h){var J=!1;return Array.isArray(h)&&(J=h.filter(function(x){return typeof x!="string"}).length===0),J}function ue(h){var J=!1;return Array.isArray(h)&&(J=h.filter(function(x){return!E(x)}).length===0),J}function z(){var h=[];return h.sequence=!0,arguments.length===1&&h.push(arguments[0]),h}function ne(h){return h.sequence===!0&&Array.isArray(h)}function S(h){return h&&(h._jsonata_function===!0||h._jsonata_lambda===!0)||typeof h=="function"}function w(h){var J=typeof h.arity=="number"?h.arity:typeof h.implementation=="function"?h.implementation.length:typeof h.length=="number"?h.length:h.arguments.length;return J}function T(h){return h&&h._jsonata_lambda===!0}var j=(typeof Symbol=="function"?Symbol:{}).iterator||"@@iterator";function _(h){return typeof h=="object"&&h!==null&&j in h&&"next"in h&&typeof h.next=="function"}function re(h,J){if(h===J)return!0;if(typeof h=="object"&&typeof J=="object"&&h!==null&&J!==null){if(Array.isArray(h)&&Array.isArray(J)){if(h.length!==J.length)return!1;for(var x=0;x<h.length;x++)if(!re(h[x],J[x]))return!1;return!0}var p=Object.getOwnPropertyNames(h),$=Object.getOwnPropertyNames(J);if(p.length!==$.length)return!1;for(p=p.sort(),$=$.sort(),x=0;x<p.length;x++)if(p[x]!==$[x])return!1;for(x=0;x<p.length;x++){var F=p[x];if(!re(h[F],J[F]))return!1}return!0}return!1}function Z(h){return typeof h=="object"&&h!==null&&"then"in h&&typeof h.then=="function"}function I(h){var J=[];for(let x of h)J.push(x);return J}return{isNumeric:E,isArrayOfStrings:M,isArrayOfNumbers:ue,createSequence:z,isSequence:ne,isFunction:S,isLambda:T,isIterable:_,getFunctionArity:w,isDeepEqual:re,stringToArray:I,isPromise:Z}})();be.exports=we},{}]},{},[3])(3)})});var St=Lt(Dt(),1),Ot=class extends EventTarget{#e=!1;#t={};constructor(K={}){super(),Y(K,["object"],"Invalid type for config"),Y(K.functions,["object","undefined"],"Invalid type for config.functions");let De=K.functions??{};for(let m of Object.keys(De))Y(De[m],["function"],`Invalid type for config.functions["${m}"]`);this.#t=De}run(K={},De={},m={}){return new Promise((be,Be)=>{let we=new Set,E=new Set,M=new Set,ue=new Set,z=new Map,ne=new Set,S=new Set,w=new Set,T=new Set,j=[],_=K?.functions??{},re=K?.events??{},Z=K?.connections??[],I=De?.signal,h=(n,b)=>this.dispatchEvent(new CustomEvent("logs",{detail:{level:{ALL:0,DEBUG:1,INFO:2,WARN:3,ERROR:4,FATAL:5}[n],type:n,message:b}})),J=(n,b,U)=>{let N=U===null?{}:(m.waitings??=new Array(Z.length),m.waitings[U]??={}),P=n.reduce((d,a)=>(d[a]=(d[a]??0)+1,d),{}),l=d=>{let a=d.detail;if((N[d.type]??=[]).push(a),U===null&&(m.receiveds??={},m.receiveds[d.type]??=[]).push(a),h("INFO",U!=null?`Connection ${U} received event ${d.type}`:`Received event ${d.type}`),h("DEBUG",`${d.type} detail:`),h("DEBUG",a),Object.keys(P).map(k=>N[k]&&N[k].length>=P[k]).every(Boolean)){let k=n.map(A=>N[A].shift());Object.keys(N).forEach(A=>N[A].length===0?delete N[A]:null),b(k)}else $()};for(let d of n)this.addEventListener(d,l),j.push({event:d,callback:l})},x=()=>{h("INFO","clearListeners");for(let n of j)this.removeEventListener(n.event,n.callback);j=[],I&&I instanceof AbortSignal&&I.removeEventListener("abort",fe)},p=(n,b)=>{x(),n?(h("INFO","end with success"),this.dispatchEvent(new CustomEvent("success",{detail:b})),be(b)):(h("FATAL","end with error:"),h("FATAL",b.error),this.dispatchEvent(new CustomEvent("error",{detail:b})),Be(b)),h("DEBUG","state:"),h("DEBUG",b.state),this.#e=!1},$=()=>{(m.runnings??=[]).length===0&&(m.waitings??=[]).map((n,b)=>{let U=(Z[b].from??[]).reduce((d,a)=>(d[a]=(d[a]??0)+1,d),{}),N=Object.keys(U).filter(d=>U[d]>(n[F(d)?`functions.${d}`:`events.${d}`]??[]).length);h("DEBUG",`checkTerminate: connection ${b} missingFrom: ${N}`);let P=N.map(d=>F(d)!=null||re[d]?.once===!0&&z.get(d).counter>0);h("DEBUG",`checkTerminate: connection ${b} blockedFrom: ${P}`);let l=P.length===0||P.some(Boolean);return h("DEBUG",`checkTerminate: connection ${b} blocked: ${l}`),l}).every(Boolean)?p(!0,{state:m}):h("DEBUG",`checkTerminate: ${m.runnings?.length===0} `)},F=n=>_[n]?.ref?this.#t[_[n].ref]:this.#t[n],X=(n,b,U)=>{let N=U??{id:n,inputs:b};U||H(N),h("INFO",`Function ${n} start`),h("DEBUG",`Function ${n} inputs: `),h("DEBUG",b),ce(n,b).then(P=>{ke(N),Object.hasOwn(P,"result")?(h("INFO",`Function ${n} end`),h("DEBUG",`Function ${n} result:`),h("DEBUG",P.result),this.dispatchEvent(new CustomEvent(`functions.${n}`,{detail:P.result})),this.dispatchEvent(new CustomEvent("functions",{detail:{[n]:P.result}})),ne.has(n)&&Ue(n,P.result)):(h("ERROR",`Function ${n} end with errors`),h("ERROR",`Function ${n} error:`),h("ERROR",P.error),this.dispatchEvent(new CustomEvent("errors",{detail:{[n]:P.error}})),this.dispatchEvent(new CustomEvent(`errors.${n}`,{detail:P.error})),(m.errors??={},m.errors[n]??=[]).push(P.error)),$()}).catch(P=>{ke(N),p(!1,{state:m,error:P})})},ce=async(n,b)=>{let U=F(n),N=null;if(_[n]?.inputsTransformation)try{h("DEBUG",`Function ${n} inputsTransformation inputs:`),h("DEBUG",b),b=await xe(_[n]?.inputsTransformation,b),Y(b,["array"],"Invalid type returned"),h("DEBUG",`Function ${n} inputsTransformation results:`),h("DEBUG",b)}catch(P){throw h("FATAL",`Function ${n} inputsTransformation error:`),h("FATAL",P),new Error(`Function ${n} inputsTransformation: ${P.message}`)}try{N={result:await U(...b)}}catch(P){if(_[n]?.throws)throw new Error(`${n}: ${P.message??P}`);N={error:P}}if(Object.hasOwn(N,"result")&&_[n]?.outputTransformation)try{h("DEBUG",`Function ${n} outputTransformation inputs:`),h("DEBUG",N.result),N.result=await xe(_[n]?.outputTransformation,N.result),h("DEBUG",`Function ${n} outputTransformation result:`),h("DEBUG",N.result)}catch(P){throw h("FATAL",`Function ${n} outputTransformation error:`),h("FATAL",P),new Error(`Function ${n} outputTransformation: ${P.message}`)}return N},se=n=>re[n]?re[n].ref?re[n]?.ref:n:null,le=(n,b,U)=>{if(h("DEBUG",`Run ${U?'"to"':'"from"'} event ${n}`),!U&&z.has(n)&&(z.get(n).counter++,h("DEBUG",`Once Event ${n} counter: ${z.get(n).counter}`),z.get(n).counter>1)){p(!1,{state:m,error:new Error(`The events["${n}"].once == true but the event as been received ${z.get(n).counter} times`)});return}ne.has(n)&&Ue(n,b),this.dispatchEvent(new CustomEvent("events",{detail:{[n]:b}}));let N=ne.has(n)||re[n]?.ref&&U?se(n)??n:`events.${n}`;h("INFO",`Event ${N} dispatch`),h("DEBUG",`Event ${N} detail:`),h("DEBUG",b),this.dispatchEvent(new CustomEvent(N,{detail:b}))},te=(n,b,U)=>{let N=U??{id:n,inputs:b};U||H(N),h("INFO",`Connection ${n} start`),h("DEBUG",`Connection ${n} inputs:`),h("DEBUG",b),me(n,b).then(P=>{if(ke(N),h("INFO",`Connection ${n} end`),h("DEBUG",`Connection ${n} result:`),h("DEBUG",P),P.toSave)Ue(n,P.toSave);else for(let l of P.toRun)l.event?le(l.to,l.inputs,!0):X(l.to,l.inputs,void 0);Q(),$()}).catch(P=>{ke(N),p(!1,{state:m,error:P})})},me=async(n,b)=>{let U=Z[n],N=U.from??[],P=U.to??[],l=[];for(let k of b)l.push(k);let d={to:N.length>0?l.map(k=>k===null?null:[k]):new Array(P.length).fill(null).map(()=>[]),global:m.variables?.global,local:m.variables?.locals?.[n]};if(U.transition)try{let k={from:l,global:m.variables?.global,local:m.variables?.locals?.[n]};h("DEBUG",`Connection ${n} transition inputs:`),h("DEBUG",k),d=await xe(U.transition,k),h("DEBUG",`Connection ${n} transition result:`),h("DEBUG",d)}catch(k){throw h("FATAL",`Connection ${n} transition error:`),h("FATAL",k),new Error(`Connection ${n} transition: ${k.message}`)}let a=d.to;Y(d.global,["object","undefined"],`Invalid type of global variable returned by the transition of connection ${n}`),d.global&&Ge(d.global),Y(d.local,["object","undefined"],`Invalid type of local variable returned by the transition of connection ${n}`),d.local&&o(d.local,n);let y={toRun:[],toSave:null};if(P.length>0){if(Y(a,["array"],`Invalid type of "to" value returned by the transition of connection ${n}`),a.length!=P.length)throw new TypeError(`The connection ${n} transition returned "to" value must be an array of the same length of the "connection.to" array (length=${P.length}).
Returned: ${JSON.stringify(a)} (length=${a.length})`);for(let k=0;k<P.length;k++){let A=P[k],g=a[k];g!=null&&(F(A)?(Y(g,["array"],`Invalid type of "to[${k}]" value returned by the transition of connection ${n}`),y.toRun.push({event:!1,to:A,inputs:g})):y.toRun.push({event:!0,to:A,inputs:g}))}return y}else return y.toSave=a,y},xe=(n,b)=>Bt(n,b),fe=()=>p(!1,{state:m,error:I?.reason}),Q=()=>this.dispatchEvent(new CustomEvent("state.change",{detail:{state:m}})),Ue=(n,b)=>{m.finals??={},m.finals.connections??=new Array(Z.length),m.finals.events??={},m.finals.functions??={},typeof n=="number"?(m.finals.connections[n]??=[]).push(b):F(n)?(m.finals.functions[n]??=[]).push(b):(m.finals.events[n]??=[]).push(b)},H=n=>m.runnings?.push(n),ke=n=>m.runnings?.splice(m.runnings.indexOf(n),1),Ge=n=>(m.variables??={}).global=n,o=(n,b)=>(m.variables??={},m.variables.locals??=new Array(Z.length).fill(null).map(()=>({})))[b]=n;try{if(Y(K,["object"],"Invalid type for config"),Y(De,["object"],"Invalid type for options"),Y(m,["object"],"Invalid type for state"),Y(K.functions,["object","undefined"],"Invalid type for config.functions"),Y(K.events,["object","undefined"],"Invalid type for config.events"),Y(K.connections,["array","undefined"],"Invalid type for config.connections"),I&&!(I instanceof AbortSignal))throw new TypeError("The provided signal must be an instance of AbortSignal");if(this.#e)throw new Error("The Orchestration is already running");if(this.#e=!0,I&&(I.addEventListener("abort",fe,{once:!0}),I.aborted)){p(!1,{state:m,error:I.reason});return}for(let[a,y]of Z.entries()){Y(y,["object"],`Invalid type for connection[${a}]`),Y(y.from,["array","undefined"],`Invalid type for connection[${a}].from`);let k=y.from??[],A=0;k.forEach((D,B)=>{Y(D,["string"],`Invalid type for connection[${a}].from[${B}]`),we.add(D),F(D)||(M.add(D),re[D]?.once?z.set(D,{counter:0}):A++)}),Y(y.to,["array","undefined"],`Invalid type for connection[${a}].to`),(y.to??[]).forEach((D,B)=>{Y(D,["string"],`Invalid type for connection[${a}].to[${B}]`),E.add(D),F(D)||ue.add(D)}),Y(y.transition,["string","undefined"],`Invalid type for connection[${a}].transition`),k.length!==0&&J(k.map(D=>F(D)?`functions.${D}`:`events.${D}`),D=>te(a,D,void 0),a)}E.forEach(a=>{we.has(a)||ne.add(a)}),we.forEach(a=>{E.has(a)||w.add(a)}),ue.forEach(a=>{we.has(a)||S.add(a)}),M.forEach(a=>{E.has(a)||T.add(a)});let n=new Map;for(let a of M)(re[a]?.ref||T.has(a))&&(J([se(a)??a],y=>le(a,y[0],!1),null),n.set(se(a)??a,a));let b={};if(Object.keys(_).forEach(a=>{if(Y(_[a],["object"],`Invalid type for functions["${a}"]`),Y(_[a].args,["array","undefined"],`Invalid type for functions["${a}"].args`),Y(_[a].ref,["string","undefined"],`Invalid type for functions["${a}"].ref`),Y(_[a].throws,["boolean","undefined"],`Invalid type for functions["${a}"].throws`),Y(_[a].inputsTransformation,["string","undefined"],`Invalid type for functions["${a}"].inputsTransformation`),Y(_[a].outputTransformation,["string","undefined"],`Invalid type for functions["${a}"].outputTransformation`),!F(a))throw new TypeError(`Function ${a} not valid. ${_[a].ref?"The provided ref do not point to a valid function":"The parameter ref is not provided and the function name do not match any valid function"}`);_[a].args&&(b[a]=_[a].args)}),Object.keys(b).length===0&&we.forEach(a=>{F(a)&&!E.has(a)&&(b[a]=[])}),Object.keys(re).forEach(a=>{if(Y(re[a],["object"],`Invalid type for events["${a}"]`),Y(re[a].ref,["string","undefined"],`Invalid type for events["${a}"].ref`),Y(re[a].once,["boolean","undefined"],`Invalid type for events["${a}"].once`),_[a])throw new TypeError(`Invalid name for events["${a}"]. A function with the same name already exist`)}),Y(m.variables,["object","undefined"],"Invalid type for state.variables"),m.variables??={},Y(m.variables.global,["object","undefined"],"Invalid type for state.variables.global"),m.variables.global??={},Y(m.variables.locals,["array","undefined"],"Invalid type for state.variables.locals"),m.variables.locals??=new Array(Z.length).fill(null).map(()=>({})),m.variables.locals.forEach((a,y)=>Y(a,["object"],`Invalid type for state.variables.locals[${y}]`)),m.variables.locals.length!=Z.length)throw new TypeError(`Invalid length for array state.variables.locals. Expected ${Z.length} but provided ${m.variables.locals.length}`);if(Y(m.finals,["object","undefined"],"Invalid type for state.finals"),m.finals??={},Y(m.finals.connections,["array","undefined"],"Invalid type for state.finals.connections"),m.finals.connections??=new Array(Z.length),m.finals.connections.length!=Z.length)throw new TypeError(`Invalid length for array state.finals.connections. Expected ${Z.length} but provided ${m.finals.connections.length}`);m.finals.connections.forEach((a,y)=>Y(a,["array","undefined"],`Invalid type for state.finals.connections[${y}]`)),Y(m.finals.events,["object","undefined"],"Invalid type for state.finals.events"),m.finals.events??={};let U=m.finals.events;Object.keys(U).forEach(a=>{if(!S.has(a))throw new TypeError(`Invalid event name in state.finals.events: ${a}`);Y(U[a],["array"],`Invalid type for state.finals.events["${a}"]`)}),Y(m.finals.functions,["object","undefined"],"Invalid type for state.finals.functions"),m.finals.functions??={};let N=m.finals.functions;Object.keys(N).forEach(a=>{if(!F(a))throw new TypeError(`Invalid function name in state.finals.functions: ${a}`);Y(N[a],["array"],`Invalid type for state.finals.functions["${a}"]`)}),Y(m.errors,["object","undefined"],"Invalid type for state.errors"),m.errors??={};let P=m.errors;if(Object.keys(m.errors).forEach(a=>{if(!F(a))throw new TypeError(`Invalid function name in state.errors: ${a}`);Y(P[a],["array"],`Invalid type for state.errors["${a}"]`)}),Y(m.waitings,["array","undefined"],"Invalid type for state.waitings"),m.waitings??=new Array(Z.length).fill(null).map(()=>({})),m.waitings.length!=Z.length)throw new TypeError(`Invalid length for array state.waitings. Expected ${Z.length} but provided ${m.waitings.length}`);m.waitings.forEach((a,y)=>{Y(a,["object"],`Invalid type for state.waitings[${y}]`),Object.keys(a).forEach(k=>{let A=k.split(".");if(A[0]==="functions"&&!F(A[1])||A[0]==="events"&&!M.has(A[1]))throw new TypeError(`Invalid name in state.waitings[${y}]: ${k}`);Y(a[k],["array"],`Invalid type for state.waitings[${y}]["${k}"]`),A[0]==="events"&&z.has(A[1])&&z.get(A[1]).counter===0&&(z.get(A[1]).counter=a[k].length)})}),Y(m.runnings,["array","undefined"],"Invalid type for state.runnings"),m.runnings??=[],m.runnings.forEach((a,y)=>{Y(a,["object"],`Invalid type for state.runnings[${y}]`),Y(a.id,["string","number"],`Invalid type for state.runnings[${y}].id`),Y(a.inputs,["array"],`Invalid type for state.runnings[${y}].inputs`)}),Y(m.receiveds,["object","undefined"],"Invalid type for state.receiveds"),m.receiveds??={};let l=m.receiveds;if(Object.keys(m.receiveds).forEach(a=>{if(!n.has(a))throw new TypeError(`Invalid event name in state.receiveds: ${a}`);Y(l[a],["array"],`Invalid type for state.receiveds["${a}"]`);let y=n.get(a);z.has(y)&&z.get(y).counter===0&&(z.get(y).counter=l[a].length)}),m.runnings.length>0||m.waitings.map(a=>Object.keys(a).length>0).some(Boolean)||Object.keys(m.errors).length>0||Object.keys(m.finals.functions).length>0||Object.keys(m.finals.events).length>0||m.finals.connections.map(a=>a&&a.length>0).some(Boolean))for(let a of m.runnings)typeof a.id=="string"?X(a.id,a.inputs,a):te(a.id,a.inputs,a);else for(let a of Object.keys(b))X(a,b[a],void 0);for(let[a,y]of Z.entries())(y.from??[]).length===0&&te(a,[],void 0);$()}catch(n){p(!1,{state:m,error:n})}})}};async function Bt(he,K){let De={},m=M=>{let ue=typeof M;if(ue==="function"||ue==="symbol"){let z=globalThis.crypto.randomUUID();return De[z]=M,z}else if(ue==="object"){if(M===null)return null;let z=Array.isArray(M),ne=z?[]:{};for(let S of z?M:Object.keys(M))z?ne.push(m(S)):ne[S]=m(M[S]);return ne}else return M},be=M=>{let ue=typeof M;if(ue==="string"){for(let z of Object.keys(De))if(M===z)return De[z];return M}else if(ue==="object"){if(M===null)return null;let z=Array.isArray(M),ne=z?[]:{};for(let S of z?M:Object.keys(M))z?ne.push(be(S)):ne[S]=be(M[S]);return ne}else return M},Be=m(K),we=await(0,St.default)(he).evaluate(Be);return be(we)}function Y(he,K,De="Error"){let m=Array.isArray(he)?"array":typeof he;if(!(he===void 0&&K.includes("undefined"))){if(he==null)throw new TypeError(`${De}. Missing required value`);if(!K.includes(m))throw new TypeError(`${De}. Expected ${K.join(" or ")} but provided ${m}: ${JSON.stringify(he)}`)}}export{Ot as Orchestrator};
//# sourceMappingURL=index.min.js.map
